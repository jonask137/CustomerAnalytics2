<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Probabilistic Models for Customer Analytics | Customer Analytics</title>
  <meta name="description" content="4 Probabilistic Models for Customer Analytics | Customer Analytics" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Probabilistic Models for Customer Analytics | Customer Analytics" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Probabilistic Models for Customer Analytics | Customer Analytics" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="recommender-systems-and-customer-targeting.html"/>
<link rel="next" href="customer-behavior.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script>
<link href="libs/vis-4.20.1/vis.css" rel="stylesheet" />
<script src="libs/vis-4.20.1/vis.min.js"></script>
<script src="libs/visNetwork-binding-2.0.9/visNetwork.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>setup</a></li>
<li class="chapter" data-level="1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html"><i class="fa fa-check"></i><b>1</b> Customer Lifetime Value</a>
<ul>
<li class="chapter" data-level="1.1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#non-contractual-the-matrix-formulation-migration-model"><i class="fa fa-check"></i><b>1.1</b> Non-contractual: The matrix formulation (Migration model)</a></li>
<li class="chapter" data-level="1.2" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#contractual-valuing-customer-base-residual-lifetime-value"><i class="fa fa-check"></i><b>1.2</b> Contractual: Valuing customer base + residual lifetime value</a></li>
<li class="chapter" data-level="1.3" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#non-contractual-setting-probabilitic-models"><i class="fa fa-check"></i><b>1.3</b> Non-Contractual Setting: Probabilitic Models</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#paretonbd-vs.-bgnbd"><i class="fa fa-check"></i><b>1.3.1</b> Pareto/NBD vs. BG/NBD</a></li>
<li class="chapter" data-level="1.3.2" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#paretonbd"><i class="fa fa-check"></i><b>1.3.2</b> Pareto/NBD</a>
<ul>
<li class="chapter" data-level="1.3.2.1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#data-preparation"><i class="fa fa-check"></i><b>1.3.2.1</b> Data preparation</a></li>
<li class="chapter" data-level="1.3.2.2" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#parameter-estimation"><i class="fa fa-check"></i><b>1.3.2.2</b> Parameter Estimation</a></li>
<li class="chapter" data-level="1.3.2.3" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#individual-level-estimations"><i class="fa fa-check"></i><b>1.3.2.3</b> Individual Level Estimations</a></li>
<li class="chapter" data-level="1.3.2.4" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#plotting-goodness-of-fit"><i class="fa fa-check"></i><b>1.3.2.4</b> Plotting / Goodness-of-fit</a></li>
</ul></li>
<li class="chapter" data-level="1.3.3" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#bgnbd"><i class="fa fa-check"></i><b>1.3.3</b> BG/NBD</a>
<ul>
<li class="chapter" data-level="1.3.3.1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#data-preparation-1"><i class="fa fa-check"></i><b>1.3.3.1</b> Data Preparation</a></li>
<li class="chapter" data-level="1.3.3.2" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#parameter-estimation-1"><i class="fa fa-check"></i><b>1.3.3.2</b> Parameter Estimation</a></li>
<li class="chapter" data-level="1.3.3.3" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#individual-level-estimation"><i class="fa fa-check"></i><b>1.3.3.3</b> Individual Level Estimation</a></li>
<li class="chapter" data-level="1.3.3.4" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#plotting-goodness-of-fit-1"><i class="fa fa-check"></i><b>1.3.3.4</b> Plotting / Goodness-of-fit</a></li>
</ul></li>
<li class="chapter" data-level="1.3.4" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#bgbb---not-curicullum"><i class="fa fa-check"></i><b>1.3.4</b> BG/BB - Not curicullum</a></li>
<li class="chapter" data-level="1.3.5" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#examples-from-the-lecture"><i class="fa fa-check"></i><b>1.3.5</b> Examples from the lecture</a>
<ul>
<li class="chapter" data-level="1.3.5.1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#paretonbd-1"><i class="fa fa-check"></i><b>1.3.5.1</b> Pareto/NBD</a>
<ul>
<li class="chapter" data-level="1.3.5.1.1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#estimate-parameters-for-paretonbd-model-based-upon-calibration-data"><i class="fa fa-check"></i><b>1.3.5.1.1</b> Estimate parameters for Pareto/NBD model based upon calibration data</a></li>
</ul></li>
<li class="chapter" data-level="1.3.5.2" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#dert-calculation"><i class="fa fa-check"></i><b>1.3.5.2</b> DERT Calculation</a></li>
<li class="chapter" data-level="1.3.5.3" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#bgnbg-example"><i class="fa fa-check"></i><b>1.3.5.3</b> BG/NBG example</a></li>
</ul></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html"><i class="fa fa-check"></i><b>2</b> Customer Satisfaction and Loyalty</a>
<ul>
<li class="chapter" data-level="2.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#customer-surveys"><i class="fa fa-check"></i><b>2.1</b> Customer surveys</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#concepts-and-examples"><i class="fa fa-check"></i><b>2.1.1</b> (1) Concepts and examples</a></li>
<li class="chapter" data-level="2.1.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#sampling-and-response-rate"><i class="fa fa-check"></i><b>2.1.2</b> (2) Sampling and response rate</a></li>
<li class="chapter" data-level="2.1.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#pretesting-and-measurement-validity"><i class="fa fa-check"></i><b>2.1.3</b> (3) Pretesting and measurement validity</a></li>
<li class="chapter" data-level="2.1.4" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#questionnaire-design"><i class="fa fa-check"></i><b>2.1.4</b> (4) Questionnaire design</a></li>
<li class="chapter" data-level="2.1.5" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#simple-size"><i class="fa fa-check"></i><b>2.1.5</b> (5) Simple size</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#nps"><i class="fa fa-check"></i><b>2.2</b> NPS</a></li>
<li class="chapter" data-level="2.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#cfa-and-sem-application-lavann"><i class="fa fa-check"></i><b>2.3</b> CFA and SEM Application Lavann</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#business-problem-objectives"><i class="fa fa-check"></i><b>2.3.1</b> Business Problem &amp; Objectives</a></li>
<li class="chapter" data-level="2.3.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#data"><i class="fa fa-check"></i><b>2.3.2</b> Data</a>
<ul>
<li class="chapter" data-level="2.3.2.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#efa"><i class="fa fa-check"></i><b>2.3.2.1</b> EFA</a></li>
<li class="chapter" data-level="2.3.2.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#cfa-model"><i class="fa fa-check"></i><b>2.3.2.2</b> CFA model</a>
<ul>
<li class="chapter" data-level="2.3.2.2.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#initial-model"><i class="fa fa-check"></i><b>2.3.2.2.1</b> Initial model</a></li>
<li class="chapter" data-level="2.3.2.2.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#second-model"><i class="fa fa-check"></i><b>2.3.2.2.2</b> Second model</a>
<ul>
<li class="chapter" data-level="2.3.2.2.2.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#intepretation-of-the-model"><i class="fa fa-check"></i><b>2.3.2.2.2.1</b> Intepretation of the model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2.3.2.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#sem"><i class="fa fa-check"></i><b>2.3.2.3</b> SEM</a></li>
</ul></li>
<li class="chapter" data-level="2.3.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#plotting-the-model"><i class="fa fa-check"></i><b>2.3.3</b> Plotting the model</a></li>
<li class="chapter" data-level="2.3.4" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#consider-a-more-complex-sem-model-involving-a-mediating-effect."><i class="fa fa-check"></i><b>2.3.4</b> Consider a more complex SEM model involving a mediating effect.</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#pls"><i class="fa fa-check"></i><b>2.4</b> PLS</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#definition-of-pls"><i class="fa fa-check"></i><b>2.4.1</b> Definition of PLS</a></li>
<li class="chapter" data-level="2.4.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#when-to-use-pls-and-when-to-use-sem"><i class="fa fa-check"></i><b>2.4.2</b> When to use PLS and when to use SEM</a></li>
<li class="chapter" data-level="2.4.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#model-construction"><i class="fa fa-check"></i><b>2.4.3</b> Model construction</a></li>
<li class="chapter" data-level="2.4.4" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#model-estimation"><i class="fa fa-check"></i><b>2.4.4</b> Model Estimation</a></li>
<li class="chapter" data-level="2.4.5" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#model-evaluation"><i class="fa fa-check"></i><b>2.4.5</b> Model evaluation</a></li>
<li class="chapter" data-level="2.4.6" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#example-for-the-lecture"><i class="fa fa-check"></i><b>2.4.6</b> Example for the lecture</a>
<ul>
<li class="chapter" data-level="2.4.6.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#making-structural--and-measurement-model"><i class="fa fa-check"></i><b>2.4.6.1</b> Making structural- and measurement model</a></li>
<li class="chapter" data-level="2.4.6.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#now-we-can-estimate-the-model"><i class="fa fa-check"></i><b>2.4.6.2</b> Now we can estimate the model</a></li>
<li class="chapter" data-level="2.4.6.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#measuring-quality-of-the-constructs"><i class="fa fa-check"></i><b>2.4.6.3</b> Measuring quality of the constructs</a></li>
<li class="chapter" data-level="2.4.6.4" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#are-the-coefficients-significant"><i class="fa fa-check"></i><b>2.4.6.4</b> Are the coefficients significant?</a></li>
</ul></li>
<li class="chapter" data-level="2.4.7" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#revised-code"><i class="fa fa-check"></i><b>2.4.7</b> Revised code</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#segmentation-clustering"><i class="fa fa-check"></i><b>2.5</b> Segmentation (Clustering)</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#what-is-clustering"><i class="fa fa-check"></i><b>2.5.1</b> What is clustering</a></li>
<li class="chapter" data-level="2.5.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#clustering-techniques"><i class="fa fa-check"></i><b>2.5.2</b> Clustering techniques</a></li>
<li class="chapter" data-level="2.5.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#an-example"><i class="fa fa-check"></i><b>2.5.3</b> An example</a>
<ul>
<li class="chapter" data-level="2.5.3.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#background"><i class="fa fa-check"></i><b>2.5.3.1</b> 1. Background</a>
<ul>
<li class="chapter" data-level="2.5.3.1.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#the-primary-objective-is"><i class="fa fa-check"></i><b>2.5.3.1.1</b> 1.1. The primary objective is:</a></li>
</ul></li>
<li class="chapter" data-level="2.5.3.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#the-data-data-understanding-phase"><i class="fa fa-check"></i><b>2.5.3.2</b> 2. The data (Data Understanding Phase)</a>
<ul>
<li class="chapter" data-level="2.5.3.2.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#load-data-correctly"><i class="fa fa-check"></i><b>2.5.3.2.1</b> 2.1 Load data correctly</a></li>
<li class="chapter" data-level="2.5.3.2.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#check-if-the-data-is-numerical-or-categorical"><i class="fa fa-check"></i><b>2.5.3.2.2</b> 2.2 Check if the data is numerical or categorical</a></li>
<li class="chapter" data-level="2.5.3.2.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#missing-treatment"><i class="fa fa-check"></i><b>2.5.3.2.3</b> 2.3 Missing treatment</a></li>
<li class="chapter" data-level="2.5.3.2.4" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#select-relevant-variables"><i class="fa fa-check"></i><b>2.5.3.2.4</b> 2.4 Select relevant variables</a></li>
<li class="chapter" data-level="2.5.3.2.5" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#identify-extreme-outliers-the-most-dissimilar-customers"><i class="fa fa-check"></i><b>2.5.3.2.5</b> 2.5.Identify extreme outliers (the most dissimilar customers)</a></li>
<li class="chapter" data-level="2.5.3.2.6" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#standardize-the-variables-mean0-std.dev1"><i class="fa fa-check"></i><b>2.5.3.2.6</b> 2.6 Standardize the variables (mean=0, std.dev=1)</a></li>
</ul></li>
<li class="chapter" data-level="2.5.3.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#hierarchical-clustering-using-variables"><i class="fa fa-check"></i><b>2.5.3.3</b> 3. Hierarchical clustering (using variables)</a></li>
<li class="chapter" data-level="2.5.3.4" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#hierarchical-clustering-using-pcs-score-vectors"><i class="fa fa-check"></i><b>2.5.3.4</b> 4. Hierarchical clustering (using PCs score vectors)</a></li>
<li class="chapter" data-level="2.5.3.5" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#k-means"><i class="fa fa-check"></i><b>2.5.3.5</b> 5. K-means</a></li>
<li class="chapter" data-level="2.5.3.6" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#validation-and-profiling-the-clusters"><i class="fa fa-check"></i><b>2.5.3.6</b> 6. Validation and profiling the clusters</a>
<ul>
<li class="chapter" data-level="2.5.3.6.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#assessing-cluster-stability"><i class="fa fa-check"></i><b>2.5.3.6.1</b> 6.1. Assessing cluster stability</a></li>
<li class="chapter" data-level="2.5.3.6.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#assessing-criterion-predictive-validity"><i class="fa fa-check"></i><b>2.5.3.6.2</b> 6.2. Assessing criterion (predictive) validity</a></li>
<li class="chapter" data-level="2.5.3.6.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#profiling-the-final-cluster-solution"><i class="fa fa-check"></i><b>2.5.3.6.3</b> 6.3. Profiling the final cluster solution</a></li>
</ul></li>
<li class="chapter" data-level="2.5.3.7" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#final-remarks"><i class="fa fa-check"></i><b>2.5.3.7</b> 7. Final remarks</a></li>
</ul></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html"><i class="fa fa-check"></i><b>3</b> Recommender Systems and Customer Targeting</a>
<ul>
<li class="chapter" data-level="3.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#association-rule"><i class="fa fa-check"></i><b>3.1</b> Association rule</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#loading-and-data-exploration"><i class="fa fa-check"></i><b>3.1.1</b> Loading and data exploration</a></li>
<li class="chapter" data-level="3.1.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#data-preprocessing"><i class="fa fa-check"></i><b>3.1.2</b> Data preprocessing</a>
<ul>
<li class="chapter" data-level="3.1.2.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#encoding-to-correct-data-types"><i class="fa fa-check"></i><b>3.1.2.1</b> Encoding to correct data types</a></li>
<li class="chapter" data-level="3.1.2.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#create-a-data-frame-with-one-row-pr.-invoice"><i class="fa fa-check"></i><b>3.1.2.2</b> Create a data frame with one row pr. invoice</a></li>
</ul></li>
<li class="chapter" data-level="3.1.3" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#loading-transactions"><i class="fa fa-check"></i><b>3.1.3</b> Loading transactions</a></li>
<li class="chapter" data-level="3.1.4" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#plotting"><i class="fa fa-check"></i><b>3.1.4</b> Plotting</a></li>
<li class="chapter" data-level="3.1.5" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#apriori-calculation"><i class="fa fa-check"></i><b>3.1.5</b> Apriori calculation</a>
<ul>
<li class="chapter" data-level="3.1.5.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#another-example-where-maxlen-3"><i class="fa fa-check"></i><b>3.1.5.1</b> Another example where maxlen = 3</a></li>
<li class="chapter" data-level="3.1.5.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#filtering-on-right-hand-side.-an-example-with-the-item-metal"><i class="fa fa-check"></i><b>3.1.5.2</b> Filtering on right hand side. An example with the item {METAL}</a></li>
<li class="chapter" data-level="3.1.5.3" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#filtering-on-left-hand-side.-an-example-with-the-item-metal"><i class="fa fa-check"></i><b>3.1.5.3</b> Filtering on left hand side. An example with the item {METAL}</a></li>
</ul></li>
<li class="chapter" data-level="3.1.6" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#plotting-association-rules"><i class="fa fa-check"></i><b>3.1.6</b> Plotting association rules</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#colaborative-filtering"><i class="fa fa-check"></i><b>3.2</b> Colaborative filtering</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#loading-and-formatting-data"><i class="fa fa-check"></i><b>3.2.1</b> Loading and formatting data</a>
<ul>
<li class="chapter" data-level="3.2.1.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#loading-metadata-that-gets-loaded-with-main-dataset"><i class="fa fa-check"></i><b>3.2.1.1</b> Loading metadata that gets loaded with main dataset</a></li>
</ul></li>
<li class="chapter" data-level="3.2.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#data-exploration"><i class="fa fa-check"></i><b>3.2.2</b> Data Exploration</a>
<ul>
<li class="chapter" data-level="3.2.2.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#plotting-1"><i class="fa fa-check"></i><b>3.2.2.1</b> Plotting</a></li>
</ul></li>
<li class="chapter" data-level="3.2.3" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#what-models-can-we-use"><i class="fa fa-check"></i><b>3.2.3</b> What models can we use?</a></li>
<li class="chapter" data-level="3.2.4" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#training-and-test-set"><i class="fa fa-check"></i><b>3.2.4</b> Training and test set</a></li>
<li class="chapter" data-level="3.2.5" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#a-small-example-with-ibcf-item-based"><i class="fa fa-check"></i><b>3.2.5</b> A small example with IBCF (item based)</a></li>
<li class="chapter" data-level="3.2.6" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#ubcf---user-based-collaborative-based"><i class="fa fa-check"></i><b>3.2.6</b> UBCF - User based collaborative based</a>
<ul>
<li class="chapter" data-level="3.2.6.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#fitting-the-model"><i class="fa fa-check"></i><b>3.2.6.1</b> Fitting the model</a></li>
<li class="chapter" data-level="3.2.6.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#predicting-making-recommendations"><i class="fa fa-check"></i><b>3.2.6.2</b> Predicting (making) recommendations</a></li>
</ul></li>
<li class="chapter" data-level="3.2.7" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#cross-validation"><i class="fa fa-check"></i><b>3.2.7</b> Cross validation</a></li>
<li class="chapter" data-level="3.2.8" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#ibcf---item-based-collaborative-based"><i class="fa fa-check"></i><b>3.2.8</b> IBCF - Item based collaborative based</a>
<ul>
<li class="chapter" data-level="3.2.8.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#fitting-the-model-using-cv"><i class="fa fa-check"></i><b>3.2.8.1</b> Fitting the model (using CV)</a></li>
<li class="chapter" data-level="3.2.8.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#making-predictions"><i class="fa fa-check"></i><b>3.2.8.2</b> Making predictions</a></li>
<li class="chapter" data-level="3.2.8.3" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#performance-metrics"><i class="fa fa-check"></i><b>3.2.8.3</b> Performance metrics</a></li>
</ul></li>
<li class="chapter" data-level="3.2.9" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#building-roc-curve-and-precision-recall-rate"><i class="fa fa-check"></i><b>3.2.9</b> Building ROC curve and precision / recall rate</a></li>
<li class="chapter" data-level="3.2.10" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#comparing-ubcf-and-ibcf"><i class="fa fa-check"></i><b>3.2.10</b> Comparing UBCF and IBCF</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#latent-factor-models"><i class="fa fa-check"></i><b>3.3</b> Latent Factor Models</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#fitting-the-model-1"><i class="fa fa-check"></i><b>3.3.1</b> Fitting the model</a></li>
<li class="chapter" data-level="3.3.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#making-predictions-1"><i class="fa fa-check"></i><b>3.3.2</b> Making predictions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html"><i class="fa fa-check"></i><b>4</b> Probabilistic Models for Customer Analytics</a>
<ul>
<li class="chapter" data-level="4.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#bayesian-networks"><i class="fa fa-check"></i><b>4.1</b> Bayesian Networks</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#why-bayesian"><i class="fa fa-check"></i><b>4.1.1</b> <strong><em>Why Bayesian?</em></strong></a>
<ul>
<li class="chapter" data-level="4.1.1.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#many-names-for-bayesian-networks"><i class="fa fa-check"></i><b>4.1.1.1</b> <strong>Many names for Bayesian Networks</strong></a></li>
</ul></li>
<li class="chapter" data-level="4.1.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#terms-and-explanatory-examples"><i class="fa fa-check"></i><b>4.1.2</b> Terms and explanatory examples</a>
<ul>
<li class="chapter" data-level="4.1.2.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#types-of-connections"><i class="fa fa-check"></i><b>4.1.2.1</b> Types of connections</a></li>
<li class="chapter" data-level="4.1.2.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#variable-selection-based-on-a-bayesian-network"><i class="fa fa-check"></i><b>4.1.2.2</b> Variable selection based on a Bayesian Network</a></li>
</ul></li>
<li class="chapter" data-level="4.1.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#independence"><i class="fa fa-check"></i><b>4.1.3</b> Independence</a></li>
<li class="chapter" data-level="4.1.4" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#methods-for-identifying-the-network"><i class="fa fa-check"></i><b>4.1.4</b> Methods for identifying the network</a>
<ul>
<li class="chapter" data-level="4.1.4.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#algorithms-focused-on-causality-discovery"><i class="fa fa-check"></i><b>4.1.4.1</b> 1. <strong><em>Algorithms focused on causality discovery</em></strong></a></li>
<li class="chapter" data-level="4.1.4.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#algorithms-focused-on-prediction"><i class="fa fa-check"></i><b>4.1.4.2</b> 2. <strong><em>Algorithms focused on prediction</em></strong></a></li>
</ul></li>
<li class="chapter" data-level="4.1.5" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#real-life-application"><i class="fa fa-check"></i><b>4.1.5</b> <strong>Real life application</strong></a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#application-1-explaining-and-predicting-customer-retention-in-a-virtual-community"><i class="fa fa-check"></i><b>4.2</b> Application 1: Explaining and Predicting Customer Retention in a Virtual Community</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#getting-the-structure"><i class="fa fa-check"></i><b>4.2.1</b> 1. Getting the structure</a>
<ul>
<li class="chapter" data-level="4.2.1.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#a.-building-the-structure-and-parameters-manually"><i class="fa fa-check"></i><b>4.2.1.1</b> A. Building the structure and parameters manually</a>
<ul>
<li class="chapter" data-level="4.2.1.1.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#approaches-to-make-the-network"><i class="fa fa-check"></i><b>4.2.1.1.1</b> Approaches to make the network</a>
<ul>
<li class="chapter" data-level="4.2.1.1.1.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#i-first-approach"><i class="fa fa-check"></i><b>4.2.1.1.1.1</b> (i) First approach</a></li>
<li class="chapter" data-level="4.2.1.1.1.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#ii-second-approach"><i class="fa fa-check"></i><b>4.2.1.1.1.2</b> (ii) Second approach</a></li>
<li class="chapter" data-level="4.2.1.1.1.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#iii-third-approach"><i class="fa fa-check"></i><b>4.2.1.1.1.3</b> (iii) Third approach</a></li>
</ul></li>
<li class="chapter" data-level="4.2.1.1.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#loadingentering-data"><i class="fa fa-check"></i><b>4.2.1.1.2</b> Loading/entering data</a></li>
<li class="chapter" data-level="4.2.1.1.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#conditional-probability-table-cpt"><i class="fa fa-check"></i><b>4.2.1.1.3</b> Conditional probability table (CPT)</a></li>
</ul></li>
<li class="chapter" data-level="4.2.1.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#b.-learning-the-structure-and-parameters-from-observational-data"><i class="fa fa-check"></i><b>4.2.1.2</b> B. Learning the structure and parameters from observational data</a>
<ul>
<li class="chapter" data-level="4.2.1.2.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#grow-shrink-gs---learning-a-structure-using-a-constrained-based-algorithm"><i class="fa fa-check"></i><b>4.2.1.2.1</b> Grow-shrink (gs) - Learning a structure using a constrained-based algorithm</a>
<ul>
<li class="chapter" data-level="4.2.1.2.1.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#identifying-undirectred-links"><i class="fa fa-check"></i><b>4.2.1.2.1.1</b> Identifying undirectred links</a></li>
</ul></li>
<li class="chapter" data-level="4.2.1.2.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#hill-climbing-hc---learning-the-structure-using-a-score-based-algorithm"><i class="fa fa-check"></i><b>4.2.1.2.2</b> Hill-Climbing (hc) - Learning the structure using a score-based algorithm</a></li>
<li class="chapter" data-level="4.2.1.2.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#fitting-the-model-to-the-data-learning-the-probabilities"><i class="fa fa-check"></i><b>4.2.1.2.3</b> Fitting the model to the data (learning the probabilities)</a></li>
<li class="chapter" data-level="4.2.1.2.4" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#alternatives-to-grow-shrink-and-hc"><i class="fa fa-check"></i><b>4.2.1.2.4</b> Alternatives to Grow-Shrink and HC</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4.2.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#model-evaluation-1"><i class="fa fa-check"></i><b>4.2.2</b> 2. Model evaluation</a>
<ul>
<li class="chapter" data-level="4.2.2.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#i.-metrics-of-model-complexity"><i class="fa fa-check"></i><b>4.2.2.1</b> I. Metrics of model complexity</a></li>
<li class="chapter" data-level="4.2.2.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#ii.-metrics-of-model-sensitivity"><i class="fa fa-check"></i><b>4.2.2.2</b> II. Metrics of model sensitivity</a></li>
<li class="chapter" data-level="4.2.2.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#iii.-evaluate-the-arc.strength"><i class="fa fa-check"></i><b>4.2.2.3</b> III. Evaluate the arc.strength()</a>
<ul>
<li class="chapter" data-level="4.2.2.3.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#for-the-growth-shrink"><i class="fa fa-check"></i><b>4.2.2.3.1</b> For the growth shrink</a></li>
<li class="chapter" data-level="4.2.2.3.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#for-the-hill-climbing-structure"><i class="fa fa-check"></i><b>4.2.2.3.2</b> For the hill-climbing structure</a></li>
<li class="chapter" data-level="4.2.2.3.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#different-information-criteria-evaluations"><i class="fa fa-check"></i><b>4.2.2.3.3</b> Different information criteria evaluations</a></li>
</ul></li>
<li class="chapter" data-level="4.2.2.4" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#iv.-metrics-of-predictive-accuracy-error-rate-confusion-matrix-auc"><i class="fa fa-check"></i><b>4.2.2.4</b> IV. Metrics of predictive accuracy (error rate, confusion matrix, AUC)</a>
<ul>
<li class="chapter" data-level="4.2.2.4.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#cross-validation-1"><i class="fa fa-check"></i><b>4.2.2.4.1</b> Cross validation</a></li>
<li class="chapter" data-level="4.2.2.4.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#alternative-approach-to-fit-and-predict-without-grain"><i class="fa fa-check"></i><b>4.2.2.4.2</b> Alternative approach to fit and predict (Without gRain)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4.2.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#making-inference-and-queries-based-on-the-model"><i class="fa fa-check"></i><b>4.2.3</b> 3. Making inference and queries based on the model</a>
<ul>
<li class="chapter" data-level="4.2.3.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#diagnostics-forward-inference"><i class="fa fa-check"></i><b>4.2.3.1</b> Diagnostics (Forward inference)</a>
<ul>
<li class="chapter" data-level="4.2.3.1.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#let-us-repeat-the-same-analysis-by-setting-evidence-in-pleasure"><i class="fa fa-check"></i><b>4.2.3.1.1</b> <em>let us repeat the same analysis by setting evidence in Pleasure</em></a></li>
</ul></li>
<li class="chapter" data-level="4.2.3.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#diagnostic-backward-inference"><i class="fa fa-check"></i><b>4.2.3.2</b> Diagnostic (Backward inference)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#application-2-identifying-populations-with-positive-expected-lift-in-profit-elp-and-targeting"><i class="fa fa-check"></i><b>4.3</b> Application 2: Identifying populations with Positive Expected Lift in Profit (ELP) and targeting</a></li>
<li class="chapter" data-level="4.4" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#application-3-product-recommendation-using-probabilistic-models-bn"><i class="fa fa-check"></i><b>4.4</b> Application 3: Product Recommendation using Probabilistic Models (BN)</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#method-1-learn-the-probabilistic-relationships-using-a-bayesian-network-learning"><i class="fa fa-check"></i><b>4.4.1</b> Method 1: Learn the probabilistic relationships using a Bayesian network learning</a></li>
<li class="chapter" data-level="4.4.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#method-2-finding-latent-segments"><i class="fa fa-check"></i><b>4.4.2</b> Method 2: Finding latent segments</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#latent-models-for-cross-selling-and-acquisition-sequence"><i class="fa fa-check"></i><b>4.5</b> Latent models for cross selling and acquisition sequence</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#latent-trait-model---applying-the-ltm-package-in-r"><i class="fa fa-check"></i><b>4.5.1</b> Latent Trait Model - Applying the LTM Package in R</a></li>
<li class="chapter" data-level="4.5.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#the-latent-hidden-markov-model"><i class="fa fa-check"></i><b>4.5.2</b> The latent (hidden) Markov model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="customer-behavior.html"><a href="customer-behavior.html"><i class="fa fa-check"></i><b>5</b> Customer behavior</a>
<ul>
<li class="chapter" data-level="5.1" data-path="customer-behavior.html"><a href="customer-behavior.html#characteristics-of-cliskstream"><i class="fa fa-check"></i><b>5.1</b> Characteristics of cliskstream</a></li>
<li class="chapter" data-level="5.2" data-path="customer-behavior.html"><a href="customer-behavior.html#applications-with-clickstream-data"><i class="fa fa-check"></i><b>5.2</b> Applications with clickstream data</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="customer-behavior.html"><a href="customer-behavior.html#a-motivating-example"><i class="fa fa-check"></i><b>5.2.1</b> A motivating example</a>
<ul>
<li class="chapter" data-level="5.2.1.1" data-path="customer-behavior.html"><a href="customer-behavior.html#i-predict-either-the-next-click-or-the-ﬁnal-click-state-of-a-customer."><i class="fa fa-check"></i><b>5.2.1.1</b> i) Predict either the next click or the ﬁnal click (state) of a customer.</a></li>
<li class="chapter" data-level="5.2.1.2" data-path="customer-behavior.html"><a href="customer-behavior.html#ii-clustering-and-generalizing-upon-clickstreams"><i class="fa fa-check"></i><b>5.2.1.2</b> ii) Clustering and generalizing upon clickstreams</a></li>
</ul></li>
<li class="chapter" data-level="5.2.2" data-path="customer-behavior.html"><a href="customer-behavior.html#second-exercise-clickstream-more-extensive"><i class="fa fa-check"></i><b>5.2.2</b> Second exercise (clickstream) more extensive</a></li>
<li class="chapter" data-level="5.2.3" data-path="customer-behavior.html"><a href="customer-behavior.html#a-concrete-eaxmple-with-real-data"><i class="fa fa-check"></i><b>5.2.3</b> A concrete eaxmple with real data</a>
<ul>
<li class="chapter" data-level="5.2.3.1" data-path="customer-behavior.html"><a href="customer-behavior.html#markov-chain"><i class="fa fa-check"></i><b>5.2.3.1</b> (1) Markov Chain</a></li>
<li class="chapter" data-level="5.2.3.2" data-path="customer-behavior.html"><a href="customer-behavior.html#using-association-rule-mining"><i class="fa fa-check"></i><b>5.2.3.2</b> (2) Using association rule mining</a></li>
<li class="chapter" data-level="5.2.3.3" data-path="customer-behavior.html"><a href="customer-behavior.html#use-frequencies-instead-of-the-sequence"><i class="fa fa-check"></i><b>5.2.3.3</b> (3) Use frequencies instead of the sequence</a></li>
<li class="chapter" data-level="5.2.3.4" data-path="customer-behavior.html"><a href="customer-behavior.html#neural-networks"><i class="fa fa-check"></i><b>5.2.3.4</b> (4) Neural networks</a></li>
</ul></li>
<li class="chapter" data-level="5.2.4" data-path="customer-behavior.html"><a href="customer-behavior.html#optional-exercise"><i class="fa fa-check"></i><b>5.2.4</b> Optional exercise</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="customer-behavior.html"><a href="customer-behavior.html#ab-testing"><i class="fa fa-check"></i><b>5.3</b> AB Testing</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="customer-behavior.html"><a href="customer-behavior.html#what-is-it-and-when-to-apply-it"><i class="fa fa-check"></i><b>5.3.1</b> (1 + 2): What is it and when to apply it</a></li>
<li class="chapter" data-level="5.3.2" data-path="customer-behavior.html"><a href="customer-behavior.html#how-to-perform-an-ab-test"><i class="fa fa-check"></i><b>5.3.2</b> (3): How to perform an A/B test</a></li>
<li class="chapter" data-level="5.3.3" data-path="customer-behavior.html"><a href="customer-behavior.html#pitfalls-and-challenges."><i class="fa fa-check"></i><b>5.3.3</b> (4): Pitfalls and challenges.</a></li>
<li class="chapter" data-level="5.3.4" data-path="customer-behavior.html"><a href="customer-behavior.html#ab-tests-and-bandits."><i class="fa fa-check"></i><b>5.3.4</b> (5): A/B tests and bandits.</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Customer Analytics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="probabilistic-models-for-customer-analytics" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Probabilistic Models for Customer Analytics</h1>
<div id="bayesian-networks" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Bayesian Networks</h2>
<p><strong><em>Why do we use bayesian network analysis?</em></strong></p>
<p>We have seen EFA, CFA and lastly SEM, which are structural models where you assume relationships among variables. Bayesian network is applied to <em>identify causality</em> in the data.</p>
<p>Notice that Bayesian Networks ONLY deals with categorical data, hence if you are given a continous dataset, then you want to encode it as factors before modeling, e.g., in ordered categories, non-ordered, or as binary.</p>
<div id="why-bayesian" class="section level3" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> <strong><em>Why Bayesian?</em></strong></h3>
<p>We apply the bayes theorem to update probabilities in light of new evidence. A quick summary:</p>
<p><span class="math display">\[P(A|B) = P(A)\frac{P(B|A)}{P(B)}\]</span></p>
<p>Where we see A is the outcome given event B happening. This means:</p>
<ul>
<li><span class="math inline">\(P(A)\)</span> = prior, i.e., unconditional probability, hence not accounting for event B.</li>
<li><span class="math inline">\(P(A|B)\)</span> = the posterior, i.e., conditional probaiblity, here we account for event A happening given event B is happening.</li>
<li><span class="math inline">\(P(B)\)</span> = Plausible cause, i.e., the predictor.</li>
<li><span class="math inline">\(P(B|A)\)</span> = The likelihood, i.e., conditional probability of B given that event A occurs.</li>
</ul>
<p>We should notice that this assumes that there is a dependency between the variables. As if there were no dependence then event A happening given event B happening is not changed at all, for instance wind gusts in Denmark and temperature in Denmark must have a dependency on each other, e.g., when it is very windy it is probable that the temperature will decrease. Although when it is windy in Australia one may not infer a relationship between these two variables. This could also be written with <span class="math inline">\(P(A|B) = P(Y)\)</span>, as event B has no effect at all.</p>
<div id="many-names-for-bayesian-networks" class="section level4" number="4.1.1.1">
<h4><span class="header-section-number">4.1.1.1</span> <strong>Many names for Bayesian Networks</strong></h4>
<ul>
<li>Causal probabilistic networks</li>
<li>Probabilistic graphical models</li>
<li>Bayesian Belief networks</li>
<li>Causal networks</li>
<li>Directed graphs</li>
<li>Probabilistic expert systems</li>
<li>Influence diagrams</li>
</ul>
</div>
</div>
<div id="terms-and-explanatory-examples" class="section level3" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Terms and explanatory examples</h3>
<p>Whe have the following <strong>terms:</strong></p>
<ul>
<li>DAG: Directed Acyclic Graph: meaning that we have graphs with directed arrows that cannot lead to cycles. Within the structure we have the following terms:
<ul>
<li>Nodes = variable</li>
<li>Arcs = links = relationships (the arrows)</li>
<li>Path = A path where you are only able to directions of the arrows.</li>
<li>Chain = This is path, but you are not constrained to following the directions.</li>
<li>A cycle = that would be that a path is starting and able to end in the same node. in BN we are not able to have these instances.</li>
<li>Connected graph = Where all nodes are connected</li>
<li>Empty graph = A graph with nodes, but not with arcs.</li>
</ul></li>
<li>Multivariate analysis: Where the graph is the means and the variable relationships the ends.</li>
<li>Bayesian Networks is a stochastic data-mining technique. It applies different elements to construct the model.</li>
</ul>
<p>We see in the following picture, that there is a relationship from Job down to Credit. These we call the parent and the child (root and non-root). Hence it is clear the the direction is also from Job to Credit.</p>
<div class="figure">
<img src="images/BN1.png" alt="" />
<p class="caption">Simple example of a Bayesian network</p>
</div>
<p>It can be seen in the model that the prior <span class="math inline">\(P(A) = 0.915\)</span>, hence a probability of approx. 91% being that you have a job. Then we see the different kinds of probabilities of B and non B (credit) given a person having a job or not having a job.</p>
<p>We see a more extensive example here:</p>
<div class="figure">
<img src="images/BNgraphexample.png" alt="" />
<p class="caption">Extensive example of a Bayesian network</p>
</div>
<p>Notice that the decendents are effetcs of the given variables, e.g., that a given season influence the probability of how it is going to rain or sprinkle etc. In general we should be able to say, that a guy has a broken leg and then we can calculate backwards what the probabilities of the different variables being occurent.</p>
<p>Recall that each connected variables (and adjacent) have a conditional probability between them, meaning that we can take the same example as above:</p>
<hr />
<p><em><strong>Example:</strong> We know a guy has broken his leg, we can now calculate backwards and use the probabilities for the certain events to get an idea of the whole situation. Hence it is probable that it was slippery, due to rain or sprinkles and ultimately due to the season, hence the information flows.</em></p>
<p><em>On the other hand, if we find out that it was in fact slippery, hence we impose <strong>evidence</strong>, i.e., control for slippery, we see that <code>broken leg</code> and <code>(sprinkle,rain)</code> is completely independent of each other, as we know that it was slippery, hence no more information is needed.</em></p>
<hr />
<div id="types-of-connections" class="section level4" number="4.1.2.1">
<h4><span class="header-section-number">4.1.2.1</span> Types of connections</h4>
<p>We have three types of connections:</p>
<ol style="list-style-type: decimal">
<li>Serial connection,</li>
<li>Explaining away (discounting),</li>
<li>Common cause (divergent)</li>
</ol>
<p>I have summarized the approaches in the following visualization and following by an example for each.</p>
<div class="figure">
<img src="images/BNconnections.png" alt="" />
<p class="caption">Examples of connections</p>
</div>
<p><em><strong>Serial connection example:</strong>We have a scenario where wet is the cause of slippery, and slippery is the cause of breaking legs. Lets say that we know that a person has a broken leg, hence we can update the probability for it being slippery and then if it was wet. this will also increase probabilities for B (slippery) and C (Wet)</em></p>
<p><em>Now lets say that we also know that it was slippery any new information about C (broken leg condition) is not changing A. And changes in A (the wet condition) will not affect C (broken leg condition) because these are now known as we found evidence, e.g., if we find out that it was not wet, but we still know that it was slippery (I guess that would also require some other relationship to B)</em></p>
<p><em><strong>Explaining away example:</strong> We have a scenario where both having covid and a cold is the cause of dry coughing, hence dry coughing being the children while the others the parents. Notice that A and B is completely independent.</em></p>
<p><em>Lets say that a person has symptoms C and we later find out that the person has covid (A). Hence we set probability of A = 100 (or in practive it would probably be 99%) then the probability of B will decrease as it is now less likely that the person is also having a could, because we have found one cause for the symptoms.</em></p>
<p><em><strong>Common cause example:</strong> We have a scenario where we have children that are related to the same parents.</em></p>
<p><em>We now know that the house is burning, this will increase the probability that of B (forgetting stove) is also higher. This leads with the probability of food being overcooked is also increasing.</em></p>
<p><em>Now lets say that we get the information that you did in fact forget the stove. Hence any new information in A (about burning house) will not change anything to the probability of C (overcooked meal)</em></p>
</div>
<div id="variable-selection-based-on-a-bayesian-network" class="section level4" number="4.1.2.2">
<h4><span class="header-section-number">4.1.2.2</span> Variable selection based on a Bayesian Network</h4>
<p>We know that a Bayesian network can be used to indentify causality and hence dependencies among variables, <em>given that we apply an algorithm for this (more about this in a later section)</em>, we can now start inferring important variables based on this.</p>
<p>But how to do this? Recall that parents are the causes while the children being the outcome. Let us say that we have a child, which we want to analyze, e.g., a burning house, and we want to explore the causes. What would be natural to do?</p>
<p>One could take the following variables:</p>
<ol style="list-style-type: decimal">
<li>The child’s parents’</li>
<li>The child’s children.</li>
<li>Other parents of the child.</li>
</ol>
<p>This is called the <strong><em>the Markov Blanket</em></strong>. Hence one is able to find the Markov Blanket of a variable, meaning identifying variables that you must find information about (hence control for, i.e., evidence) making the child conditional independent of all other variables. Meaning that any change in any given non-related variable will not affect the variable that we want to look into.</p>
<p>Therefore, Bayesian networks in combination with Markov Blanket method is a strong combination for variable selection.</p>
<p>Although one must be aware that, the Markov Blanket model build on the Markov property:</p>
<center>
<p><em>For each variable X in a graph, X is conditionally independent of the set of all nondescendents given the set of all its parents</em> That means that all we need to do is check for a nodes parents, if we can find evidance on these, then the given node is not dependent on all non descendents. In laymans words it can be said, that if a node is not a descendent (can be found by following the arc directions), then it is a nondescendent. The following draws an example.</p>
</center>
<div class="sourceCode" id="cb522"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb522-1"><a href="probabilistic-models-for-customer-analytics.html#cb522-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdag)</span>
<span id="cb522-2"><a href="probabilistic-models-for-customer-analytics.html#cb522-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb522-3"><a href="probabilistic-models-for-customer-analytics.html#cb522-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Generating the relationships</span></span>
<span id="cb522-4"><a href="probabilistic-models-for-customer-analytics.html#cb522-4" aria-hidden="true" tabindex="-1"></a>dag <span class="ot">&lt;-</span> dagitty<span class="sc">::</span><span class="fu">dagitty</span>(<span class="st">&quot;dag {</span></span>
<span id="cb522-5"><a href="probabilistic-models-for-customer-analytics.html#cb522-5" aria-hidden="true" tabindex="-1"></a><span class="st">    X -&gt; Y -&gt; W</span></span>
<span id="cb522-6"><a href="probabilistic-models-for-customer-analytics.html#cb522-6" aria-hidden="true" tabindex="-1"></a><span class="st">    X -&gt; Z -&gt; W</span></span>
<span id="cb522-7"><a href="probabilistic-models-for-customer-analytics.html#cb522-7" aria-hidden="true" tabindex="-1"></a><span class="st">    X -&gt; Z -&gt; V</span></span>
<span id="cb522-8"><a href="probabilistic-models-for-customer-analytics.html#cb522-8" aria-hidden="true" tabindex="-1"></a><span class="st">  }&quot;</span></span>
<span id="cb522-9"><a href="probabilistic-models-for-customer-analytics.html#cb522-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb522-10"><a href="probabilistic-models-for-customer-analytics.html#cb522-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb522-11"><a href="probabilistic-models-for-customer-analytics.html#cb522-11" aria-hidden="true" tabindex="-1"></a>tidy_dag <span class="ot">&lt;-</span> <span class="fu">tidy_dagitty</span>(dag)</span>
<span id="cb522-12"><a href="probabilistic-models-for-customer-analytics.html#cb522-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb522-13"><a href="probabilistic-models-for-customer-analytics.html#cb522-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Adding information on the color</span></span>
<span id="cb522-14"><a href="probabilistic-models-for-customer-analytics.html#cb522-14" aria-hidden="true" tabindex="-1"></a>tidy_dag<span class="sc">$</span>data <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(tidy_dag<span class="sc">$</span>data,</span>
<span id="cb522-15"><a href="probabilistic-models-for-customer-analytics.html#cb522-15" aria-hidden="true" tabindex="-1"></a>                               <span class="at">colour =</span> <span class="fu">ifelse</span>(tidy_dag<span class="sc">$</span>data<span class="sc">$</span>name <span class="sc">==</span> <span class="st">&quot;Z&quot;</span></span>
<span id="cb522-16"><a href="probabilistic-models-for-customer-analytics.html#cb522-16" aria-hidden="true" tabindex="-1"></a>                                               ,<span class="st">&quot;Reference point&quot;</span></span>
<span id="cb522-17"><a href="probabilistic-models-for-customer-analytics.html#cb522-17" aria-hidden="true" tabindex="-1"></a>                                               ,<span class="fu">ifelse</span>(tidy_dag<span class="sc">$</span>data<span class="sc">$</span>name <span class="sc">==</span> <span class="st">&quot;X&quot;</span>,<span class="st">&quot;Parent&quot;</span></span>
<span id="cb522-18"><a href="probabilistic-models-for-customer-analytics.html#cb522-18" aria-hidden="true" tabindex="-1"></a>                                                       ,<span class="fu">ifelse</span>(tidy_dag<span class="sc">$</span>data<span class="sc">$</span>name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;V&quot;</span>,<span class="st">&quot;W&quot;</span>),<span class="st">&quot;Descendent&quot;</span>,<span class="st">&quot;Non descendents&quot;</span>))))</span>
<span id="cb522-19"><a href="probabilistic-models-for-customer-analytics.html#cb522-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb522-20"><a href="probabilistic-models-for-customer-analytics.html#cb522-20" aria-hidden="true" tabindex="-1"></a><span class="co">#Making the plot</span></span>
<span id="cb522-21"><a href="probabilistic-models-for-customer-analytics.html#cb522-21" aria-hidden="true" tabindex="-1"></a>tidy_dag <span class="sc">%&gt;%</span></span>
<span id="cb522-22"><a href="probabilistic-models-for-customer-analytics.html#cb522-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(</span>
<span id="cb522-23"><a href="probabilistic-models-for-customer-analytics.html#cb522-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> x,</span>
<span id="cb522-24"><a href="probabilistic-models-for-customer-analytics.html#cb522-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> y,</span>
<span id="cb522-25"><a href="probabilistic-models-for-customer-analytics.html#cb522-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">xend =</span> xend,</span>
<span id="cb522-26"><a href="probabilistic-models-for-customer-analytics.html#cb522-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">yend =</span> yend</span>
<span id="cb522-27"><a href="probabilistic-models-for-customer-analytics.html#cb522-27" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb522-28"><a href="probabilistic-models-for-customer-analytics.html#cb522-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> colour)) <span class="sc">+</span></span>
<span id="cb522-29"><a href="probabilistic-models-for-customer-analytics.html#cb522-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>() <span class="sc">+</span></span>
<span id="cb522-30"><a href="probabilistic-models-for-customer-analytics.html#cb522-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>() <span class="sc">+</span></span>
<span id="cb522-31"><a href="probabilistic-models-for-customer-analytics.html#cb522-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dag</span>()</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-242-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>We that for Z, V and W are its descendents. We see that X is its parent and Y being its ancestor i.e., nondescendent. We can make Z independent (hence it being conditionally independent of Y) of Y, if we just control for X as it is its parent.</p>
<p>This mean that the graph must include all relevant variables, hence you cannot have <em>hidden causes</em>. In such as case we cannot say that it is a complete Bayesian Network, although the model may still hold and can be used for prediction.</p>
<p>In general what we see here, is that this is no different that we have previously seen in machine learning, that you can search for the true model, although truth is utopia that can only very rarely if ever be achieved.</p>
<p><em>I am actually a bit in doubt whether this is actually a true statement I make here, perhaps one could perhaps just say that when you have found the Markov Blanket in your model, then changes in all variables that become conditional independent cannot have an effect on the variable under evaluation if their ‘state’ changes, e.g., we impose evidence.</em></p>
</div>
</div>
<div id="independence" class="section level3" number="4.1.3">
<h3><span class="header-section-number">4.1.3</span> Independence</h3>
<p>We have three different scenarios:</p>
<ol style="list-style-type: decimal">
<li>No dependence between two variables.</li>
<li>Dependence between two variables.</li>
<li>Conditional independence between two variables. This is the example with the broken leg, where we can make two non adjacent nodes in a serial correlation independent if we control for a given variable, that is why the name <em>conditional independence</em>, because variables can become independent, if check for the variable inbetween, because then you don’t need to know the ancestor (parent of the parent).</li>
</ol>
<p>See a visual example of these.</p>
<div class="figure">
<img src="images/dependenceexamples.png" alt="" />
<p class="caption">Dependence examples</p>
</div>
<p>Notice that in the last scenario we see that the A is no longer depend on B because we account for C, hence we have a conditional indepedency, where we see the chain reaction, that A is dependent on C which is dependent on B.</p>
<p>With Bayesian networks we are able to graph this and find the dependencies and independencies and also the directions hence the causality among the variables. Therefore, we see that <code>constrained based algorithms</code> explores this, where <code>score-based algorithms</code> it primarily focusing on making good predictions.</p>
</div>
<div id="methods-for-identifying-the-network" class="section level3" number="4.1.4">
<h3><span class="header-section-number">4.1.4</span> Methods for identifying the network</h3>
<p>There are many different methods, although we are going to focus on two different schools:</p>
<div id="algorithms-focused-on-causality-discovery" class="section level4" number="4.1.4.1">
<h4><span class="header-section-number">4.1.4.1</span> 1. <strong><em>Algorithms focused on causality discovery</em></strong></h4>
<p>We are going to work with <code>constrained based algorithms</code>. Basically what this is doing is:
1. Assess data
2. Identify conditional independence tests
3. Create arcs (arrows, i.e., dependencies) based on the dependencies we find in step two.</p>
<p>Therefore, this approach is heavily relying on the principles found the section above, regarding independence.</p>
<p>Algorithms: There are different approaches, we are going to apply the <strong><em>Grow-Shrink (gs)</em></strong>.</p>
<p>Limitations: 1) This approach requires sufficient data to learn conditional independencies; 2) we manually have set the significance levels, hence we introduce bias.</p>
<p>Hence we want the graph to be stable, e.g., if we introduce new data we should not see that the model changes.</p>
</div>
<div id="algorithms-focused-on-prediction" class="section level4" number="4.1.4.2">
<h4><span class="header-section-number">4.1.4.2</span> 2. <strong><em>Algorithms focused on prediction</em></strong></h4>
<p>We are going to work with <code>score-based algorithms</code>. This is developed after the method above, hence it is also building on their algorithms. The aim for this algorithm is to make predictions, and hence not primarily identify causalities. It works in the following way:</p>
<ol style="list-style-type: decimal">
<li>All possible DAGs (Directed Acyclic Graphs) are drawed.</li>
<li>Evaluate and score all DAGs based on different information criteria, e.g., AIC and BIC.</li>
<li>Choose the DAG with the highest score.</li>
</ol>
<p>We are going to work with the algorithm <strong><em>Hill Climbing (hs)</em></strong>, which is a greedy search algorithm, hence acting according to the procedure above.</p>
<p>The reason that this is not used for discovering causality, is that for instance the HS approach is looking at the model on an overall level and not on each ARC, hence we cannot rely on actual causality in the ARC, although it we can by coincidence find actual causalities.</p>
</div>
</div>
<div id="real-life-application" class="section level3" number="4.1.5">
<h3><span class="header-section-number">4.1.5</span> <strong>Real life application</strong></h3>
<p>There are not many applications for Bayesian Networks within Customer Analytics, but there are some examples. Although it is becoming more used. But examples are:</p>
<ul>
<li>Medical diagnostics</li>
<li>Mechanical diagnostics</li>
<li>Weather prediction</li>
<li>Stock market prediction</li>
<li>Bank services</li>
<li>Insurances</li>
<li>Computer science for robotic vision</li>
<li>And other examples, all though they are limited, see the slide</li>
</ul>
<p>We see that we can use this to find the directions between the nodes and we are able to infer the probabilities between the nodes and scenarios.</p>
<hr />
<p><em>Example from the slides: We can use the network to simulate situations, f.eks. if we have some information on customers and we want to know if we should send out mails/commercials to the given customer. Hence we can apply a BN to see how characteristics of a given customer affects him making a purchase or not. Then we can introduce a variable about marketing or not to see how this affects the outcome. Naturally, this requires that we have data to support this.</em></p>
<p><em>Assume that we have the data from the example, then we can calculate the <strong>expected Lift in profit</strong> for a customer by simulating whether we market or not, e.g., finding out whehter it is worth to market or not by looking at the probabilities of making a purchase.</em></p>
<hr />
</div>
</div>
<div id="application-1-explaining-and-predicting-customer-retention-in-a-virtual-community" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Application 1: Explaining and Predicting Customer Retention in a Virtual Community</h2>
<ol style="list-style-type: decimal">
<li>Getting the structure
<ol style="list-style-type: lower-alpha">
<li>Building the structure manually. Here we manually decide the arrows and hence the directions.</li>
<li>Learning the structure from data. Here we are going to learn the arcs based on actual data.</li>
</ol></li>
<li>Model evaluation</li>
<li>Making inference</li>
</ol>
<div id="getting-the-structure" class="section level3" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> 1. Getting the structure</h3>
<div id="a.-building-the-structure-and-parameters-manually" class="section level4" number="4.2.1.1">
<h4><span class="header-section-number">4.2.1.1</span> A. Building the structure and parameters manually</h4>
<p>There are three different approaches</p>
<div id="approaches-to-make-the-network" class="section level5" number="4.2.1.1.1">
<h5><span class="header-section-number">4.2.1.1.1</span> Approaches to make the network</h5>
<p><strong>Three approaches:</strong> we are going to see three different approaches to making this.</p>
<ol style="list-style-type: decimal">
<li>Use <code>set.arc()</code></li>
<li>Construct a matrix, with two columns, <code>from</code> and <code>to</code></li>
<li>Manually write the conditional probabilties.</li>
</ol>
<p>First we will build the graph based on a given structure.</p>
<p>Notice that this corresponds with the graph in the slides:</p>
<p><img src="images/paste-E8DBE844.png" /></p>
<div id="i-first-approach" class="section level6" number="4.2.1.1.1.1">
<h6><span class="header-section-number">4.2.1.1.1.1</span> (i) First approach</h6>
<div class="sourceCode" id="cb523"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb523-1"><a href="probabilistic-models-for-customer-analytics.html#cb523-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bnlearn)</span>
<span id="cb523-2"><a href="probabilistic-models-for-customer-analytics.html#cb523-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb523-3"><a href="probabilistic-models-for-customer-analytics.html#cb523-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an empty graph </span></span>
<span id="cb523-4"><a href="probabilistic-models-for-customer-analytics.html#cb523-4" aria-hidden="true" tabindex="-1"></a>dag <span class="ot">&lt;-</span> <span class="fu">empty.graph</span>(<span class="at">nodes =</span> <span class="fu">c</span>(<span class="st">&quot;Fuse&quot;</span>,<span class="st">&quot;Plea&quot;</span>,<span class="st">&quot;Atti&quot;</span>,<span class="st">&quot;Comm&quot;</span>))</span>
<span id="cb523-5"><a href="probabilistic-models-for-customer-analytics.html#cb523-5" aria-hidden="true" tabindex="-1"></a>dag</span></code></pre></div>
<pre><code>## 
##   Random/Generated Bayesian network
## 
##   model:
##    [Fuse][Plea][Atti][Comm] 
##   nodes:                                 4 
##   arcs:                                  0 
##     undirected arcs:                     0 
##     directed arcs:                       0 
##   average markov blanket size:           0.00 
##   average neighbourhood size:            0.00 
##   average branching factor:              0.00 
## 
##   generation algorithm:                  Empty</code></pre>
<p>We see that the arcs are empty. Now we can start building the structure, hence adding arrows.</p>
<div class="sourceCode" id="cb525"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb525-1"><a href="probabilistic-models-for-customer-analytics.html#cb525-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the arcs that encode the direct dependencies between variables</span></span>
<span id="cb525-2"><a href="probabilistic-models-for-customer-analytics.html#cb525-2" aria-hidden="true" tabindex="-1"></a>dag <span class="ot">&lt;-</span> <span class="fu">set.arc</span>(dag, <span class="at">from =</span> <span class="st">&quot;Fuse&quot;</span>, <span class="at">to =</span> <span class="st">&quot;Atti&quot;</span>)</span>
<span id="cb525-3"><a href="probabilistic-models-for-customer-analytics.html#cb525-3" aria-hidden="true" tabindex="-1"></a>dag <span class="ot">&lt;-</span> <span class="fu">set.arc</span>(dag, <span class="at">from =</span> <span class="st">&quot;Plea&quot;</span>, <span class="at">to =</span> <span class="st">&quot;Atti&quot;</span>)</span>
<span id="cb525-4"><a href="probabilistic-models-for-customer-analytics.html#cb525-4" aria-hidden="true" tabindex="-1"></a>dag <span class="ot">&lt;-</span> <span class="fu">set.arc</span>(dag, <span class="at">from =</span> <span class="st">&quot;Fuse&quot;</span>, <span class="at">to =</span> <span class="st">&quot;Comm&quot;</span>)</span>
<span id="cb525-5"><a href="probabilistic-models-for-customer-analytics.html#cb525-5" aria-hidden="true" tabindex="-1"></a>dag <span class="ot">&lt;-</span> <span class="fu">set.arc</span>(dag, <span class="at">from =</span> <span class="st">&quot;Plea&quot;</span>, <span class="at">to =</span> <span class="st">&quot;Comm&quot;</span>)</span>
<span id="cb525-6"><a href="probabilistic-models-for-customer-analytics.html#cb525-6" aria-hidden="true" tabindex="-1"></a>dag <span class="ot">&lt;-</span> <span class="fu">set.arc</span>(dag, <span class="at">from =</span> <span class="st">&quot;Atti&quot;</span>, <span class="at">to =</span> <span class="st">&quot;Comm&quot;</span>)</span>
<span id="cb525-7"><a href="probabilistic-models-for-customer-analytics.html#cb525-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb525-8"><a href="probabilistic-models-for-customer-analytics.html#cb525-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the DAG</span></span>
<span id="cb525-9"><a href="probabilistic-models-for-customer-analytics.html#cb525-9" aria-hidden="true" tabindex="-1"></a>dag</span></code></pre></div>
<pre><code>## 
##   Random/Generated Bayesian network
## 
##   model:
##    [Fuse][Plea][Atti|Fuse:Plea][Comm|Fuse:Plea:Atti] 
##   nodes:                                 4 
##   arcs:                                  5 
##     undirected arcs:                     0 
##     directed arcs:                       5 
##   average markov blanket size:           3.00 
##   average neighbourhood size:            2.50 
##   average branching factor:              1.25 
## 
##   generation algorithm:                  Empty</code></pre>
<p>we see the directed graph here.</p>
<p>Now we can get the model string, also show the nodes.</p>
<div class="sourceCode" id="cb527"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb527-1"><a href="probabilistic-models-for-customer-analytics.html#cb527-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Direct dependencies are listed for each variable: </span></span>
<span id="cb527-2"><a href="probabilistic-models-for-customer-analytics.html#cb527-2" aria-hidden="true" tabindex="-1"></a><span class="fu">modelstring</span>(dag)</span></code></pre></div>
<pre><code>## [1] &quot;[Fuse][Plea][Atti|Fuse:Plea][Comm|Fuse:Plea:Atti]&quot;</code></pre>
<p><em>Notice that this is written as the conditional probabilities.</em></p>
<p>We see that Fuse and Plea are parent nodes. We see that attitude is based on Functional usefulness and Pleasure</p>
<p>Now we can explore it visually.</p>
<div class="sourceCode" id="cb529"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb529-1"><a href="probabilistic-models-for-customer-analytics.html#cb529-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Explore the elements of the graphical network</span></span>
<span id="cb529-2"><a href="probabilistic-models-for-customer-analytics.html#cb529-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span>(dag)</span>
<span id="cb529-3"><a href="probabilistic-models-for-customer-analytics.html#cb529-3" aria-hidden="true" tabindex="-1"></a><span class="fu">arcs</span>(dag)</span>
<span id="cb529-4"><a href="probabilistic-models-for-customer-analytics.html#cb529-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dag)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-246-1.png" width="720" style="display: block; margin: auto;" /></p>
<pre><code>## [1] &quot;Fuse&quot; &quot;Plea&quot; &quot;Atti&quot; &quot;Comm&quot;
##      from   to    
## [1,] &quot;Fuse&quot; &quot;Atti&quot;
## [2,] &quot;Plea&quot; &quot;Atti&quot;
## [3,] &quot;Fuse&quot; &quot;Comm&quot;
## [4,] &quot;Plea&quot; &quot;Comm&quot;
## [5,] &quot;Atti&quot; &quot;Comm&quot;</code></pre>
<p><em>Notice that throughout the code, the <code>Rgraphviz</code> package is applied to better looking plots, although I have not been able to install it. Although it is not necessary.</em></p>
<div class="sourceCode" id="cb531"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb531-1"><a href="probabilistic-models-for-customer-analytics.html#cb531-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional</span></span>
<span id="cb531-2"><a href="probabilistic-models-for-customer-analytics.html#cb531-2" aria-hidden="true" tabindex="-1"></a><span class="co"># library(Rgraphviz) </span></span>
<span id="cb531-3"><a href="probabilistic-models-for-customer-analytics.html#cb531-3" aria-hidden="true" tabindex="-1"></a><span class="co"># graphviz.plot(dag)</span></span></code></pre></div>
</div>
<div id="ii-second-approach" class="section level6" number="4.2.1.1.1.2">
<h6><span class="header-section-number">4.2.1.1.1.2</span> (ii) Second approach</h6>
<p>Another way to build a large network from scratch is to define the nodes and create a matrix to set the whole arc set at once:</p>
<div class="sourceCode" id="cb532"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb532-1"><a href="probabilistic-models-for-customer-analytics.html#cb532-1" aria-hidden="true" tabindex="-1"></a>dag2 <span class="ot">&lt;-</span> <span class="fu">empty.graph</span>(<span class="at">nodes =</span> <span class="fu">c</span>(<span class="st">&quot;Fuse&quot;</span>,<span class="st">&quot;Plea&quot;</span>,<span class="st">&quot;Atti&quot;</span>,<span class="st">&quot;Comm&quot;</span>))</span>
<span id="cb532-2"><a href="probabilistic-models-for-customer-analytics.html#cb532-2" aria-hidden="true" tabindex="-1"></a><span class="fu">arcs</span>(dag2) <span class="ot">=</span> <span class="fu">matrix</span> (<span class="fu">c</span>(<span class="st">&quot;Fuse&quot;</span>, <span class="st">&quot;Atti&quot;</span>,</span>
<span id="cb532-3"><a href="probabilistic-models-for-customer-analytics.html#cb532-3" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;Plea&quot;</span>, <span class="st">&quot;Atti&quot;</span>,</span>
<span id="cb532-4"><a href="probabilistic-models-for-customer-analytics.html#cb532-4" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;Fuse&quot;</span>, <span class="st">&quot;Comm&quot;</span>,</span>
<span id="cb532-5"><a href="probabilistic-models-for-customer-analytics.html#cb532-5" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;Plea&quot;</span>, <span class="st">&quot;Comm&quot;</span>,</span>
<span id="cb532-6"><a href="probabilistic-models-for-customer-analytics.html#cb532-6" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;Atti&quot;</span>, <span class="st">&quot;Comm&quot;</span>),</span>
<span id="cb532-7"><a href="probabilistic-models-for-customer-analytics.html#cb532-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">byrow  =</span> <span class="cn">TRUE</span>, <span class="at">ncol =</span> <span class="dv">2</span>,</span>
<span id="cb532-8"><a href="probabilistic-models-for-customer-analytics.html#cb532-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">dimnames =</span> <span class="fu">list</span> (<span class="cn">NULL</span>, <span class="fu">c</span>(<span class="st">&quot;from&quot;</span>, <span class="st">&quot;to&quot;</span>)))</span>
<span id="cb532-9"><a href="probabilistic-models-for-customer-analytics.html#cb532-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dag2)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-248-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>We see that we get the exact same plot.</p>
</div>
<div id="iii-third-approach" class="section level6" number="4.2.1.1.1.3">
<h6><span class="header-section-number">4.2.1.1.1.3</span> (iii) Third approach</h6>
<p>An even easier way to build the DAG when we know the structure:</p>
<p>Notice that this is the output that we have seen from the first approach. When we are having a simple network it is doable, but with larger networks it gets more difficult.</p>
<div class="sourceCode" id="cb533"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb533-1"><a href="probabilistic-models-for-customer-analytics.html#cb533-1" aria-hidden="true" tabindex="-1"></a>dag3 <span class="ot">&lt;-</span> <span class="fu">model2network</span>(<span class="st">&quot;[Fuse][Plea][Atti|Fuse:Plea][Comm|Fuse:Plea:Atti]&quot;</span>)</span>
<span id="cb533-2"><a href="probabilistic-models-for-customer-analytics.html#cb533-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dag3)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-249-1.png" width="720" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb534"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb534-1"><a href="probabilistic-models-for-customer-analytics.html#cb534-1" aria-hidden="true" tabindex="-1"></a><span class="co"># graphviz.plot (dag3)</span></span></code></pre></div>
<p>We see that they are the same. Although we can also use a function to check for this.</p>
<div class="sourceCode" id="cb535"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb535-1"><a href="probabilistic-models-for-customer-analytics.html#cb535-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare dags</span></span>
<span id="cb535-2"><a href="probabilistic-models-for-customer-analytics.html#cb535-2" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(dag, dag2)</span>
<span id="cb535-3"><a href="probabilistic-models-for-customer-analytics.html#cb535-3" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(dag, dag3)</span></code></pre></div>
<pre><code>## [1] TRUE
## [1] TRUE</code></pre>
<p>We see that all methods are the same.</p>
</div>
</div>
<div id="loadingentering-data" class="section level5" number="4.2.1.1.2">
<h5><span class="header-section-number">4.2.1.1.2</span> Loading/entering data</h5>
<p>We see that we are manually entering the matrices:</p>
<p><img src="images/paste-DAB5B86A.png" /></p>
<p><img src="images/paste-4AC4EB97.png" /></p>
<p><img src="images/paste-B865AB80.png" /></p>
<p><img src="images/paste-021AE152.png" /></p>
<div class="sourceCode" id="cb537"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb537-1"><a href="probabilistic-models-for-customer-analytics.html#cb537-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Introducing the parameters manually</span></span>
<span id="cb537-2"><a href="probabilistic-models-for-customer-analytics.html#cb537-2" aria-hidden="true" tabindex="-1"></a>Fuse.lv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Low&quot;</span>, <span class="st">&quot;Med&quot;</span>, <span class="st">&quot;High&quot;</span>) </span>
<span id="cb537-3"><a href="probabilistic-models-for-customer-analytics.html#cb537-3" aria-hidden="true" tabindex="-1"></a>Plea.lv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Low&quot;</span>, <span class="st">&quot;Med&quot;</span>, <span class="st">&quot;High&quot;</span>)</span>
<span id="cb537-4"><a href="probabilistic-models-for-customer-analytics.html#cb537-4" aria-hidden="true" tabindex="-1"></a>Atti.lv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Low&quot;</span>, <span class="st">&quot;Med&quot;</span>, <span class="st">&quot;High&quot;</span>)</span>
<span id="cb537-5"><a href="probabilistic-models-for-customer-analytics.html#cb537-5" aria-hidden="true" tabindex="-1"></a>Comm.lv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Low&quot;</span>, <span class="st">&quot;Med&quot;</span>, <span class="st">&quot;High&quot;</span>)</span>
<span id="cb537-6"><a href="probabilistic-models-for-customer-analytics.html#cb537-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb537-7"><a href="probabilistic-models-for-customer-analytics.html#cb537-7" aria-hidden="true" tabindex="-1"></a>Fuse.prob <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">c</span>(<span class="fl">0.02</span>, <span class="fl">0.26</span>, <span class="fl">0.72</span>), <span class="at">dim =</span> <span class="dv">3</span>, <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="at">Fuse =</span> Fuse.lv))</span>
<span id="cb537-8"><a href="probabilistic-models-for-customer-analytics.html#cb537-8" aria-hidden="true" tabindex="-1"></a>Fuse.prob</span>
<span id="cb537-9"><a href="probabilistic-models-for-customer-analytics.html#cb537-9" aria-hidden="true" tabindex="-1"></a>Plea.prob <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.55</span>, <span class="fl">0.44</span>), <span class="at">dim =</span> <span class="dv">3</span>, <span class="at">dimnames=</span> <span class="fu">list</span>(<span class="at">Plea =</span> Plea.lv))</span>
<span id="cb537-10"><a href="probabilistic-models-for-customer-analytics.html#cb537-10" aria-hidden="true" tabindex="-1"></a>Plea.prob</span>
<span id="cb537-11"><a href="probabilistic-models-for-customer-analytics.html#cb537-11" aria-hidden="true" tabindex="-1"></a>Atti.prob <span class="ot">&lt;-</span>      <span class="fu">array</span>(<span class="fu">c</span>(<span class="fl">0.99</span>, <span class="fl">0.01</span>, <span class="fl">0.00</span>,</span>
<span id="cb537-12"><a href="probabilistic-models-for-customer-analytics.html#cb537-12" aria-hidden="true" tabindex="-1"></a>                          <span class="fl">0.00</span>, <span class="fl">0.67</span>, <span class="fl">0.33</span>,</span>
<span id="cb537-13"><a href="probabilistic-models-for-customer-analytics.html#cb537-13" aria-hidden="true" tabindex="-1"></a>                          <span class="fl">0.01</span>, <span class="fl">0.99</span>, <span class="fl">0.00</span>,</span>
<span id="cb537-14"><a href="probabilistic-models-for-customer-analytics.html#cb537-14" aria-hidden="true" tabindex="-1"></a>                          <span class="fl">0.34</span>, <span class="fl">0.33</span>, <span class="fl">0.33</span>, </span>
<span id="cb537-15"><a href="probabilistic-models-for-customer-analytics.html#cb537-15" aria-hidden="true" tabindex="-1"></a>                          <span class="fl">0.00</span>, <span class="fl">0.79</span>, <span class="fl">0.21</span>,</span>
<span id="cb537-16"><a href="probabilistic-models-for-customer-analytics.html#cb537-16" aria-hidden="true" tabindex="-1"></a>                          <span class="fl">0.00</span>, <span class="fl">0.40</span>, <span class="fl">0.60</span>,</span>
<span id="cb537-17"><a href="probabilistic-models-for-customer-analytics.html#cb537-17" aria-hidden="true" tabindex="-1"></a>                          <span class="fl">0.99</span>, <span class="fl">0.01</span>, <span class="fl">0.00</span>,</span>
<span id="cb537-18"><a href="probabilistic-models-for-customer-analytics.html#cb537-18" aria-hidden="true" tabindex="-1"></a>                          <span class="fl">0.00</span>, <span class="fl">0.47</span>, <span class="fl">0.53</span>,</span>
<span id="cb537-19"><a href="probabilistic-models-for-customer-analytics.html#cb537-19" aria-hidden="true" tabindex="-1"></a>                          <span class="fl">0.00</span>, <span class="fl">0.09</span>, <span class="fl">0.91</span>), </span>
<span id="cb537-20"><a href="probabilistic-models-for-customer-analytics.html#cb537-20" aria-hidden="true" tabindex="-1"></a>                        <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>), </span>
<span id="cb537-21"><a href="probabilistic-models-for-customer-analytics.html#cb537-21" aria-hidden="true" tabindex="-1"></a>                        <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="at">Atti =</span> Atti.lv, </span>
<span id="cb537-22"><a href="probabilistic-models-for-customer-analytics.html#cb537-22" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">Plea =</span> Plea.lv, </span>
<span id="cb537-23"><a href="probabilistic-models-for-customer-analytics.html#cb537-23" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">Fuse =</span> Fuse.lv))</span>
<span id="cb537-24"><a href="probabilistic-models-for-customer-analytics.html#cb537-24" aria-hidden="true" tabindex="-1"></a>Atti.prob</span></code></pre></div>
<pre><code>## Fuse
##  Low  Med High 
## 0.02 0.26 0.72 
## Plea
##  Low  Med High 
## 0.01 0.55 0.44 
## , , Fuse = Low
## 
##       Plea
## Atti    Low  Med High
##   Low  0.99 0.00 0.01
##   Med  0.01 0.67 0.99
##   High 0.00 0.33 0.00
## 
## , , Fuse = Med
## 
##       Plea
## Atti    Low  Med High
##   Low  0.34 0.00  0.0
##   Med  0.33 0.79  0.4
##   High 0.33 0.21  0.6
## 
## , , Fuse = High
## 
##       Plea
## Atti    Low  Med High
##   Low  0.99 0.00 0.00
##   Med  0.01 0.47 0.09
##   High 0.00 0.53 0.91</code></pre>
<p>We see that all these are probabilities for the given situations, just as we have seen previously with naive bayes.</p>
<div class="sourceCode" id="cb539"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb539-1"><a href="probabilistic-models-for-customer-analytics.html#cb539-1" aria-hidden="true" tabindex="-1"></a>Comm.prob <span class="ot">&lt;-</span>    <span class="fu">array</span>(<span class="fu">c</span>(<span class="fl">0.00</span>, <span class="fl">1.00</span>, <span class="fl">0.00</span>, </span>
<span id="cb539-2"><a href="probabilistic-models-for-customer-analytics.html#cb539-2" aria-hidden="true" tabindex="-1"></a>                        <span class="fl">0.34</span>, <span class="fl">0.33</span>, <span class="fl">0.33</span>, </span>
<span id="cb539-3"><a href="probabilistic-models-for-customer-analytics.html#cb539-3" aria-hidden="true" tabindex="-1"></a>                        <span class="fl">0.34</span>, <span class="fl">0.33</span>, <span class="fl">0.33</span>, </span>
<span id="cb539-4"><a href="probabilistic-models-for-customer-analytics.html#cb539-4" aria-hidden="true" tabindex="-1"></a>                        <span class="fl">0.34</span>, <span class="fl">0.33</span>, <span class="fl">0.33</span>, </span>
<span id="cb539-5"><a href="probabilistic-models-for-customer-analytics.html#cb539-5" aria-hidden="true" tabindex="-1"></a>                        <span class="fl">0.00</span>, <span class="fl">1.00</span>, <span class="fl">0.00</span>, </span>
<span id="cb539-6"><a href="probabilistic-models-for-customer-analytics.html#cb539-6" aria-hidden="true" tabindex="-1"></a>                        <span class="fl">1.00</span>, <span class="fl">0.00</span>, <span class="fl">0.00</span>, </span>
<span id="cb539-7"><a href="probabilistic-models-for-customer-analytics.html#cb539-7" aria-hidden="true" tabindex="-1"></a>                        <span class="fl">0.34</span>, <span class="fl">0.33</span>, <span class="fl">0.33</span>,</span>
<span id="cb539-8"><a href="probabilistic-models-for-customer-analytics.html#cb539-8" aria-hidden="true" tabindex="-1"></a>                        <span class="fl">0.00</span>, <span class="fl">1.00</span>, <span class="fl">0.00</span>, </span>
<span id="cb539-9"><a href="probabilistic-models-for-customer-analytics.html#cb539-9" aria-hidden="true" tabindex="-1"></a>                        <span class="fl">0.34</span>, <span class="fl">0.33</span>, <span class="fl">0.33</span>,</span>
<span id="cb539-10"><a href="probabilistic-models-for-customer-analytics.html#cb539-10" aria-hidden="true" tabindex="-1"></a>                        <span class="fl">0.34</span>, <span class="fl">0.33</span>, <span class="fl">0.33</span>,</span>
<span id="cb539-11"><a href="probabilistic-models-for-customer-analytics.html#cb539-11" aria-hidden="true" tabindex="-1"></a>                        <span class="fl">0.34</span>, <span class="fl">0.33</span>, <span class="fl">0.33</span>,</span>
<span id="cb539-12"><a href="probabilistic-models-for-customer-analytics.html#cb539-12" aria-hidden="true" tabindex="-1"></a>                        <span class="fl">0.34</span>, <span class="fl">0.33</span>, <span class="fl">0.33</span>,</span>
<span id="cb539-13"><a href="probabilistic-models-for-customer-analytics.html#cb539-13" aria-hidden="true" tabindex="-1"></a>                        <span class="fl">0.34</span>, <span class="fl">0.33</span>, <span class="fl">0.33</span>,</span>
<span id="cb539-14"><a href="probabilistic-models-for-customer-analytics.html#cb539-14" aria-hidden="true" tabindex="-1"></a>                        <span class="fl">0.00</span>, <span class="fl">0.98</span>, <span class="fl">0.02</span>,</span>
<span id="cb539-15"><a href="probabilistic-models-for-customer-analytics.html#cb539-15" aria-hidden="true" tabindex="-1"></a>                        <span class="fl">0.00</span>, <span class="fl">0.83</span>, <span class="fl">0.17</span>,</span>
<span id="cb539-16"><a href="probabilistic-models-for-customer-analytics.html#cb539-16" aria-hidden="true" tabindex="-1"></a>                        <span class="fl">0.34</span>, <span class="fl">0.33</span>, <span class="fl">0.33</span>,</span>
<span id="cb539-17"><a href="probabilistic-models-for-customer-analytics.html#cb539-17" aria-hidden="true" tabindex="-1"></a>                        <span class="fl">0.00</span>, <span class="fl">0.33</span>, <span class="fl">0.67</span>,</span>
<span id="cb539-18"><a href="probabilistic-models-for-customer-analytics.html#cb539-18" aria-hidden="true" tabindex="-1"></a>                        <span class="fl">0.00</span>, <span class="fl">0.44</span>, <span class="fl">0.56</span>,</span>
<span id="cb539-19"><a href="probabilistic-models-for-customer-analytics.html#cb539-19" aria-hidden="true" tabindex="-1"></a>                        <span class="fl">1.00</span>, <span class="fl">0.00</span>, <span class="fl">0.00</span>,</span>
<span id="cb539-20"><a href="probabilistic-models-for-customer-analytics.html#cb539-20" aria-hidden="true" tabindex="-1"></a>                        <span class="fl">0.34</span>, <span class="fl">0.33</span>, <span class="fl">0.33</span>,</span>
<span id="cb539-21"><a href="probabilistic-models-for-customer-analytics.html#cb539-21" aria-hidden="true" tabindex="-1"></a>                        <span class="fl">0.34</span>, <span class="fl">0.33</span>, <span class="fl">0.33</span>,</span>
<span id="cb539-22"><a href="probabilistic-models-for-customer-analytics.html#cb539-22" aria-hidden="true" tabindex="-1"></a>                        <span class="fl">0.34</span>, <span class="fl">0.33</span>, <span class="fl">0.33</span>,</span>
<span id="cb539-23"><a href="probabilistic-models-for-customer-analytics.html#cb539-23" aria-hidden="true" tabindex="-1"></a>                        <span class="fl">0.00</span>, <span class="fl">0.84</span>, <span class="fl">0.16</span>,</span>
<span id="cb539-24"><a href="probabilistic-models-for-customer-analytics.html#cb539-24" aria-hidden="true" tabindex="-1"></a>                        <span class="fl">0.00</span>, <span class="fl">0.71</span>, <span class="fl">0.29</span>,</span>
<span id="cb539-25"><a href="probabilistic-models-for-customer-analytics.html#cb539-25" aria-hidden="true" tabindex="-1"></a>                        <span class="fl">0.34</span>, <span class="fl">0.33</span>, <span class="fl">0.33</span>,</span>
<span id="cb539-26"><a href="probabilistic-models-for-customer-analytics.html#cb539-26" aria-hidden="true" tabindex="-1"></a>                        <span class="fl">0.00</span>, <span class="fl">0.40</span>, <span class="fl">0.60</span>,</span>
<span id="cb539-27"><a href="probabilistic-models-for-customer-analytics.html#cb539-27" aria-hidden="true" tabindex="-1"></a>                        <span class="fl">0.00</span>, <span class="fl">0.10</span>, <span class="fl">0.90</span>), </span>
<span id="cb539-28"><a href="probabilistic-models-for-customer-analytics.html#cb539-28" aria-hidden="true" tabindex="-1"></a>                 <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>), </span>
<span id="cb539-29"><a href="probabilistic-models-for-customer-analytics.html#cb539-29" aria-hidden="true" tabindex="-1"></a>                 <span class="at">dimnames=</span> <span class="fu">list</span>(<span class="at">Comm =</span> Comm.lv, </span>
<span id="cb539-30"><a href="probabilistic-models-for-customer-analytics.html#cb539-30" aria-hidden="true" tabindex="-1"></a>                                <span class="at">Atti =</span> Atti.lv, </span>
<span id="cb539-31"><a href="probabilistic-models-for-customer-analytics.html#cb539-31" aria-hidden="true" tabindex="-1"></a>                                <span class="at">Plea =</span> Plea.lv, </span>
<span id="cb539-32"><a href="probabilistic-models-for-customer-analytics.html#cb539-32" aria-hidden="true" tabindex="-1"></a>                                <span class="at">Fuse =</span> Fuse.lv))</span>
<span id="cb539-33"><a href="probabilistic-models-for-customer-analytics.html#cb539-33" aria-hidden="true" tabindex="-1"></a>Comm.prob</span></code></pre></div>
<pre><code>## , , Plea = Low, Fuse = Low
## 
##       Atti
## Comm   Low  Med High
##   Low    0 0.34 0.34
##   Med    1 0.33 0.33
##   High   0 0.33 0.33
## 
## , , Plea = Med, Fuse = Low
## 
##       Atti
## Comm    Low Med High
##   Low  0.34   0    1
##   Med  0.33   1    0
##   High 0.33   0    0
## 
## , , Plea = High, Fuse = Low
## 
##       Atti
## Comm    Low Med High
##   Low  0.34   0 0.34
##   Med  0.33   1 0.33
##   High 0.33   0 0.33
## 
## , , Plea = Low, Fuse = Med
## 
##       Atti
## Comm    Low  Med High
##   Low  0.34 0.34 0.34
##   Med  0.33 0.33 0.33
##   High 0.33 0.33 0.33
## 
## , , Plea = Med, Fuse = Med
## 
##       Atti
## Comm    Low  Med High
##   Low  0.34 0.00 0.00
##   Med  0.33 0.98 0.83
##   High 0.33 0.02 0.17
## 
## , , Plea = High, Fuse = Med
## 
##       Atti
## Comm    Low  Med High
##   Low  0.34 0.00 0.00
##   Med  0.33 0.33 0.44
##   High 0.33 0.67 0.56
## 
## , , Plea = Low, Fuse = High
## 
##       Atti
## Comm   Low  Med High
##   Low    1 0.34 0.34
##   Med    0 0.33 0.33
##   High   0 0.33 0.33
## 
## , , Plea = Med, Fuse = High
## 
##       Atti
## Comm    Low  Med High
##   Low  0.34 0.00 0.00
##   Med  0.33 0.84 0.71
##   High 0.33 0.16 0.29
## 
## , , Plea = High, Fuse = High
## 
##       Atti
## Comm    Low Med High
##   Low  0.34 0.0  0.0
##   Med  0.33 0.4  0.1
##   High 0.33 0.6  0.9</code></pre>
<p>Now where we have defined the numbers, we want to combine the matrices and the graphical structure.</p>
</div>
<div id="conditional-probability-table-cpt" class="section level5" number="4.2.1.1.3">
<h5><span class="header-section-number">4.2.1.1.3</span> Conditional probability table (CPT)</h5>
<p>Now we are going to combine the probabilities into a list</p>
<div class="sourceCode" id="cb541"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb541-1"><a href="probabilistic-models-for-customer-analytics.html#cb541-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Relate the CPT to the labels</span></span>
<span id="cb541-2"><a href="probabilistic-models-for-customer-analytics.html#cb541-2" aria-hidden="true" tabindex="-1"></a>cpt <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">Fuse =</span> Fuse.prob, </span>
<span id="cb541-3"><a href="probabilistic-models-for-customer-analytics.html#cb541-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">Plea =</span> Plea.prob,</span>
<span id="cb541-4"><a href="probabilistic-models-for-customer-analytics.html#cb541-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">Atti =</span> Atti.prob, </span>
<span id="cb541-5"><a href="probabilistic-models-for-customer-analytics.html#cb541-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">Comm =</span> Comm.prob)</span>
<span id="cb541-6"><a href="probabilistic-models-for-customer-analytics.html#cb541-6" aria-hidden="true" tabindex="-1"></a><span class="co">#  Relate the DAG and CPT and define a fully-specified BN</span></span>
<span id="cb541-7"><a href="probabilistic-models-for-customer-analytics.html#cb541-7" aria-hidden="true" tabindex="-1"></a>bn <span class="ot">&lt;-</span> <span class="fu">custom.fit</span>(dag, cpt)</span>
<span id="cb541-8"><a href="probabilistic-models-for-customer-analytics.html#cb541-8" aria-hidden="true" tabindex="-1"></a>bn</span></code></pre></div>
<pre><code>## 
##   Bayesian network parameters
## 
##   Parameters of node Fuse (multinomial distribution)
## 
## Conditional probability table:
##  Fuse
##  Low  Med High 
## 0.02 0.26 0.72 
## 
##   Parameters of node Plea (multinomial distribution)
## 
## Conditional probability table:
##  Plea
##  Low  Med High 
## 0.01 0.55 0.44 
## 
##   Parameters of node Atti (multinomial distribution)
## 
## Conditional probability table:
##  
## , , Plea = Low
## 
##       Fuse
## Atti    Low  Med High
##   Low  0.99 0.34 0.99
##   Med  0.01 0.33 0.01
##   High 0.00 0.33 0.00
## 
## , , Plea = Med
## 
##       Fuse
## Atti    Low  Med High
##   Low  0.00 0.00 0.00
##   Med  0.67 0.79 0.47
##   High 0.33 0.21 0.53
## 
## , , Plea = High
## 
##       Fuse
## Atti    Low  Med High
##   Low  0.01 0.00 0.00
##   Med  0.99 0.40 0.09
##   High 0.00 0.60 0.91
## 
## 
##   Parameters of node Comm (multinomial distribution)
## 
## Conditional probability table:
##  
## , , Plea = Low, Atti = Low
## 
##       Fuse
## Comm    Low  Med High
##   Low  0.00 0.34 1.00
##   Med  1.00 0.33 0.00
##   High 0.00 0.33 0.00
## 
## , , Plea = Med, Atti = Low
## 
##       Fuse
## Comm    Low  Med High
##   Low  0.34 0.34 0.34
##   Med  0.33 0.33 0.33
##   High 0.33 0.33 0.33
## 
## , , Plea = High, Atti = Low
## 
##       Fuse
## Comm    Low  Med High
##   Low  0.34 0.34 0.34
##   Med  0.33 0.33 0.33
##   High 0.33 0.33 0.33
## 
## , , Plea = Low, Atti = Med
## 
##       Fuse
## Comm    Low  Med High
##   Low  0.34 0.34 0.34
##   Med  0.33 0.33 0.33
##   High 0.33 0.33 0.33
## 
## , , Plea = Med, Atti = Med
## 
##       Fuse
## Comm    Low  Med High
##   Low  0.00 0.00 0.00
##   Med  1.00 0.98 0.84
##   High 0.00 0.02 0.16
## 
## , , Plea = High, Atti = Med
## 
##       Fuse
## Comm    Low  Med High
##   Low  0.00 0.00 0.00
##   Med  1.00 0.33 0.40
##   High 0.00 0.67 0.60
## 
## , , Plea = Low, Atti = High
## 
##       Fuse
## Comm    Low  Med High
##   Low  0.34 0.34 0.34
##   Med  0.33 0.33 0.33
##   High 0.33 0.33 0.33
## 
## , , Plea = Med, Atti = High
## 
##       Fuse
## Comm    Low  Med High
##   Low  1.00 0.00 0.00
##   Med  0.00 0.83 0.71
##   High 0.00 0.17 0.29
## 
## , , Plea = High, Atti = High
## 
##       Fuse
## Comm    Low  Med High
##   Low  0.34 0.00 0.00
##   Med  0.33 0.44 0.10
##   High 0.33 0.56 0.90</code></pre>
</div>
</div>
<div id="b.-learning-the-structure-and-parameters-from-observational-data" class="section level4" number="4.2.1.2">
<h4><span class="header-section-number">4.2.1.2</span> B. Learning the structure and parameters from observational data</h4>
<p>We have seen in the previous section, that we are able to manually set the directions. We can also use a constrained based algorithms to learn the links based on historical data.</p>
<div class="sourceCode" id="cb543"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb543-1"><a href="probabilistic-models-for-customer-analytics.html#cb543-1" aria-hidden="true" tabindex="-1"></a>retention <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;Data/Probabilistic Models for Customer Analytics/retention.csv&quot;</span></span>
<span id="cb543-2"><a href="probabilistic-models-for-customer-analytics.html#cb543-2" aria-hidden="true" tabindex="-1"></a>                      ,<span class="at">header =</span> T</span>
<span id="cb543-3"><a href="probabilistic-models-for-customer-analytics.html#cb543-3" aria-hidden="true" tabindex="-1"></a>                      ,<span class="at">colClasses =</span> <span class="st">&quot;factor&quot;</span>)</span>
<span id="cb543-4"><a href="probabilistic-models-for-customer-analytics.html#cb543-4" aria-hidden="true" tabindex="-1"></a>retention_test <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;Data/Probabilistic Models for Customer Analytics/retention_test.csv&quot;</span>, <span class="at">header =</span> T, <span class="at">colClasses =</span> <span class="st">&quot;factor&quot;</span> )</span>
<span id="cb543-5"><a href="probabilistic-models-for-customer-analytics.html#cb543-5" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb543-6"><a href="probabilistic-models-for-customer-analytics.html#cb543-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(retention)</span>
<span id="cb543-7"><a href="probabilistic-models-for-customer-analytics.html#cb543-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(retention)</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="left">Fuse</th>
<th align="left">Plea</th>
<th align="left">Atti</th>
<th align="left">Comm</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">High</td>
<td align="left">High</td>
<td align="left">High</td>
<td align="left">High</td>
</tr>
<tr class="even">
<td align="left">Med</td>
<td align="left">High</td>
<td align="left">High</td>
<td align="left">Med</td>
</tr>
<tr class="odd">
<td align="left">High</td>
<td align="left">Med</td>
<td align="left">High</td>
<td align="left">High</td>
</tr>
<tr class="even">
<td align="left">Low</td>
<td align="left">Med</td>
<td align="left">High</td>
<td align="left">Low</td>
</tr>
<tr class="odd">
<td align="left">High</td>
<td align="left">Med</td>
<td align="left">Med</td>
<td align="left">Med</td>
</tr>
<tr class="even">
<td align="left">High</td>
<td align="left">Med</td>
<td align="left">High</td>
<td align="left">Med</td>
</tr>
</tbody>
</table>
</div>
<pre><code>## &#39;data.frame&#39;:    5000 obs. of  4 variables:
##  $ Fuse: Factor w/ 3 levels &quot;High&quot;,&quot;Low&quot;,&quot;Med&quot;: 1 3 1 2 1 1 1 1 1 1 ...
##  $ Plea: Factor w/ 3 levels &quot;High&quot;,&quot;Low&quot;,&quot;Med&quot;: 1 1 3 3 3 3 1 1 3 1 ...
##  $ Atti: Factor w/ 3 levels &quot;High&quot;,&quot;Low&quot;,&quot;Med&quot;: 1 1 1 1 3 1 1 1 3 1 ...
##  $ Comm: Factor w/ 3 levels &quot;High&quot;,&quot;Low&quot;,&quot;Med&quot;: 1 3 1 2 3 3 1 1 3 1 ...</code></pre>
<p>We see that we have four vectors with three factor levels, high, low and medium.</p>
<p>Notice that the data must be factors. Although she does mention that one can also have all numeric data, we did not explore this.</p>
<p>bn are particularly designed for categorical variables, continuous variable require to be discretisized if all variables are continuous, a Gausian bn can be built (not discussed here).</p>
<div id="grow-shrink-gs---learning-a-structure-using-a-constrained-based-algorithm" class="section level5" number="4.2.1.2.1">
<h5><span class="header-section-number">4.2.1.2.1</span> Grow-shrink (gs) - Learning a structure using a constrained-based algorithm</h5>
<p>2.1 Learning a structure using a constrained-based algorithm</p>
<p>“grow-shrink (gs)”, with conditional independence test chi-squared Constrained-based alg. do not work with missing data</p>
<div class="sourceCode" id="cb545"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb545-1"><a href="probabilistic-models-for-customer-analytics.html#cb545-1" aria-hidden="true" tabindex="-1"></a>bn.gs <span class="ot">&lt;-</span> <span class="fu">gs</span>(retention <span class="co">#The data</span></span>
<span id="cb545-2"><a href="probabilistic-models-for-customer-analytics.html#cb545-2" aria-hidden="true" tabindex="-1"></a>            ,<span class="at">alpha =</span> <span class="fl">0.05</span> <span class="co">#The signifance level, for deciding if there is a relationship</span></span>
<span id="cb545-3"><a href="probabilistic-models-for-customer-analytics.html#cb545-3" aria-hidden="true" tabindex="-1"></a>            ,<span class="at">test =</span><span class="st">&quot;x2&quot;</span>) <span class="co"># alternative test =&quot;mi&quot;</span></span>
<span id="cb545-4"><a href="probabilistic-models-for-customer-analytics.html#cb545-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bn.gs, <span class="at">main =</span> <span class="st">&quot;Grow shrink_X2&quot;</span>)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-255-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>We see that this is the model that the model suggests, purely on the data. We see that it could not draw the direction of the Communicating and Attitude, but the rest, it was able to identify the arrows.</p>
<p>Hence we must set the arrow ourselves. Then how do we set the arrow?</p>
<ul>
<li>A rule of thumb, is chronological order, if it cannot be applied, derive it theoretically</li>
</ul>
<p>The following is just an example with graphviz but not mandatory.</p>
<div class="sourceCode" id="cb546"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb546-1"><a href="probabilistic-models-for-customer-analytics.html#cb546-1" aria-hidden="true" tabindex="-1"></a><span class="co">#graphviz.plot (bn.gs, main = &quot;Grow shrink_X2&quot;) </span></span>
<span id="cb546-2"><a href="probabilistic-models-for-customer-analytics.html#cb546-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># notice that in the constrained-based alg some links are undirected.</span></span>
<span id="cb546-3"><a href="probabilistic-models-for-customer-analytics.html#cb546-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this occurs because the algorithm cannot establish the direction of &quot;causality&quot;.</span></span></code></pre></div>
<div id="identifying-undirectred-links" class="section level6" number="4.2.1.2.1.1">
<h6><span class="header-section-number">4.2.1.2.1.1</span> Identifying undirectred links</h6>
<p>Notice that when we do not manually set the links, then there is a risk of having variables where the technique is not able to identify directions. As we cannot have bidrectional links, we much search for these.</p>
<p>If we already have knowledge about what relationships that can and cannot be there, we can <strong><em>blacklist</em></strong> and <strong><em>whitelist</em></strong> these.</p>
<p>Blacklisting is about prohibiting a relationship while whitelisting a relationship if it should be there. Notice that you must specify the directions correctly, if a relationship just cannot be there, then you blacklist both directions.</p>
<p>Now we can look into which links that the algorithm could not define. We can see the undirected arcs in the following.</p>
<div class="sourceCode" id="cb547"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb547-1"><a href="probabilistic-models-for-customer-analytics.html#cb547-1" aria-hidden="true" tabindex="-1"></a><span class="fu">undirected.arcs</span>(bn.gs)</span></code></pre></div>
<pre><code>##      from   to    
## [1,] &quot;Atti&quot; &quot;Comm&quot;
## [2,] &quot;Comm&quot; &quot;Atti&quot;</code></pre>
<p>We need to set the direction of the undirected arcs to be able, this is done in the following.</p>
<p><strong>Setting directions manually</strong></p>
<p>Now we can set the relationship manually.</p>
<div class="sourceCode" id="cb549"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb549-1"><a href="probabilistic-models-for-customer-analytics.html#cb549-1" aria-hidden="true" tabindex="-1"></a>bn.gs1 <span class="ot">&lt;-</span> <span class="fu">set.arc</span>(bn.gs, <span class="at">from =</span> <span class="st">&quot;Atti&quot;</span>, <span class="at">to =</span> <span class="st">&quot;Comm&quot;</span>) <span class="co"># to learn the parameters from observational data</span></span>
<span id="cb549-2"><a href="probabilistic-models-for-customer-analytics.html#cb549-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bn.gs1, <span class="at">main =</span> <span class="st">&quot;Grow Shrink_&quot;</span>) </span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-258-1.png" width="720" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb550"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb550-1"><a href="probabilistic-models-for-customer-analytics.html#cb550-1" aria-hidden="true" tabindex="-1"></a><span class="co">#graphviz.plot(bn.gs1, main = &quot;Grow Shrink&quot;)</span></span></code></pre></div>
<p>Now we see that all variables are directed.</p>
<p><strong>Blacklisting and whitelisting relationships</strong></p>
<p>In the following we blacklist a relationship, hence we see that there can be no relationship from commitment to attitude, but not the other way around. Hence if we know such, it could be a good idea to provide that information.</p>
<p>Therefore we are now going to imposing restrictions to the algorithm based on previous knowledge
+ blacklist() and whitelist(): e.g., if Comm cannot theoretically determine Atti, but Atti can determine Comm</p>
<div class="sourceCode" id="cb551"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb551-1"><a href="probabilistic-models-for-customer-analytics.html#cb551-1" aria-hidden="true" tabindex="-1"></a>bn.gs <span class="ot">&lt;-</span> <span class="fu">gs</span>(retention, <span class="at">blacklist =</span> <span class="fu">c</span>(<span class="st">&quot;Comm&quot;</span>, <span class="st">&quot;Atti&quot;</span>))</span>
<span id="cb551-2"><a href="probabilistic-models-for-customer-analytics.html#cb551-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># graphviz.plot(bn.gs, main = &quot;Grow Shrink_ with restriction 1&quot;)</span></span></code></pre></div>
<p>Now we can <strong>blacklist</strong> one more relationship</p>
<p>if arc Atti - Comm should not be there at all</p>
<div class="sourceCode" id="cb552"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb552-1"><a href="probabilistic-models-for-customer-analytics.html#cb552-1" aria-hidden="true" tabindex="-1"></a>blacklist <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">from =</span> <span class="fu">c</span>(<span class="st">&quot;Comm&quot;</span>, <span class="st">&quot;Atti&quot;</span>), <span class="at">to =</span> <span class="fu">c</span>(<span class="st">&quot;Atti&quot;</span>, <span class="st">&quot;Comm&quot;</span>))</span>
<span id="cb552-2"><a href="probabilistic-models-for-customer-analytics.html#cb552-2" aria-hidden="true" tabindex="-1"></a>blacklist</span>
<span id="cb552-3"><a href="probabilistic-models-for-customer-analytics.html#cb552-3" aria-hidden="true" tabindex="-1"></a>bn.gsb <span class="ot">&lt;-</span> <span class="fu">gs</span>(retention, <span class="at">blacklist =</span> blacklist)</span>
<span id="cb552-4"><a href="probabilistic-models-for-customer-analytics.html#cb552-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bn.gsb, <span class="at">main =</span> <span class="st">&quot;Grow Shrink_with restriction 2&quot;</span>)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-260-1.png" width="720" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb553"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb553-1"><a href="probabilistic-models-for-customer-analytics.html#cb553-1" aria-hidden="true" tabindex="-1"></a><span class="co"># graphviz.plot(bn.gsb, main = &quot;Grow Shrink_with restrictions&quot;)</span></span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="left">from</th>
<th align="left">to</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Comm</td>
<td align="left">Atti</td>
</tr>
<tr class="even">
<td align="left">Atti</td>
<td align="left">Comm</td>
</tr>
</tbody>
</table>
</div>
<p>Now we see that the link between Comm and Atti is not there.</p>
<p>We can also allow for a relationship, that is done by <strong>white listing</strong>.</p>
<p>if theoretically the arc Atti -&gt; Comm should be there</p>
<div class="sourceCode" id="cb554"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb554-1"><a href="probabilistic-models-for-customer-analytics.html#cb554-1" aria-hidden="true" tabindex="-1"></a>bn.gsw <span class="ot">&lt;-</span> <span class="fu">gs</span>(retention, <span class="at">whitelist =</span> <span class="fu">c</span>(<span class="st">&quot;Atti&quot;</span>, <span class="st">&quot;Comm&quot;</span>))</span>
<span id="cb554-2"><a href="probabilistic-models-for-customer-analytics.html#cb554-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bn.gsw, <span class="at">main =</span> <span class="st">&quot;Grow Shrink_with restriction 3&quot;</span>)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-261-1.png" width="720" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb555"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb555-1"><a href="probabilistic-models-for-customer-analytics.html#cb555-1" aria-hidden="true" tabindex="-1"></a><span class="co"># graphviz.plot(bn.gsw, main = &quot;Grow Shrink_with restriction 3&quot;)</span></span></code></pre></div>
<p>We see that the arrow is not there again, going from attitude to commitment, because we whitelisted that relationship.</p>
</div>
</div>
<div id="hill-climbing-hc---learning-the-structure-using-a-score-based-algorithm" class="section level5" number="4.2.1.2.2">
<h5><span class="header-section-number">4.2.1.2.2</span> Hill-Climbing (hc) - Learning the structure using a score-based algorithm</h5>
<p><strong>Hill-Climbing (hc) greedy search</strong>, this is made for prediction.</p>
<p>Here we are using an information criteria to predict the relationships and choose on the IC.</p>
<div class="sourceCode" id="cb556"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb556-1"><a href="probabilistic-models-for-customer-analytics.html#cb556-1" aria-hidden="true" tabindex="-1"></a>bn.hc <span class="ot">&lt;-</span> <span class="fu">hc</span>(retention, <span class="at">score =</span> <span class="st">&quot;bde&quot;</span>)</span>
<span id="cb556-2"><a href="probabilistic-models-for-customer-analytics.html#cb556-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span> (bn.hc, <span class="at">main =</span> <span class="st">&quot;Hill Climbing_BDe&quot;</span>) </span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-262-1.png" width="720" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb557"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb557-1"><a href="probabilistic-models-for-customer-analytics.html#cb557-1" aria-hidden="true" tabindex="-1"></a><span class="co">#graphviz.plot (bn.hc, main = &quot;Hill Climbing_BDe&quot;)</span></span>
<span id="cb557-2"><a href="probabilistic-models-for-customer-analytics.html#cb557-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb557-3"><a href="probabilistic-models-for-customer-analytics.html#cb557-3" aria-hidden="true" tabindex="-1"></a>bn.hc <span class="ot">&lt;-</span> <span class="fu">hc</span>(retention, <span class="at">score =</span> <span class="st">&quot;bic&quot;</span>)</span>
<span id="cb557-4"><a href="probabilistic-models-for-customer-analytics.html#cb557-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span> (bn.hc, <span class="at">main =</span> <span class="st">&quot;Hill Climbing_BIC&quot;</span>) </span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-262-2.png" width="720" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb558"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb558-1"><a href="probabilistic-models-for-customer-analytics.html#cb558-1" aria-hidden="true" tabindex="-1"></a><span class="co">#graphviz.plot (bn.hc, main = &quot;Hill Climbing_BIC&quot;) </span></span></code></pre></div>
<p>We see that this suggests two different structures.</p>
</div>
<div id="fitting-the-model-to-the-data-learning-the-probabilities" class="section level5" number="4.2.1.2.3">
<h5><span class="header-section-number">4.2.1.2.3</span> Fitting the model to the data (learning the probabilities)</h5>
<p><em>Notice that in the first section with the manual method, we manually made the conditional probabilities.</em></p>
<p>We are going to learn the model parameters using the Grow-Shrink model that was created earlier.</p>
<p><strong>Bayesian network model</strong></p>
<p>I chose bn.gs1.</p>
<div class="sourceCode" id="cb559"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb559-1"><a href="probabilistic-models-for-customer-analytics.html#cb559-1" aria-hidden="true" tabindex="-1"></a>bn.mle <span class="ot">&lt;-</span> <span class="fu">bn.fit</span>(bn.gs1, <span class="at">data =</span> retention, <span class="at">method =</span> <span class="st">&quot;mle&quot;</span>)</span>
<span id="cb559-2"><a href="probabilistic-models-for-customer-analytics.html#cb559-2" aria-hidden="true" tabindex="-1"></a>bn.mle</span>
<span id="cb559-3"><a href="probabilistic-models-for-customer-analytics.html#cb559-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb559-4"><a href="probabilistic-models-for-customer-analytics.html#cb559-4" aria-hidden="true" tabindex="-1"></a><span class="co">#One by one</span></span>
<span id="cb559-5"><a href="probabilistic-models-for-customer-analytics.html#cb559-5" aria-hidden="true" tabindex="-1"></a>bn.mle<span class="sc">$</span>Fuse <span class="co">#Parent</span></span>
<span id="cb559-6"><a href="probabilistic-models-for-customer-analytics.html#cb559-6" aria-hidden="true" tabindex="-1"></a>bn.mle<span class="sc">$</span>Plea <span class="co">#Parent</span></span>
<span id="cb559-7"><a href="probabilistic-models-for-customer-analytics.html#cb559-7" aria-hidden="true" tabindex="-1"></a>bn.mle<span class="sc">$</span>Atti</span>
<span id="cb559-8"><a href="probabilistic-models-for-customer-analytics.html#cb559-8" aria-hidden="true" tabindex="-1"></a>bn.mle<span class="sc">$</span>Comm</span>
<span id="cb559-9"><a href="probabilistic-models-for-customer-analytics.html#cb559-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb559-10"><a href="probabilistic-models-for-customer-analytics.html#cb559-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Other useful functions </span></span>
<span id="cb559-11"><a href="probabilistic-models-for-customer-analytics.html#cb559-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># set.arc(net, from = &quot;A&quot;, to = &quot;T&quot;)</span></span>
<span id="cb559-12"><a href="probabilistic-models-for-customer-analytics.html#cb559-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># drop.arc(net, from=&quot;A&quot;, to=&quot;&quot;T)</span></span>
<span id="cb559-13"><a href="probabilistic-models-for-customer-analytics.html#cb559-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># e.g. newnet = drop.arc(net, from = &quot;T&quot;, to = &quot;A&quot;)</span></span>
<span id="cb559-14"><a href="probabilistic-models-for-customer-analytics.html#cb559-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Test for the conditional independence between variables </span></span>
<span id="cb559-15"><a href="probabilistic-models-for-customer-analytics.html#cb559-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ci.test(&quot;T&quot;, &quot;E&quot;, c(&quot;O&quot;, &quot;R&quot;), test = &quot;x2&quot;, data = data)</span></span></code></pre></div>
<pre><code>## 
##   Bayesian network parameters
## 
##   Parameters of node Fuse (multinomial distribution)
## 
## Conditional probability table:
##    High    Low    Med 
## 0.7206 0.0212 0.2582 
## 
##   Parameters of node Plea (multinomial distribution)
## 
## Conditional probability table:
##    High    Low    Med 
## 0.4346 0.0094 0.5560 
## 
##   Parameters of node Atti (multinomial distribution)
## 
## Conditional probability table:
##  
## , , Plea = High
## 
##       Fuse
## Atti         High        Low        Med
##   High 0.91332059 0.00000000 0.58676208
##   Low  0.00000000 0.02222222 0.00000000
##   Med  0.08667941 0.97777778 0.41323792
## 
## , , Plea = Low
## 
##       Fuse
## Atti         High        Low        Med
##   High 0.00000000 0.00000000 0.36363636
##   Low  1.00000000 1.00000000 0.45454545
##   Med  0.00000000 0.00000000 0.18181818
## 
## , , Plea = Med
## 
##       Fuse
## Atti         High        Low        Med
##   High 0.52576288 0.28333333 0.19694868
##   Low  0.00000000 0.00000000 0.00000000
##   Med  0.47423712 0.71666667 0.80305132
## 
## 
##   Parameters of node Comm (multinomial distribution)
## 
## Conditional probability table:
##  
## , , Plea = High, Atti = High
## 
##       Fuse
## Comm         High Low        Med
##   High 0.89602233     0.56402439
##   Low  0.00000000     0.00000000
##   Med  0.10397767     0.43597561
## 
## , , Plea = Low, Atti = High
## 
##       Fuse
## Comm   High Low        Med
##   High          0.50000000
##   Low           0.25000000
##   Med           0.25000000
## 
## , , Plea = Med, Atti = High
## 
##       Fuse
## Comm         High        Low        Med
##   High 0.30066603 0.00000000 0.11267606
##   Low  0.00000000 1.00000000 0.00000000
##   Med  0.69933397 0.00000000 0.88732394
## 
## , , Plea = High, Atti = Low
## 
##       Fuse
## Comm   High        Low Med
##   High      1.00000000    
##   Low       0.00000000    
##   Med       0.00000000    
## 
## , , Plea = Low, Atti = Low
## 
##       Fuse
## Comm         High        Low        Med
##   High 0.00000000 0.00000000 0.00000000
##   Low  1.00000000 0.00000000 0.40000000
##   Med  0.00000000 1.00000000 0.60000000
## 
## , , Plea = Med, Atti = Low
## 
##       Fuse
## Comm   High Low Med
##   High             
##   Low              
##   Med              
## 
## , , Plea = High, Atti = Med
## 
##       Fuse
## Comm         High        Low        Med
##   High 0.61029412 0.00000000 0.67532468
##   Low  0.00000000 0.00000000 0.00000000
##   Med  0.38970588 1.00000000 0.32467532
## 
## , , Plea = Low, Atti = Med
## 
##       Fuse
## Comm   High Low        Med
##   High          0.00000000
##   Low           0.50000000
##   Med           0.50000000
## 
## , , Plea = Med, Atti = Med
## 
##       Fuse
## Comm         High        Low        Med
##   High 0.17405063 0.00000000 0.01899827
##   Low  0.00000000 0.00000000 0.00000000
##   Med  0.82594937 1.00000000 0.98100173
## 
## 
## 
##   Parameters of node Fuse (multinomial distribution)
## 
## Conditional probability table:
##    High    Low    Med 
## 0.7206 0.0212 0.2582 
## 
##   Parameters of node Plea (multinomial distribution)
## 
## Conditional probability table:
##    High    Low    Med 
## 0.4346 0.0094 0.5560 
## 
##   Parameters of node Atti (multinomial distribution)
## 
## Conditional probability table:
##  
## , , Plea = High
## 
##       Fuse
## Atti         High        Low        Med
##   High 0.91332059 0.00000000 0.58676208
##   Low  0.00000000 0.02222222 0.00000000
##   Med  0.08667941 0.97777778 0.41323792
## 
## , , Plea = Low
## 
##       Fuse
## Atti         High        Low        Med
##   High 0.00000000 0.00000000 0.36363636
##   Low  1.00000000 1.00000000 0.45454545
##   Med  0.00000000 0.00000000 0.18181818
## 
## , , Plea = Med
## 
##       Fuse
## Atti         High        Low        Med
##   High 0.52576288 0.28333333 0.19694868
##   Low  0.00000000 0.00000000 0.00000000
##   Med  0.47423712 0.71666667 0.80305132
## 
## 
##   Parameters of node Comm (multinomial distribution)
## 
## Conditional probability table:
##  
## , , Plea = High, Atti = High
## 
##       Fuse
## Comm         High Low        Med
##   High 0.89602233     0.56402439
##   Low  0.00000000     0.00000000
##   Med  0.10397767     0.43597561
## 
## , , Plea = Low, Atti = High
## 
##       Fuse
## Comm   High Low        Med
##   High          0.50000000
##   Low           0.25000000
##   Med           0.25000000
## 
## , , Plea = Med, Atti = High
## 
##       Fuse
## Comm         High        Low        Med
##   High 0.30066603 0.00000000 0.11267606
##   Low  0.00000000 1.00000000 0.00000000
##   Med  0.69933397 0.00000000 0.88732394
## 
## , , Plea = High, Atti = Low
## 
##       Fuse
## Comm   High        Low Med
##   High      1.00000000    
##   Low       0.00000000    
##   Med       0.00000000    
## 
## , , Plea = Low, Atti = Low
## 
##       Fuse
## Comm         High        Low        Med
##   High 0.00000000 0.00000000 0.00000000
##   Low  1.00000000 0.00000000 0.40000000
##   Med  0.00000000 1.00000000 0.60000000
## 
## , , Plea = Med, Atti = Low
## 
##       Fuse
## Comm   High Low Med
##   High             
##   Low              
##   Med              
## 
## , , Plea = High, Atti = Med
## 
##       Fuse
## Comm         High        Low        Med
##   High 0.61029412 0.00000000 0.67532468
##   Low  0.00000000 0.00000000 0.00000000
##   Med  0.38970588 1.00000000 0.32467532
## 
## , , Plea = Low, Atti = Med
## 
##       Fuse
## Comm   High Low        Med
##   High          0.00000000
##   Low           0.50000000
##   Med           0.50000000
## 
## , , Plea = Med, Atti = Med
## 
##       Fuse
## Comm         High        Low        Med
##   High 0.17405063 0.00000000 0.01899827
##   Low  0.00000000 0.00000000 0.00000000
##   Med  0.82594937 1.00000000 0.98100173</code></pre>
</div>
<div id="alternatives-to-grow-shrink-and-hc" class="section level5" number="4.2.1.2.4">
<h5><span class="header-section-number">4.2.1.2.4</span> Alternatives to Grow-Shrink and HC</h5>
<p>These are others algorithms to constructing the Bayesian Network.</p>
<div class="sourceCode" id="cb561"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb561-1"><a href="probabilistic-models-for-customer-analytics.html#cb561-1" aria-hidden="true" tabindex="-1"></a><span class="co"># other constraint-based algorithms have been developed</span></span>
<span id="cb561-2"><a href="probabilistic-models-for-customer-analytics.html#cb561-2" aria-hidden="true" tabindex="-1"></a>    bn2 <span class="ot">&lt;-</span> <span class="fu">iamb</span>(retention, <span class="at">alpha =</span> <span class="fl">0.05</span>, <span class="at">test =</span><span class="st">&quot;mi&quot;</span>)</span>
<span id="cb561-3"><a href="probabilistic-models-for-customer-analytics.html#cb561-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">#graphviz.plot (bn2, main = &quot;Iamb1_mi&quot; ) </span></span>
<span id="cb561-4"><a href="probabilistic-models-for-customer-analytics.html#cb561-4" aria-hidden="true" tabindex="-1"></a>    bn3 <span class="ot">&lt;-</span> <span class="fu">fast.iamb</span>(retention, <span class="at">alpha =</span> <span class="fl">0.05</span>, <span class="at">test =</span><span class="st">&quot;mi&quot;</span>)</span>
<span id="cb561-5"><a href="probabilistic-models-for-customer-analytics.html#cb561-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">#graphviz.plot (bn3, main = &quot;FastIamb_mi&quot;) </span></span>
<span id="cb561-6"><a href="probabilistic-models-for-customer-analytics.html#cb561-6" aria-hidden="true" tabindex="-1"></a>    bn4 <span class="ot">&lt;-</span> <span class="fu">inter.iamb</span>(retention, <span class="at">alpha =</span> <span class="fl">0.05</span>, <span class="at">test =</span><span class="st">&quot;mi&quot;</span> )</span>
<span id="cb561-7"><a href="probabilistic-models-for-customer-analytics.html#cb561-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">#graphviz.plot (bn4, main = &quot;InterIamb_mi&quot;) </span></span>
<span id="cb561-8"><a href="probabilistic-models-for-customer-analytics.html#cb561-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># in the optimal case, all will return the same graph</span></span></code></pre></div>
</div>
</div>
</div>
<div id="model-evaluation-1" class="section level3" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> 2. Model evaluation</h3>
<p>Now we are going to test how good the model is.</p>
<div id="i.-metrics-of-model-complexity" class="section level4" number="4.2.2.1">
<h4><span class="header-section-number">4.2.2.1</span> I. Metrics of model complexity</h4>
<div class="sourceCode" id="cb562"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb562-1"><a href="probabilistic-models-for-customer-analytics.html#cb562-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nodes</span>(bn.mle)</span>
<span id="cb562-2"><a href="probabilistic-models-for-customer-analytics.html#cb562-2" aria-hidden="true" tabindex="-1"></a><span class="fu">arcs</span>(bn.mle)</span>
<span id="cb562-3"><a href="probabilistic-models-for-customer-analytics.html#cb562-3" aria-hidden="true" tabindex="-1"></a>bn.mle</span>
<span id="cb562-4"><a href="probabilistic-models-for-customer-analytics.html#cb562-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bn.gs1)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-265-1.png" width="720" style="display: block; margin: auto;" /></p>
<pre><code>## [1] &quot;Fuse&quot; &quot;Plea&quot; &quot;Atti&quot; &quot;Comm&quot;
##      from   to    
## [1,] &quot;Fuse&quot; &quot;Atti&quot;
## [2,] &quot;Fuse&quot; &quot;Comm&quot;
## [3,] &quot;Plea&quot; &quot;Atti&quot;
## [4,] &quot;Plea&quot; &quot;Comm&quot;
## [5,] &quot;Atti&quot; &quot;Comm&quot;
## 
##   Bayesian network parameters
## 
##   Parameters of node Fuse (multinomial distribution)
## 
## Conditional probability table:
##    High    Low    Med 
## 0.7206 0.0212 0.2582 
## 
##   Parameters of node Plea (multinomial distribution)
## 
## Conditional probability table:
##    High    Low    Med 
## 0.4346 0.0094 0.5560 
## 
##   Parameters of node Atti (multinomial distribution)
## 
## Conditional probability table:
##  
## , , Plea = High
## 
##       Fuse
## Atti         High        Low        Med
##   High 0.91332059 0.00000000 0.58676208
##   Low  0.00000000 0.02222222 0.00000000
##   Med  0.08667941 0.97777778 0.41323792
## 
## , , Plea = Low
## 
##       Fuse
## Atti         High        Low        Med
##   High 0.00000000 0.00000000 0.36363636
##   Low  1.00000000 1.00000000 0.45454545
##   Med  0.00000000 0.00000000 0.18181818
## 
## , , Plea = Med
## 
##       Fuse
## Atti         High        Low        Med
##   High 0.52576288 0.28333333 0.19694868
##   Low  0.00000000 0.00000000 0.00000000
##   Med  0.47423712 0.71666667 0.80305132
## 
## 
##   Parameters of node Comm (multinomial distribution)
## 
## Conditional probability table:
##  
## , , Plea = High, Atti = High
## 
##       Fuse
## Comm         High Low        Med
##   High 0.89602233     0.56402439
##   Low  0.00000000     0.00000000
##   Med  0.10397767     0.43597561
## 
## , , Plea = Low, Atti = High
## 
##       Fuse
## Comm   High Low        Med
##   High          0.50000000
##   Low           0.25000000
##   Med           0.25000000
## 
## , , Plea = Med, Atti = High
## 
##       Fuse
## Comm         High        Low        Med
##   High 0.30066603 0.00000000 0.11267606
##   Low  0.00000000 1.00000000 0.00000000
##   Med  0.69933397 0.00000000 0.88732394
## 
## , , Plea = High, Atti = Low
## 
##       Fuse
## Comm   High        Low Med
##   High      1.00000000    
##   Low       0.00000000    
##   Med       0.00000000    
## 
## , , Plea = Low, Atti = Low
## 
##       Fuse
## Comm         High        Low        Med
##   High 0.00000000 0.00000000 0.00000000
##   Low  1.00000000 0.00000000 0.40000000
##   Med  0.00000000 1.00000000 0.60000000
## 
## , , Plea = Med, Atti = Low
## 
##       Fuse
## Comm   High Low Med
##   High             
##   Low              
##   Med              
## 
## , , Plea = High, Atti = Med
## 
##       Fuse
## Comm         High        Low        Med
##   High 0.61029412 0.00000000 0.67532468
##   Low  0.00000000 0.00000000 0.00000000
##   Med  0.38970588 1.00000000 0.32467532
## 
## , , Plea = Low, Atti = Med
## 
##       Fuse
## Comm   High Low        Med
##   High          0.00000000
##   Low           0.50000000
##   Med           0.50000000
## 
## , , Plea = Med, Atti = Med
## 
##       Fuse
## Comm         High        Low        Med
##   High 0.17405063 0.00000000 0.01899827
##   Low  0.00000000 0.00000000 0.00000000
##   Med  0.82594937 1.00000000 0.98100173</code></pre>
<p>We see that the model is rather simple, not many variables and links.</p>
</div>
<div id="ii.-metrics-of-model-sensitivity" class="section level4" number="4.2.2.2">
<h4><span class="header-section-number">4.2.2.2</span> II. Metrics of model sensitivity</h4>
<p>Test if any two nodes are d-separated, meaning that information for one variables to another flows or not. For this I refer back to the conditional independence. In the following we see that we just compare two nodes, although one could also add the scenario of imposing evidence (hence controlling for a given variable).</p>
<div class="sourceCode" id="cb564"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb564-1"><a href="probabilistic-models-for-customer-analytics.html#cb564-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dsep</span>(bn.mle, <span class="at">x =</span> <span class="st">&quot;Plea&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Fuse&quot;</span>)</span>
<span id="cb564-2"><a href="probabilistic-models-for-customer-analytics.html#cb564-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dsep</span>(bn.mle, <span class="at">x =</span> <span class="st">&quot;Plea&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Comm&quot;</span>)</span></code></pre></div>
<pre><code>## [1] TRUE
## [1] FALSE</code></pre>
<p>We see that Pleasure and functional usefulness is not dependent on each other, although pleasure and communication is not separated, hence dependent.</p>
</div>
<div id="iii.-evaluate-the-arc.strength" class="section level4" number="4.2.2.3">
<h4><span class="header-section-number">4.2.2.3</span> III. Evaluate the arc.strength()</h4>
<div id="for-the-growth-shrink" class="section level5" number="4.2.2.3.1">
<h5><span class="header-section-number">4.2.2.3.1</span> For the growth shrink</h5>
<p>Now we want to see how strong the relationship is between the nodes. Normally we have beta values as normally, hence we can look at:</p>
<ol style="list-style-type: decimal">
<li>p-values: with criterion = “x2” or “mi” (mutual information), the output reports the p-value for the test. The lower the p-value, the stronger the relationship.</li>
<li>using BIC: with criterion =“bic” reports the change in the BIC score of the net caused by an arc removal.The more negative the change, means the BIC score will go worse if we delete that arc (i.e. the arc is important for the model).</li>
</ol>
<div class="sourceCode" id="cb566"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb566-1"><a href="probabilistic-models-for-customer-analytics.html#cb566-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb566-2"><a href="probabilistic-models-for-customer-analytics.html#cb566-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">cipen =</span> <span class="dv">0</span>)</span>
<span id="cb566-3"><a href="probabilistic-models-for-customer-analytics.html#cb566-3" aria-hidden="true" tabindex="-1"></a><span class="fu">arc.strength</span>(bn.gs1, retention, <span class="at">criterion =</span> <span class="st">&quot;x2&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb566-4"><a href="probabilistic-models-for-customer-analytics.html#cb566-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb566-5"><a href="probabilistic-models-for-customer-analytics.html#cb566-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">arrange</span>(strength)</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="left">from</th>
<th align="left">to</th>
<th align="right">strength</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Plea</td>
<td align="left">Atti</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Plea</td>
<td align="left">Comm</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">Fuse</td>
<td align="left">Comm</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Fuse</td>
<td align="left">Atti</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">Atti</td>
<td align="left">Comm</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
<p>We see that the strength between Pleasure and Attitude is not strong, hence it makes sense that not all models find the relationship. That also means the the significance of this relationship is low.</p>
<div class="sourceCode" id="cb567"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb567-1"><a href="probabilistic-models-for-customer-analytics.html#cb567-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arc.strength</span>(bn.gs1, retention, <span class="at">criterion =</span> <span class="st">&quot;bic&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb567-2"><a href="probabilistic-models-for-customer-analytics.html#cb567-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb567-3"><a href="probabilistic-models-for-customer-analytics.html#cb567-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">arrange</span>(strength)</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="left">from</th>
<th align="left">to</th>
<th align="right">strength</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Plea</td>
<td align="left">Comm</td>
<td align="right">-668.21187</td>
</tr>
<tr class="even">
<td align="left">Plea</td>
<td align="left">Atti</td>
<td align="right">-638.17237</td>
</tr>
<tr class="odd">
<td align="left">Fuse</td>
<td align="left">Atti</td>
<td align="right">-302.40435</td>
</tr>
<tr class="even">
<td align="left">Fuse</td>
<td align="left">Comm</td>
<td align="right">-147.83732</td>
</tr>
<tr class="odd">
<td align="left">Atti</td>
<td align="left">Comm</td>
<td align="right">40.48931</td>
</tr>
</tbody>
</table>
</div>
<p>The output reveals that, if we remove Plea -&gt; Comm, BIC will decrease with -668.211, which in bnlearn means the model will get worse. The output reveals that, if we remove Atti -&gt; Comm, BIC will increase with 40.48, which in bnlearn package means the model may improve based on this index.</p>
<p>We see that the relationship between Pleasure and commitment for instance is very high.</p>
</div>
<div id="for-the-hill-climbing-structure" class="section level5" number="4.2.2.3.2">
<h5><span class="header-section-number">4.2.2.3.2</span> For the hill-climbing structure</h5>
<p>Notice that we are just merely repeating the same here, just with the other method.</p>
<div class="sourceCode" id="cb568"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb568-1"><a href="probabilistic-models-for-customer-analytics.html#cb568-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arc.strength</span>(bn.hc, retention, <span class="at">criterion =</span> <span class="st">&quot;bic&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb568-2"><a href="probabilistic-models-for-customer-analytics.html#cb568-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb568-3"><a href="probabilistic-models-for-customer-analytics.html#cb568-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">arrange</span>(strength)</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="left">from</th>
<th align="left">to</th>
<th align="right">strength</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Plea</td>
<td align="left">Comm</td>
<td align="right">-1221.6057</td>
</tr>
<tr class="even">
<td align="left">Plea</td>
<td align="left">Atti</td>
<td align="right">-638.1724</td>
</tr>
<tr class="odd">
<td align="left">Fuse</td>
<td align="left">Atti</td>
<td align="right">-302.4043</td>
</tr>
<tr class="even">
<td align="left">Fuse</td>
<td align="left">Comm</td>
<td align="right">-277.3471</td>
</tr>
</tbody>
</table>
</div>
<p>As expected, all strenghts are negative as the model is fitted against BIC, hence if it could improve the model by removing the given link, then it would do so.</p>
</div>
<div id="different-information-criteria-evaluations" class="section level5" number="4.2.2.3.3">
<h5><span class="header-section-number">4.2.2.3.3</span> Different information criteria evaluations</h5>
<p>Metrics of evaluation and selection among several dags:</p>
<ul>
<li>BIC, BDe, AIC scores are used to compare alternative structures and choose the best. In bnlearn, AIC, BIC, BDE closer to zero means better model; often the three indexesdo not agree. See the following examples:</li>
</ul>
<div class="sourceCode" id="cb569"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb569-1"><a href="probabilistic-models-for-customer-analytics.html#cb569-1" aria-hidden="true" tabindex="-1"></a>bnlearn<span class="sc">::</span><span class="fu">score</span>(bn.gs1, retention, <span class="at">type =</span> <span class="st">&quot;aic&quot;</span>)</span>
<span id="cb569-2"><a href="probabilistic-models-for-customer-analytics.html#cb569-2" aria-hidden="true" tabindex="-1"></a>bnlearn<span class="sc">::</span><span class="fu">score</span>(bn.hc, retention, <span class="at">type =</span> <span class="st">&quot;aic&quot;</span>)</span>
<span id="cb569-3"><a href="probabilistic-models-for-customer-analytics.html#cb569-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb569-4"><a href="probabilistic-models-for-customer-analytics.html#cb569-4" aria-hidden="true" tabindex="-1"></a>bnlearn<span class="sc">::</span><span class="fu">score</span>(bn.gs1, retention, <span class="at">type =</span> <span class="st">&quot;bic&quot;</span>)</span>
<span id="cb569-5"><a href="probabilistic-models-for-customer-analytics.html#cb569-5" aria-hidden="true" tabindex="-1"></a>bnlearn<span class="sc">::</span><span class="fu">score</span>(bn.hc, retention, <span class="at">type =</span> <span class="st">&quot;bic&quot;</span>)</span>
<span id="cb569-6"><a href="probabilistic-models-for-customer-analytics.html#cb569-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb569-7"><a href="probabilistic-models-for-customer-analytics.html#cb569-7" aria-hidden="true" tabindex="-1"></a>bnlearn<span class="sc">::</span><span class="fu">score</span>(bn.gs1, retention, <span class="at">type =</span> <span class="st">&quot;bde&quot;</span>)</span>
<span id="cb569-8"><a href="probabilistic-models-for-customer-analytics.html#cb569-8" aria-hidden="true" tabindex="-1"></a>bnlearn<span class="sc">::</span><span class="fu">score</span>(bn.hc, retention, <span class="at">type =</span> <span class="st">&quot;bde&quot;</span>)</span></code></pre></div>
<pre><code>## [1] -11842.95
## [1] -11919.77
## [1] -12090.61
## [1] -12050.12
## [1] -11904.39
## [1] -11983.02</code></pre>
<p>We see that the models that we have learned through HC ans GS, they appear to all be the same. Probably because they were trained on the same IC, during the lecture we see that there is a difference.</p>
</div>
</div>
<div id="iv.-metrics-of-predictive-accuracy-error-rate-confusion-matrix-auc" class="section level4" number="4.2.2.4">
<h4><span class="header-section-number">4.2.2.4</span> IV. Metrics of predictive accuracy (error rate, confusion matrix, AUC)</h4>
<p>Here we are going to predict one variable and see what the error rate will be.</p>
<div class="sourceCode" id="cb571"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb571-1"><a href="probabilistic-models-for-customer-analytics.html#cb571-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gRain)</span>
<span id="cb571-2"><a href="probabilistic-models-for-customer-analytics.html#cb571-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gRbase)</span>
<span id="cb571-3"><a href="probabilistic-models-for-customer-analytics.html#cb571-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span> (caTools)</span></code></pre></div>
<div id="cross-validation-1" class="section level5" number="4.2.2.4.1">
<h5><span class="header-section-number">4.2.2.4.1</span> Cross validation</h5>
<p>This function requires as one of its parameters only structure (not the full bayesian model). We use classification error (“pred”) for the node Comm (our target) as a loss function.</p>
<div class="sourceCode" id="cb572"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb572-1"><a href="probabilistic-models-for-customer-analytics.html#cb572-1" aria-hidden="true" tabindex="-1"></a>netcv <span class="ot">&lt;-</span> <span class="fu">bn.cv</span>(retention, bn.gs1</span>
<span id="cb572-2"><a href="probabilistic-models-for-customer-analytics.html#cb572-2" aria-hidden="true" tabindex="-1"></a>               ,<span class="at">loss =</span><span class="st">&quot;pred&quot;</span> <span class="co">#Gives error rate</span></span>
<span id="cb572-3"><a href="probabilistic-models-for-customer-analytics.html#cb572-3" aria-hidden="true" tabindex="-1"></a>               ,<span class="at">k =</span> <span class="dv">5</span></span>
<span id="cb572-4"><a href="probabilistic-models-for-customer-analytics.html#cb572-4" aria-hidden="true" tabindex="-1"></a>               ,<span class="at">loss.args =</span> <span class="fu">list</span>(<span class="at">target =</span> <span class="st">&quot;Comm&quot;</span>)</span>
<span id="cb572-5"><a href="probabilistic-models-for-customer-analytics.html#cb572-5" aria-hidden="true" tabindex="-1"></a>               ,<span class="at">debug =</span> <span class="cn">TRUE</span>)</span>
<span id="cb572-6"><a href="probabilistic-models-for-customer-analytics.html#cb572-6" aria-hidden="true" tabindex="-1"></a>netcv</span></code></pre></div>
<pre><code>## * splitting 5000 data in 5 subsets.
## ----------------------------------------------------------------
## * fitting the parameters of the network from the training sample.
## * applying the loss function to the data from the test sample.
##   &gt; classification error for node Comm is 0.189 .
##   @ total loss is 0.189 .
## ----------------------------------------------------------------
## * fitting the parameters of the network from the training sample.
## * applying the loss function to the data from the test sample.
##   &gt; classification error for node Comm is 0.181 .
##   @ total loss is 0.181 .
## ----------------------------------------------------------------
## * fitting the parameters of the network from the training sample.
## * applying the loss function to the data from the test sample.
##   &gt; classification error for node Comm is 0.184 .
##   @ total loss is 0.184 .
## ----------------------------------------------------------------
## * fitting the parameters of the network from the training sample.
## * applying the loss function to the data from the test sample.
##   &gt; classification error for node Comm is 0.1861862 .
##   @ total loss is 0.1861862 .
## ----------------------------------------------------------------
## * fitting the parameters of the network from the training sample.
## * applying the loss function to the data from the test sample.
##   &gt; classification error for node Comm is 0.1961962 .
##   @ total loss is 0.1961962 .
## ----------------------------------------------------------------
## * summary of the observed values for the loss function:
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.1810  0.1840  0.1862  0.1873  0.1890  0.1962 
## 
##   k-fold cross-validation for Bayesian networks
## 
##   target network structure:
##    [Fuse][Plea][Atti|Fuse:Plea][Comm|Fuse:Plea:Atti] 
##   number of folds:                       5 
##   loss function:                         Classification Error 
##   training node:                         Comm 
##   expected loss:                         0.1872765</code></pre>
<p>The prediction accuracy of Comm based on 5-fold cross validation is quite high (1-0.18 = 0.82) one can also look at each individual variables.</p>
<p>Using a testing sample to evaluate the model performance <strong><em>we need to transform the full bayesian model into a gRain object</em></strong></p>
<div class="sourceCode" id="cb574"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb574-1"><a href="probabilistic-models-for-customer-analytics.html#cb574-1" aria-hidden="true" tabindex="-1"></a>net1 <span class="ot">&lt;-</span> <span class="fu">as.grain</span>(bn.mle)</span>
<span id="cb574-2"><a href="probabilistic-models-for-customer-analytics.html#cb574-2" aria-hidden="true" tabindex="-1"></a>net1</span></code></pre></div>
<pre><code>## Independence network: Compiled: TRUE Propagated: FALSE 
##   Nodes: chr [1:4] &quot;Fuse&quot; &quot;Plea&quot; &quot;Atti&quot; &quot;Comm&quot;</code></pre>
<p>assuming Comm is the target node, we predict the probability of Comm being High, Medium and Large using net1 in the test sample.</p>
<div class="sourceCode" id="cb576"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb576-1"><a href="probabilistic-models-for-customer-analytics.html#cb576-1" aria-hidden="true" tabindex="-1"></a>predComm <span class="ot">&lt;-</span> <span class="fu">predict</span>(net1</span>
<span id="cb576-2"><a href="probabilistic-models-for-customer-analytics.html#cb576-2" aria-hidden="true" tabindex="-1"></a>                   ,<span class="at">response =</span> <span class="fu">c</span>(<span class="st">&quot;Comm&quot;</span>)</span>
<span id="cb576-3"><a href="probabilistic-models-for-customer-analytics.html#cb576-3" aria-hidden="true" tabindex="-1"></a>                   ,<span class="at">newdata =</span> retention_test</span>
<span id="cb576-4"><a href="probabilistic-models-for-customer-analytics.html#cb576-4" aria-hidden="true" tabindex="-1"></a>                   ,<span class="at">predictors =</span> <span class="fu">names</span>(retention_test)[<span class="sc">-</span><span class="dv">4</span>] <span class="co">#Removing target variable</span></span>
<span id="cb576-5"><a href="probabilistic-models-for-customer-analytics.html#cb576-5" aria-hidden="true" tabindex="-1"></a>                   ,<span class="at">type =</span> <span class="st">&quot;distribution&quot;</span> <span class="co">#This returns likelihoods</span></span>
<span id="cb576-6"><a href="probabilistic-models-for-customer-analytics.html#cb576-6" aria-hidden="true" tabindex="-1"></a>                   )</span>
<span id="cb576-7"><a href="probabilistic-models-for-customer-analytics.html#cb576-7" aria-hidden="true" tabindex="-1"></a>predComm <span class="ot">=</span> predComm<span class="sc">$</span>pred<span class="sc">$</span>Comm</span>
<span id="cb576-8"><a href="probabilistic-models-for-customer-analytics.html#cb576-8" aria-hidden="true" tabindex="-1"></a><span class="co">#View(predComm) #Shows the likelihood</span></span>
<span id="cb576-9"><a href="probabilistic-models-for-customer-analytics.html#cb576-9" aria-hidden="true" tabindex="-1"></a><span class="co"># write.csv(predComm, &quot;PredComm.csv&quot;, row.names = FALSE) </span></span></code></pre></div>
<p>Or add the predictions to the data file creating a new variable.</p>
<p>Instead of probabilities of 0 or 1, one can save the actual CLASS (0/1).</p>
<div class="sourceCode" id="cb577"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb577-1"><a href="probabilistic-models-for-customer-analytics.html#cb577-1" aria-hidden="true" tabindex="-1"></a>predComm_class <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="at">object =</span> net1</span>
<span id="cb577-2"><a href="probabilistic-models-for-customer-analytics.html#cb577-2" aria-hidden="true" tabindex="-1"></a>                          ,<span class="at">response =</span> <span class="fu">c</span>(<span class="st">&quot;Comm&quot;</span>)</span>
<span id="cb577-3"><a href="probabilistic-models-for-customer-analytics.html#cb577-3" aria-hidden="true" tabindex="-1"></a>                          ,<span class="at">newdata =</span> retention_test</span>
<span id="cb577-4"><a href="probabilistic-models-for-customer-analytics.html#cb577-4" aria-hidden="true" tabindex="-1"></a>                          ,<span class="at">predictors =</span> <span class="fu">names</span> (retention_test)[<span class="sc">-</span><span class="dv">4</span>] <span class="co">#Removing target variable</span></span>
<span id="cb577-5"><a href="probabilistic-models-for-customer-analytics.html#cb577-5" aria-hidden="true" tabindex="-1"></a>                          ,<span class="at">type =</span> <span class="st">&quot;class&quot;</span> <span class="co">#This just returns the class</span></span>
<span id="cb577-6"><a href="probabilistic-models-for-customer-analytics.html#cb577-6" aria-hidden="true" tabindex="-1"></a>                          )</span>
<span id="cb577-7"><a href="probabilistic-models-for-customer-analytics.html#cb577-7" aria-hidden="true" tabindex="-1"></a>predCommclass <span class="ot">&lt;-</span> predComm_class<span class="sc">$</span>pred<span class="sc">$</span>Comm</span>
<span id="cb577-8"><a href="probabilistic-models-for-customer-analytics.html#cb577-8" aria-hidden="true" tabindex="-1"></a><span class="co">#View(predCommclass)</span></span>
<span id="cb577-9"><a href="probabilistic-models-for-customer-analytics.html#cb577-9" aria-hidden="true" tabindex="-1"></a><span class="co"># write.csv(predictionsTclass, &quot;PredictedTclass&quot;)</span></span></code></pre></div>
</div>
<div id="alternative-approach-to-fit-and-predict-without-grain" class="section level5" number="4.2.2.4.2">
<h5><span class="header-section-number">4.2.2.4.2</span> Alternative approach to fit and predict (Without gRain)</h5>
<p>A quick method WITHOUT using package gRain.</p>
<div class="sourceCode" id="cb578"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb578-1"><a href="probabilistic-models-for-customer-analytics.html#cb578-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Speficy network</span></span>
<span id="cb578-2"><a href="probabilistic-models-for-customer-analytics.html#cb578-2" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">model2network</span>(<span class="st">&quot;[Fuse][Plea][Atti|Fuse:Plea][Comm|Fuse:Plea:Atti]&quot;</span>)</span>
<span id="cb578-3"><a href="probabilistic-models-for-customer-analytics.html#cb578-3" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb578-4"><a href="probabilistic-models-for-customer-analytics.html#cb578-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Fit the data</span></span>
<span id="cb578-5"><a href="probabilistic-models-for-customer-analytics.html#cb578-5" aria-hidden="true" tabindex="-1"></a>bn.mle1 <span class="ot">&lt;-</span> <span class="fu">bn.fit</span>(model</span>
<span id="cb578-6"><a href="probabilistic-models-for-customer-analytics.html#cb578-6" aria-hidden="true" tabindex="-1"></a>                  ,retention) </span>
<span id="cb578-7"><a href="probabilistic-models-for-customer-analytics.html#cb578-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb578-8"><a href="probabilistic-models-for-customer-analytics.html#cb578-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Make predictions</span></span>
<span id="cb578-9"><a href="probabilistic-models-for-customer-analytics.html#cb578-9" aria-hidden="true" tabindex="-1"></a>predComm1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(bn.mle1</span>
<span id="cb578-10"><a href="probabilistic-models-for-customer-analytics.html#cb578-10" aria-hidden="true" tabindex="-1"></a>                     ,<span class="at">node =</span> <span class="st">&quot;Comm&quot;</span></span>
<span id="cb578-11"><a href="probabilistic-models-for-customer-analytics.html#cb578-11" aria-hidden="true" tabindex="-1"></a>                     ,<span class="at">data =</span> retention_test)</span>
<span id="cb578-12"><a href="probabilistic-models-for-customer-analytics.html#cb578-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb578-13"><a href="probabilistic-models-for-customer-analytics.html#cb578-13" aria-hidden="true" tabindex="-1"></a><span class="co">#See the predictions compared to previous predictions.</span></span>
<span id="cb578-14"><a href="probabilistic-models-for-customer-analytics.html#cb578-14" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(predCommclass, predComm1)</span></code></pre></div>
<pre><code>##              predComm1
## predCommclass High  Low  Med
##          High 1098    0    0
##          Low     0   27    1
##          Med     0    0 1374</code></pre>
<p>We see that this methods almost makes the same results.</p>
<p>We cam also make a <strong>confusion matrix</strong>.</p>
<div class="sourceCode" id="cb580"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb580-1"><a href="probabilistic-models-for-customer-analytics.html#cb580-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(predComm_class<span class="sc">$</span>pred<span class="sc">$</span>Comm, retention_test<span class="sc">$</span>Comm)</span></code></pre></div>
<pre><code>##       
##        High  Low  Med
##   High  903    1  194
##   Low     2   25    1
##   Med   250    1 1123</code></pre>
<p>Plotting <strong>ROC and AUC</strong></p>
<p><em>Notice that ROC and AUC is made for a two class scenario, hence it returns nine lines, one for each line.</em></p>
<div class="sourceCode" id="cb582"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb582-1"><a href="probabilistic-models-for-customer-analytics.html#cb582-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caTools)</span>
<span id="cb582-2"><a href="probabilistic-models-for-customer-analytics.html#cb582-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colAUC</span>(predComm, retention_test[ ,<span class="dv">4</span>], <span class="at">plotROC =</span> <span class="cn">TRUE</span>) <span class="co">#requires the predicted probabilities, not the predicted class</span></span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-278-1.png" width="720" style="display: block; margin: auto;" /></p>
<pre><code>##                   High       Low       Med
## High vs. Low 0.9910855 0.9998397 0.9195447
## High vs. Med 0.8753043 0.5001077 0.8764289
## Low vs. Med  0.9556286 0.9998876 0.9876075</code></pre>
<p>we get an AUC for every column of the prediction matrix our DV has 3 categories: Low, Med and High we observe that the model has problems when d istiguisging between high and medium but performs pretty well when indentifying the Low category (customers who are not commited)</p>
</div>
</div>
</div>
<div id="making-inference-and-queries-based-on-the-model" class="section level3" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> 3. Making inference and queries based on the model</h3>
<p>How do we use the model in practice to make inference with incomplete data? Below we consider several hypothetical situations.</p>
<p>A customer is considered retained if he has a positive attitude and high commitment to the Virtual Community (hereafter, VC). How do functional usefulness and pleasure influence on attitude and commitment? We know the strength of the relationship based on the arc strength. The following analysis helps to understand the relationship, which we will see that it is not be necessarily linear Using BN, one can evaluate the expected changes in attitude, and respectively, commitment due to changes in functional usefulness and pleasure. We will set evidence in the network for Fuse and Plea and we´ll look at the cpt (conditional probability table) for Atti and Comm before and after setting the evidence. Setting (hard) evidence means setting one of the states of the variable at probability 1 (that is, as 100%).</p>
<p>Transform the <code>bn</code> into a junction tree</p>
<p>We are going to make two types of diagnositcs:</p>
<ol style="list-style-type: decimal">
<li><em>Forward inference:</em> following the directions, hence setting evidence for the parents and then see how that affects the children</li>
<li><em>Backward inference:</em> going against the directions, hence setting evidence for children and then seeing how that affects the parents.</li>
</ol>
<p><strong>The following is also forward integration</strong></p>
<div class="sourceCode" id="cb584"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb584-1"><a href="probabilistic-models-for-customer-analytics.html#cb584-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span> (gRain)</span>
<span id="cb584-2"><a href="probabilistic-models-for-customer-analytics.html#cb584-2" aria-hidden="true" tabindex="-1"></a>junction <span class="ot">&lt;-</span> <span class="fu">compile</span>(<span class="fu">as.grain</span>(bn.mle))</span>
<span id="cb584-3"><a href="probabilistic-models-for-customer-analytics.html#cb584-3" aria-hidden="true" tabindex="-1"></a><span class="co"># &quot;querygrain&quot; function extracts the marginal distribution of the nodes</span></span></code></pre></div>
<p>First we are going to look at the prior probabilities, that is done in the following.</p>
<div class="sourceCode" id="cb585"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb585-1"><a href="probabilistic-models-for-customer-analytics.html#cb585-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ctp for atti and comm are:</span></span>
<span id="cb585-2"><a href="probabilistic-models-for-customer-analytics.html#cb585-2" aria-hidden="true" tabindex="-1"></a><span class="fu">querygrain</span>(junction, <span class="at">nodes =</span> <span class="st">&quot;Atti&quot;</span>)</span>
<span id="cb585-3"><a href="probabilistic-models-for-customer-analytics.html#cb585-3" aria-hidden="true" tabindex="-1"></a><span class="fu">querygrain</span>(junction, <span class="at">nodes =</span> <span class="st">&quot;Comm&quot;</span>)</span></code></pre></div>
<pre><code>## $Atti
## Atti
##        High         Low         Med 
## 0.595014752 0.008280883 0.396704365 
## 
## $Comm
## Comm
##       High        Low        Med 
## 0.44373332 0.01099592 0.54527076</code></pre>
<p>Imagine a new person joins the VC reporting a Low, Medium, or High Functional Usefulness perception. This information can be fed to the network as evidence in order to predict the conditional probability of his/her attitude and commitment to VC.</p>
<div class="sourceCode" id="cb587"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb587-1"><a href="probabilistic-models-for-customer-analytics.html#cb587-1" aria-hidden="true" tabindex="-1"></a><span class="co"># new ctp(if Fuse = Low)</span></span>
<span id="cb587-2"><a href="probabilistic-models-for-customer-analytics.html#cb587-2" aria-hidden="true" tabindex="-1"></a>jLow <span class="ot">&lt;-</span> <span class="fu">setEvidence</span> (junction, <span class="at">nodes =</span> <span class="st">&quot;Fuse&quot;</span>, <span class="at">states =</span> <span class="st">&quot;Low&quot;</span>)</span>
<span id="cb587-3"><a href="probabilistic-models-for-customer-analytics.html#cb587-3" aria-hidden="true" tabindex="-1"></a>A1 <span class="ot">&lt;-</span> <span class="fu">querygrain</span>(jLow, <span class="at">nodes =</span> <span class="st">&quot;Atti&quot;</span>)</span>
<span id="cb587-4"><a href="probabilistic-models-for-customer-analytics.html#cb587-4" aria-hidden="true" tabindex="-1"></a>A1</span></code></pre></div>
<pre><code>## $Atti
## Atti
##       High        Low        Med 
## 0.15753333 0.01905778 0.82340889</code></pre>
<p>We see that we enter a piece of information and then see how the attitude changes. So we see that it went from 59% to 15%, which is a strong decrease.</p>
<p>We can do the same with commitment</p>
<div class="sourceCode" id="cb589"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb589-1"><a href="probabilistic-models-for-customer-analytics.html#cb589-1" aria-hidden="true" tabindex="-1"></a>C1 <span class="ot">&lt;-</span> <span class="fu">querygrain</span>(jLow, <span class="at">nodes =</span> <span class="st">&quot;Comm&quot;</span>)</span>
<span id="cb589-2"><a href="probabilistic-models-for-customer-analytics.html#cb589-2" aria-hidden="true" tabindex="-1"></a>C1</span></code></pre></div>
<pre><code>## $Comm
## Comm
##        High         Low         Med 
## 0.009657778 0.157533333 0.832808889</code></pre>
<p>We see that the High segment in the commitment as weel.</p>
<div class="sourceCode" id="cb591"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb591-1"><a href="probabilistic-models-for-customer-analytics.html#cb591-1" aria-hidden="true" tabindex="-1"></a><span class="co"># new ctp (if Fuse = Med)</span></span>
<span id="cb591-2"><a href="probabilistic-models-for-customer-analytics.html#cb591-2" aria-hidden="true" tabindex="-1"></a>jMed <span class="ot">&lt;-</span> <span class="fu">setEvidence</span> (junction, <span class="at">nodes =</span> <span class="st">&quot;Fuse&quot;</span>, <span class="at">states =</span> <span class="st">&quot;Med&quot;</span>)</span>
<span id="cb591-3"><a href="probabilistic-models-for-customer-analytics.html#cb591-3" aria-hidden="true" tabindex="-1"></a>A2 <span class="ot">&lt;-</span> <span class="fu">querygrain</span>(jMed, <span class="at">nodes =</span> <span class="st">&quot;Atti&quot;</span>)</span>
<span id="cb591-4"><a href="probabilistic-models-for-customer-analytics.html#cb591-4" aria-hidden="true" tabindex="-1"></a>A2</span>
<span id="cb591-5"><a href="probabilistic-models-for-customer-analytics.html#cb591-5" aria-hidden="true" tabindex="-1"></a>C2 <span class="ot">&lt;-</span> <span class="fu">querygrain</span>(jMed, <span class="at">nodes =</span> <span class="st">&quot;Comm&quot;</span>)</span>
<span id="cb591-6"><a href="probabilistic-models-for-customer-analytics.html#cb591-6" aria-hidden="true" tabindex="-1"></a>C2</span>
<span id="cb591-7"><a href="probabilistic-models-for-customer-analytics.html#cb591-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb591-8"><a href="probabilistic-models-for-customer-analytics.html#cb591-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb591-9"><a href="probabilistic-models-for-customer-analytics.html#cb591-9" aria-hidden="true" tabindex="-1"></a><span class="co"># new ctp (if Fuse = High)</span></span>
<span id="cb591-10"><a href="probabilistic-models-for-customer-analytics.html#cb591-10" aria-hidden="true" tabindex="-1"></a>jHigh <span class="ot">&lt;-</span> <span class="fu">setEvidence</span> (junction, <span class="at">nodes =</span> <span class="st">&quot;Fuse&quot;</span>, <span class="at">states =</span> <span class="st">&quot;High&quot;</span>)</span>
<span id="cb591-11"><a href="probabilistic-models-for-customer-analytics.html#cb591-11" aria-hidden="true" tabindex="-1"></a>A3 <span class="ot">&lt;-</span> <span class="fu">querygrain</span>(jHigh, <span class="at">nodes =</span> <span class="st">&quot;Atti&quot;</span>)</span>
<span id="cb591-12"><a href="probabilistic-models-for-customer-analytics.html#cb591-12" aria-hidden="true" tabindex="-1"></a>A3</span>
<span id="cb591-13"><a href="probabilistic-models-for-customer-analytics.html#cb591-13" aria-hidden="true" tabindex="-1"></a>C3 <span class="ot">&lt;-</span> <span class="fu">querygrain</span>(jHigh, <span class="at">nodes =</span> <span class="st">&quot;Comm&quot;</span>)</span>
<span id="cb591-14"><a href="probabilistic-models-for-customer-analytics.html#cb591-14" aria-hidden="true" tabindex="-1"></a>C3</span></code></pre></div>
<pre><code>## $Atti
## Atti
##        High         Low         Med 
## 0.367928447 0.004272727 0.627798826 
## 
## $Comm
## Comm
##        High         Low         Med 
## 0.287643947 0.003418182 0.708937871 
## 
## $Atti
## Atti
##      High       Low       Med 
## 0.6892533 0.0094000 0.3013467 
## 
## $Comm
## Comm
##      High       Low       Med 
## 0.5124326 0.0094000 0.4781674</code></pre>
<div id="diagnostics-forward-inference" class="section level4" number="4.2.3.1">
<h4><span class="header-section-number">4.2.3.1</span> Diagnostics (Forward inference)</h4>
<p>Here we are going to set evidence for a given customer and see how probabilities for other variables are affected.</p>
<p>We see that we get likelihood of the different states where attitude is set to low, medium and high. We see that when attitude = low, then changes in fuse will have no effect.</p>
<div class="sourceCode" id="cb593"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb593-1"><a href="probabilistic-models-for-customer-analytics.html#cb593-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary (only for Atti)</span></span>
<span id="cb593-2"><a href="probabilistic-models-for-customer-analytics.html#cb593-2" aria-hidden="true" tabindex="-1"></a>AttiHigh <span class="ot">&lt;-</span><span class="fu">c</span>(A1<span class="sc">$</span>Atti[[<span class="dv">1</span>]], A2<span class="sc">$</span>Atti[[<span class="dv">1</span>]], A3<span class="sc">$</span>Atti[[<span class="dv">1</span>]])</span>
<span id="cb593-3"><a href="probabilistic-models-for-customer-analytics.html#cb593-3" aria-hidden="true" tabindex="-1"></a>AttiLow <span class="ot">&lt;-</span> <span class="fu">c</span>(A1<span class="sc">$</span>Atti[[<span class="dv">2</span>]], A2<span class="sc">$</span>Atti[[<span class="dv">2</span>]], A3<span class="sc">$</span>Atti[[<span class="dv">2</span>]])</span>
<span id="cb593-4"><a href="probabilistic-models-for-customer-analytics.html#cb593-4" aria-hidden="true" tabindex="-1"></a>AttiMed <span class="ot">&lt;-</span> <span class="fu">c</span>(A1<span class="sc">$</span>Atti[[<span class="dv">3</span>]], A2<span class="sc">$</span>Atti[[<span class="dv">3</span>]], A3<span class="sc">$</span>Atti[[<span class="dv">3</span>]])</span>
<span id="cb593-5"><a href="probabilistic-models-for-customer-analytics.html#cb593-5" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fuse =</span> <span class="fu">c</span>(<span class="st">&quot;Low&quot;</span>, <span class="st">&quot;Med&quot;</span>, <span class="st">&quot;High&quot;</span>), AttiLow, AttiMed, AttiHigh)</span>
<span id="cb593-6"><a href="probabilistic-models-for-customer-analytics.html#cb593-6" aria-hidden="true" tabindex="-1"></a>df1</span>
<span id="cb593-7"><a href="probabilistic-models-for-customer-analytics.html#cb593-7" aria-hidden="true" tabindex="-1"></a><span class="fu">matplot</span>(<span class="fu">rownames</span>(df1), df1</span>
<span id="cb593-8"><a href="probabilistic-models-for-customer-analytics.html#cb593-8" aria-hidden="true" tabindex="-1"></a>        ,<span class="at">type =</span> <span class="st">&#39;l&#39;</span></span>
<span id="cb593-9"><a href="probabilistic-models-for-customer-analytics.html#cb593-9" aria-hidden="true" tabindex="-1"></a>        ,<span class="at">xlab =</span> <span class="st">&#39;Fuse&#39;</span></span>
<span id="cb593-10"><a href="probabilistic-models-for-customer-analytics.html#cb593-10" aria-hidden="true" tabindex="-1"></a>        ,<span class="at">ylab =</span> <span class="st">&#39;Probability&#39;</span></span>
<span id="cb593-11"><a href="probabilistic-models-for-customer-analytics.html#cb593-11" aria-hidden="true" tabindex="-1"></a>        ,<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb593-12"><a href="probabilistic-models-for-customer-analytics.html#cb593-12" aria-hidden="true" tabindex="-1"></a>        ,<span class="at">col =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">2</span>))</span>
<span id="cb593-13"><a href="probabilistic-models-for-customer-analytics.html#cb593-13" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&#39;topright&#39;</span></span>
<span id="cb593-14"><a href="probabilistic-models-for-customer-analytics.html#cb593-14" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">inset =</span> .<span class="dv">01</span></span>
<span id="cb593-15"><a href="probabilistic-models-for-customer-analytics.html#cb593-15" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">legend =</span> <span class="fu">colnames</span>(df1[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]) <span class="co">#&quot;AttiLow&quot;  &quot;AttiMed&quot;  &quot;AttiHigh&quot;</span></span>
<span id="cb593-16"><a href="probabilistic-models-for-customer-analytics.html#cb593-16" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">pch =</span> <span class="dv">1</span>,<span class="at">horiz =</span> T</span>
<span id="cb593-17"><a href="probabilistic-models-for-customer-analytics.html#cb593-17" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>,<span class="st">&quot;red&quot;</span>,<span class="st">&quot;green&quot;</span>))</span></code></pre></div>
<img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-284-1.png" width="720" style="display: block; margin: auto;" />
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="left">Fuse</th>
<th align="right">AttiLow</th>
<th align="right">AttiMed</th>
<th align="right">AttiHigh</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Low</td>
<td align="right">0.0190578</td>
<td align="right">0.8234089</td>
<td align="right">0.1575333</td>
</tr>
<tr class="even">
<td align="left">Med</td>
<td align="right">0.0042727</td>
<td align="right">0.6277988</td>
<td align="right">0.3679284</td>
</tr>
<tr class="odd">
<td align="left">High</td>
<td align="right">0.0094000</td>
<td align="right">0.3013467</td>
<td align="right">0.6892533</td>
</tr>
</tbody>
</table>
</div>
<p><strong><em>Discussion</em></strong></p>
<ul>
<li>as Fuse changes from low to medium to high,
<ul>
<li>the high state of attitude shows an increasing trend,</li>
<li>the medium state of attitude shows a decreasing trend,</li>
<li>the low state of attitude shows a constant trend.</li>
</ul></li>
<li>it depicts that when functional usefulness is low, the probability of attitude medium is quite high (0.80) and thus functional usefulness does not radically affect the customer´s attitude. And when the attitude is just low, then the functional usefullness does not change anything.</li>
</ul>
<div id="let-us-repeat-the-same-analysis-by-setting-evidence-in-pleasure" class="section level5" number="4.2.3.1.1">
<h5><span class="header-section-number">4.2.3.1.1</span> <em>let us repeat the same analysis by setting evidence in Pleasure</em></h5>
<p>We can do the same graphs, just where we see the relationship between pleasure and attitude.</p>
<div class="sourceCode" id="cb594"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb594-1"><a href="probabilistic-models-for-customer-analytics.html#cb594-1" aria-hidden="true" tabindex="-1"></a><span class="co"># new cpt</span></span>
<span id="cb594-2"><a href="probabilistic-models-for-customer-analytics.html#cb594-2" aria-hidden="true" tabindex="-1"></a>jLow <span class="ot">&lt;-</span> <span class="fu">setEvidence</span> (junction, <span class="at">nodes =</span> <span class="st">&quot;Plea&quot;</span>, <span class="at">states =</span> <span class="st">&quot;Low&quot;</span>)</span>
<span id="cb594-3"><a href="probabilistic-models-for-customer-analytics.html#cb594-3" aria-hidden="true" tabindex="-1"></a>A1 <span class="ot">=</span> <span class="fu">querygrain</span>(jLow, <span class="at">nodes =</span> <span class="st">&quot;Atti&quot;</span>)</span>
<span id="cb594-4"><a href="probabilistic-models-for-customer-analytics.html#cb594-4" aria-hidden="true" tabindex="-1"></a>C1 <span class="ot">=</span> <span class="fu">querygrain</span>(jLow, <span class="at">nodes =</span> <span class="st">&quot;Comm&quot;</span>)</span>
<span id="cb594-5"><a href="probabilistic-models-for-customer-analytics.html#cb594-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb594-6"><a href="probabilistic-models-for-customer-analytics.html#cb594-6" aria-hidden="true" tabindex="-1"></a><span class="co"># New cpt</span></span>
<span id="cb594-7"><a href="probabilistic-models-for-customer-analytics.html#cb594-7" aria-hidden="true" tabindex="-1"></a>jMed <span class="ot">&lt;-</span> <span class="fu">setEvidence</span> (junction, <span class="at">nodes =</span> <span class="st">&quot;Plea&quot;</span>, <span class="at">states =</span> <span class="st">&quot;Med&quot;</span>)</span>
<span id="cb594-8"><a href="probabilistic-models-for-customer-analytics.html#cb594-8" aria-hidden="true" tabindex="-1"></a>A2 <span class="ot">=</span> <span class="fu">querygrain</span>(jMed, <span class="at">nodes =</span> <span class="st">&quot;Atti&quot;</span>)</span>
<span id="cb594-9"><a href="probabilistic-models-for-customer-analytics.html#cb594-9" aria-hidden="true" tabindex="-1"></a>C2 <span class="ot">=</span> <span class="fu">querygrain</span>(jMed, <span class="at">nodes =</span> <span class="st">&quot;Comm&quot;</span>)</span>
<span id="cb594-10"><a href="probabilistic-models-for-customer-analytics.html#cb594-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb594-11"><a href="probabilistic-models-for-customer-analytics.html#cb594-11" aria-hidden="true" tabindex="-1"></a><span class="co"># New cpt</span></span>
<span id="cb594-12"><a href="probabilistic-models-for-customer-analytics.html#cb594-12" aria-hidden="true" tabindex="-1"></a>jHigh <span class="ot">&lt;-</span> <span class="fu">setEvidence</span> (junction, <span class="at">nodes =</span> <span class="st">&quot;Plea&quot;</span>, <span class="at">states =</span> <span class="st">&quot;High&quot;</span>)</span>
<span id="cb594-13"><a href="probabilistic-models-for-customer-analytics.html#cb594-13" aria-hidden="true" tabindex="-1"></a>A3 <span class="ot">=</span> <span class="fu">querygrain</span>(jHigh, <span class="at">nodes =</span> <span class="st">&quot;Atti&quot;</span>)</span>
<span id="cb594-14"><a href="probabilistic-models-for-customer-analytics.html#cb594-14" aria-hidden="true" tabindex="-1"></a>C3 <span class="ot">=</span> <span class="fu">querygrain</span>(jHigh, <span class="at">nodes =</span> <span class="st">&quot;Comm&quot;</span>)</span>
<span id="cb594-15"><a href="probabilistic-models-for-customer-analytics.html#cb594-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb594-16"><a href="probabilistic-models-for-customer-analytics.html#cb594-16" aria-hidden="true" tabindex="-1"></a><span class="co"># summary</span></span>
<span id="cb594-17"><a href="probabilistic-models-for-customer-analytics.html#cb594-17" aria-hidden="true" tabindex="-1"></a>AttiHigh <span class="ot">&lt;-</span> <span class="fu">c</span>(A1<span class="sc">$</span>Atti[[<span class="dv">1</span>]], A2<span class="sc">$</span>Atti[[<span class="dv">1</span>]], A3<span class="sc">$</span>Atti[[<span class="dv">1</span>]])</span>
<span id="cb594-18"><a href="probabilistic-models-for-customer-analytics.html#cb594-18" aria-hidden="true" tabindex="-1"></a>AttiLow <span class="ot">&lt;-</span> <span class="fu">c</span>(A1<span class="sc">$</span>Atti[[<span class="dv">2</span>]], A2<span class="sc">$</span>Atti[[<span class="dv">2</span>]], A3<span class="sc">$</span>Atti[[<span class="dv">2</span>]])</span>
<span id="cb594-19"><a href="probabilistic-models-for-customer-analytics.html#cb594-19" aria-hidden="true" tabindex="-1"></a>AttiMed <span class="ot">&lt;-</span> <span class="fu">c</span>(A1<span class="sc">$</span>Atti[[<span class="dv">3</span>]], A2<span class="sc">$</span>Atti[[<span class="dv">3</span>]], A3<span class="sc">$</span>Atti[[<span class="dv">3</span>]])</span>
<span id="cb594-20"><a href="probabilistic-models-for-customer-analytics.html#cb594-20" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Plea =</span> <span class="fu">c</span>(<span class="st">&quot;Low&quot;</span>, <span class="st">&quot;Med&quot;</span>, <span class="st">&quot;High&quot;</span>), AttiLow, AttiMed, AttiHigh)</span>
<span id="cb594-21"><a href="probabilistic-models-for-customer-analytics.html#cb594-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb594-22"><a href="probabilistic-models-for-customer-analytics.html#cb594-22" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span>
<span id="cb594-23"><a href="probabilistic-models-for-customer-analytics.html#cb594-23" aria-hidden="true" tabindex="-1"></a>df2</span>
<span id="cb594-24"><a href="probabilistic-models-for-customer-analytics.html#cb594-24" aria-hidden="true" tabindex="-1"></a><span class="fu">matplot</span>(<span class="fu">rownames</span>(df2), df2, <span class="at">type =</span> <span class="st">&#39;l&#39;</span>, <span class="at">xlab =</span> <span class="st">&#39;Plea&#39;</span></span>
<span id="cb594-25"><a href="probabilistic-models-for-customer-analytics.html#cb594-25" aria-hidden="true" tabindex="-1"></a>        ,<span class="at">ylab =</span> <span class="st">&#39;Probability&#39;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb594-26"><a href="probabilistic-models-for-customer-analytics.html#cb594-26" aria-hidden="true" tabindex="-1"></a>        ,<span class="at">col =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">2</span>))</span>
<span id="cb594-27"><a href="probabilistic-models-for-customer-analytics.html#cb594-27" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&#39;topright&#39;</span>, <span class="at">inset=</span>.<span class="dv">01</span>, <span class="at">legend=</span><span class="fu">colnames</span>(df2[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]), </span>
<span id="cb594-28"><a href="probabilistic-models-for-customer-analytics.html#cb594-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch=</span><span class="dv">1</span>, <span class="at">horiz=</span>T, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>,<span class="st">&quot;red&quot;</span>,<span class="st">&quot;green&quot;</span>))</span></code></pre></div>
<img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-285-1.png" width="720" style="display: block; margin: auto;" />
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="left">Plea</th>
<th align="right">AttiLow</th>
<th align="right">AttiMed</th>
<th align="right">AttiHigh</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Low</td>
<td align="right">0.8591636</td>
<td align="right">0.0469455</td>
<td align="right">0.0938909</td>
</tr>
<tr class="even">
<td align="left">Med</td>
<td align="right">0.0000000</td>
<td align="right">0.5642765</td>
<td align="right">0.4357235</td>
</tr>
<tr class="odd">
<td align="left">High</td>
<td align="right">0.0004711</td>
<td align="right">0.1898881</td>
<td align="right">0.8096408</td>
</tr>
</tbody>
</table>
</div>
<p>We see that the probability of a high attitude increases as pleasure increases. Although we see that the low attitude probability decrease as pleasure increases, and at some point, the low attitude will</p>
<p><strong>Discussion</strong></p>
<p>as Plea changes from low to medium to high,</p>
<ul>
<li>the high state of attitude shows an increasing trend</li>
<li>the medium state of attitude shows a mixed trend and</li>
<li>the low state of attitude shows a decreasing trend</li>
</ul>
<p>When pleasure is low, the probability of attitude being low is high (0.8592). This means pleasure has a stronger relationship with attitude; hence, to increase the attitude of customers, it is more important to enhance their perceived pleasure than to enhance functional usefulness.</p>
<p>Similar influences of changes of FUSE, PLEA and ATTI on commitment can be similarly explored. To conclude, the above inference is called forward inference because we set evidence in the parent and look at cpt changes in the child. Next, we look at backward inference - a great type of inference offered by BN models.</p>
</div>
</div>
<div id="diagnostic-backward-inference" class="section level4" number="4.2.3.2">
<h4><span class="header-section-number">4.2.3.2</span> Diagnostic (Backward inference)</h4>
<p>Here we are going to go against the arrows.</p>
<p>Let’s assume that the evidence given is that the customer’s attitude towards VC is high. This information is fed to the network by setting the probability of attitude being high (that is, as 1.00) and observing the changes in the parent variables (Fuse and Plea)</p>
<div class="sourceCode" id="cb595"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb595-1"><a href="probabilistic-models-for-customer-analytics.html#cb595-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prior cpt</span></span>
<span id="cb595-2"><a href="probabilistic-models-for-customer-analytics.html#cb595-2" aria-hidden="true" tabindex="-1"></a><span class="fu">querygrain</span>(junction, <span class="at">nodes =</span> <span class="st">&quot;Fuse&quot;</span>)</span>
<span id="cb595-3"><a href="probabilistic-models-for-customer-analytics.html#cb595-3" aria-hidden="true" tabindex="-1"></a><span class="fu">querygrain</span>(junction, <span class="at">nodes =</span> <span class="st">&quot;Plea&quot;</span>)</span>
<span id="cb595-4"><a href="probabilistic-models-for-customer-analytics.html#cb595-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb595-5"><a href="probabilistic-models-for-customer-analytics.html#cb595-5" aria-hidden="true" tabindex="-1"></a><span class="co"># New cpt</span></span>
<span id="cb595-6"><a href="probabilistic-models-for-customer-analytics.html#cb595-6" aria-hidden="true" tabindex="-1"></a>jHigh <span class="ot">&lt;-</span> <span class="fu">setEvidence</span> (junction, <span class="at">nodes =</span> <span class="st">&quot;Atti&quot;</span>, <span class="at">states =</span> <span class="st">&quot;High&quot;</span>) </span>
<span id="cb595-7"><a href="probabilistic-models-for-customer-analytics.html#cb595-7" aria-hidden="true" tabindex="-1"></a><span class="fu">querygrain</span>(jHigh, <span class="at">nodes =</span> <span class="st">&quot;Fuse&quot;</span>)</span>
<span id="cb595-8"><a href="probabilistic-models-for-customer-analytics.html#cb595-8" aria-hidden="true" tabindex="-1"></a><span class="fu">querygrain</span>(jHigh, <span class="at">nodes =</span> <span class="st">&quot;Plea&quot;</span>)</span></code></pre></div>
<pre><code>## $Fuse
## Fuse
##   High    Low    Med 
## 0.7206 0.0212 0.2582 
## 
## $Plea
## Plea
##   High    Low    Med 
## 0.4346 0.0094 0.5560 
## 
## $Fuse
## Fuse
##        High         Low         Med 
## 0.834728750 0.005612813 0.159658437 
## 
## $Plea
## Plea
##        High         Low         Med 
## 0.591363295 0.001483282 0.407153423</code></pre>
<p><strong>Discussion</strong></p>
<p>The probability of the high state of Plea and Fuse is increasing, while the probability of the low and medium states of Plea and Fuse is decreasing. This implies that increased attitude towards interaction in a VC is because of person’s increased perception of pleasure and functional usefulness in the VC.</p>
<p><strong>An example</strong></p>
<p><em>Assume that the online vendor observes decreasing commitment towards participation</em> among its customers. He can set evidence to the network that the probability of commitment is low and see the effect of the parent variables (attitude, functional usefulness and pleasure).</p>
<div class="sourceCode" id="cb597"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb597-1"><a href="probabilistic-models-for-customer-analytics.html#cb597-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Prior cpt </span></span>
<span id="cb597-2"><a href="probabilistic-models-for-customer-analytics.html#cb597-2" aria-hidden="true" tabindex="-1"></a><span class="fu">querygrain</span>(junction, <span class="at">nodes =</span> <span class="st">&quot;Atti&quot;</span>)</span>
<span id="cb597-3"><a href="probabilistic-models-for-customer-analytics.html#cb597-3" aria-hidden="true" tabindex="-1"></a><span class="fu">querygrain</span>(junction, <span class="at">nodes =</span> <span class="st">&quot;Fuse&quot;</span>)</span>
<span id="cb597-4"><a href="probabilistic-models-for-customer-analytics.html#cb597-4" aria-hidden="true" tabindex="-1"></a><span class="fu">querygrain</span>(junction, <span class="at">nodes =</span> <span class="st">&quot;Plea&quot;</span>)</span></code></pre></div>
<pre><code>## $Atti
## Atti
##        High         Low         Med 
## 0.595014752 0.008280883 0.396704365 
## 
## $Fuse
## Fuse
##   High    Low    Med 
## 0.7206 0.0212 0.2582 
## 
## $Plea
## Plea
##   High    Low    Med 
## 0.4346 0.0094 0.5560</code></pre>
<div class="sourceCode" id="cb599"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb599-1"><a href="probabilistic-models-for-customer-analytics.html#cb599-1" aria-hidden="true" tabindex="-1"></a><span class="co"># New cpt</span></span>
<span id="cb599-2"><a href="probabilistic-models-for-customer-analytics.html#cb599-2" aria-hidden="true" tabindex="-1"></a>CLow <span class="ot">&lt;-</span> <span class="fu">setEvidence</span> (junction, <span class="at">nodes =</span> <span class="st">&quot;Comm&quot;</span>, <span class="at">states =</span> <span class="st">&quot;Low&quot;</span>) <span class="co">#We set commitment to low</span></span>
<span id="cb599-3"><a href="probabilistic-models-for-customer-analytics.html#cb599-3" aria-hidden="true" tabindex="-1"></a><span class="fu">querygrain</span>(CLow, <span class="at">nodes =</span> <span class="st">&quot;Atti&quot;</span>)</span>
<span id="cb599-4"><a href="probabilistic-models-for-customer-analytics.html#cb599-4" aria-hidden="true" tabindex="-1"></a><span class="fu">querygrain</span>(CLow, <span class="at">nodes =</span> <span class="st">&quot;Fuse&quot;</span>)</span>
<span id="cb599-5"><a href="probabilistic-models-for-customer-analytics.html#cb599-5" aria-hidden="true" tabindex="-1"></a><span class="fu">querygrain</span>(CLow, <span class="at">nodes =</span> <span class="st">&quot;Plea&quot;</span>)</span></code></pre></div>
<pre><code>## $Atti
## Atti
##       High        Low        Med 
## 0.32378827 0.65614578 0.02006595 
## 
## $Fuse
## Fuse
##       High        Low        Med 
## 0.61601387 0.30372232 0.08026381 
## 
## $Plea
## Plea
##      High       Low       Med 
## 0.0000000 0.6962777 0.3037223</code></pre>
<p>A vendor, therefore, needs to take corrective action to enhance customers’ pleasure aspect in the VC to improve customers’ commitment toward the VC. we found that it is mainly due to lack of enhancement of the pleasure aspect of the website; the vendors needed to take corrective action to provide the customers with more fun and enjoyment.</p>
<p>We see that when the communication is set to low, then the probability of pleasure being high is 0.</p>
<p><strong>Modeling contradictory behavior</strong></p>
<p><em>Assume some customers interact in the VC to seek information from the VC, but do not participate in VC activities</em>. Such customers can be considered persons with positive attitudes but low commitment. Can BN predict the reasons behind such contradictory behavior?</p>
<div class="sourceCode" id="cb601"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb601-1"><a href="probabilistic-models-for-customer-analytics.html#cb601-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prior ctp</span></span>
<span id="cb601-2"><a href="probabilistic-models-for-customer-analytics.html#cb601-2" aria-hidden="true" tabindex="-1"></a><span class="fu">querygrain</span>(junction, <span class="at">nodes =</span> <span class="st">&quot;Fuse&quot;</span>)</span>
<span id="cb601-3"><a href="probabilistic-models-for-customer-analytics.html#cb601-3" aria-hidden="true" tabindex="-1"></a><span class="fu">querygrain</span>(junction, <span class="at">nodes =</span> <span class="st">&quot;Plea&quot;</span>)</span>
<span id="cb601-4"><a href="probabilistic-models-for-customer-analytics.html#cb601-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb601-5"><a href="probabilistic-models-for-customer-analytics.html#cb601-5" aria-hidden="true" tabindex="-1"></a><span class="co"># New ctp</span></span>
<span id="cb601-6"><a href="probabilistic-models-for-customer-analytics.html#cb601-6" aria-hidden="true" tabindex="-1"></a>AHigh <span class="ot">&lt;-</span> <span class="fu">setEvidence</span> (junction, <span class="at">nodes =</span> <span class="st">&quot;Att&quot;</span>, <span class="at">states =</span> <span class="st">&quot;High&quot;</span>)</span>
<span id="cb601-7"><a href="probabilistic-models-for-customer-analytics.html#cb601-7" aria-hidden="true" tabindex="-1"></a>AHighCLow <span class="ot">&lt;-</span> <span class="fu">setEvidence</span> (AHigh, <span class="at">nodes =</span> <span class="st">&quot;Comm&quot;</span>, <span class="at">states =</span> <span class="st">&quot;Low&quot;</span>)</span>
<span id="cb601-8"><a href="probabilistic-models-for-customer-analytics.html#cb601-8" aria-hidden="true" tabindex="-1"></a><span class="fu">querygrain</span>(AHighCLow, <span class="at">nodes =</span> <span class="st">&quot;Fuse&quot;</span>)</span>
<span id="cb601-9"><a href="probabilistic-models-for-customer-analytics.html#cb601-9" aria-hidden="true" tabindex="-1"></a><span class="fu">querygrain</span>(AHighCLow, <span class="at">nodes =</span> <span class="st">&quot;Plea&quot;</span>)</span></code></pre></div>
<pre><code>## $Fuse
## Fuse
##   High    Low    Med 
## 0.7206 0.0212 0.2582 
## 
## $Plea
## Plea
##   High    Low    Med 
## 0.4346 0.0094 0.5560 
## 
## $Fuse
## Fuse
##       High        Low        Med 
## 0.61601387 0.30372232 0.08026381 
## 
## $Plea
## Plea
##      High       Low       Med 
## 0.0000000 0.6962777 0.3037223</code></pre>
<p><strong>Discussion</strong></p>
<p>The probability of attitude high and commitment low was set to 1.00.</p>
<p>The results imply that FUSE is 0.3 likely to be low but a significant proportion is still likely to be high (0.62); instead, PLEA is most likely to be low (0.7) and unlikelly to be high (0%). This reveals that customers interact primarily because of fun, and they do not perceive the VC to be sufficiently useful to them to commit to.</p>
</div>
</div>
</div>
<div id="application-2-identifying-populations-with-positive-expected-lift-in-profit-elp-and-targeting" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Application 2: Identifying populations with Positive Expected Lift in Profit (ELP) and targeting</h2>
<p>The idea is to use BN to identify segments of customers that will most <em>likely purchase</em> when sending the ad (persuadable segments) and <strong>avoid</strong> sending the ad to the rest: 1) to the ones who will not buy the advertised product ever, 2) to the ones who will be offended by receiving an unwanted advertisement or call, 3) or to the ones who will always buy)</p>
<p>If historical data is available, we start learning the relationships between the variables train and select the best model as a prelimimnary step. Below we use the model structure from the text (given),and we only have to learn the parameters (probabilities). Next,we focus exclusively on how model is used as a decision support for marketing managers.</p>
<div class="sourceCode" id="cb603"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb603-1"><a href="probabilistic-models-for-customer-analytics.html#cb603-1" aria-hidden="true" tabindex="-1"></a>targeted.adv <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;Data/Probabilistic Models for Customer Analytics/targeted.adv.csv&quot;</span></span>
<span id="cb603-2"><a href="probabilistic-models-for-customer-analytics.html#cb603-2" aria-hidden="true" tabindex="-1"></a>                         ,<span class="at">header =</span> T, <span class="at">colClasses =</span> <span class="st">&quot;factor&quot;</span>)</span>
<span id="cb603-3"><a href="probabilistic-models-for-customer-analytics.html#cb603-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(targeted.adv)</span>
<span id="cb603-4"><a href="probabilistic-models-for-customer-analytics.html#cb603-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(targeted.adv)</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="left">IDnum</th>
<th align="left">Buy</th>
<th align="left">Income</th>
<th align="left">Sex</th>
<th align="left">Mailed</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">yes</td>
<td align="left">high</td>
<td align="left">male</td>
<td align="left">no</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">no</td>
<td align="left">low</td>
<td align="left">male</td>
<td align="left">no</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="left">no</td>
<td align="left">low</td>
<td align="left">female</td>
<td align="left">yes</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="left">no</td>
<td align="left">low</td>
<td align="left">female</td>
<td align="left">yes</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="left">no</td>
<td align="left">low</td>
<td align="left">female</td>
<td align="left">no</td>
</tr>
<tr class="even">
<td align="left">6</td>
<td align="left">no</td>
<td align="left">low</td>
<td align="left">female</td>
<td align="left">no</td>
</tr>
</tbody>
</table>
</div>
<pre><code>## &#39;data.frame&#39;:    1000 obs. of  5 variables:
##  $ IDnum : Factor w/ 1000 levels &quot;1&quot;,&quot;10&quot;,&quot;100&quot;,..: 1 113 224 335 446 557 668 779 890 2 ...
##  $ Buy   : Factor w/ 2 levels &quot;no&quot;,&quot;yes&quot;: 2 1 1 1 1 1 2 2 2 1 ...
##  $ Income: Factor w/ 3 levels &quot;high&quot;,&quot;low&quot;,&quot;medium&quot;: 1 2 2 2 2 2 1 3 1 3 ...
##  $ Sex   : Factor w/ 2 levels &quot;female&quot;,&quot;male&quot;: 2 2 1 1 1 1 1 1 2 1 ...
##  $ Mailed: Factor w/ 2 levels &quot;no&quot;,&quot;yes&quot;: 1 1 2 2 1 1 2 2 2 1 ...</code></pre>
<p>We see that the table contains 5 columns, ID, Buy, Income, Sex and Mailed. All the variables are factor variables</p>
<div class="sourceCode" id="cb605"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb605-1"><a href="probabilistic-models-for-customer-analytics.html#cb605-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build the structure</span></span>
<span id="cb605-2"><a href="probabilistic-models-for-customer-analytics.html#cb605-2" aria-hidden="true" tabindex="-1"></a>dagTA <span class="ot">&lt;-</span> <span class="fu">model2network</span>(<span class="st">&quot;[Income][Sex][Mailed][Buy|Income:Sex:Mailed]&quot;</span>)</span>
<span id="cb605-3"><a href="probabilistic-models-for-customer-analytics.html#cb605-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dagTA)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-291-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>We see that the all variables leads towards buy.</p>
<div class="sourceCode" id="cb606"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb606-1"><a href="probabilistic-models-for-customer-analytics.html#cb606-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Learn the cpt (conditional probability table)</span></span>
<span id="cb606-2"><a href="probabilistic-models-for-customer-analytics.html#cb606-2" aria-hidden="true" tabindex="-1"></a>bnTA.mle <span class="ot">&lt;-</span> <span class="fu">bn.fit</span>(dagTA, <span class="at">data =</span> targeted.adv[, <span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>)], <span class="at">method =</span> <span class="st">&quot;mle&quot;</span>)</span>
<span id="cb606-3"><a href="probabilistic-models-for-customer-analytics.html#cb606-3" aria-hidden="true" tabindex="-1"></a>bnTA.mle</span></code></pre></div>
<pre><code>## 
##   Bayesian network parameters
## 
##   Parameters of node Buy (multinomial distribution)
## 
## Conditional probability table:
##  
## , , Mailed = no, Sex = female
## 
##      Income
## Buy        high       low    medium
##   no  0.4090909 0.5326087 0.5609756
##   yes 0.5909091 0.4673913 0.4390244
## 
## , , Mailed = yes, Sex = female
## 
##      Income
## Buy        high       low    medium
##   no  0.4197531 0.4204545 0.2812500
##   yes 0.5802469 0.5795455 0.7187500
## 
## , , Mailed = no, Sex = male
## 
##      Income
## Buy        high       low    medium
##   no  0.4285714 0.5306122 0.8043478
##   yes 0.5714286 0.4693878 0.1956522
## 
## , , Mailed = yes, Sex = male
## 
##      Income
## Buy        high       low    medium
##   no  0.4555556 0.3827160 0.5853659
##   yes 0.5444444 0.6172840 0.4146341
## 
## 
##   Parameters of node Income (multinomial distribution)
## 
## Conditional probability table:
##    high    low medium 
##  0.321  0.359  0.320 
## 
##   Parameters of node Mailed (multinomial distribution)
## 
## Conditional probability table:
##     no   yes 
## 0.514 0.486 
## 
##   Parameters of node Sex (multinomial distribution)
## 
## Conditional probability table:
##  female   male 
##  0.473  0.527</code></pre>
<p>We know that the whole network is based upon the conditional probabilities.</p>
<p>Now we want to calculate the <strong>ELP (Expected Lift in Profit)</strong></p>
<p>The function is basically</p>
<p><span class="math display">\[ELP = P(Buy = Yes| Mailed = yes) * r_s  - P(Buy = Yes| Mailed = no) r_u - c\]</span></p>
<p>That applies for any given population Y. We see that we have the following notations:</p>
<ul>
<li><span class="math inline">\(c\)</span> = cost of mailing the ad to a give person</li>
<li><span class="math inline">\(r_u\)</span> = the income obtained from a sale to en unsolicited customer</li>
<li><span class="math inline">\(r_c\)</span> = the income obtained from a sale to en solicited customer</li>
<li><span class="math inline">\(r_u\)</span> and <span class="math inline">\(r_s\)</span> = are different because we may offer some discount in the ad</li>
</ul>
<p>We can take the following assumptions.</p>
<p>Now we need to do three different scenarios:</p>
<ol style="list-style-type: lower-alpha">
<li><p>Compute the ELP for the population consisting of individuals with medium income who are male. Should we mail an ad to this population?</p></li>
<li><p>Compute the ELP for the population consisting of individuals with medium income who are female. Should we mail the ad to this population?</p></li>
<li><p>Compute the ELP for the population consisting of individuals with low income. Should we mail an ad this population?</p></li>
</ol>
<p><strong>Scenario 1</strong></p>
<p>We are going to evaluate males with high income. First we see the probability of buying when mailed and when not.</p>
<div class="sourceCode" id="cb608"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb608-1"><a href="probabilistic-models-for-customer-analytics.html#cb608-1" aria-hidden="true" tabindex="-1"></a>c <span class="ot">=</span> <span class="fl">0.5</span> <span class="co">#Cost</span></span>
<span id="cb608-2"><a href="probabilistic-models-for-customer-analytics.html#cb608-2" aria-hidden="true" tabindex="-1"></a>r_s <span class="ot">=</span> <span class="dv">8</span> <span class="co">#Income with discount</span></span>
<span id="cb608-3"><a href="probabilistic-models-for-customer-analytics.html#cb608-3" aria-hidden="true" tabindex="-1"></a>r_u <span class="ot">=</span> <span class="dv">10</span> <span class="co">#Income obtained from a sale to en unsolicited customer</span></span></code></pre></div>
<div class="sourceCode" id="cb609"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb609-1"><a href="probabilistic-models-for-customer-analytics.html#cb609-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set evidence and get the cpt </span></span>
<span id="cb609-2"><a href="probabilistic-models-for-customer-analytics.html#cb609-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span> (gRain)</span>
<span id="cb609-3"><a href="probabilistic-models-for-customer-analytics.html#cb609-3" aria-hidden="true" tabindex="-1"></a>junctionTA <span class="ot">&lt;-</span> <span class="fu">compile</span>(<span class="fu">as.grain</span>(bnTA.mle))</span>
<span id="cb609-4"><a href="probabilistic-models-for-customer-analytics.html#cb609-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb609-5"><a href="probabilistic-models-for-customer-analytics.html#cb609-5" aria-hidden="true" tabindex="-1"></a><span class="co">#We have mailed</span></span>
<span id="cb609-6"><a href="probabilistic-models-for-customer-analytics.html#cb609-6" aria-hidden="true" tabindex="-1"></a>Med_male_yes <span class="ot">&lt;-</span> <span class="fu">setEvidence</span>(junctionTA, <span class="at">nodes =</span> <span class="fu">c</span>(<span class="st">&quot;Income&quot;</span>, <span class="st">&quot;Sex&quot;</span>, <span class="st">&quot;Mailed&quot;</span>)</span>
<span id="cb609-7"><a href="probabilistic-models-for-customer-analytics.html#cb609-7" aria-hidden="true" tabindex="-1"></a>                             , <span class="at">states =</span> <span class="fu">c</span>(<span class="st">&quot;medium&quot;</span>, <span class="st">&quot;male&quot;</span>, <span class="st">&quot;yes&quot;</span>))</span>
<span id="cb609-8"><a href="probabilistic-models-for-customer-analytics.html#cb609-8" aria-hidden="true" tabindex="-1"></a><span class="fu">querygrain</span>(Med_male_yes, <span class="at">nodes =</span> <span class="st">&quot;Buy&quot;</span>)</span></code></pre></div>
<pre><code>## $Buy
## Buy
##        no       yes 
## 0.5853659 0.4146341</code></pre>
<p>Probability of buying when mailed = 41.46%.</p>
<div class="sourceCode" id="cb611"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb611-1"><a href="probabilistic-models-for-customer-analytics.html#cb611-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Not mailed</span></span>
<span id="cb611-2"><a href="probabilistic-models-for-customer-analytics.html#cb611-2" aria-hidden="true" tabindex="-1"></a>Med_male_no <span class="ot">&lt;-</span> <span class="fu">setEvidence</span>(junctionTA, <span class="at">nodes =</span> <span class="fu">c</span>(<span class="st">&quot;Income&quot;</span>, <span class="st">&quot;Sex&quot;</span>, <span class="st">&quot;Mailed&quot;</span>)</span>
<span id="cb611-3"><a href="probabilistic-models-for-customer-analytics.html#cb611-3" aria-hidden="true" tabindex="-1"></a>                            , <span class="at">states =</span> <span class="fu">c</span>(<span class="st">&quot;medium&quot;</span>, <span class="st">&quot;male&quot;</span>, <span class="st">&quot;no&quot;</span>))</span>
<span id="cb611-4"><a href="probabilistic-models-for-customer-analytics.html#cb611-4" aria-hidden="true" tabindex="-1"></a><span class="fu">querygrain</span>(Med_male_no, <span class="at">nodes =</span> <span class="st">&quot;Buy&quot;</span>)</span></code></pre></div>
<pre><code>## $Buy
## Buy
##        no       yes 
## 0.8043478 0.1956522</code></pre>
<p>Probability of buying when not mailed = 19.56%</p>
<p>Calculate expected lift.</p>
<div class="sourceCode" id="cb613"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb613-1"><a href="probabilistic-models-for-customer-analytics.html#cb613-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb613-2"><a href="probabilistic-models-for-customer-analytics.html#cb613-2" aria-hidden="true" tabindex="-1"></a>ELP <span class="ot">=</span> <span class="fu">querygrain</span>(Med_male_yes, <span class="at">nodes =</span> <span class="st">&quot;Buy&quot;</span>)<span class="sc">$</span>Buy[[<span class="dv">2</span>]] <span class="sc">*</span> r_s <span class="sc">-</span></span>
<span id="cb613-3"><a href="probabilistic-models-for-customer-analytics.html#cb613-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">querygrain</span>(Med_male_no, <span class="at">nodes =</span> <span class="st">&quot;Buy&quot;</span>)<span class="sc">$</span>Buy[[<span class="dv">2</span>]] <span class="sc">*</span> r_u <span class="sc">-</span> c</span>
<span id="cb613-4"><a href="probabilistic-models-for-customer-analytics.html#cb613-4" aria-hidden="true" tabindex="-1"></a>ELP</span></code></pre></div>
<pre><code>## [1] 0.86</code></pre>
<p>We see that the expected lift (ELP) is positive hence, we should mail the high income males.</p>
<p><strong>Scenario 2</strong></p>
<p>In this examplle we basically do the same, just with females instead.</p>
<div class="sourceCode" id="cb615"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb615-1"><a href="probabilistic-models-for-customer-analytics.html#cb615-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Assumptions</span></span>
<span id="cb615-2"><a href="probabilistic-models-for-customer-analytics.html#cb615-2" aria-hidden="true" tabindex="-1"></a>c <span class="ot">=</span> <span class="fl">0.6</span> <span class="co">#Cost</span></span>
<span id="cb615-3"><a href="probabilistic-models-for-customer-analytics.html#cb615-3" aria-hidden="true" tabindex="-1"></a>r_s <span class="ot">=</span> <span class="dv">7</span> <span class="co">#Income with discount</span></span>
<span id="cb615-4"><a href="probabilistic-models-for-customer-analytics.html#cb615-4" aria-hidden="true" tabindex="-1"></a>r_u <span class="ot">=</span> <span class="dv">9</span> <span class="co">#Income obtained from a sale to en unsolicited customer</span></span>
<span id="cb615-5"><a href="probabilistic-models-for-customer-analytics.html#cb615-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb615-6"><a href="probabilistic-models-for-customer-analytics.html#cb615-6" aria-hidden="true" tabindex="-1"></a>Med_fem_yes <span class="ot">&lt;-</span> <span class="fu">setEvidence</span>(junctionTA, <span class="at">nodes =</span> <span class="fu">c</span>(<span class="st">&quot;Income&quot;</span>, <span class="st">&quot;Sex&quot;</span>, <span class="st">&quot;Mailed&quot;</span>)</span>
<span id="cb615-7"><a href="probabilistic-models-for-customer-analytics.html#cb615-7" aria-hidden="true" tabindex="-1"></a>                           ,<span class="at">states =</span> <span class="fu">c</span>(<span class="st">&quot;medium&quot;</span>, <span class="st">&quot;female&quot;</span>, <span class="st">&quot;yes&quot;</span>))</span>
<span id="cb615-8"><a href="probabilistic-models-for-customer-analytics.html#cb615-8" aria-hidden="true" tabindex="-1"></a><span class="fu">querygrain</span>(Med_fem_yes, <span class="at">nodes =</span> <span class="st">&quot;Buy&quot;</span>)</span></code></pre></div>
<pre><code>## $Buy
## Buy
##   no  yes 
## 0.28 0.72</code></pre>
<p>We see the probability of buying = 72% when they are mailed.</p>
<div class="sourceCode" id="cb617"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb617-1"><a href="probabilistic-models-for-customer-analytics.html#cb617-1" aria-hidden="true" tabindex="-1"></a>Med_fem_no <span class="ot">&lt;-</span> <span class="fu">setEvidence</span>(junctionTA, <span class="at">nodes =</span> <span class="fu">c</span>(<span class="st">&quot;Income&quot;</span>, <span class="st">&quot;Sex&quot;</span>, <span class="st">&quot;Mailed&quot;</span>)</span>
<span id="cb617-2"><a href="probabilistic-models-for-customer-analytics.html#cb617-2" aria-hidden="true" tabindex="-1"></a>                          ,<span class="at">states =</span> <span class="fu">c</span>(<span class="st">&quot;medium&quot;</span>, <span class="st">&quot;female&quot;</span>, <span class="st">&quot;no&quot;</span>))</span>
<span id="cb617-3"><a href="probabilistic-models-for-customer-analytics.html#cb617-3" aria-hidden="true" tabindex="-1"></a><span class="fu">querygrain</span>(Med_fem_no, <span class="at">nodes =</span> <span class="st">&quot;Buy&quot;</span>)</span></code></pre></div>
<pre><code>## $Buy
## Buy
##   no  yes 
## 0.56 0.44</code></pre>
<p>We see that the probability of buying = 44% when mailed.</p>
<div class="sourceCode" id="cb619"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb619-1"><a href="probabilistic-models-for-customer-analytics.html#cb619-1" aria-hidden="true" tabindex="-1"></a>ELP <span class="ot">=</span> <span class="fu">querygrain</span>(Med_fem_yes, <span class="at">nodes =</span> <span class="st">&quot;Buy&quot;</span>)<span class="sc">$</span>Buy[[<span class="dv">2</span>]] <span class="sc">*</span> r_s <span class="sc">-</span></span>
<span id="cb619-2"><a href="probabilistic-models-for-customer-analytics.html#cb619-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">querygrain</span>(Med_fem_no, <span class="at">nodes =</span> <span class="st">&quot;Buy&quot;</span>)<span class="sc">$</span>Buy[[<span class="dv">2</span>]] <span class="sc">*</span> r_u <span class="sc">-</span> c</span>
<span id="cb619-3"><a href="probabilistic-models-for-customer-analytics.html#cb619-3" aria-hidden="true" tabindex="-1"></a>ELP</span></code></pre></div>
<pre><code>## [1] 0.48</code></pre>
<p>We see that the ELP = 0.48, hence positive. Meaning that we should mail the medium income females as well, because we see that we earn more on these.</p>
<p><strong>Scenario 3</strong></p>
<p>We go with the same assumptions this time.</p>
<p>We are going to look at low income customers.</p>
<div class="sourceCode" id="cb621"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb621-1"><a href="probabilistic-models-for-customer-analytics.html#cb621-1" aria-hidden="true" tabindex="-1"></a>Low_yes <span class="ot">&lt;-</span> <span class="fu">setEvidence</span> (junctionTA, <span class="at">nodes =</span> <span class="fu">c</span>(<span class="st">&quot;Income&quot;</span>, <span class="st">&quot;Mailed&quot;</span>)</span>
<span id="cb621-2"><a href="probabilistic-models-for-customer-analytics.html#cb621-2" aria-hidden="true" tabindex="-1"></a>                        ,<span class="at">states =</span> <span class="fu">c</span>(<span class="st">&quot;low&quot;</span>, <span class="st">&quot;yes&quot;</span>))</span>
<span id="cb621-3"><a href="probabilistic-models-for-customer-analytics.html#cb621-3" aria-hidden="true" tabindex="-1"></a><span class="fu">querygrain</span>( Low_yes, <span class="at">nodes =</span> <span class="st">&quot;Buy&quot;</span>)</span></code></pre></div>
<pre><code>## $Buy
## Buy
##  no yes 
## 0.4 0.6</code></pre>
<p>We see that the probability of buying = 60%</p>
<div class="sourceCode" id="cb623"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb623-1"><a href="probabilistic-models-for-customer-analytics.html#cb623-1" aria-hidden="true" tabindex="-1"></a>Low_no <span class="ot">&lt;-</span> <span class="fu">setEvidence</span> (junctionTA, <span class="at">nodes =</span> <span class="fu">c</span>(<span class="st">&quot;Income&quot;</span>, <span class="st">&quot;Mailed&quot;</span>)</span>
<span id="cb623-2"><a href="probabilistic-models-for-customer-analytics.html#cb623-2" aria-hidden="true" tabindex="-1"></a>                       ,<span class="at">states =</span> <span class="fu">c</span>(<span class="st">&quot;low&quot;</span>, <span class="st">&quot;no&quot;</span>))</span>
<span id="cb623-3"><a href="probabilistic-models-for-customer-analytics.html#cb623-3" aria-hidden="true" tabindex="-1"></a><span class="fu">querygrain</span>(Low_no, <span class="at">nodes =</span> <span class="st">&quot;Buy&quot;</span>)</span></code></pre></div>
<pre><code>## $Buy
## Buy
##   no  yes 
## 0.53 0.47</code></pre>
<p>Now we see that there is 47% probability of buying when they are mailed.</p>
<div class="sourceCode" id="cb625"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb625-1"><a href="probabilistic-models-for-customer-analytics.html#cb625-1" aria-hidden="true" tabindex="-1"></a>ELP <span class="ot">=</span> <span class="fu">querygrain</span>(Low_yes, <span class="at">nodes =</span> <span class="st">&quot;Buy&quot;</span>)<span class="sc">$</span>Buy[[<span class="dv">2</span>]] <span class="sc">*</span> r_s <span class="sc">-</span></span>
<span id="cb625-2"><a href="probabilistic-models-for-customer-analytics.html#cb625-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">querygrain</span>(Low_no, <span class="at">nodes =</span> <span class="st">&quot;Buy&quot;</span>)<span class="sc">$</span>Buy[[<span class="dv">2</span>]] <span class="sc">*</span> r_u <span class="sc">-</span> c</span>
<span id="cb625-3"><a href="probabilistic-models-for-customer-analytics.html#cb625-3" aria-hidden="true" tabindex="-1"></a>ELP</span></code></pre></div>
<pre><code>## [1] -0.62</code></pre>
<p>We see that it is negative, hence we should not email the low income people.</p>
<p>Discussion:</p>
<p>Using BN in this application allows to identify persuadable segments of individuals who would buy only if they are sent an ad. It avoids sending ads to those who will never buy those who always buy (thus avoid wasting the ad), and those who are turned off by the advertisement when they receive it. The network can be extended with more nodes according to the characteritics of the pop. in the dataset</p>
</div>
<div id="application-3-product-recommendation-using-probabilistic-models-bn" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Application 3: Product Recommendation using Probabilistic Models (BN)</h2>
<div id="method-1-learn-the-probabilistic-relationships-using-a-bayesian-network-learning" class="section level3" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> Method 1: Learn the probabilistic relationships using a Bayesian network learning</h3>
<p>Now we are going to use the Hill+Climbing algorithm to estimate the model.</p>
<p>We are going to use the Bayesian Network for Collaborative Filtering.</p>
<div class="sourceCode" id="cb627"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb627-1"><a href="probabilistic-models-for-customer-analytics.html#cb627-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bnlearn)</span>
<span id="cb627-2"><a href="probabilistic-models-for-customer-analytics.html#cb627-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Rgraphviz)</span>
<span id="cb627-3"><a href="probabilistic-models-for-customer-analytics.html#cb627-3" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">&quot;Data/Probabilistic Models for Customer Analytics/CollFilforR.csv&quot;</span></span>
<span id="cb627-4"><a href="probabilistic-models-for-customer-analytics.html#cb627-4" aria-hidden="true" tabindex="-1"></a>               ,<span class="at">header =</span> T,<span class="at">colClasses =</span> <span class="st">&quot;factor&quot;</span>,<span class="at">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb627-5"><a href="probabilistic-models-for-customer-analytics.html#cb627-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data)</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="left">V1</th>
<th align="left">V2</th>
<th align="left">V3</th>
<th align="left">V4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">4</td>
<td align="left">5</td>
<td align="left">4</td>
</tr>
<tr class="even">
<td align="left">5</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">2</td>
</tr>
<tr class="odd">
<td align="left">4</td>
<td align="left">1</td>
<td align="left">2</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">5</td>
<td align="left">4</td>
<td align="left">5</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">5</td>
<td align="left">5</td>
<td align="left">5</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">5</td>
<td align="left">5</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
</div>
<p>We see that we have information on four different items.</p>
<p>Structural expectation-maximization function learns with mising data a Hill-Climbing structure and further predict the missing values, which will be the recommendations</p>
<div class="sourceCode" id="cb628"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb628-1"><a href="probabilistic-models-for-customer-analytics.html#cb628-1" aria-hidden="true" tabindex="-1"></a>mystructural <span class="ot">&lt;-</span> <span class="fu">structural.em</span>(data, <span class="at">maximize =</span> <span class="st">&quot;hc&quot;</span>, <span class="at">return.all =</span> <span class="cn">TRUE</span>) </span>
<span id="cb628-2"><a href="probabilistic-models-for-customer-analytics.html#cb628-2" aria-hidden="true" tabindex="-1"></a><span class="fu">graphviz.plot</span>(mystructural<span class="sc">$</span>dag)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-304-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>We see the structure.</p>
<div class="sourceCode" id="cb629"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb629-1"><a href="probabilistic-models-for-customer-analytics.html#cb629-1" aria-hidden="true" tabindex="-1"></a>mystructural<span class="sc">$</span>dag <span class="co"># the structure</span></span></code></pre></div>
<pre><code>## 
##   Bayesian network learned from Missing Data
## 
##   model:
##    [V1][V2][V4|V1][V3|V4] 
##   nodes:                                 4 
##   arcs:                                  2 
##     undirected arcs:                     0 
##     directed arcs:                       2 
##   average markov blanket size:           1.00 
##   average neighbourhood size:            1.00 
##   average branching factor:              0.50 
## 
##   learning algorithm:                    Structural EM 
##   score-based method:                    Hill-Climbing 
##   parameter learning method:             Maximum Likelihood 
##   imputation method:                     
##                                      Posterior Expectation (Likelihood Weighting) 
##   penalization coefficient:              2.3 
##   tests used in the learning procedure:  34 
##   optimized:                             TRUE</code></pre>
<p>In the following see the conditional probabilities.</p>
<div class="sourceCode" id="cb631"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb631-1"><a href="probabilistic-models-for-customer-analytics.html#cb631-1" aria-hidden="true" tabindex="-1"></a>mystructural<span class="sc">$</span>fitted <span class="co"># the parameters</span></span></code></pre></div>
<pre><code>## 
##   Bayesian network parameters
## 
##   Parameters of node V1 (multinomial distribution)
## 
## Conditional probability table:
##     1    2    3    4    5 
## 0.67 0.06 0.03 0.07 0.17 
## 
##   Parameters of node V2 (multinomial distribution)
## 
## Conditional probability table:
##     1    2    3    4    5 
## 0.58 0.17 0.03 0.03 0.19 
## 
##   Parameters of node V3 (multinomial distribution)
## 
## Conditional probability table:
##  
##    V4
## V3      1     2     4     5
##   1 0.600 0.556 0.000 0.045
##   2 0.400 0.444 0.000 0.061
##   3 0.000 0.000 0.000 0.015
##   4 0.000 0.000 0.000 0.061
##   5 0.000 0.000 1.000 0.818
## 
##   Parameters of node V4 (multinomial distribution)
## 
## Conditional probability table:
##  
##    V1
## V4      1     2     3     4     5
##   1 0.000 0.000 1.000 0.571 0.176
##   2 0.075 0.500 0.000 0.000 0.588
##   4 0.090 0.000 0.000 0.000 0.000
##   5 0.836 0.500 0.000 0.429 0.235</code></pre>
<p>Now we see that the method imputed the NA that we had in row 6.</p>
<div class="sourceCode" id="cb633"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb633-1"><a href="probabilistic-models-for-customer-analytics.html#cb633-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data)</span>
<span id="cb633-2"><a href="probabilistic-models-for-customer-analytics.html#cb633-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mystructural<span class="sc">$</span>imputed) <span class="co"># the predictions based on the probabilistic structure</span></span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="left">V1</th>
<th align="left">V2</th>
<th align="left">V3</th>
<th align="left">V4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">4</td>
<td align="left">5</td>
<td align="left">4</td>
</tr>
<tr class="even">
<td align="left">5</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">2</td>
</tr>
<tr class="odd">
<td align="left">4</td>
<td align="left">1</td>
<td align="left">2</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">5</td>
<td align="left">4</td>
<td align="left">5</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">5</td>
<td align="left">5</td>
<td align="left">5</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">5</td>
<td align="left">5</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
</div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="left">V1</th>
<th align="left">V2</th>
<th align="left">V3</th>
<th align="left">V4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">4</td>
<td align="left">5</td>
<td align="left">4</td>
</tr>
<tr class="even">
<td align="left">5</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">2</td>
</tr>
<tr class="odd">
<td align="left">4</td>
<td align="left">1</td>
<td align="left">2</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">5</td>
<td align="left">4</td>
<td align="left">5</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">5</td>
<td align="left">5</td>
<td align="left">5</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">5</td>
<td align="left">5</td>
<td align="left">5</td>
</tr>
</tbody>
</table>
</div>
<p><strong>Alternatively</strong>, BN model is trained with any other algorithm using non-missing registers, and used afterwards for making inference; <code>impute()</code> function allow us to make inference in a new data set of customers for which we want to make recommendations.</p>
<div class="sourceCode" id="cb634"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb634-1"><a href="probabilistic-models-for-customer-analytics.html#cb634-1" aria-hidden="true" tabindex="-1"></a>data_wNA <span class="ot">=</span> <span class="fu">na.omit</span>(data)</span>
<span id="cb634-2"><a href="probabilistic-models-for-customer-analytics.html#cb634-2" aria-hidden="true" tabindex="-1"></a>dag <span class="ot">=</span> <span class="fu">tree.bayes</span>(data_wNA, <span class="st">&quot;V4&quot;</span>) <span class="co"># a tree bayes</span></span>
<span id="cb634-3"><a href="probabilistic-models-for-customer-analytics.html#cb634-3" aria-hidden="true" tabindex="-1"></a><span class="fu">graphviz.plot</span>(dag)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-308-1.png" width="720" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb635"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb635-1"><a href="probabilistic-models-for-customer-analytics.html#cb635-1" aria-hidden="true" tabindex="-1"></a>myBN <span class="ot">=</span> <span class="fu">bn.fit</span>(dag, data_wNA)</span></code></pre></div>
<p>Assuming the model was trained and tested through a cross-validation procedure (as in App 1), one can further use it for making recommendations with impute() function in a new dataset</p>
<div class="sourceCode" id="cb636"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb636-1"><a href="probabilistic-models-for-customer-analytics.html#cb636-1" aria-hidden="true" tabindex="-1"></a>dataimputed <span class="ot">=</span> bnlearn<span class="sc">::</span><span class="fu">impute</span>(myBN, data, <span class="at">method =</span> <span class="st">&quot;parents&quot;</span>, <span class="at">debug =</span> <span class="cn">TRUE</span>)</span>
<span id="cb636-2"><a href="probabilistic-models-for-customer-analytics.html#cb636-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">is.na</span>(dataimputed))</span></code></pre></div>
<pre><code>## * checking node V4 .
##   &gt; found 16 missing value(s).
## * checking node V1 .
##   &gt; found 7 missing value(s).
## * checking node V3 .
##   &gt; found 13 missing value(s).
## * checking node V2 .
##   &gt; found 10 missing value(s).
## 
## FALSE 
##   400</code></pre>
<p>compare the recommendations made by the two methods. We make confusion matrices.</p>
<div class="sourceCode" id="cb638"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb638-1"><a href="probabilistic-models-for-customer-analytics.html#cb638-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(mystructural<span class="sc">$</span>imputed<span class="sc">$</span>V1, dataimputed<span class="sc">$</span>V1)</span>
<span id="cb638-2"><a href="probabilistic-models-for-customer-analytics.html#cb638-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(mystructural<span class="sc">$</span>imputed<span class="sc">$</span>V2, dataimputed<span class="sc">$</span>V2)</span>
<span id="cb638-3"><a href="probabilistic-models-for-customer-analytics.html#cb638-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(mystructural<span class="sc">$</span>imputed<span class="sc">$</span>V3, dataimputed<span class="sc">$</span>V3)</span>
<span id="cb638-4"><a href="probabilistic-models-for-customer-analytics.html#cb638-4" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(mystructural<span class="sc">$</span>imputed<span class="sc">$</span>V4, dataimputed<span class="sc">$</span>V4)</span></code></pre></div>
<pre><code>##    
##      1  2  3  4  5
##   1 67  0  0  0  0
##   2  0  6  0  0  0
##   3  0  0  3  0  0
##   4  0  0  0  7  0
##   5  0  0  0  0 17
##    
##      1  2  3  4  5
##   1 51  2  3  1  1
##   2  0 17  0  0  0
##   3  0  0  3  0  0
##   4  0  0  0  3  0
##   5  0  0  0  0 19
##    
##      1  2  3  4  5
##   1 19  0  0  0  0
##   2  0 16  0  0  0
##   3  0  0  1  0  0
##   4  0  0  0  4  0
##   5  0  0  0  1 59
##    
##      1  2  4  5
##   1 10  0  0  0
##   2  0 15  0  3
##   4  0  0  6  0
##   5  0  0  0 66</code></pre>
<p>as seen, the recommendations made by the two methods are almost the same</p>
</div>
<div id="method-2-finding-latent-segments" class="section level3" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> Method 2: Finding latent segments</h3>
<p>A latent class (segment) that can accurately predict the ratings for the user on all items. The advantages of this method is that is considers both the similarities between users, items and their interaction.</p>
<p>Hence we want to use Bayesian Networks to identify segments / or clusters. These are latent, hence we cannot directly measure them. Therefore we are going to test different number of latent segments and see which has the lowest best performance according to the log likelihood.</p>
<p>Notice that the data consists of four different variables, these could for instance be movies.</p>
<div class="sourceCode" id="cb640"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb640-1"><a href="probabilistic-models-for-customer-analytics.html#cb640-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(poLCA)</span>
<span id="cb640-2"><a href="probabilistic-models-for-customer-analytics.html#cb640-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the variables used for (the model ~1 means without covariates)</span></span>
<span id="cb640-3"><a href="probabilistic-models-for-customer-analytics.html#cb640-3" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">cbind</span>(V1, V2, V3, V4)<span class="sc">~</span><span class="dv">1</span></span></code></pre></div>
<p>We are going to run several models with the for() function. We are going to evaluate BIC. One also have used AIC, <span class="math inline">\(G^2\)</span>, <span class="math inline">\(X^2\)</span>.</p>
<div class="sourceCode" id="cb641"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb641-1"><a href="probabilistic-models-for-customer-analytics.html#cb641-1" aria-hidden="true" tabindex="-1"></a>min_bic <span class="ot">&lt;-</span> <span class="dv">100000</span></span>
<span id="cb641-2"><a href="probabilistic-models-for-customer-analytics.html#cb641-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">10</span>){ <span class="co">#We test from 2 to 10 segments.</span></span>
<span id="cb641-3"><a href="probabilistic-models-for-customer-analytics.html#cb641-3" aria-hidden="true" tabindex="-1"></a> lc <span class="ot">&lt;-</span> <span class="fu">poLCA</span>(f, data, <span class="at">nclass=</span>i <span class="co">#We iterate through no. of classes.</span></span>
<span id="cb641-4"><a href="probabilistic-models-for-customer-analytics.html#cb641-4" aria-hidden="true" tabindex="-1"></a>             , <span class="at">maxiter=</span><span class="dv">3000</span>,</span>
<span id="cb641-5"><a href="probabilistic-models-for-customer-analytics.html#cb641-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">tol=</span><span class="fl">1e-5</span>, <span class="at">na.rm=</span><span class="cn">FALSE</span>,</span>
<span id="cb641-6"><a href="probabilistic-models-for-customer-analytics.html#cb641-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">nrep=</span><span class="dv">1</span>, <span class="at">verbose=</span><span class="cn">TRUE</span>, <span class="at">calc.se=</span><span class="cn">TRUE</span>)</span>
<span id="cb641-7"><a href="probabilistic-models-for-customer-analytics.html#cb641-7" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb641-8"><a href="probabilistic-models-for-customer-analytics.html#cb641-8" aria-hidden="true" tabindex="-1"></a> <span class="cf">if</span>(lc<span class="sc">$</span>bic <span class="sc">&lt;</span> min_bic){</span>
<span id="cb641-9"><a href="probabilistic-models-for-customer-analytics.html#cb641-9" aria-hidden="true" tabindex="-1"></a>   min_bic <span class="ot">&lt;-</span> lc<span class="sc">$</span>bic</span>
<span id="cb641-10"><a href="probabilistic-models-for-customer-analytics.html#cb641-10" aria-hidden="true" tabindex="-1"></a>   LCA_best_model<span class="ot">&lt;-</span>lc</span>
<span id="cb641-11"><a href="probabilistic-models-for-customer-analytics.html#cb641-11" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb641-12"><a href="probabilistic-models-for-customer-analytics.html#cb641-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb641-13"><a href="probabilistic-models-for-customer-analytics.html#cb641-13" aria-hidden="true" tabindex="-1"></a>LCA_best_model</span></code></pre></div>
<pre><code>## Conditional item response (column) probabilities,
##  by outcome variable, for each class (row) 
##  
## $V1
##              1     2     3    4    5
## class 1:  0.24 0.081 0.075 0.18 0.43
## class 2:  0.95 0.053 0.000 0.00 0.00
## 
## $V2
##              1    2     3     4    5
## class 1:  0.37 0.54 0.095 0.000 0.00
## class 2:  0.62 0.00 0.000 0.051 0.33
## 
## $V3
##              1    2     3     4     5
## class 1:  0.44 0.44 0.028 0.000 0.085
## class 2:  0.00 0.00 0.000 0.079 0.921
## 
## $V4
##              1    2    4    5
## class 1:  0.31 0.46 0.00 0.23
## class 2:  0.00 0.00 0.12 0.88
## 
## Estimated class population shares 
##  0.4 0.6 
##  
## Predicted class memberships (by modal posterior prob.) 
##  0.39 0.61 
##  
## ========================================================= 
## Fit for 2 latent classes: 
## ========================================================= 
## number of observations: 100 
## number of fully observed cases: 68 
## number of estimated parameters: 31 
## residual degrees of freedom: 69 
## maximum log-likelihood: -312 
##  
## AIC(2): 686
## BIC(2): 767
## G^2(2): 160 (Likelihood ratio/deviance statistic) 
## X^2(2): 381 (Chi-square goodness of fit) 
##  
## Conditional item response (column) probabilities,
##  by outcome variable, for each class (row) 
##  
## $V1
##              1    2   3    4    5
## class 1:  1.00 0.00 0.0 0.00 0.00
## class 2:  0.32 0.00 0.1 0.00 0.58
## class 3:  0.00 0.46 0.0 0.54 0.00
## 
## $V2
##              1    2    3     4    5
## class 1:  0.66 0.00 0.00 0.054 0.29
## class 2:  0.33 0.53 0.13 0.000 0.00
## class 3:  0.33 0.42 0.00 0.000 0.25
## 
## $V3
##              1    2     3     4    5
## class 1:  0.00 0.00 0.000 0.021 0.98
## class 2:  0.62 0.35 0.038 0.000 0.00
## class 3:  0.00 0.54 0.000 0.231 0.23
## 
## $V4
##              1    2    4    5
## class 1:  0.00 0.00 0.13 0.87
## class 2:  0.24 0.48 0.00 0.28
## class 3:  0.36 0.27 0.00 0.37
## 
## Estimated class population shares 
##  0.56 0.29 0.14 
##  
## Predicted class memberships (by modal posterior prob.) 
##  0.56 0.29 0.15 
##  
## ========================================================= 
## Fit for 3 latent classes: 
## ========================================================= 
## number of observations: 100 
## number of fully observed cases: 68 
## number of estimated parameters: 47 
## residual degrees of freedom: 53 
## maximum log-likelihood: -302 
##  
## AIC(3): 699
## BIC(3): 821
## G^2(3): 140 (Likelihood ratio/deviance statistic) 
## X^2(3): 262 (Chi-square goodness of fit) 
##  
## Conditional item response (column) probabilities,
##  by outcome variable, for each class (row) 
##  
## $V1
##              1     2    3    4    5
## class 1:  0.42 0.000 0.00 0.58 0.00
## class 2:  0.36 0.116 0.11 0.00 0.42
## class 3:  0.94 0.056 0.00 0.00 0.00
## class 4:  0.00 0.000 0.00 0.41 0.59
## 
## $V2
##              1    2    3    4    5
## class 1:  0.00 0.37 0.00 0.37 0.27
## class 2:  0.37 0.63 0.00 0.00 0.00
## class 3:  0.68 0.00 0.00 0.00 0.32
## class 4:  0.50 0.12 0.38 0.00 0.00
## 
## $V3
##              1    2   3     4    5
## class 1:  0.00 0.00 0.0 0.000 1.00
## class 2:  0.69 0.31 0.0 0.000 0.00
## class 3:  0.00 0.00 0.0 0.089 0.91
## class 4:  0.00 0.90 0.1 0.000 0.00
## 
## $V4
##              1    2 4    5
## class 1:  0.00 0.00 1 0.00
## class 2:  0.25 0.62 0 0.13
## class 3:  0.00 0.00 0 1.00
## class 4:  0.50 0.00 0 0.50
## 
## Estimated class population shares 
##  0.092 0.27 0.54 0.098 
##  
## Predicted class memberships (by modal posterior prob.) 
##  0.09 0.25 0.55 0.11 
##  
## ========================================================= 
## Fit for 4 latent classes: 
## ========================================================= 
## number of observations: 100 
## number of fully observed cases: 68 
## number of estimated parameters: 63 
## residual degrees of freedom: 37 
## maximum log-likelihood: -284 
##  
## AIC(4): 695
## BIC(4): 859
## G^2(4): 122 (Likelihood ratio/deviance statistic) 
## X^2(4): 228 (Chi-square goodness of fit) 
##  
## Conditional item response (column) probabilities,
##  by outcome variable, for each class (row) 
##  
## $V1
##              1    2     3   4    5
## class 1:  1.00 0.00 0.000 0.0 0.00
## class 2:  1.00 0.00 0.000 0.0 0.00
## class 3:  0.00 1.00 0.000 0.0 0.00
## class 4:  0.00 0.00 0.000 0.0 1.00
## class 5:  0.28 0.09 0.088 0.2 0.34
## 
## $V2
##              1    2    3    4    5
## class 1:  0.75 0.00 0.00 0.00 0.25
## class 2:  0.00 0.00 0.00 0.54 0.46
## class 3:  0.00 0.00 0.00 0.00 1.00
## class 4:  0.00 0.25 0.75 0.00 0.00
## class 5:  0.42 0.58 0.00 0.00 0.00
## 
## $V3
##              1    2    3 4   5
## class 1:  0.00 0.00 0.00 0 1.0
## class 2:  0.00 0.00 0.00 0 1.0
## class 3:  0.00 0.00 0.00 1 0.0
## class 4:  0.00 0.82 0.18 0 0.0
## class 5:  0.52 0.38 0.00 0 0.1
## 
## $V4
##              1    2 4    5
## class 1:  0.00 0.00 0 1.00
## class 2:  0.00 0.00 1 0.00
## class 3:  0.00 0.00 0 1.00
## class 4:  0.00 0.00 0 1.00
## class 5:  0.36 0.53 0 0.11
## 
## Estimated class population shares 
##  0.49 0.066 0.049 0.055 0.34 
##  
## Predicted class memberships (by modal posterior prob.) 
##  0.5 0.06 0.05 0.07 0.32 
##  
## ========================================================= 
## Fit for 5 latent classes: 
## ========================================================= 
## number of observations: 100 
## number of fully observed cases: 68 
## number of estimated parameters: 79 
## residual degrees of freedom: 21 
## maximum log-likelihood: -275 
##  
## AIC(5): 709
## BIC(5): 914
## G^2(5): 98 (Likelihood ratio/deviance statistic) 
## X^2(5): 168 (Chi-square goodness of fit) 
##  
## Conditional item response (column) probabilities,
##  by outcome variable, for each class (row) 
##  
## $V1
##              1    2   3    4    5
## class 1:  0.22 0.23 0.0 0.55 0.00
## class 2:  0.27 0.22 0.0 0.00 0.51
## class 3:  1.00 0.00 0.0 0.00 0.00
## class 4:  0.00 0.00 0.5 0.00 0.50
## class 5:  0.33 0.00 0.0 0.00 0.67
## class 6:  1.00 0.00 0.0 0.00 0.00
## 
## $V2
##              1    2    3    4    5
## class 1:  0.35 0.65 0.00 0.00 0.00
## class 2:  0.00 0.37 0.26 0.00 0.37
## class 3:  0.75 0.00 0.00 0.00 0.25
## class 4:  0.00 1.00 0.00 0.00 0.00
## class 5:  1.00 0.00 0.00 0.00 0.00
## class 6:  0.00 0.00 0.00 0.53 0.47
## 
## $V3
##              1    2    3    4    5
## class 1:  0.00 0.76 0.00 0.00 0.24
## class 2:  0.21 0.44 0.07 0.28 0.00
## class 3:  0.00 0.00 0.00 0.00 1.00
## class 4:  1.00 0.00 0.00 0.00 0.00
## class 5:  1.00 0.00 0.00 0.00 0.00
## class 6:  0.00 0.00 0.00 0.00 1.00
## 
## $V4
##              1    2 4 5
## class 1:  0.44 0.56 0 0
## class 2:  0.00 0.00 0 1
## class 3:  0.00 0.00 0 1
## class 4:  1.00 0.00 0 0
## class 5:  0.00 1.00 0 0
## class 6:  0.00 0.00 1 0
## 
## Estimated class population shares 
##  0.13 0.16 0.48 0.06 0.11 0.066 
##  
## Predicted class memberships (by modal posterior prob.) 
##  0.13 0.15 0.5 0.06 0.1 0.06 
##  
## ========================================================= 
## Fit for 6 latent classes: 
## ========================================================= 
## number of observations: 100 
## number of fully observed cases: 68 
## number of estimated parameters: 95 
## residual degrees of freedom: 5 
## maximum log-likelihood: -263 
##  
## AIC(6): 717
## BIC(6): 964
## G^2(6): 75 (Likelihood ratio/deviance statistic) 
## X^2(6): 112 (Chi-square goodness of fit) 
##  
## Conditional item response (column) probabilities,
##  by outcome variable, for each class (row) 
##  
## $V1
##              1    2   3    4      5
## class 1:  0.49 0.00 0.0 0.00 0.5116
## class 2:  0.31 0.29 0.0 0.39 0.0007
## class 3:  0.00 0.30 0.0 0.00 0.6999
## class 4:  1.00 0.00 0.0 0.00 0.0000
## class 5:  1.00 0.00 0.0 0.00 0.0000
## class 6:  0.00 0.00 0.5 0.00 0.5000
## class 7:  0.43 0.00 0.0 0.57 0.0000
## 
## $V2
##              1    2    3    4    5
## class 1:  0.72 0.28 0.00 0.00 0.00
## class 2:  0.46 0.54 0.00 0.00 0.00
## class 3:  0.00 0.12 0.38 0.00 0.50
## class 4:  0.82 0.00 0.00 0.00 0.18
## class 5:  0.67 0.00 0.00 0.00 0.33
## class 6:  0.00 1.00 0.00 0.00 0.00
## class 7:  0.00 0.36 0.00 0.36 0.27
## 
## $V3
##           1    2     3    4 5
## class 1:  1 0.00 0.000 0.00 0
## class 2:  0 1.00 0.000 0.00 0
## class 3:  0 0.55 0.091 0.36 0
## class 4:  0 0.00 0.000 0.00 1
## class 5:  0 0.00 0.000 0.00 1
## class 6:  1 0.00 0.000 0.00 0
## class 7:  0 0.00 0.000 0.00 1
## 
## $V4
##              1    2 4    5
## class 1:  0.00 0.77 0 0.23
## class 2:  0.44 0.56 0 0.00
## class 3:  0.00 0.00 0 1.00
## class 4:  0.00 0.00 0 1.00
## class 5:  0.00 0.00 0 1.00
## class 6:  1.00 0.00 0 0.00
## class 7:  0.00 0.00 1 0.00
## 
## Estimated class population shares 
##  0.14 0.1 0.12 0.21 0.27 0.06 0.092 
##  
## Predicted class memberships (by modal posterior prob.) 
##  0.13 0.1 0.12 0.5 0.06 0.09 
##  
## ========================================================= 
## Fit for 7 latent classes: 
## ========================================================= 
## number of observations: 100 
## number of fully observed cases: 68 
## number of estimated parameters: 111 
## residual degrees of freedom: -11 
## maximum log-likelihood: -261 
##  
## AIC(7): 745
## BIC(7): 1034
## G^2(7): 76 (Likelihood ratio/deviance statistic) 
## X^2(7): 100 (Chi-square goodness of fit) 
##  
## ALERT: number of parameters estimated ( 111 ) exceeds number of observations ( 100 ) 
##  
## ALERT: negative degrees of freedom; respecify model 
##  
## Conditional item response (column) probabilities,
##  by outcome variable, for each class (row) 
##  
## $V1
##              1   2   3 4      5
## class 1:  1.00 0.0 0.0 0 0.0000
## class 2:  1.00 0.0 0.0 0 0.0000
## class 3:  0.34 0.0 0.0 0 0.6648
## class 4:  0.00 0.0 0.0 0 1.0000
## class 5:  0.30 0.0 0.3 0 0.4000
## class 6:  0.00 0.0 0.0 1 0.0000
## class 7:  0.00 1.0 0.0 0 0.0000
## class 8:  0.50 0.5 0.0 0 0.0002
## 
## $V2
##              1    2 3    4    5
## class 1:  0.00 0.00 0 0.54 0.46
## class 2:  0.75 0.00 0 0.00 0.25
## class 3:  1.00 0.00 0 0.00 0.00
## class 4:  0.00 0.00 1 0.00 0.00
## class 5:  0.00 1.00 0 0.00 0.00
## class 6:  0.57 0.43 0 0.00 0.00
## class 7:  0.00 0.00 0 0.00 1.00
## class 8:  0.00 1.00 0 0.00 0.00
## 
## $V3
##             1    2   3 4    5
## class 1:  0.0 0.00 0.0 0 1.00
## class 2:  0.0 0.00 0.0 0 1.00
## class 3:  1.0 0.00 0.0 0 0.00
## class 4:  0.0 1.00 0.0 0 0.00
## class 5:  0.9 0.00 0.1 0 0.00
## class 6:  0.0 0.57 0.0 0 0.43
## class 7:  0.0 0.00 0.0 1 0.00
## class 8:  0.0 1.00 0.0 0 0.00
## 
## $V4
##             1      2 4   5
## class 1:  0.0 0.0000 1 0.0
## class 2:  0.0 0.0000 0 1.0
## class 3:  0.0 1.0000 0 0.0
## class 4:  0.0 0.0001 0 1.0
## class 5:  0.6 0.0000 0 0.4
## class 6:  1.0 0.0000 0 0.0
## class 7:  0.0 0.0000 0 1.0
## class 8:  0.0 1.0000 0 0.0
## 
## Estimated class population shares 
##  0.066 0.49 0.11 0.06 0.1 0.07 0.05 0.06 
##  
## Predicted class memberships (by modal posterior prob.) 
##  0.06 0.5 0.1 0.06 0.1 0.07 0.05 0.06 
##  
## ========================================================= 
## Fit for 8 latent classes: 
## ========================================================= 
## number of observations: 100 
## number of fully observed cases: 68 
## number of estimated parameters: 127 
## residual degrees of freedom: -27 
## maximum log-likelihood: -237 
##  
## AIC(8): 727
## BIC(8): 1058
## G^2(8): 32 (Likelihood ratio/deviance statistic) 
## X^2(8): 33 (Chi-square goodness of fit) 
##  
## ALERT: number of parameters estimated ( 127 ) exceeds number of observations ( 100 ) 
##  
## ALERT: negative degrees of freedom; respecify model 
##  
## Conditional item response (column) probabilities,
##  by outcome variable, for each class (row) 
##  
## $V1
##              1    2   3 4    5
## class 1:  0.20 0.22 0.0 0 0.58
## class 2:  1.00 0.00 0.0 0 0.00
## class 3:  0.00 0.00 0.0 1 0.00
## class 4:  0.00 0.00 0.0 1 0.00
## class 5:  0.00 1.00 0.0 0 0.00
## class 6:  0.00 0.00 0.5 0 0.50
## class 7:  1.00 0.00 0.0 0 0.00
## class 8:  1.00 0.00 0.0 0 0.00
## class 9:  0.39 0.00 0.0 0 0.61
## 
## $V2
##              1    2    3    4    5
## class 1:  0.00 0.67 0.33 0.00 0.00
## class 2:  0.00 1.00 0.00 0.00 0.00
## class 3:  0.00 1.00 0.00 0.00 0.00
## class 4:  1.00 0.00 0.00 0.00 0.00
## class 5:  0.00 0.00 0.00 0.00 1.00
## class 6:  0.00 1.00 0.00 0.00 0.00
## class 7:  0.75 0.00 0.00 0.00 0.25
## class 8:  0.00 0.00 0.00 0.54 0.46
## class 9:  1.00 0.00 0.00 0.00 0.00
## 
## $V3
##           1    2     3 4 5
## class 1:  0 0.92 0.077 0 0
## class 2:  1 0.00 0.000 0 0
## class 3:  0 0.00 0.000 0 1
## class 4:  0 1.00 0.000 0 0
## class 5:  0 0.00 0.000 1 0
## class 6:  1 0.00 0.000 0 0
## class 7:  0 0.00 0.000 0 1
## class 8:  0 0.00 0.000 0 1
## class 9:  1 0.00 0.000 0 0
## 
## $V4
##           1   2 4   5
## class 1:  0 0.6 0 0.4
## class 2:  0 0.0 0 1.0
## class 3:  0 0.0 1 0.0
## class 4:  1 0.0 0 0.0
## class 5:  0 0.0 0 1.0
## class 6:  1 0.0 0 0.0
## class 7:  0 0.0 0 1.0
## class 8:  0 0.0 1 0.0
## class 9:  0 1.0 0 0.0
## 
## Estimated class population shares 
##  0.15 0.03 0.034 0.04 0.048 0.06 0.49 0.062 0.091 
##  
## Predicted class memberships (by modal posterior prob.) 
##  0.13 0.03 0.03 0.04 0.05 0.06 0.5 0.06 0.1 
##  
## ========================================================= 
## Fit for 9 latent classes: 
## ========================================================= 
## number of observations: 100 
## number of fully observed cases: 68 
## number of estimated parameters: 143 
## residual degrees of freedom: -43 
## maximum log-likelihood: -234 
##  
## AIC(9): 755
## BIC(9): 1127
## G^2(9): 37 (Likelihood ratio/deviance statistic) 
## X^2(9): 34 (Chi-square goodness of fit) 
##  
## ALERT: number of parameters estimated ( 143 ) exceeds number of observations ( 100 ) 
##  
## ALERT: negative degrees of freedom; respecify model 
##  
## Conditional item response (column) probabilities,
##  by outcome variable, for each class (row) 
##  
## $V1
##               1   2    3 4      5
## class 1:   1.00 0.0 0.00 0 0.0000
## class 2:   0.34 0.0 0.00 0 0.6648
## class 3:   0.00 0.0 0.00 1 0.0000
## class 4:   0.00 0.0 0.00 0 1.0000
## class 5:   1.00 0.0 0.00 0 0.0000
## class 6:   0.33 0.0 0.33 0 0.3333
## class 7:   1.00 0.0 0.00 0 0.0000
## class 8:   0.00 1.0 0.00 0 0.0000
## class 9:   0.50 0.5 0.00 0 0.0003
## class 10:  0.00 0.0 0.00 1 0.0000
## 
## $V2
##               1    2    3    4    5
## class 1:   0.00 0.00 0.00 0.54 0.46
## class 2:   1.00 0.00 0.00 0.00 0.00
## class 3:   1.00 0.00 0.00 0.00 0.00
## class 4:   0.00 0.25 0.75 0.00 0.00
## class 5:   0.82 0.00 0.00 0.00 0.18
## class 6:   0.00 1.00 0.00 0.00 0.00
## class 7:   0.44 0.00 0.00 0.00 0.56
## class 8:   0.00 0.00 0.00 0.00 1.00
## class 9:   0.00 1.00 0.00 0.00 0.00
## class 10:  0.00 1.00 0.00 0.00 0.00
## 
## $V3
##            1    2    3 4 5
## class 1:   0 0.00 0.00 0 1
## class 2:   1 0.00 0.00 0 0
## class 3:   0 1.00 0.00 0 0
## class 4:   0 0.86 0.14 0 0
## class 5:   0 0.00 0.00 0 1
## class 6:   1 0.00 0.00 0 0
## class 7:   0 0.00 0.00 0 1
## class 8:   0 0.00 0.00 1 0
## class 9:   0 1.00 0.00 0 0
## class 10:  0 0.00 0.00 0 1
## 
## $V4
##               1 2 4    5
## class 1:   0.00 0 1 0.00
## class 2:   0.00 1 0 0.00
## class 3:   1.00 0 0 0.00
## class 4:   0.00 0 0 1.00
## class 5:   0.00 0 0 1.00
## class 6:   0.67 0 0 0.33
## class 7:   0.00 0 0 1.00
## class 8:   0.00 0 0 1.00
## class 9:   0.00 1 0 0.00
## class 10:  0.00 0 1 0.00
## 
## Estimated class population shares 
##  0.062 0.11 0.04 0.07 0.39 0.09 0.097 0.05 0.06 0.034 
##  
## Predicted class memberships (by modal posterior prob.) 
##  0.06 0.1 0.04 0.07 0.5 0.09 0.05 0.06 0.03 
##  
## ========================================================= 
## Fit for 10 latent classes: 
## ========================================================= 
## number of observations: 100 
## number of fully observed cases: 68 
## number of estimated parameters: 159 
## residual degrees of freedom: -59 
## maximum log-likelihood: -232 
##  
## AIC(10): 781
## BIC(10): 1195
## G^2(10): 29 (Likelihood ratio/deviance statistic) 
## X^2(10): 26 (Chi-square goodness of fit) 
##  
## ALERT: number of parameters estimated ( 159 ) exceeds number of observations ( 100 ) 
##  
## ALERT: negative degrees of freedom; respecify model 
##  
## Conditional item response (column) probabilities,
##  by outcome variable, for each class (row) 
##  
## $V1
##              1     2     3    4    5
## class 1:  0.24 0.081 0.075 0.18 0.43
## class 2:  0.95 0.053 0.000 0.00 0.00
## 
## $V2
##              1    2     3     4    5
## class 1:  0.37 0.54 0.095 0.000 0.00
## class 2:  0.62 0.00 0.000 0.051 0.33
## 
## $V3
##              1    2     3     4     5
## class 1:  0.44 0.44 0.028 0.000 0.085
## class 2:  0.00 0.00 0.000 0.079 0.921
## 
## $V4
##              1    2    4    5
## class 1:  0.31 0.46 0.00 0.23
## class 2:  0.00 0.00 0.12 0.88
## 
## Estimated class population shares 
##  0.4 0.6 
##  
## Predicted class memberships (by modal posterior prob.) 
##  0.39 0.61 
##  
## ========================================================= 
## Fit for 2 latent classes: 
## ========================================================= 
## number of observations: 100 
## number of fully observed cases: 68 
## number of estimated parameters: 31 
## residual degrees of freedom: 69 
## maximum log-likelihood: -312 
##  
## AIC(2): 686
## BIC(2): 767
## G^2(2): 160 (Likelihood ratio/deviance statistic) 
## X^2(2): 381 (Chi-square goodness of fit) 
## </code></pre>
<p>We see that the best model is with 2 segments.</p>
<p>For the best model we can look at the posterior probabilities.</p>
<div class="sourceCode" id="cb643"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb643-1"><a href="probabilistic-models-for-customer-analytics.html#cb643-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(LCA_best_model<span class="sc">$</span>posterior) <span class="co"># matrix of posterior class membership probabilities</span></span></code></pre></div>
<pre><code>##                                    [,1]
## [1,] 0.00000000000000000000000000000025
## [2,] 1.00000000000000000000000000000000
## [3,] 1.00000000000000000000000000000000
## [4,] 0.00000000000000000000000000000269
## [5,] 0.00000000001706127526545741249315
## [6,] 0.00000000006689576208680722138440
##                                               [,2]
## [1,] 1.0000000000000000000000000000000000000000000
## [2,] 0.0000000000000000000000000000000000001926063
## [3,] 0.0000000000000000000000000000000000000000027
## [4,] 1.0000000000000000000000000000000000000000000
## [5,] 0.9999999999829387586913753693806938827037811
## [6,] 0.9999999999331041777850259677506983280181885</code></pre>
<p>Instead of looking at the probabilities we can also look at the actual class predictions.</p>
<div class="sourceCode" id="cb645"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb645-1"><a href="probabilistic-models-for-customer-analytics.html#cb645-1" aria-hidden="true" tabindex="-1"></a>LCA_best_model<span class="sc">$</span>predclass <span class="sc">%&gt;%</span> <span class="fu">head</span>() <span class="co"># class membership</span></span>
<span id="cb645-2"><a href="probabilistic-models-for-customer-analytics.html#cb645-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(LCA_best_model<span class="sc">$</span>predclass)</span>
<span id="cb645-3"><a href="probabilistic-models-for-customer-analytics.html#cb645-3" aria-hidden="true" tabindex="-1"></a>LCA_best_model<span class="sc">$</span>P <span class="co"># size of each class</span></span></code></pre></div>
<pre><code>## [1] 2 1 1 2 2 2
## 
##  1  2 
## 39 61 
## [1] 0.4 0.6</code></pre>
<p>We see the different predictions, and the table shows the distribution. Lastly we have the proportions for each class.</p>
<div class="sourceCode" id="cb647"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb647-1"><a href="probabilistic-models-for-customer-analytics.html#cb647-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">0</span>)</span>
<span id="cb647-2"><a href="probabilistic-models-for-customer-analytics.html#cb647-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The estimated class-conditional response probabilities</span></span>
<span id="cb647-3"><a href="probabilistic-models-for-customer-analytics.html#cb647-3" aria-hidden="true" tabindex="-1"></a>LCA_best_model<span class="sc">$</span>probs</span>
<span id="cb647-4"><a href="probabilistic-models-for-customer-analytics.html#cb647-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Ploting (graph=TRUE) them for better interpretation</span></span>
<span id="cb647-5"><a href="probabilistic-models-for-customer-analytics.html#cb647-5" aria-hidden="true" tabindex="-1"></a>ch2 <span class="ot">&lt;-</span> <span class="fu">poLCA</span>(f, data, <span class="at">nclass =</span> <span class="dv">2</span>, <span class="at">graph =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-315-1.png" width="720" style="display: block; margin: auto;" /></p>
<pre><code>## $V1
##              1     2       3       4       5
## class 1:  0.24 0.080 7.5e-02 1.8e-01 4.3e-01
## class 2:  0.95 0.053 4.3e-81 2.1e-21 1.8e-22
## 
## $V2
##              1       2       3       4       5
## class 1:  0.37 5.4e-01 9.5e-02 4.7e-32 2.9e-11
## class 2:  0.62 2.1e-21 2.1e-36 5.1e-02 3.3e-01
## 
## $V3
##                 1       2       3       4     5
## class 1:  4.4e-01 4.4e-01 2.8e-02 2.5e-31 0.085
## class 2:  2.3e-23 3.7e-22 6.0e-42 7.9e-02 0.921
## 
## $V4
##                 1       2       4    5
## class 1:  3.1e-01 4.6e-01 1.4e-11 0.23
## class 2:  2.1e-43 1.7e-26 1.2e-01 0.88
## 
## Conditional item response (column) probabilities,
##  by outcome variable, for each class (row) 
##  
## $V1
##              1    2     3    4    5
## class 1:  1.00 0.00 0.000 0.00 0.00
## class 2:  0.28 0.14 0.069 0.14 0.38
## 
## $V2
##              1    2   3     4     5
## class 1:  0.79 0.00 0.0 0.051 0.154
## class 2:  0.38 0.45 0.1 0.000 0.069
## 
## $V3
##              1    2     3     4 5
## class 1:  0.00 0.00 0.000 0.000 1
## class 2:  0.52 0.38 0.035 0.069 0
## 
## $V4
##              1    2     4    5
## class 1:  0.00 0.00 0.051 0.95
## class 2:  0.31 0.38 0.000 0.31
## 
## Estimated class population shares 
##  0.57 0.43 
##  
## Predicted class memberships (by modal posterior prob.) 
##  0.57 0.43 
##  
## ========================================================= 
## Fit for 2 latent classes: 
## ========================================================= 
## number of observations: 68 
## number of estimated parameters: 31 
## residual degrees of freedom: 37 
## maximum log-likelihood: -215 
##  
## AIC(2): 492
## BIC(2): 561
## G^2(2): 153 (Likelihood ratio/deviance statistic) 
## X^2(2): 976 (Chi-square goodness of fit) 
## </code></pre>
<p>We see the values for each variable, e.g., in class 1 V2, we primarily have 1’s and 2’s. Where the class 2 vector 2 has only values 1 and 5.</p>
<div class="sourceCode" id="cb649"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb649-1"><a href="probabilistic-models-for-customer-analytics.html#cb649-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save the class</span></span>
<span id="cb649-2"><a href="probabilistic-models-for-customer-analytics.html#cb649-2" aria-hidden="true" tabindex="-1"></a>data_copy <span class="ot">&lt;-</span> data</span>
<span id="cb649-3"><a href="probabilistic-models-for-customer-analytics.html#cb649-3" aria-hidden="true" tabindex="-1"></a>data_copy<span class="sc">$</span>class <span class="ot">&lt;-</span> <span class="fu">factor</span>(LCA_best_model<span class="sc">$</span>predclass)</span>
<span id="cb649-4"><a href="probabilistic-models-for-customer-analytics.html#cb649-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_copy)</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="left">V1</th>
<th align="left">V2</th>
<th align="left">V3</th>
<th align="left">V4</th>
<th align="left">class</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">4</td>
<td align="left">5</td>
<td align="left">4</td>
<td align="left">2</td>
</tr>
<tr class="even">
<td align="left">5</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">2</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">4</td>
<td align="left">1</td>
<td align="left">2</td>
<td align="left">1</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">5</td>
<td align="left">4</td>
<td align="left">5</td>
<td align="left">2</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">5</td>
<td align="left">5</td>
<td align="left">5</td>
<td align="left">2</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">5</td>
<td align="left">5</td>
<td align="left">NA</td>
<td align="left">2</td>
</tr>
</tbody>
</table>
</div>
<p>Now we see that the class that we estimate the observation to be within is added.</p>
<div class="sourceCode" id="cb650"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb650-1"><a href="probabilistic-models-for-customer-analytics.html#cb650-1" aria-hidden="true" tabindex="-1"></a><span class="co"># learn a BN classifier considering the class as the root node</span></span>
<span id="cb650-2"><a href="probabilistic-models-for-customer-analytics.html#cb650-2" aria-hidden="true" tabindex="-1"></a>mystructural <span class="ot">&lt;-</span> <span class="fu">structural.em</span>(data_copy, <span class="at">maximize =</span> <span class="st">&quot;hc&quot;</span>, <span class="at">return.all =</span> <span class="cn">TRUE</span>) </span>
<span id="cb650-3"><a href="probabilistic-models-for-customer-analytics.html#cb650-3" aria-hidden="true" tabindex="-1"></a><span class="fu">graphviz.plot</span>(mystructural<span class="sc">$</span>dag)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-317-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>We see that the hill climbing method actually sets V3 as an ancestor and not class. This we want to correct.</p>
<div class="sourceCode" id="cb651"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb651-1"><a href="probabilistic-models-for-customer-analytics.html#cb651-1" aria-hidden="true" tabindex="-1"></a>mystructural<span class="sc">$</span>dag <span class="ot">&lt;-</span> <span class="fu">set.arc</span>(mystructural<span class="sc">$</span>dag, <span class="at">from =</span> <span class="st">&quot;class&quot;</span>, <span class="at">to =</span> <span class="st">&quot;V3&quot;</span>)</span>
<span id="cb651-2"><a href="probabilistic-models-for-customer-analytics.html#cb651-2" aria-hidden="true" tabindex="-1"></a><span class="fu">graphviz.plot</span> (mystructural<span class="sc">$</span>dag)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-318-1.png" width="720" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb652"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb652-1"><a href="probabilistic-models-for-customer-analytics.html#cb652-1" aria-hidden="true" tabindex="-1"></a>bn.mle <span class="ot">&lt;-</span> <span class="fu">bn.fit</span> (mystructural<span class="sc">$</span>dag, <span class="at">data =</span> data_copy, <span class="at">method =</span> <span class="st">&quot;mle&quot;</span>)</span></code></pre></div>
<p>Now we have corrected the DAG that is not correct. Hence, we are able to start making inference.</p>
<p><em>Lets say we have a customer who has reported the following: V1 = 1, V2=5, V3=5. Then what would the rating for V4 be?</em></p>
<div class="sourceCode" id="cb653"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb653-1"><a href="probabilistic-models-for-customer-analytics.html#cb653-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gRain)</span>
<span id="cb653-2"><a href="probabilistic-models-for-customer-analytics.html#cb653-2" aria-hidden="true" tabindex="-1"></a>junction <span class="ot">&lt;-</span> <span class="fu">compile</span>(<span class="fu">as.grain</span>(bn.mle))</span>
<span id="cb653-3"><a href="probabilistic-models-for-customer-analytics.html#cb653-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb653-4"><a href="probabilistic-models-for-customer-analytics.html#cb653-4" aria-hidden="true" tabindex="-1"></a><span class="co">#We set evidance</span></span>
<span id="cb653-5"><a href="probabilistic-models-for-customer-analytics.html#cb653-5" aria-hidden="true" tabindex="-1"></a>V1V2V3 <span class="ot">&lt;-</span> <span class="fu">setEvidence</span>(junction, <span class="at">nodes =</span> <span class="fu">c</span>(<span class="st">&quot;V1&quot;</span>, <span class="st">&quot;V2&quot;</span>, <span class="st">&quot;V3&quot;</span>)</span>
<span id="cb653-6"><a href="probabilistic-models-for-customer-analytics.html#cb653-6" aria-hidden="true" tabindex="-1"></a>                      ,<span class="at">states =</span> <span class="fu">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;5&quot;</span>, <span class="st">&quot;5&quot;</span>))</span>
<span id="cb653-7"><a href="probabilistic-models-for-customer-analytics.html#cb653-7" aria-hidden="true" tabindex="-1"></a><span class="fu">querygrain</span>(V1V2V3, <span class="at">nodes =</span> <span class="st">&quot;class&quot;</span>)</span></code></pre></div>
<pre><code>## $class
## class
## 1 2 
## 0 1</code></pre>
<p>It is most likely that this person is in class 1.</p>
<div class="sourceCode" id="cb655"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb655-1"><a href="probabilistic-models-for-customer-analytics.html#cb655-1" aria-hidden="true" tabindex="-1"></a><span class="fu">querygrain</span>(V1V2V3, <span class="at">nodes =</span> <span class="st">&quot;V4&quot;</span>) <span class="co">#estimated preference: 0.12*4 + 0.88*5 = 4.88</span></span></code></pre></div>
<pre><code>## $V4
## V4
##    1    2    4    5 
## 0.00 0.00 0.12 0.88</code></pre>
<p>We see that there is 12% probability of rating 4, and 88% probability of rating 5, hence we can aggregate on those.</p>
<p><span class="math inline">\(0.12 * 4 + 0.88 * 5 = 4.88\)</span></p>
</div>
</div>
<div id="latent-models-for-cross-selling-and-acquisition-sequence" class="section level2" number="4.5">
<h2><span class="header-section-number">4.5</span> Latent models for cross selling and acquisition sequence</h2>
<p>In this section I will introduce two methods.</p>
<ol style="list-style-type: decimal">
<li><p>Latent trait model - which is for corss selling, so leans towards the recommender systems as we have previously seen.</p></li>
<li><p>Latent Markov approach (the hidden Markov chain) - for time-series (dynamic approach).</p></li>
</ol>
<p>Compared to association rule models, Bayesian Networks collaborative filtering etc. we see that the methods introduced in this chapter is more about the sequence of events and analyzing these.</p>
<blockquote>
<p>The new method will look at what the customer has bought up until now, or a given date and make recommendations based on these.</p>
</blockquote>
<p>What <strong>data type?</strong>, we will see that the two approaches need data in products as column dummies and users as rows, e.g.,</p>
<p><img src="images/latent%20model%20data%20types.png" /></p>
<p><em>Notice that the LMM model needs one row pr. user pr. timeperiod.</em></p>
<p>Lets recap, <strong><em>what is a latent trait?</em></strong> This is an udnerlying factor that is unknown hence latent. Therefore, we are going to esimate these.</p>
<p>Latent train = underlying characteristics. This is something that cannot be directly measured, that meaning be answered by one question (e.g., as how old are you?), but must be answered through a number of questions.</p>
<blockquote>
<p>Example of a latent trait. Let’s say that we want to measure intelligence. The procedure would be to ask several questions. So this is basically like an exam, the more correct answers you have, the higher the intelligence.</p>
</blockquote>
<p>Then one may say, can we assume if a student can answer the most difficult question, will he then be able to answer all the other less difficult questions? If yes, then we in principle only need to know which question was the hardest that he correctly answered, and then we basically just need to look at this item to make recommendations, that could be grading in this example.</p>
<p>If not, then we need to know all the other answers as well.</p>
<p><strong>Different models needs different solutions.</strong></p>
<p>He shows this:</p>
<div class="figure">
<img src="images/Latentmodels.png" alt="" />
<p class="caption">Different models for different scenarios</p>
</div>
<p><em>Observed variables = manifest variables</em></p>
<p>We see that the <strong><em>latent trait models</em></strong>, which we are going to work with, takes categorical input but will give an continous output. (or more correct, we assume that the underlying scale is continuous).</p>
<p><strong><em>This is also known as Item Response Theory (IRT)</em></strong></p>
<p>He then introduce the <em>item response function (IRF)</em>, it looks like the following</p>
<p><span class="math display">\[P(Y = 1 | O_j,a_i,b_i) = 
\frac{e^{a_i(O_j-b_i}}
{1+e^{a_i(O_j-b_i}}\]</span></p>
<p>Where</p>
<ul>
<li><span class="math inline">\(a_i\)</span> = an items location is defined as the amount of latetn trait needed to have a 50% probability of endorsing the item.</li>
<li><span class="math inline">\(b\)</span> = the higher on the trait level a respondent needs to be in order to endorse the item.</li>
</ul>
<div class="figure">
<img src="images/probofendorsing.png" alt="" />
<p class="caption">The Item Response Function</p>
</div>
<p>Endorsing an item = the probability of buying the product.</p>
<p>In the following plot we see two different persons, where the their latent scores are estimated to be different, although they share the same probability of buying the product, hence such curves could look like this:</p>
<div class="figure">
<img src="images/IRF1.png" alt="" />
<p class="caption">IRF examples</p>
</div>
<p>We see that they have different latent scores. In a later example we are going to look at bank customers. Where we base the latent score on what financial services that a given customer has. Hence <code>the latent score = financial maturity</code>, this is visualized with the following:</p>
<div class="figure">
<img src="images/IRF2.png" alt="" />
<p class="caption">IRF example financial services</p>
</div>
<p>Here we see the relationships between getting the financial services and the expected financial maturity, for instance to have probability of 50% of having a check account, the maturity is low, although to have a loan, you expect the persons to be much much more mature.</p>
<p>We see that -1 maturity = 50% probability of having a loan, but that also implies that almost certainty of a person having a check account.</p>
<p>Naturally that means that one could also make a list of these models, and we want to know:</p>
<ol style="list-style-type: decimal">
<li><span class="math inline">\(a_i\)</span> = the slope parameter, the slope of the sigmoid at 50%</li>
<li><span class="math inline">\(b_i\)</span> = Position parameter, this is the latent score (financial maturity in the example above) at 50% buying probability. See an example below.</li>
</ol>
<div class="figure">
<img src="images/IRFaibi.png" alt="" />
<p class="caption">a_i and b_i scores for each financial service</p>
</div>
<p>Notice that financial maturity is merely an expression for how far up the ladder (what products a customer have) a given person is and then we can set the B value to plot into the function to assess what products you expect the customer to have.</p>
<p>Hence we should be able to calculate the latent score for a given customer based on a set of predictor variables, an example in the following:</p>
<div class="figure">
<img src="images/predictorvariables.png" alt="" />
<p class="caption">Example of predictor varaibles + significance and influence on latent score</p>
</div>
<p>We see that the higher th T-ratio, the higher significance. Then we can also look at the B, e.g., if you are renting, it is a negative effect on financial maturity.</p>
<p><strong>Why is this important?</strong></p>
<p>We need to know this, to make appropriate recommendations, hence a person with a low latent score (financial maturity) may not get a mortgage loan although he may get a check account.</p>
<div id="latent-trait-model---applying-the-ltm-package-in-r" class="section level3" number="4.5.1">
<h3><span class="header-section-number">4.5.1</span> Latent Trait Model - Applying the LTM Package in R</h3>
<p>The LSAT data is having 5 questions of increasing difficulty (although not in the actual order) (5 items) and we are going to make an analysis on this.</p>
<div class="sourceCode" id="cb657"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb657-1"><a href="probabilistic-models-for-customer-analytics.html#cb657-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ltm)</span>
<span id="cb657-2"><a href="probabilistic-models-for-customer-analytics.html#cb657-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(LSAT) <span class="co">#We see that itmes are one hot encoded</span></span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">Item 1</th>
<th align="right">Item 2</th>
<th align="right">Item 3</th>
<th align="right">Item 4</th>
<th align="right">Item 5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode" id="cb658"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb658-1"><a href="probabilistic-models-for-customer-analytics.html#cb658-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Some summary descriptions</span></span>
<span id="cb658-2"><a href="probabilistic-models-for-customer-analytics.html#cb658-2" aria-hidden="true" tabindex="-1"></a>des <span class="ot">&lt;-</span> <span class="fu">descript</span>(LSAT)</span>
<span id="cb658-3"><a href="probabilistic-models-for-customer-analytics.html#cb658-3" aria-hidden="true" tabindex="-1"></a>des</span></code></pre></div>
<pre><code>## 
## Descriptive statistics for the &#39;LSAT&#39; data-set
## 
## Sample:
##  5 items and 1000 sample units; 0 missing values
## 
## Proportions for each level of response:
##            0    1 logit
## Item 1 0.076 0.92  2.50
## Item 2 0.291 0.71  0.89
## Item 3 0.447 0.55  0.21
## Item 4 0.237 0.76  1.17
## Item 5 0.130 0.87  1.90
## 
## 
## Frequencies of total scores:
##      0  1  2   3   4   5
## Freq 3 20 85 237 357 298
## 
## 
## Point Biserial correlation with Total Score:
##        Included Excluded
## Item 1     0.36     0.11
## Item 2     0.57     0.15
## Item 3     0.62     0.17
## Item 4     0.53     0.14
## Item 5     0.44     0.12
## 
## 
## Cronbach&#39;s alpha:
##                  value
## All Items         0.29
## Excluding Item 1  0.28
## Excluding Item 2  0.24
## Excluding Item 3  0.22
## Excluding Item 4  0.25
## Excluding Item 5  0.27
## 
## 
## Pairwise Associations:
##    Item i Item j p.value
## 1       1      5   0.565
## 2       1      4   0.208
## 3       3      5   0.113
## 4       2      4   0.059
## 5       1      2   0.028
## 6       2      5   0.009
## 7       1      3   0.003
## 8       4      5   0.002
## 9       3      4   7e-04
## 10      2      3   4e-04</code></pre>
<p>We can see the frequency of the different scores etc.</p>
<ul>
<li>The important thing with the descriptive statistics</li>
<li>In <em>the proportions for each level of response</em>: We see that item 1 is the simplest and item 3 is the most difficult. That we will be clear from the <code>res</code> output. 0 = proportion of wrong answers, 1 = proportion of correct answers.</li>
<li>The other important thing is the <em>pairwise associations</em>: where we see that if there is correlation between the different questions. High p = correlation, low correlation = low p-value. We want to find some high p-values, of not, the model does not make any sense.</li>
</ul>
<p>Now lets fit the model.</p>
<div class="sourceCode" id="cb660"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb660-1"><a href="probabilistic-models-for-customer-analytics.html#cb660-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">ltm</span>(LSAT <span class="sc">~</span> z1) <span class="co">#z1 for the birnbaum model</span></span>
<span id="cb660-2"><a href="probabilistic-models-for-customer-analytics.html#cb660-2" aria-hidden="true" tabindex="-1"></a>fit</span></code></pre></div>
<pre><code>## 
## Call:
## ltm(formula = LSAT ~ z1)
## 
## Coefficients:
##         Dffclt  Dscrmn
## Item 1   -3.36    0.82
## Item 2   -1.37    0.72
## Item 3   -0.28    0.89
## Item 4   -1.87    0.69
## Item 5   -3.12    0.66
## 
## Log.Lik: -2467</code></pre>
<p>We see:</p>
<ul>
<li><em>Coefficients</em>: that is where they are placed on the scale, e.g., item 3 (Q3) leads to the highest maturity.</li>
<li>Dffclt = location parameters</li>
<li>Dscrmn = the slope</li>
</ul>
<p>We can look at the different scores depending on the correct answers, that is for each of the persons.</p>
<div class="sourceCode" id="cb662"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb662-1"><a href="probabilistic-models-for-customer-analytics.html#cb662-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">factor.scores</span>(fit)</span>
<span id="cb662-2"><a href="probabilistic-models-for-customer-analytics.html#cb662-2" aria-hidden="true" tabindex="-1"></a>res <span class="co">#Fore respondents</span></span></code></pre></div>
<pre><code>## 
## Call:
## ltm(formula = LSAT ~ z1)
## 
## Scoring Method: Empirical Bayes
## 
## Factor-Scores for observed response patterns:
##    Item 1 Item 2 Item 3 Item 4 Item 5 Obs   Exp     z1 se.z1
## 1       0      0      0      0      0   3   2.3 -1.895  0.80
## 2       0      0      0      0      1   6   5.9 -1.479  0.80
## 3       0      0      0      1      0   2   2.6 -1.460  0.80
## 4       0      0      0      1      1  11   8.9 -1.041  0.80
## 5       0      0      1      0      0   1   0.7 -1.331  0.80
## 6       0      0      1      0      1   1   2.6 -0.911  0.80
## 7       0      0      1      1      0   3   1.2 -0.891  0.80
## 8       0      0      1      1      1   4   6.0 -0.463  0.81
## 9       0      1      0      0      0   1   1.8 -1.438  0.80
## 10      0      1      0      0      1   8   6.4 -1.019  0.80
## 11      0      1      0      1      1  16  13.6 -0.573  0.81
## 12      0      1      1      0      1   3   4.4 -0.441  0.81
## 13      0      1      1      1      0   2   2.0 -0.420  0.81
## 14      0      1      1      1      1  15  13.9  0.023  0.83
## 15      1      0      0      0      0  10   9.5 -1.373  0.80
## 16      1      0      0      0      1  29  34.6 -0.953  0.80
## 17      1      0      0      1      0  14  15.6 -0.933  0.80
## 18      1      0      0      1      1  81  76.6 -0.506  0.81
## 19      1      0      1      0      0   3   4.7 -0.803  0.80
## 20      1      0      1      0      1  28  25.0 -0.373  0.81
## 21      1      0      1      1      0  15  11.5 -0.352  0.81
## 22      1      0      1      1      1  80  83.5  0.093  0.83
## 23      1      1      0      0      0  16  11.3 -0.911  0.80
## 24      1      1      0      0      1  56  56.1 -0.483  0.81
## 25      1      1      0      1      0  21  25.6 -0.463  0.81
## 26      1      1      0      1      1 173 173.3 -0.022  0.83
## 27      1      1      1      0      0  11   8.4 -0.329  0.82
## 28      1      1      1      0      1  61  62.5  0.117  0.83
## 29      1      1      1      1      0  28  29.1  0.139  0.83
## 30      1      1      1      1      1 298 296.7  0.606  0.85</code></pre>
<p>We see that</p>
<ul>
<li>Z1 is where a person is set on a the latent scale. where person no. 30 (or this group of persons as there are 298) has a latent score of 0.606. He is also plotted with the red line in the following plot.</li>
</ul>
<p>Now we can also plot the item response functions.</p>
<p>I have added ablines in the plot, to visualize the latent scores of 50% probability of buying.</p>
<div class="sourceCode" id="cb664"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb664-1"><a href="probabilistic-models-for-customer-analytics.html#cb664-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit)</span>
<span id="cb664-2"><a href="probabilistic-models-for-customer-analytics.html#cb664-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Lets add plot the coefficient and check if it adds up to 50% prob.</span></span>
<span id="cb664-3"><a href="probabilistic-models-for-customer-analytics.html#cb664-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fl">0.5</span>,<span class="at">lty =</span> <span class="dv">2</span>,<span class="at">col =</span> <span class="st">&quot;darkgrey&quot;</span>)</span>
<span id="cb664-4"><a href="probabilistic-models-for-customer-analytics.html#cb664-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="sc">-</span><span class="fl">0.280</span>,<span class="at">lty =</span> <span class="dv">2</span>,<span class="at">col =</span> <span class="st">&quot;darkgrey&quot;</span>)</span>
<span id="cb664-5"><a href="probabilistic-models-for-customer-analytics.html#cb664-5" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="sc">-</span><span class="fl">0.0280</span>,<span class="at">y =</span> <span class="fl">0.024</span>,<span class="st">&quot;-0.0280 (coef)&quot;</span>,<span class="at">col =</span> <span class="st">&quot;green&quot;</span>,<span class="at">cex =</span> <span class="fl">0.7</span>)</span>
<span id="cb664-6"><a href="probabilistic-models-for-customer-analytics.html#cb664-6" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="fl">1.9</span>,<span class="at">y =</span> <span class="fl">0.51</span>,<span class="st">&quot;50% prob.&quot;</span>,<span class="at">col =</span> <span class="st">&quot;green&quot;</span>,<span class="at">cex =</span> <span class="fl">0.7</span>)</span>
<span id="cb664-7"><a href="probabilistic-models-for-customer-analytics.html#cb664-7" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fl">0.606</span>,<span class="at">lty =</span> <span class="dv">2</span>,<span class="at">col =</span> <span class="st">&quot;darkred&quot;</span>) <span class="co">#Group 30 from the res</span></span>
<span id="cb664-8"><a href="probabilistic-models-for-customer-analytics.html#cb664-8" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="fl">1.0</span>,<span class="at">y =</span> <span class="fl">0.26</span>,<span class="st">&quot;Person 30&quot;</span>,<span class="at">col =</span> <span class="st">&quot;darkred&quot;</span>,<span class="at">cex =</span> <span class="fl">0.7</span>)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-324-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>We see that at the visualize maturity, there is almost certinaty that the person is correctly answering item 1 (Q1).</p>
</div>
<div id="the-latent-hidden-markov-model" class="section level3" number="4.5.2">
<h3><span class="header-section-number">4.5.2</span> The latent (hidden) Markov model</h3>
<p><strong><em>Let me first summarize the Markov Chain</em></strong></p>
<p>The Markov chain model looks as the following:</p>
<div class="figure">
<img src="images/MarkovChain.png" alt="" />
<p class="caption">The Markov Chain model</p>
</div>
<p>This model has some transition probabilities assigned.</p>
<div class="figure">
<img src="images/TransitionProbabilities.png" alt="" />
<p class="caption">Transition Probabilities</p>
</div>
<p>We see that state 1 is the most recent purchasers and then state 5 is the lost customers. Hence we see one can move from e.g., state 4 to 1.</p>
<blockquote>
<p>The Markov Chain is that there is a probability of moving upwards in the states (recency states) or they can move down in states. In the end there is a catch all sate, where we assume that you will stay the rest of the time, namely where you dont buy again.</p>
</blockquote>
<p><strong>But what is the Hidden Markov Chain? (HMC)</strong></p>
<p>It is basically what it says, <em>it is hidden</em>. But what does the states then reflect? In the hidden markov chain the states reflect different buying patterns, hence you will try to estimate if a given person has changed his buying patterns and what that means for him.</p>
<p><em>The difference to the Latent Trait Model (LTM)</em>: It is that previously we just had one row pr. person (or group with identical person) we are now having one row pr. customer pr. transaction.</p>
<p>To explain this, he applied a <strong>case with COOP</strong>, the data looked the following:</p>
<div class="figure">
<img src="images/COOPData.png" alt="" />
<p class="caption">COOP data</p>
</div>
<p>Characteristics of the study (hence also the HMC)</p>
<ul>
<li>Assume that households may be in different states with different purchasing patterns, which is in general also the assumption for the HMC.</li>
<li>Across time a household is allowed to switch form one state to another, which is also the assumption for HMC.</li>
<li>Then the Markovian assumption, meaning that the latent state membership for a household in a given time period is assumed to only depend on the state membership in the previous time period. <em>Why</em> take a look at the chain above, and see that this is the only thing we need to know, to address which outcomes there may be.</li>
</ul>
<p><strong>The procedure:</strong></p>
<ol style="list-style-type: decimal">
<li>They calculated the probability of a households buying products within given categories, see the following:</li>
</ol>
<div class="figure">
<img src="images/householdBuyingItems.png" alt="" />
<p class="caption">Proportions of buying certain items: The example is one household, where each row is the timeperiod and each column is a product category.</p>
</div>
<p>We see that for instance there is a tendency to buy more vegetables in the periods.</p>
<p>We can also show the <strong>probability of buying an item in the different states</strong>, see the following:</p>
<div class="figure">
<img src="images/stateprobabilities.png" alt="" />
<p class="caption">State probabilities of buying items</p>
</div>
<p>Hence we see that in the overall probability of buying something decrease as the state lowers. The same goes for each group.</p>
<p>Now we can also look at the transition probabilities. We see:</p>
<ol style="list-style-type: decimal">
<li>Big values omn the diagonal, indicating that there is a great probability of a person staying in the same state.</li>
<li>We see that the probability of moving from state 7 to state 6 is 18.6%, on the other hand if you are in state 6, there is a probability of going to state 7. In general, we see a very low probability of reaching state 7 (those buying the least).</li>
</ol>
<div class="figure">
<img src="images/TransitionProbsCOOP.png" alt="" />
<p class="caption">Transition probabilities</p>
</div>
<p>Then the question is, <em>what are we actually adopting, when moving from one state to another</em>.</p>
<div class="figure">
<img src="images/MovingBetweenStates.png" alt="" />
<p class="caption">Products that are adopted when moving from one state to another, e.g., when moving from state 7 (all item groups being low) we see that people start adding dairy products and so on.</p>
</div>
<p>Hence we see that adding dairy indicating that a customer on an upwards journey. Then we can see that if a person starts adding vegetables he will end in state 5 and if he adds eggs and vegetables, he will end up ion state 4.</p>
<p><strong>What do we get out of this?</strong></p>
<p>In the example he showed one of the COOP private label milk, where they originally marketed a beer on one side of the beers, where they then added ecological eggs, as we see that this will manipulate the customer upwards in the states. This was a great results.</p>
<p>Hence again, it about knowing enough about the customer to know what to recommend them, and not just market some random product.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="recommender-systems-and-customer-targeting.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="customer-behavior.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
