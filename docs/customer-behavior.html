<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Customer behavior | Customer Analytics</title>
  <meta name="description" content="5 Customer behavior | Customer Analytics" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Customer behavior | Customer Analytics" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Customer behavior | Customer Analytics" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="probabilistic-models-for-customer-analytics.html"/>
<link rel="next" href="privacy.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script>
<link href="libs/vis-4.20.1/vis.css" rel="stylesheet" />
<script src="libs/vis-4.20.1/vis.min.js"></script>
<script src="libs/visNetwork-binding-2.0.9/visNetwork.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>setup</a></li>
<li class="chapter" data-level="1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html"><i class="fa fa-check"></i><b>1</b> Customer Lifetime Value</a>
<ul>
<li class="chapter" data-level="1.1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#non-contractual-the-matrix-formulation-migration-model"><i class="fa fa-check"></i><b>1.1</b> Non-contractual: The matrix formulation (Migration model)</a></li>
<li class="chapter" data-level="1.2" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#contractual-valuing-customer-base-residual-lifetime-value"><i class="fa fa-check"></i><b>1.2</b> Contractual: Valuing customer base + residual lifetime value</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#sbg-shifted-beta-geometric-model"><i class="fa fa-check"></i><b>1.2.1</b> sBG (Shifted Beta Geometric model)</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#non-contractual-setting-probabilitic-models"><i class="fa fa-check"></i><b>1.3</b> Non-Contractual Setting: Probabilitic Models</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#paretonbd-vs.-bgnbd"><i class="fa fa-check"></i><b>1.3.1</b> Pareto/NBD vs.Â BG/NBD</a></li>
<li class="chapter" data-level="1.3.2" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#paretonbd"><i class="fa fa-check"></i><b>1.3.2</b> Pareto/NBD</a>
<ul>
<li class="chapter" data-level="1.3.2.1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#data-preparation"><i class="fa fa-check"></i><b>1.3.2.1</b> Data preparation</a></li>
<li class="chapter" data-level="1.3.2.2" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#parameter-estimation"><i class="fa fa-check"></i><b>1.3.2.2</b> Parameter Estimation</a></li>
<li class="chapter" data-level="1.3.2.3" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#individual-level-estimations"><i class="fa fa-check"></i><b>1.3.2.3</b> Individual Level Estimations</a></li>
<li class="chapter" data-level="1.3.2.4" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#plotting-goodness-of-fit"><i class="fa fa-check"></i><b>1.3.2.4</b> Plotting / Goodness-of-fit</a></li>
</ul></li>
<li class="chapter" data-level="1.3.3" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#bgnbd"><i class="fa fa-check"></i><b>1.3.3</b> BG/NBD</a>
<ul>
<li class="chapter" data-level="1.3.3.1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#data-preparation-1"><i class="fa fa-check"></i><b>1.3.3.1</b> Data Preparation</a></li>
<li class="chapter" data-level="1.3.3.2" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#parameter-estimation-1"><i class="fa fa-check"></i><b>1.3.3.2</b> Parameter Estimation</a></li>
<li class="chapter" data-level="1.3.3.3" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#individual-level-estimation"><i class="fa fa-check"></i><b>1.3.3.3</b> Individual Level Estimation</a></li>
<li class="chapter" data-level="1.3.3.4" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#plotting-goodness-of-fit-1"><i class="fa fa-check"></i><b>1.3.3.4</b> Plotting / Goodness-of-fit</a></li>
</ul></li>
<li class="chapter" data-level="1.3.4" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#bgbb---not-curicullum"><i class="fa fa-check"></i><b>1.3.4</b> BG/BB - Not curicullum</a></li>
<li class="chapter" data-level="1.3.5" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#examples-from-the-lecture"><i class="fa fa-check"></i><b>1.3.5</b> Examples from the lecture</a>
<ul>
<li class="chapter" data-level="1.3.5.1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#paretonbd-1"><i class="fa fa-check"></i><b>1.3.5.1</b> Pareto/NBD</a>
<ul>
<li class="chapter" data-level="1.3.5.1.1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#estimate-parameters-for-paretonbd-model-based-upon-calibration-data"><i class="fa fa-check"></i><b>1.3.5.1.1</b> Estimate parameters for Pareto/NBD model based upon calibration data</a></li>
</ul></li>
<li class="chapter" data-level="1.3.5.2" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#dert-calculation"><i class="fa fa-check"></i><b>1.3.5.2</b> DERT Calculation</a></li>
<li class="chapter" data-level="1.3.5.3" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#bgnbg-example"><i class="fa fa-check"></i><b>1.3.5.3</b> BG/NBG example</a></li>
</ul></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html"><i class="fa fa-check"></i><b>2</b> Customer Satisfaction and Loyalty</a>
<ul>
<li class="chapter" data-level="2.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#customer-surveys"><i class="fa fa-check"></i><b>2.1</b> Customer surveys</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#concepts-and-examples"><i class="fa fa-check"></i><b>2.1.1</b> (1) Concepts and examples</a></li>
<li class="chapter" data-level="2.1.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#sampling-and-response-rate"><i class="fa fa-check"></i><b>2.1.2</b> (2) Sampling and response rate</a></li>
<li class="chapter" data-level="2.1.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#pretesting-and-measurement-validity"><i class="fa fa-check"></i><b>2.1.3</b> (3) Pretesting and measurement validity</a></li>
<li class="chapter" data-level="2.1.4" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#questionnaire-design"><i class="fa fa-check"></i><b>2.1.4</b> (4) Questionnaire design</a></li>
<li class="chapter" data-level="2.1.5" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#simple-size"><i class="fa fa-check"></i><b>2.1.5</b> (5) Simple size</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#nps"><i class="fa fa-check"></i><b>2.2</b> NPS</a></li>
<li class="chapter" data-level="2.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#efa-cfa-and-sem"><i class="fa fa-check"></i><b>2.3</b> EFA, CFA and SEM</a></li>
<li class="chapter" data-level="2.4" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#application-with-lavann-and-hbat-data"><i class="fa fa-check"></i><b>2.4</b> Application with Lavann and HBAT data</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#business-problem-objectives"><i class="fa fa-check"></i><b>2.4.1</b> Business Problem &amp; Objectives</a></li>
<li class="chapter" data-level="2.4.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#data"><i class="fa fa-check"></i><b>2.4.2</b> Data</a>
<ul>
<li class="chapter" data-level="2.4.2.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#efa"><i class="fa fa-check"></i><b>2.4.2.1</b> EFA</a></li>
<li class="chapter" data-level="2.4.2.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#cfa-model"><i class="fa fa-check"></i><b>2.4.2.2</b> CFA model</a>
<ul>
<li class="chapter" data-level="2.4.2.2.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#initial-model"><i class="fa fa-check"></i><b>2.4.2.2.1</b> Initial model</a></li>
<li class="chapter" data-level="2.4.2.2.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#second-model"><i class="fa fa-check"></i><b>2.4.2.2.2</b> Second model</a>
<ul>
<li class="chapter" data-level="2.4.2.2.2.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#intepretation-of-the-model"><i class="fa fa-check"></i><b>2.4.2.2.2.1</b> Intepretation of the model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2.4.2.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#sem"><i class="fa fa-check"></i><b>2.4.2.3</b> SEM</a></li>
</ul></li>
<li class="chapter" data-level="2.4.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#plotting-the-model"><i class="fa fa-check"></i><b>2.4.3</b> Plotting the model</a></li>
<li class="chapter" data-level="2.4.4" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#consider-a-more-complex-sem-model-involving-a-mediating-effect."><i class="fa fa-check"></i><b>2.4.4</b> Consider a more complex SEM model involving a mediating effect.</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#pls"><i class="fa fa-check"></i><b>2.5</b> PLS</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#definition-of-pls"><i class="fa fa-check"></i><b>2.5.1</b> Definition of PLS</a></li>
<li class="chapter" data-level="2.5.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#when-to-use-pls-and-when-to-use-sem"><i class="fa fa-check"></i><b>2.5.2</b> When to use PLS and when to use SEM</a></li>
<li class="chapter" data-level="2.5.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#model-construction"><i class="fa fa-check"></i><b>2.5.3</b> Model construction</a></li>
<li class="chapter" data-level="2.5.4" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#model-estimation"><i class="fa fa-check"></i><b>2.5.4</b> Model Estimation</a></li>
<li class="chapter" data-level="2.5.5" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#model-evaluation"><i class="fa fa-check"></i><b>2.5.5</b> Model evaluation</a></li>
<li class="chapter" data-level="2.5.6" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#example-for-the-lecture"><i class="fa fa-check"></i><b>2.5.6</b> Example for the lecture</a>
<ul>
<li class="chapter" data-level="2.5.6.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#making-structural--and-measurement-model"><i class="fa fa-check"></i><b>2.5.6.1</b> Making structural- and measurement model</a></li>
<li class="chapter" data-level="2.5.6.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#now-we-can-estimate-the-model"><i class="fa fa-check"></i><b>2.5.6.2</b> Now we can estimate the model</a></li>
<li class="chapter" data-level="2.5.6.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#measuring-quality-of-the-constructs"><i class="fa fa-check"></i><b>2.5.6.3</b> Measuring quality of the constructs</a></li>
<li class="chapter" data-level="2.5.6.4" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#are-the-coefficients-significant"><i class="fa fa-check"></i><b>2.5.6.4</b> Are the coefficients significant?</a></li>
</ul></li>
<li class="chapter" data-level="2.5.7" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#revised-code"><i class="fa fa-check"></i><b>2.5.7</b> Revised code</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#segmentation-clustering"><i class="fa fa-check"></i><b>2.6</b> Segmentation (Clustering)</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#what-is-clustering"><i class="fa fa-check"></i><b>2.6.1</b> What is clustering</a></li>
<li class="chapter" data-level="2.6.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#clustering-techniques"><i class="fa fa-check"></i><b>2.6.2</b> Clustering techniques</a></li>
<li class="chapter" data-level="2.6.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#an-example-with-hbat"><i class="fa fa-check"></i><b>2.6.3</b> An example with HBAT</a>
<ul>
<li class="chapter" data-level="2.6.3.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#background"><i class="fa fa-check"></i><b>2.6.3.1</b> 1. Background</a>
<ul>
<li class="chapter" data-level="2.6.3.1.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#the-primary-objective-is"><i class="fa fa-check"></i><b>2.6.3.1.1</b> 1.1. The primary objective is:</a></li>
</ul></li>
<li class="chapter" data-level="2.6.3.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#the-data-data-understanding-phase"><i class="fa fa-check"></i><b>2.6.3.2</b> 2. The data (Data Understanding Phase)</a>
<ul>
<li class="chapter" data-level="2.6.3.2.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#load-data-correctly"><i class="fa fa-check"></i><b>2.6.3.2.1</b> 2.1 Load data correctly</a></li>
<li class="chapter" data-level="2.6.3.2.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#check-if-the-data-is-numerical-or-categorical"><i class="fa fa-check"></i><b>2.6.3.2.2</b> 2.2 Check if the data is numerical or categorical</a></li>
<li class="chapter" data-level="2.6.3.2.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#missing-treatment"><i class="fa fa-check"></i><b>2.6.3.2.3</b> 2.3 Missing treatment</a></li>
<li class="chapter" data-level="2.6.3.2.4" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#select-relevant-variables"><i class="fa fa-check"></i><b>2.6.3.2.4</b> 2.4 Select relevant variables</a></li>
<li class="chapter" data-level="2.6.3.2.5" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#identify-extreme-outliers-the-most-dissimilar-customers"><i class="fa fa-check"></i><b>2.6.3.2.5</b> 2.5.Identify extreme outliers (the most dissimilar customers)</a></li>
<li class="chapter" data-level="2.6.3.2.6" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#standardize-the-variables-mean0-std.dev1"><i class="fa fa-check"></i><b>2.6.3.2.6</b> 2.6 Standardize the variables (mean=0, std.dev=1)</a></li>
</ul></li>
<li class="chapter" data-level="2.6.3.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#hierarchical-clustering-using-variables"><i class="fa fa-check"></i><b>2.6.3.3</b> 3. Hierarchical clustering (using variables)</a></li>
<li class="chapter" data-level="2.6.3.4" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#hierarchical-clustering-using-pcs-score-vectors"><i class="fa fa-check"></i><b>2.6.3.4</b> 4. Hierarchical clustering (using PCs score vectors)</a></li>
<li class="chapter" data-level="2.6.3.5" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#k-means"><i class="fa fa-check"></i><b>2.6.3.5</b> 5. K-means</a></li>
<li class="chapter" data-level="2.6.3.6" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#validation-and-profiling-the-clusters"><i class="fa fa-check"></i><b>2.6.3.6</b> 6. Validation and profiling the clusters</a>
<ul>
<li class="chapter" data-level="2.6.3.6.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#assessing-cluster-stability"><i class="fa fa-check"></i><b>2.6.3.6.1</b> 6.1. Assessing cluster stability</a></li>
<li class="chapter" data-level="2.6.3.6.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#assessing-criterion-predictive-validity"><i class="fa fa-check"></i><b>2.6.3.6.2</b> 6.2. Assessing criterion (predictive) validity</a></li>
<li class="chapter" data-level="2.6.3.6.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#profiling-the-final-cluster-solution"><i class="fa fa-check"></i><b>2.6.3.6.3</b> 6.3. Profiling the final cluster solution</a></li>
</ul></li>
<li class="chapter" data-level="2.6.3.7" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#final-remarks"><i class="fa fa-check"></i><b>2.6.3.7</b> 7. Final remarks</a></li>
</ul></li>
<li class="chapter" data-level="2.6.4" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#an-example-with-mcdonalds-data"><i class="fa fa-check"></i><b>2.6.4</b> An example with McDonalds data</a>
<ul>
<li class="chapter" data-level="2.6.4.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#loading-and-exploring-the-data"><i class="fa fa-check"></i><b>2.6.4.1</b> Loading and exploring the data</a></li>
<li class="chapter" data-level="2.6.4.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#k-means-clustering"><i class="fa fa-check"></i><b>2.6.4.2</b> k-Means clustering</a></li>
<li class="chapter" data-level="2.6.4.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#interpreting-the-clusters"><i class="fa fa-check"></i><b>2.6.4.3</b> Interpreting the clusters</a></li>
</ul></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html"><i class="fa fa-check"></i><b>3</b> Recommender Systems and Customer Targeting</a>
<ul>
<li class="chapter" data-level="3.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#association-rule"><i class="fa fa-check"></i><b>3.1</b> Association rule</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#loading-and-data-exploration"><i class="fa fa-check"></i><b>3.1.1</b> Loading and data exploration</a></li>
<li class="chapter" data-level="3.1.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#data-preprocessing"><i class="fa fa-check"></i><b>3.1.2</b> Data preprocessing</a>
<ul>
<li class="chapter" data-level="3.1.2.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#encoding-to-correct-data-types"><i class="fa fa-check"></i><b>3.1.2.1</b> Encoding to correct data types</a></li>
<li class="chapter" data-level="3.1.2.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#create-a-data-frame-with-one-row-pr.-invoice"><i class="fa fa-check"></i><b>3.1.2.2</b> Create a data frame with one row pr. invoice</a></li>
</ul></li>
<li class="chapter" data-level="3.1.3" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#loading-transactions"><i class="fa fa-check"></i><b>3.1.3</b> Loading transactions</a></li>
<li class="chapter" data-level="3.1.4" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#plotting"><i class="fa fa-check"></i><b>3.1.4</b> Plotting</a></li>
<li class="chapter" data-level="3.1.5" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#apriori-calculation"><i class="fa fa-check"></i><b>3.1.5</b> Apriori calculation</a>
<ul>
<li class="chapter" data-level="3.1.5.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#another-example-where-maxlen-3"><i class="fa fa-check"></i><b>3.1.5.1</b> Another example where maxlen = 3</a></li>
<li class="chapter" data-level="3.1.5.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#filtering-on-right-hand-side.-an-example-with-the-item-metal"><i class="fa fa-check"></i><b>3.1.5.2</b> Filtering on right hand side. An example with the item {METAL}</a></li>
<li class="chapter" data-level="3.1.5.3" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#filtering-on-left-hand-side.-an-example-with-the-item-metal"><i class="fa fa-check"></i><b>3.1.5.3</b> Filtering on left hand side. An example with the item {METAL}</a></li>
</ul></li>
<li class="chapter" data-level="3.1.6" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#plotting-association-rules"><i class="fa fa-check"></i><b>3.1.6</b> Plotting association rules</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#colaborative-filtering"><i class="fa fa-check"></i><b>3.2</b> Colaborative filtering</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#loading-and-formatting-data"><i class="fa fa-check"></i><b>3.2.1</b> Loading and formatting data</a>
<ul>
<li class="chapter" data-level="3.2.1.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#loading-metadata-that-gets-loaded-with-main-dataset"><i class="fa fa-check"></i><b>3.2.1.1</b> Loading metadata that gets loaded with main dataset</a></li>
</ul></li>
<li class="chapter" data-level="3.2.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#data-exploration"><i class="fa fa-check"></i><b>3.2.2</b> Data Exploration</a>
<ul>
<li class="chapter" data-level="3.2.2.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#plotting-1"><i class="fa fa-check"></i><b>3.2.2.1</b> Plotting</a></li>
</ul></li>
<li class="chapter" data-level="3.2.3" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#what-models-can-we-use"><i class="fa fa-check"></i><b>3.2.3</b> What models can we use?</a></li>
<li class="chapter" data-level="3.2.4" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#training-and-test-set"><i class="fa fa-check"></i><b>3.2.4</b> Training and test set</a></li>
<li class="chapter" data-level="3.2.5" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#a-small-example-with-ibcf-item-based"><i class="fa fa-check"></i><b>3.2.5</b> A small example with IBCF (item based)</a></li>
<li class="chapter" data-level="3.2.6" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#ubcf---user-based-collaborative-based"><i class="fa fa-check"></i><b>3.2.6</b> UBCF - User based collaborative based</a>
<ul>
<li class="chapter" data-level="3.2.6.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#fitting-the-model"><i class="fa fa-check"></i><b>3.2.6.1</b> Fitting the model</a></li>
<li class="chapter" data-level="3.2.6.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#predicting-making-recommendations"><i class="fa fa-check"></i><b>3.2.6.2</b> Predicting (making) recommendations</a></li>
</ul></li>
<li class="chapter" data-level="3.2.7" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#cross-validation"><i class="fa fa-check"></i><b>3.2.7</b> Cross validation</a></li>
<li class="chapter" data-level="3.2.8" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#ibcf---item-based-collaborative-based"><i class="fa fa-check"></i><b>3.2.8</b> IBCF - Item based collaborative based</a>
<ul>
<li class="chapter" data-level="3.2.8.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#fitting-the-model-using-cv"><i class="fa fa-check"></i><b>3.2.8.1</b> Fitting the model (using CV)</a></li>
<li class="chapter" data-level="3.2.8.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#making-predictions"><i class="fa fa-check"></i><b>3.2.8.2</b> Making predictions</a></li>
<li class="chapter" data-level="3.2.8.3" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#performance-metrics"><i class="fa fa-check"></i><b>3.2.8.3</b> Performance metrics</a></li>
</ul></li>
<li class="chapter" data-level="3.2.9" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#building-roc-curve-and-precision-recall-rate"><i class="fa fa-check"></i><b>3.2.9</b> Building ROC curve and precision / recall rate</a></li>
<li class="chapter" data-level="3.2.10" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#comparing-ubcf-and-ibcf"><i class="fa fa-check"></i><b>3.2.10</b> Comparing UBCF and IBCF</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#latent-factor-models"><i class="fa fa-check"></i><b>3.3</b> Latent Factor Models</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#fitting-the-model-1"><i class="fa fa-check"></i><b>3.3.1</b> Fitting the model</a></li>
<li class="chapter" data-level="3.3.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#making-predictions-1"><i class="fa fa-check"></i><b>3.3.2</b> Making predictions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html"><i class="fa fa-check"></i><b>4</b> Probabilistic Models for Customer Analytics</a>
<ul>
<li class="chapter" data-level="4.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#bayesian-networks"><i class="fa fa-check"></i><b>4.1</b> Bayesian Networks</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#why-bayesian"><i class="fa fa-check"></i><b>4.1.1</b> <strong><em>Why Bayesian?</em></strong></a>
<ul>
<li class="chapter" data-level="4.1.1.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#many-names-for-bayesian-networks"><i class="fa fa-check"></i><b>4.1.1.1</b> <strong>Many names for Bayesian Networks</strong></a></li>
</ul></li>
<li class="chapter" data-level="4.1.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#terms-and-explanatory-examples"><i class="fa fa-check"></i><b>4.1.2</b> Terms and explanatory examples</a>
<ul>
<li class="chapter" data-level="4.1.2.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#types-of-connections"><i class="fa fa-check"></i><b>4.1.2.1</b> Types of connections</a></li>
<li class="chapter" data-level="4.1.2.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#variable-selection-based-on-a-bayesian-network"><i class="fa fa-check"></i><b>4.1.2.2</b> Variable selection based on a Bayesian Network</a></li>
</ul></li>
<li class="chapter" data-level="4.1.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#independence"><i class="fa fa-check"></i><b>4.1.3</b> Independence</a></li>
<li class="chapter" data-level="4.1.4" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#methods-for-identifying-the-network"><i class="fa fa-check"></i><b>4.1.4</b> Methods for identifying the network</a>
<ul>
<li class="chapter" data-level="4.1.4.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#algorithms-focused-on-causality-discovery"><i class="fa fa-check"></i><b>4.1.4.1</b> 1. <strong><em>Algorithms focused on causality discovery</em></strong></a></li>
<li class="chapter" data-level="4.1.4.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#algorithms-focused-on-prediction"><i class="fa fa-check"></i><b>4.1.4.2</b> 2. <strong><em>Algorithms focused on prediction</em></strong></a></li>
</ul></li>
<li class="chapter" data-level="4.1.5" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#real-life-application"><i class="fa fa-check"></i><b>4.1.5</b> <strong>Real life application</strong></a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#application-1-explaining-and-predicting-customer-retention-in-a-virtual-community"><i class="fa fa-check"></i><b>4.2</b> Application 1: Explaining and Predicting Customer Retention in a Virtual Community</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#getting-the-structure"><i class="fa fa-check"></i><b>4.2.1</b> 1. Getting the structure</a>
<ul>
<li class="chapter" data-level="4.2.1.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#a.-building-the-structure-and-parameters-manually"><i class="fa fa-check"></i><b>4.2.1.1</b> A. Building the structure and parameters manually</a>
<ul>
<li class="chapter" data-level="4.2.1.1.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#approaches-to-make-the-network"><i class="fa fa-check"></i><b>4.2.1.1.1</b> Approaches to make the network</a>
<ul>
<li class="chapter" data-level="4.2.1.1.1.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#i-first-approach"><i class="fa fa-check"></i><b>4.2.1.1.1.1</b> (i) First approach</a></li>
<li class="chapter" data-level="4.2.1.1.1.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#ii-second-approach"><i class="fa fa-check"></i><b>4.2.1.1.1.2</b> (ii) Second approach</a></li>
<li class="chapter" data-level="4.2.1.1.1.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#iii-third-approach"><i class="fa fa-check"></i><b>4.2.1.1.1.3</b> (iii) Third approach</a></li>
</ul></li>
<li class="chapter" data-level="4.2.1.1.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#loadingentering-data"><i class="fa fa-check"></i><b>4.2.1.1.2</b> Loading/entering data</a></li>
<li class="chapter" data-level="4.2.1.1.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#conditional-probability-table-cpt"><i class="fa fa-check"></i><b>4.2.1.1.3</b> Conditional probability table (CPT)</a></li>
</ul></li>
<li class="chapter" data-level="4.2.1.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#b.-learning-the-structure-and-parameters-from-observational-data"><i class="fa fa-check"></i><b>4.2.1.2</b> B. Learning the structure and parameters from observational data</a>
<ul>
<li class="chapter" data-level="4.2.1.2.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#grow-shrink-gs---learning-a-structure-using-a-constrained-based-algorithm"><i class="fa fa-check"></i><b>4.2.1.2.1</b> Grow-shrink (gs) - Learning a structure using a constrained-based algorithm</a>
<ul>
<li class="chapter" data-level="4.2.1.2.1.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#identifying-undirectred-links"><i class="fa fa-check"></i><b>4.2.1.2.1.1</b> Identifying undirectred links</a></li>
</ul></li>
<li class="chapter" data-level="4.2.1.2.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#hill-climbing-hc---learning-the-structure-using-a-score-based-algorithm"><i class="fa fa-check"></i><b>4.2.1.2.2</b> Hill-Climbing (hc) - Learning the structure using a score-based algorithm</a></li>
<li class="chapter" data-level="4.2.1.2.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#fitting-the-model-to-the-data-learning-the-probabilities"><i class="fa fa-check"></i><b>4.2.1.2.3</b> Fitting the model to the data (learning the probabilities)</a></li>
<li class="chapter" data-level="4.2.1.2.4" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#alternatives-to-grow-shrink-and-hc"><i class="fa fa-check"></i><b>4.2.1.2.4</b> Alternatives to Grow-Shrink and HC</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4.2.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#model-evaluation-1"><i class="fa fa-check"></i><b>4.2.2</b> 2. Model evaluation</a>
<ul>
<li class="chapter" data-level="4.2.2.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#i.-metrics-of-model-complexity"><i class="fa fa-check"></i><b>4.2.2.1</b> I. Metrics of model complexity</a></li>
<li class="chapter" data-level="4.2.2.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#ii.-metrics-of-model-sensitivity"><i class="fa fa-check"></i><b>4.2.2.2</b> II. Metrics of model sensitivity</a></li>
<li class="chapter" data-level="4.2.2.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#iii.-evaluate-the-arc.strength"><i class="fa fa-check"></i><b>4.2.2.3</b> III. Evaluate the arc.strength()</a>
<ul>
<li class="chapter" data-level="4.2.2.3.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#for-the-growth-shrink"><i class="fa fa-check"></i><b>4.2.2.3.1</b> For the growth shrink</a></li>
<li class="chapter" data-level="4.2.2.3.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#for-the-hill-climbing-structure"><i class="fa fa-check"></i><b>4.2.2.3.2</b> For the hill-climbing structure</a></li>
<li class="chapter" data-level="4.2.2.3.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#different-information-criteria-evaluations"><i class="fa fa-check"></i><b>4.2.2.3.3</b> Different information criteria evaluations</a></li>
</ul></li>
<li class="chapter" data-level="4.2.2.4" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#iv.-metrics-of-predictive-accuracy-error-rate-confusion-matrix-auc"><i class="fa fa-check"></i><b>4.2.2.4</b> IV. Metrics of predictive accuracy (error rate, confusion matrix, AUC)</a>
<ul>
<li class="chapter" data-level="4.2.2.4.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#cross-validation-1"><i class="fa fa-check"></i><b>4.2.2.4.1</b> Cross validation</a></li>
<li class="chapter" data-level="4.2.2.4.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#alternative-approach-to-fit-and-predict-without-grain"><i class="fa fa-check"></i><b>4.2.2.4.2</b> Alternative approach to fit and predict (Without gRain)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4.2.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#making-inference-and-queries-based-on-the-model"><i class="fa fa-check"></i><b>4.2.3</b> 3. Making inference and queries based on the model</a>
<ul>
<li class="chapter" data-level="4.2.3.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#diagnostics-forward-inference"><i class="fa fa-check"></i><b>4.2.3.1</b> Diagnostics (Forward inference)</a>
<ul>
<li class="chapter" data-level="4.2.3.1.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#let-us-repeat-the-same-analysis-by-setting-evidence-in-pleasure"><i class="fa fa-check"></i><b>4.2.3.1.1</b> <em>let us repeat the same analysis by setting evidence in Pleasure</em></a></li>
</ul></li>
<li class="chapter" data-level="4.2.3.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#diagnostic-backward-inference"><i class="fa fa-check"></i><b>4.2.3.2</b> Diagnostic (Backward inference)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#application-2-identifying-populations-with-positive-expected-lift-in-profit-elp-and-targeting"><i class="fa fa-check"></i><b>4.3</b> Application 2: Identifying populations with Positive Expected Lift in Profit (ELP) and targeting</a></li>
<li class="chapter" data-level="4.4" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#application-3-product-recommendation-using-probabilistic-models-bn"><i class="fa fa-check"></i><b>4.4</b> Application 3: Product Recommendation using Probabilistic Models (BN)</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#method-1-learn-the-probabilistic-relationships-using-a-bayesian-network-learning"><i class="fa fa-check"></i><b>4.4.1</b> Method 1: Learn the probabilistic relationships using a Bayesian network learning</a></li>
<li class="chapter" data-level="4.4.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#method-2-finding-latent-segments"><i class="fa fa-check"></i><b>4.4.2</b> Method 2: Finding latent segments</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#latent-models-for-cross-selling-and-acquisition-sequence"><i class="fa fa-check"></i><b>4.5</b> Latent models for cross selling and acquisition sequence</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#latent-trait-model---applying-the-ltm-package-in-r"><i class="fa fa-check"></i><b>4.5.1</b> Latent Trait Model - Applying the LTM Package in R</a></li>
<li class="chapter" data-level="4.5.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#the-latent-hidden-markov-model"><i class="fa fa-check"></i><b>4.5.2</b> The latent (hidden) Markov model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="customer-behavior.html"><a href="customer-behavior.html"><i class="fa fa-check"></i><b>5</b> Customer behavior</a>
<ul>
<li class="chapter" data-level="5.1" data-path="customer-behavior.html"><a href="customer-behavior.html#characteristics-of-cliskstream"><i class="fa fa-check"></i><b>5.1</b> Characteristics of cliskstream</a></li>
<li class="chapter" data-level="5.2" data-path="customer-behavior.html"><a href="customer-behavior.html#applications-with-clickstream-data"><i class="fa fa-check"></i><b>5.2</b> Applications with clickstream data</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="customer-behavior.html"><a href="customer-behavior.html#a-motivating-example"><i class="fa fa-check"></i><b>5.2.1</b> A motivating example</a>
<ul>
<li class="chapter" data-level="5.2.1.1" data-path="customer-behavior.html"><a href="customer-behavior.html#i-predict-either-the-next-click-or-the-ï¬nal-click-state-of-a-customer."><i class="fa fa-check"></i><b>5.2.1.1</b> i) Predict either the next click or the ï¬nal click (state) of a customer.</a></li>
<li class="chapter" data-level="5.2.1.2" data-path="customer-behavior.html"><a href="customer-behavior.html#ii-clustering-and-generalizing-upon-clickstreams"><i class="fa fa-check"></i><b>5.2.1.2</b> ii) Clustering and generalizing upon clickstreams</a></li>
</ul></li>
<li class="chapter" data-level="5.2.2" data-path="customer-behavior.html"><a href="customer-behavior.html#second-exercise-clickstream-more-extensive"><i class="fa fa-check"></i><b>5.2.2</b> Second exercise (clickstream) more extensive</a></li>
<li class="chapter" data-level="5.2.3" data-path="customer-behavior.html"><a href="customer-behavior.html#a-concrete-eaxmple-with-real-data"><i class="fa fa-check"></i><b>5.2.3</b> A concrete eaxmple with real data</a>
<ul>
<li class="chapter" data-level="5.2.3.1" data-path="customer-behavior.html"><a href="customer-behavior.html#markov-chain"><i class="fa fa-check"></i><b>5.2.3.1</b> (1) Markov Chain</a></li>
<li class="chapter" data-level="5.2.3.2" data-path="customer-behavior.html"><a href="customer-behavior.html#using-association-rule-mining"><i class="fa fa-check"></i><b>5.2.3.2</b> (2) Using association rule mining</a></li>
<li class="chapter" data-level="5.2.3.3" data-path="customer-behavior.html"><a href="customer-behavior.html#use-frequencies-instead-of-the-sequence"><i class="fa fa-check"></i><b>5.2.3.3</b> (3) Use frequencies instead of the sequence</a></li>
<li class="chapter" data-level="5.2.3.4" data-path="customer-behavior.html"><a href="customer-behavior.html#neural-networks"><i class="fa fa-check"></i><b>5.2.3.4</b> (4) Neural networks</a></li>
</ul></li>
<li class="chapter" data-level="5.2.4" data-path="customer-behavior.html"><a href="customer-behavior.html#optional-exercise"><i class="fa fa-check"></i><b>5.2.4</b> Optional exercise</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="customer-behavior.html"><a href="customer-behavior.html#ab-testing"><i class="fa fa-check"></i><b>5.3</b> AB Testing</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="customer-behavior.html"><a href="customer-behavior.html#what-is-it-and-when-to-apply-it"><i class="fa fa-check"></i><b>5.3.1</b> (1 + 2): What is it and when to apply it</a></li>
<li class="chapter" data-level="5.3.2" data-path="customer-behavior.html"><a href="customer-behavior.html#how-to-perform-an-ab-test"><i class="fa fa-check"></i><b>5.3.2</b> (3): How to perform an A/B test</a></li>
<li class="chapter" data-level="5.3.3" data-path="customer-behavior.html"><a href="customer-behavior.html#pitfalls-and-challenges."><i class="fa fa-check"></i><b>5.3.3</b> (4): Pitfalls and challenges.</a></li>
<li class="chapter" data-level="5.3.4" data-path="customer-behavior.html"><a href="customer-behavior.html#ab-tests-and-bandits."><i class="fa fa-check"></i><b>5.3.4</b> (5): A/B tests and bandits.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="privacy.html"><a href="privacy.html"><i class="fa fa-check"></i><b>6</b> Privacy</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Customer Analytics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="customer-behavior" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Customer behavior</h1>
<div id="characteristics-of-cliskstream" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Characteristics of cliskstream</h2>
<p>We see that this can be organized in a pyramid.</p>
<div class="figure">
<img src="images/CharacteristicsOfClickstream.png" alt="" />
<p class="caption">Characteristics of clickstream data</p>
</div>
<p>We see that the more information we have about the actual user the more valuable is the clickstream data.</p>
<p>We saw an example with clickstreams from the google merchendise, here we information on the cookie, timestamps, eventID, sessionID, destination (the actual page they are visiting etc.). Naturally this must be organized so it can be used for analysis.</p>
<p>It the slidedeck there is a bunch of steps for preparing data, although I would argue that they are very case sensitive.</p>
<p><strong>Challenges with clickstreams:</strong></p>
<ol style="list-style-type: decimal">
<li><p>One must choose the right period for evaluation, as we want to have as many full cycles as possible, hence if we start the survey at the 1 of january, then customers starting to visit the page in december will appear as new customers, while they are not. The same applies at the end of the period.</p></li>
<li><p>Customer use different devices for the same purposes, these are difficult to track.</p></li>
<li><p>Cookies expires after a certain time period.</p></li>
<li><p>If a user is having different windows open, it is difficult to know which page the user is actually on.</p></li>
<li><p>Many patterns in the data is due to how the website is constructed.</p></li>
</ol>
<p><strong>Where do customers come from?</strong>: one could investigate the following:</p>
<ul>
<li>What type of device is used, PC, tableg, mobile etc.</li>
<li>What product category is visited.</li>
<li>What is the entry channel? advertising, direct access, social media etc.</li>
<li>Time of entry: At what time the person visit the page?</li>
</ul>
<p><strong>How does the person behave on the webiste?</strong>: it is important to know which panels the customer choose, where they go from a product page, from the front page, from the basket etc.</p>
<p><strong>Conversion rates</strong>: We need to know the conversion rates of the customers.</p>
</div>
<div id="applications-with-clickstream-data" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Applications with clickstream data</h2>
<p>For modeling sequences of clicks: neural networks (NN) and Markov chains are two of the most common type of models. NN are black-box models best for prediction (not covered here). Markov models are transparent models that are used both for predicting and understanding customer behavior. In this application, I focus on the âclickstreamâ library to model the data with Markov chains models. From time to time I refer to other R packages that offer similar functionality.</p>
<p><strong>What is a (discrete state) Markov Chain?</strong></p>
<p><em>(note: we can have Markov chains with discrete and continous states and in discrete and in continuous time).</em></p>
<ul>
<li><p>A Markov chain is a stochastic process <em>X</em> that takes state <em>m</em> from a ï¬nite set of states <em>M</em> at each time <em>n</em>. If the state in <em>n</em> only depends on the recent <em>k</em> states, we call <em>X</em> a Markov chain of order <em>k</em>. For example:</p></li>
<li><p>0-order Markov chain = the probability to be in any of the <em>m</em> states in the next step is independent of the present state. Hence states are completely independent of each other.</p></li>
<li><p>1st-order Markov chain = the probability to be in any of the <em>m</em> states in the next step is independent of the previous states given the present state (one-period memory)</p></li>
<li><p>2nd-order Markov chain = two-periods memory</p></li>
<li><p>3rd-order Markov chain = three-periods memory</p></li>
<li><p>â¦so on</p></li>
</ul>
<p>Markov chains can be described by transition probability matrices =&gt; Each value in these matrices is a parameter Higher-order Markov chains have <span class="math inline">\((mâ1)m^k\)</span> model parameters =&gt; the number of lag parameters increases exponentially</p>
<p><strong>Markov Chain</strong></p>
<p>It is about sequences of events and we want to use markov chain to analyse the sequence of events, i.e.Â the clickstream. Hence what we want to get out of it, is the likelyhood of converting.</p>
<p>Recall in a Bayesian Network, that variables would only have influence in one direction and hence not create loops etc. So we see that for instance a sequence of events, you would only assess the adjacent click events.</p>
<p>With markov chain, we are able to make more relationships e.g., non adjacent events having influence of each other.</p>
<p>Recall that HJ showed a hidden markov chain where this is not a hidden markov chain.</p>
<p><strong>Why Markov Chain and not a Bayesian Network?</strong></p>
<p>We see that a person can be jumping among a set of pages, hence we can create cycles (where one person can start and end at the same page), this is not allowed in a bayesian network, hence we cannot apply this.</p>
<p><strong>How we select the Markov Chain order:</strong></p>
<ul>
<li><p>Usually, a user considering a Product Page might either Add the product to the shopping cart,</p></li>
<li><p>view Product Reviews, follow a Product Recommendation, or Search for another product.</p></li>
<li><p>Moe (2003) proposes that the probability for a transition to either of the possible next states depends on the MODE (browsing, searching, or buying) the user is currently in.</p></li>
<li><p>This MODE (latent state) can be identiï¬ed when considering the recent <em>k</em> states.</p></li>
<li><p>Model order selection is usually based on a criteria like AIC or BIC. The function <code>fitMarkovChain()</code> estimates the parameters of a Markov chain model of order k.</p></li>
</ul>
<p><strong>How does R interpret the clickstreams?</strong></p>
<p>Clickstreams = collection of data sequences - with different sizes!</p>
<p>Notice that</p>
<ul>
<li>session = an individual, i.e., their user session.</li>
<li>P = page</li>
</ul>
<p>An example:</p>
<ul>
<li>Session 1: P1 P2 P1 P3 P4 Defer</li>
<li>Session 2: P3 P4 P1 P3 Defer</li>
<li>Session 3: P5 P1 P6 P7 P6 P7 P8 P7 Buy</li>
<li>Session 4: P9 P2 P11 P12 P11 P13 P11 Buy</li>
<li>Session 5: P4 P6 P11 P6 P1 P3 Defer</li>
<li>Session 6: P3 P13 P12 P4 P12 P1 P4 P1 P3 Defer - <em>this is examplified in the DAG</em></li>
<li>Session 7: P10 P5 P10 P8 P8 P5 P1 P7 Buy</li>
<li>Session 8: P9 P2 P1 P9 P3 P1 Defer</li>
<li>Session 9: P5 P8 P5 P7 P4 P1 P6 P4 Defer</li>
</ul>
<p>There are 13 possible product pages and two <strong>absorbing</strong> stages, that are stages you can end up in.</p>
<p>Hence we see that a clickstream is a sequence of events. This can naturally be shown as a vector in R and we can apply the function <code>readClickstreams()</code>, the input must be a commaseperated file.</p>
<p>The following is an example where we start in P3, then go to p13, P12, P4, P12, P1, P4, P1 back to P3 and then leave. The graph may be a biiit difficult to follow, but following the path (directions) one will end up in defer.</p>
<p><em>Notice that we did not do this during the class, although I did it for fun.</em></p>
<div class="sourceCode" id="cb705"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb705-1"><a href="customer-behavior.html#cb705-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdag)</span>
<span id="cb705-2"><a href="customer-behavior.html#cb705-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb705-3"><a href="customer-behavior.html#cb705-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Generating the relationships</span></span>
<span id="cb705-4"><a href="customer-behavior.html#cb705-4" aria-hidden="true" tabindex="-1"></a>dag <span class="ot">&lt;-</span> dagitty<span class="sc">::</span><span class="fu">dagitty</span>(<span class="st">&quot;dag {</span></span>
<span id="cb705-5"><a href="customer-behavior.html#cb705-5" aria-hidden="true" tabindex="-1"></a><span class="st">    P3 -&gt; P13 -&gt; P12 -&gt; P4 -&gt; P12 -&gt; P1 -&gt; P4 -&gt; P1 -&gt; P3 -&gt; Defer</span></span>
<span id="cb705-6"><a href="customer-behavior.html#cb705-6" aria-hidden="true" tabindex="-1"></a><span class="st">  }&quot;</span></span>
<span id="cb705-7"><a href="customer-behavior.html#cb705-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb705-8"><a href="customer-behavior.html#cb705-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb705-9"><a href="customer-behavior.html#cb705-9" aria-hidden="true" tabindex="-1"></a>tidy_dag <span class="ot">&lt;-</span> <span class="fu">tidy_dagitty</span>(dag)</span>
<span id="cb705-10"><a href="customer-behavior.html#cb705-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb705-11"><a href="customer-behavior.html#cb705-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Adding information on the color</span></span>
<span id="cb705-12"><a href="customer-behavior.html#cb705-12" aria-hidden="true" tabindex="-1"></a>starting_page <span class="ot">&lt;-</span> <span class="st">&quot;P3&quot;</span></span>
<span id="cb705-13"><a href="customer-behavior.html#cb705-13" aria-hidden="true" tabindex="-1"></a>tidy_dag<span class="sc">$</span>data <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(tidy_dag<span class="sc">$</span>data,</span>
<span id="cb705-14"><a href="customer-behavior.html#cb705-14" aria-hidden="true" tabindex="-1"></a>                               <span class="at">colour =</span> <span class="fu">ifelse</span>(tidy_dag<span class="sc">$</span>data<span class="sc">$</span>name <span class="sc">==</span> starting_page</span>
<span id="cb705-15"><a href="customer-behavior.html#cb705-15" aria-hidden="true" tabindex="-1"></a>                                               ,<span class="st">&quot;Starting page&quot;</span>, <span class="st">&quot;Visited page&quot;</span>))</span>
<span id="cb705-16"><a href="customer-behavior.html#cb705-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb705-17"><a href="customer-behavior.html#cb705-17" aria-hidden="true" tabindex="-1"></a><span class="co">#Making the plot</span></span>
<span id="cb705-18"><a href="customer-behavior.html#cb705-18" aria-hidden="true" tabindex="-1"></a>tidy_dag <span class="sc">%&gt;%</span></span>
<span id="cb705-19"><a href="customer-behavior.html#cb705-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(</span>
<span id="cb705-20"><a href="customer-behavior.html#cb705-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> x,</span>
<span id="cb705-21"><a href="customer-behavior.html#cb705-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> y,</span>
<span id="cb705-22"><a href="customer-behavior.html#cb705-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">xend =</span> xend,</span>
<span id="cb705-23"><a href="customer-behavior.html#cb705-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">yend =</span> yend</span>
<span id="cb705-24"><a href="customer-behavior.html#cb705-24" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb705-25"><a href="customer-behavior.html#cb705-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> colour)) <span class="sc">+</span></span>
<span id="cb705-26"><a href="customer-behavior.html#cb705-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>() <span class="sc">+</span></span>
<span id="cb705-27"><a href="customer-behavior.html#cb705-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>() <span class="sc">+</span></span>
<span id="cb705-28"><a href="customer-behavior.html#cb705-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dag</span>()</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-350-1.png" width="720" style="display: block; margin: auto;" /></p>
<div id="a-motivating-example" class="section level3" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> A motivating example</h3>
<div class="sourceCode" id="cb706"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb706-1"><a href="customer-behavior.html#cb706-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(clickstream)</span>
<span id="cb706-2"><a href="customer-behavior.html#cb706-2" aria-hidden="true" tabindex="-1"></a>cls <span class="ot">&lt;-</span> <span class="fu">readClickstreams</span>(<span class="at">file =</span> <span class="st">&quot;Data/Customer behavior/sample.csv&quot;</span></span>
<span id="cb706-3"><a href="customer-behavior.html#cb706-3" aria-hidden="true" tabindex="-1"></a>                        , <span class="at">sep =</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb706-4"><a href="customer-behavior.html#cb706-4" aria-hidden="true" tabindex="-1"></a>                        , <span class="at">header =</span> <span class="cn">TRUE</span>) </span>
<span id="cb706-5"><a href="customer-behavior.html#cb706-5" aria-hidden="true" tabindex="-1"></a>cls <span class="co">#Shows sessions</span></span>
<span id="cb706-6"><a href="customer-behavior.html#cb706-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cls) <span class="co">#Summary stats</span></span>
<span id="cb706-7"><a href="customer-behavior.html#cb706-7" aria-hidden="true" tabindex="-1"></a><span class="co"># writeClickstreams(cls, &quot;sample.csv&quot;, header = TRUE, sep = &quot;,&quot;)</span></span></code></pre></div>
<pre><code>## Clickstreams
## 
## Session1: P1 P2 P1 P3 P4 Defer
## Session2: P3 P4 P1 P3 Defer
## Session3: P5 P1 P6 P7 P6 P7 P8 P7 Buy
## Session4: P9 P2 P11 P12 P11 P13 P11 Buy
## Session5: P4 P6 P11 P6 P1 P3 Defer
## Session6: P3 P13 P12 P4 P12 P1 P4 P1 P3 Defer
## Session7: P10 P5 P10 P8 P8 P5 P1 P7 Buy
## Session8: P9 P2 P1 P9 P3 P1 Defer
## Session9: P5 P8 P5 P7 P4 P1 P6 P4 Defer
## Observations: 9
## 
## Click Frequencies:
##   Buy Defer    P1   P10   P11   P12   P13    P2    P3    P4    P5    P6    P7 
##     3     6    11     2     4     3     2     3     7     7     5     5     5 
##    P8    P9 
##     4     3</code></pre>
<p>We see the frequencies of each page, where it is clear that P1 is most visited, hence might also be the front page.</p>
<p>Now we can <strong>fit</strong> the model and s</p>
<div class="sourceCode" id="cb708"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb708-1"><a href="customer-behavior.html#cb708-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>,<span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb708-2"><a href="customer-behavior.html#cb708-2" aria-hidden="true" tabindex="-1"></a>order <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb708-3"><a href="customer-behavior.html#cb708-3" aria-hidden="true" tabindex="-1"></a>mc <span class="ot">&lt;-</span> <span class="fu">fitMarkovChain</span>(<span class="at">clickstreamList =</span> cls,<span class="at">order =</span> order <span class="co">#= two-periods memory, i.e. 2 lags</span></span>
<span id="cb708-4"><a href="customer-behavior.html#cb708-4" aria-hidden="true" tabindex="-1"></a>                     ,<span class="at">control =</span> <span class="fu">list</span>(<span class="at">optimizer =</span> <span class="st">&quot;quadratic&quot;</span>)) </span>
<span id="cb708-5"><a href="customer-behavior.html#cb708-5" aria-hidden="true" tabindex="-1"></a>mc</span></code></pre></div>
<pre><code>## Higher-Order Markov Chain (order=2)
## 
## Transition Probabilities:
## 
## Lag:  1 
## lambda:  0.22 
##       Buy Defer    P1 P10  P11  P12 P13   P2   P3   P4  P5  P6  P7   P8   P9
## Buy     0     0 0.000 0.0 0.25 0.00 0.0 0.00 0.00 0.00 0.0 0.0 0.4 0.00 0.00
## Defer   0     0 0.091 0.0 0.00 0.00 0.0 0.00 0.43 0.29 0.0 0.0 0.0 0.00 0.00
## P1      0     0 0.000 0.0 0.00 0.33 0.0 0.67 0.14 0.43 0.4 0.2 0.0 0.00 0.00
## P10     0     0 0.000 0.0 0.00 0.00 0.0 0.00 0.00 0.00 0.2 0.0 0.0 0.00 0.00
## P11     0     0 0.000 0.0 0.00 0.33 0.5 0.33 0.00 0.00 0.0 0.2 0.0 0.00 0.00
## P12     0     0 0.000 0.0 0.25 0.00 0.5 0.00 0.00 0.14 0.0 0.0 0.0 0.00 0.00
## P13     0     0 0.000 0.0 0.25 0.00 0.0 0.00 0.14 0.00 0.0 0.0 0.0 0.00 0.00
## P2      0     0 0.091 0.0 0.00 0.00 0.0 0.00 0.00 0.00 0.0 0.0 0.0 0.00 0.67
## P3      0     0 0.364 0.0 0.00 0.00 0.0 0.00 0.00 0.00 0.0 0.0 0.0 0.00 0.33
## P4      0     0 0.091 0.0 0.00 0.33 0.0 0.00 0.29 0.00 0.0 0.2 0.2 0.00 0.00
## P5      0     0 0.000 0.5 0.00 0.00 0.0 0.00 0.00 0.00 0.0 0.0 0.0 0.50 0.00
## P6      0     0 0.182 0.0 0.25 0.00 0.0 0.00 0.00 0.14 0.0 0.0 0.2 0.00 0.00
## P7      0     0 0.091 0.0 0.00 0.00 0.0 0.00 0.00 0.00 0.2 0.4 0.0 0.25 0.00
## P8      0     0 0.000 0.5 0.00 0.00 0.0 0.00 0.00 0.00 0.2 0.0 0.2 0.25 0.00
## P9      0     0 0.091 0.0 0.00 0.00 0.0 0.00 0.00 0.00 0.0 0.0 0.0 0.00 0.00
## 
## Lag:  2 
## lambda:  0.78 
##       Buy Defer  P1 P10  P11  P12 P13   P2   P3  P4  P5  P6   P7   P8   P9
## Buy     0     0 0.1 0.0 0.00 0.00 0.5 0.00 0.00 0.0 0.0 0.0 0.00 0.25 0.00
## Defer   0     0 0.3 0.0 0.00 0.00 0.0 0.00 0.50 0.0 0.0 0.2 0.00 0.00 0.00
## P1      0     0 0.2 0.0 0.33 0.00 0.0 0.00 0.25 0.2 0.0 0.0 0.33 0.25 0.67
## P10     0     0 0.0 0.5 0.00 0.00 0.0 0.00 0.00 0.0 0.0 0.0 0.00 0.00 0.00
## P11     0     0 0.0 0.0 0.67 0.00 0.0 0.00 0.00 0.2 0.0 0.0 0.00 0.00 0.33
## P12     0     0 0.0 0.0 0.00 0.33 0.0 0.33 0.25 0.0 0.0 0.0 0.00 0.00 0.00
## P13     0     0 0.0 0.0 0.00 0.33 0.0 0.00 0.00 0.0 0.0 0.0 0.00 0.00 0.00
## P2      0     0 0.0 0.0 0.00 0.00 0.0 0.00 0.00 0.0 0.0 0.0 0.00 0.00 0.00
## P3      0     0 0.1 0.0 0.00 0.00 0.0 0.33 0.00 0.4 0.0 0.2 0.00 0.00 0.00
## P4      0     0 0.2 0.0 0.00 0.33 0.5 0.00 0.00 0.0 0.2 0.0 0.00 0.00 0.00
## P5      0     0 0.0 0.0 0.00 0.00 0.0 0.00 0.00 0.0 0.2 0.0 0.00 0.25 0.00
## P6      0     0 0.0 0.0 0.00 0.00 0.0 0.00 0.00 0.2 0.2 0.4 0.00 0.00 0.00
## P7      0     0 0.1 0.0 0.00 0.00 0.0 0.00 0.00 0.0 0.2 0.0 0.67 0.25 0.00
## P8      0     0 0.0 0.5 0.00 0.00 0.0 0.00 0.00 0.0 0.2 0.2 0.00 0.00 0.00
## P9      0     0 0.0 0.0 0.00 0.00 0.0 0.33 0.00 0.0 0.0 0.0 0.00 0.00 0.00
## 
## Start Probabilities:
## 
##   P1  P10   P3   P4   P5   P9 
## 0.11 0.11 0.22 0.11 0.22 0.22 
## 
## End Probabilities:
## 
##   Buy Defer 
##  0.33  0.67</code></pre>
<p>The outcome:</p>
<ul>
<li>the two transition probabilities matrices for the two lags</li>
<li>start probabilities for the states the corresponding clickstreams started</li>
<li>end probabilities for the states the corresponding clickstreams ended</li>
</ul>
<p>We see that with lag = 1, ther is only conversion (buying probability) from P11 and P7, although looking one further step back, we see more pages may also lead to a purchase. I guess P11 and P7 have something to do with a basket or a checkout.</p>
<p>Then we can also see the different probabilities of moving from one page to another.</p>
<p>Lastly we can see the different start probabilities, that is the probability of a person starting on a given page. Also we can see the end probabilities, that being posterior probabilities of buying or not.</p>
<p>Lets now compute the summary of the fitted model and plot the transition probabilities.</p>
<div class="sourceCode" id="cb710"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb710-1"><a href="customer-behavior.html#cb710-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mc)</span>
<span id="cb710-2"><a href="customer-behavior.html#cb710-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mc, <span class="at">order =</span> order)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-353-1.png" width="720" style="display: block; margin: auto;" /></p>
<pre><code>## Higher-Order Markov Chain (order=2) with 15 states.
##  The Markov Chain has absorbing states.
## 
## Observations: 70
## LogLikelihood: -66
## AIC: 196
## BIC: 268</code></pre>
<p>We see that <code>fitMarkovChain()</code> computes the log-likelihood, hence we can calculate AIC and BIC.</p>
<p>Here we see the flow of typical flow</p>
<div id="i-predict-either-the-next-click-or-the-ï¬nal-click-state-of-a-customer." class="section level4" number="5.2.1.1">
<h4><span class="header-section-number">5.2.1.1</span> i) Predict either the next click or the ï¬nal click (state) of a customer.</h4>
<p>Now we can use it to make a prediction. <em>If a customer starts with the clickstream P9 P2, what will do next?</em></p>
<div class="sourceCode" id="cb712"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb712-1"><a href="customer-behavior.html#cb712-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Pattern to evaluate</span></span>
<span id="cb712-2"><a href="customer-behavior.html#cb712-2" aria-hidden="true" tabindex="-1"></a>pattern <span class="ot">&lt;-</span> <span class="fu">new</span>(<span class="st">&quot;Pattern&quot;</span>, <span class="at">sequence =</span> <span class="fu">c</span>(<span class="st">&quot;P9&quot;</span>, <span class="st">&quot;P2&quot;</span>))</span>
<span id="cb712-3"><a href="customer-behavior.html#cb712-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb712-4"><a href="customer-behavior.html#cb712-4" aria-hidden="true" tabindex="-1"></a><span class="co">#using predict</span></span>
<span id="cb712-5"><a href="customer-behavior.html#cb712-5" aria-hidden="true" tabindex="-1"></a>resultPattern <span class="ot">&lt;-</span> <span class="fu">predict</span>(mc</span>
<span id="cb712-6"><a href="customer-behavior.html#cb712-6" aria-hidden="true" tabindex="-1"></a>                         , <span class="at">startPattern =</span> pattern</span>
<span id="cb712-7"><a href="customer-behavior.html#cb712-7" aria-hidden="true" tabindex="-1"></a>                         , <span class="at">dist =</span> <span class="dv">1</span> <span class="co">#How far we want to predict, when he has clicked p9 and p2</span></span>
<span id="cb712-8"><a href="customer-behavior.html#cb712-8" aria-hidden="true" tabindex="-1"></a>                         )</span>
<span id="cb712-9"><a href="customer-behavior.html#cb712-9" aria-hidden="true" tabindex="-1"></a>resultPattern <span class="co">#the user will most likely click on P1 next</span></span></code></pre></div>
<pre><code>## Sequence: P1
## Probability: 0.67
## Absorbing Probabilities: 
##   None
## 1  NaN</code></pre>
<p>There is a 66% chance of clicking P1.</p>
<p>Now we make another prediction where a person has viewed page 9 and 2, with the following:</p>
<ol style="list-style-type: decimal">
<li>Predict 2 steps into the future.</li>
<li>Here we want the likelyhood of purchase</li>
</ol>
<div class="sourceCode" id="cb714"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb714-1"><a href="customer-behavior.html#cb714-1" aria-hidden="true" tabindex="-1"></a>pattern <span class="ot">&lt;-</span> <span class="fu">new</span>(<span class="st">&quot;Pattern&quot;</span></span>
<span id="cb714-2"><a href="customer-behavior.html#cb714-2" aria-hidden="true" tabindex="-1"></a>               ,<span class="at">sequence =</span> <span class="fu">c</span>(<span class="st">&quot;P9&quot;</span>, <span class="st">&quot;P2&quot;</span>) <span class="co">#A sequence for the session</span></span>
<span id="cb714-3"><a href="customer-behavior.html#cb714-3" aria-hidden="true" tabindex="-1"></a>               ,<span class="at">absorbingProbabilities =</span> <span class="fu">data.frame</span>(<span class="at">Buy =</span> <span class="fl">0.333</span>, <span class="at">Defer =</span> <span class="fl">0.667</span>) <span class="co">#provide probs for buying</span></span>
<span id="cb714-4"><a href="customer-behavior.html#cb714-4" aria-hidden="true" tabindex="-1"></a>               )</span>
<span id="cb714-5"><a href="customer-behavior.html#cb714-5" aria-hidden="true" tabindex="-1"></a>resultPattern <span class="ot">&lt;-</span> <span class="fu">predict</span>(mc, <span class="at">startPattern =</span> pattern, <span class="at">dist =</span> <span class="dv">2</span>)</span>
<span id="cb714-6"><a href="customer-behavior.html#cb714-6" aria-hidden="true" tabindex="-1"></a>resultPattern</span></code></pre></div>
<pre><code>## Sequence: P1 P3
## Probability: 0.26
## Absorbing Probabilities: 
##     Buy Defer
## 1 0.058  0.94</code></pre>
<p>The person visit products P1 and then P3, although this pattern only has a 26% probability. Purchasing probability is 5.83% after 2 further clicks, and the person is most likely to defer the purchase.</p>
<p>Online stores often have evidence on how many of the visitors convert to a buyer (this info is typically used to formulate initial absorbing probabilities for all users). But, particularly for customers who log on to their account, the online stores can also know how many times a particular user has been only visiting the online store and how often she has bought a product, This information can be used to formulate initial absorbing probabilities for a user.</p>
<p>If for example a user has been logged in and ï¬nally bought a product in 50% of her log-ins, we can compute absorbing probabilities (posterior) for a stream of clicks:</p>
<p>Now imagine that the probability of buying and defering is 50/50.</p>
<div class="sourceCode" id="cb716"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb716-1"><a href="customer-behavior.html#cb716-1" aria-hidden="true" tabindex="-1"></a>absorbingProbabilities <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>)</span>
<span id="cb716-2"><a href="customer-behavior.html#cb716-2" aria-hidden="true" tabindex="-1"></a>sequence <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;P9&quot;</span>, <span class="st">&quot;P2&quot;</span>)</span>
<span id="cb716-3"><a href="customer-behavior.html#cb716-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (s <span class="cf">in</span> sequence) {</span>
<span id="cb716-4"><a href="customer-behavior.html#cb716-4" aria-hidden="true" tabindex="-1"></a>     absorbingProbabilities <span class="ot">&lt;-</span> absorbingProbabilities <span class="sc">*</span> </span>
<span id="cb716-5"><a href="customer-behavior.html#cb716-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">data.matrix</span>(<span class="fu">subset</span>(mc<span class="sc">@</span>absorbingProbabilities, state <span class="sc">==</span> s,</span>
<span id="cb716-6"><a href="customer-behavior.html#cb716-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">select =</span> <span class="fu">c</span>(<span class="st">&quot;Buy&quot;</span>, <span class="st">&quot;Defer&quot;</span>)))</span>
<span id="cb716-7"><a href="customer-behavior.html#cb716-7" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb716-8"><a href="customer-behavior.html#cb716-8" aria-hidden="true" tabindex="-1"></a>absorbingProbabilities <span class="ot">&lt;-</span> absorbingProbabilities <span class="sc">/</span><span class="fu">sum</span>(absorbingProbabilities)</span>
<span id="cb716-9"><a href="customer-behavior.html#cb716-9" aria-hidden="true" tabindex="-1"></a>absorbingProbabilities</span></code></pre></div>
<pre><code>##     Buy Defer
## 15 0.23  0.77</code></pre>
<p>22.62% to ï¬nally buy a product after she has visited products P9 and P2.</p>
<p>Although we see that it is cumbersome to just hardcode the patterns and the absorbing rates, because the customer journey is not homogenious for all customers.</p>
<p>Therefore, we can define cluster and generalize on the clusters instead of on all customers. That is done in the following section</p>
</div>
<div id="ii-clustering-and-generalizing-upon-clickstreams" class="section level4" number="5.2.1.2">
<h4><span class="header-section-number">5.2.1.2</span> ii) Clustering and generalizing upon clickstreams</h4>
<p>An alternative before running the model is to identify segments of customers by clustering clickstreams and afterwards building a model for each cluster (Huang, Ng, Ching, Ng, and Cheung, 2001, k-means alg. and Euclidean distance)</p>
<div class="sourceCode" id="cb718"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb718-1"><a href="customer-behavior.html#cb718-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb718-2"><a href="customer-behavior.html#cb718-2" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> <span class="fu">clusterClickstreams</span>(<span class="at">clickstreamList =</span> cls, <span class="at">order =</span> <span class="dv">1</span>,<span class="at">centers =</span> <span class="dv">3</span>)</span>
<span id="cb718-3"><a href="customer-behavior.html#cb718-3" aria-hidden="true" tabindex="-1"></a>clusters</span>
<span id="cb718-4"><a href="customer-behavior.html#cb718-4" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(clusters,<span class="st">&quot;Saved Objects/clusters.rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb719"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb719-1"><a href="customer-behavior.html#cb719-1" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;Saved Objects/clusters.rds&quot;</span>)</span></code></pre></div>
<p>We see that this creates three clusters. Notice that this is a list element, hence we could also look them up individually.</p>
<p>Now we can fit a Markov Chain each of the clusters</p>
<div class="sourceCode" id="cb720"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb720-1"><a href="customer-behavior.html#cb720-1" aria-hidden="true" tabindex="-1"></a>mc_clu1 <span class="ot">&lt;-</span> <span class="fu">fitMarkovChain</span>(<span class="at">clickstreamList =</span> clusters<span class="sc">$</span>clusters[[<span class="dv">1</span>]], <span class="at">order =</span> <span class="dv">2</span>,<span class="at">control =</span> <span class="fu">list</span>(<span class="at">optimizer =</span> <span class="st">&quot;quadratic&quot;</span>))</span>
<span id="cb720-2"><a href="customer-behavior.html#cb720-2" aria-hidden="true" tabindex="-1"></a>mc_clu1</span>
<span id="cb720-3"><a href="customer-behavior.html#cb720-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb720-4"><a href="customer-behavior.html#cb720-4" aria-hidden="true" tabindex="-1"></a>mc_clu2 <span class="ot">&lt;-</span> <span class="fu">fitMarkovChain</span>(<span class="at">clickstreamList =</span> clusters<span class="sc">$</span>clusters[[<span class="dv">2</span>]], <span class="at">order =</span> <span class="dv">2</span>,<span class="at">control =</span> <span class="fu">list</span>(<span class="at">optimizer =</span> <span class="st">&quot;quadratic&quot;</span>))</span>
<span id="cb720-5"><a href="customer-behavior.html#cb720-5" aria-hidden="true" tabindex="-1"></a><span class="co">#mc_clu2</span></span>
<span id="cb720-6"><a href="customer-behavior.html#cb720-6" aria-hidden="true" tabindex="-1"></a>mc_clu3 <span class="ot">&lt;-</span> <span class="fu">fitMarkovChain</span>(<span class="at">clickstreamList =</span> clusters<span class="sc">$</span>clusters[[<span class="dv">3</span>]], <span class="at">order =</span> <span class="dv">2</span>,<span class="at">control =</span> <span class="fu">list</span>(<span class="at">optimizer =</span> <span class="st">&quot;quadratic&quot;</span>))</span>
<span id="cb720-7"><a href="customer-behavior.html#cb720-7" aria-hidden="true" tabindex="-1"></a><span class="co">#mc_clu3</span></span>
<span id="cb720-8"><a href="customer-behavior.html#cb720-8" aria-hidden="true" tabindex="-1"></a><span class="co"># or write these objects to ï¬le with writeClickstreams().</span></span></code></pre></div>
<pre><code>## Higher-Order Markov Chain (order=2)
## 
## Transition Probabilities:
## 
## Lag:  1 
## lambda:  1.827629e-07 
##       Buy Defer          P1         P2         P3         P4         P5
## Buy     0     0 0.001686989 0.00000000 0.07251001 0.14067671 0.02299401
## Defer   0     0 0.409316917 0.24847352 0.29050409 0.19693388 0.15892216
## P1      0     0 0.010417900 0.12944589 0.08770810 0.16718444 0.24634731
## P2      0     0 0.067538771 0.00000000 0.15215500 0.09097049 0.11059880
## P3      0     0 0.040517343 0.12108838 0.03677708 0.06135612 0.14754491
## P4      0     0 0.172043329 0.07697298 0.13927722 0.00000000 0.15395210
## P5      0     0 0.083609566 0.10406808 0.10255815 0.04197339 0.00000000
## P6      0     0 0.118592400 0.13398718 0.08515575 0.14104815 0.04287425
## P7      0     0 0.096276785 0.18596397 0.03335460 0.15985682 0.11676647
##               P6         P7
## Buy   0.10823498 0.04101702
## Defer 0.25697425 0.16453036
## P1    0.13505901 0.21710443
## P2    0.12303290 0.06245009
## P3    0.04130901 0.06963648
## P4    0.16881259 0.19109057
## P5    0.05552575 0.09266653
## P6    0.00000000 0.13910485
## P7    0.11105150 0.02239966
## 
## Lag:  2 
## lambda:  0.9999998 
##       Buy Defer         P1         P2         P3         P4         P5
## Buy     0     0 0.07884026 0.06494694 0.06283581 0.04149674 0.05277412
## Defer   0     0 0.21581830 0.26633829 0.27401876 0.28757137 0.33479725
## P1      0     0 0.17762926 0.13964353 0.13696385 0.12943515 0.11125750
## P2      0     0 0.08507110 0.12679632 0.06183408 0.06953507 0.06799883
## P3      0     0 0.06858952 0.06118926 0.11292232 0.05454731 0.03879373
## P4      0     0 0.11245666 0.12278475 0.09926236 0.17511215 0.09800908
## P5      0     0 0.05557510 0.05022089 0.06028595 0.06479405 0.10452350
## P6      0     0 0.08994523 0.09074290 0.08077589 0.08753059 0.10847606
## P7      0     0 0.11607457 0.07733712 0.11110099 0.08997757 0.08336993
##               P6         P7
## Buy   0.06035636 0.06485400
## Defer 0.26579337 0.28263860
## P1    0.14226354 0.12066229
## P2    0.05500387 0.08516716
## P3    0.04993309 0.06257935
## P4    0.10986689 0.11997461
## P5    0.06035636 0.05184088
## P6    0.14409465 0.08553745
## P7    0.11233185 0.12674566
## 
## Start Probabilities:
## 
##         P1         P2         P3         P4         P5         P6         P7 
## 0.21383076 0.23733697 0.09859342 0.16092281 0.08890658 0.09817637 0.10223309 
## 
## End Probabilities:
## 
##       Buy     Defer 
## 0.1754246 0.8245754</code></pre>
<p>We see that this construct the same output as we have previously seen, when just analyzing one session.</p>
</div>
</div>
<div id="second-exercise-clickstream-more-extensive" class="section level3" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> Second exercise (clickstream) more extensive</h3>
<ol start="2" style="list-style-type: decimal">
<li>Full example with simulated data:</li>
</ol>
<ul>
<li>clickstreams for 100,000 user sessions</li>
<li>clicks are either 1 of 7 products or on one of the two ï¬nal states âBuyâ and âDeferâ.</li>
</ul>
<div class="sourceCode" id="cb722"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb722-1"><a href="customer-behavior.html#cb722-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb722-2"><a href="customer-behavior.html#cb722-2" aria-hidden="true" tabindex="-1"></a>cls <span class="ot">&lt;-</span> <span class="fu">randomClickstreams</span>(<span class="at">states =</span> <span class="fu">c</span>(<span class="st">&quot;P1&quot;</span>, <span class="st">&quot;P2&quot;</span>, <span class="st">&quot;P3&quot;</span>, <span class="st">&quot;P4&quot;</span>, <span class="st">&quot;P5&quot;</span>, <span class="st">&quot;P6&quot;</span>, <span class="st">&quot;P7&quot;</span>, <span class="st">&quot;Defer&quot;</span>, <span class="st">&quot;Buy&quot;</span>),</span>
<span id="cb722-3"><a href="customer-behavior.html#cb722-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">startProbabilities =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.25</span>, <span class="fl">0.1</span>, <span class="fl">0.15</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb722-4"><a href="customer-behavior.html#cb722-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">transitionMatrix =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.09</span>, <span class="fl">0.05</span>, <span class="fl">0.21</span>, <span class="fl">0.12</span>, <span class="fl">0.17</span>, <span class="fl">0.11</span>, <span class="fl">0.2</span>, <span class="fl">0.04</span>,</span>
<span id="cb722-5"><a href="customer-behavior.html#cb722-5" aria-hidden="true" tabindex="-1"></a>                                                      <span class="fl">0.1</span>, <span class="dv">0</span>, <span class="fl">0.29</span>, <span class="fl">0.06</span>, <span class="fl">0.11</span>, <span class="fl">0.13</span>, <span class="fl">0.21</span>, <span class="fl">0.1</span>, <span class="dv">0</span>,</span>
<span id="cb722-6"><a href="customer-behavior.html#cb722-6" aria-hidden="true" tabindex="-1"></a>                                                      <span class="fl">0.07</span>, <span class="fl">0.16</span>, <span class="fl">0.03</span>, <span class="fl">0.25</span>, <span class="fl">0.23</span>, <span class="fl">0.08</span>, <span class="fl">0.03</span>, <span class="fl">0.12</span>, <span class="fl">0.03</span>,</span>
<span id="cb722-7"><a href="customer-behavior.html#cb722-7" aria-hidden="true" tabindex="-1"></a>                                                      <span class="fl">0.16</span>, <span class="fl">0.14</span>, <span class="fl">0.07</span>, <span class="dv">0</span>, <span class="fl">0.05</span>, <span class="fl">0.22</span>, <span class="fl">0.19</span>, <span class="fl">0.1</span>, <span class="fl">0.07</span>,</span>
<span id="cb722-8"><a href="customer-behavior.html#cb722-8" aria-hidden="true" tabindex="-1"></a>                                                      <span class="fl">0.24</span>, <span class="fl">0.27</span>, <span class="fl">0.17</span>, <span class="fl">0.13</span>, <span class="dv">0</span>, <span class="fl">0.03</span>, <span class="fl">0.09</span>, <span class="fl">0.06</span>, <span class="fl">0.01</span>,</span>
<span id="cb722-9"><a href="customer-behavior.html#cb722-9" aria-hidden="true" tabindex="-1"></a>                                                      <span class="fl">0.11</span>, <span class="fl">0.18</span>, <span class="fl">0.04</span>, <span class="fl">0.15</span>, <span class="fl">0.26</span>, <span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.11</span>, <span class="fl">0.05</span>,</span>
<span id="cb722-10"><a href="customer-behavior.html#cb722-10" aria-hidden="true" tabindex="-1"></a>                                                      <span class="fl">0.21</span>, <span class="fl">0.07</span>, <span class="fl">0.08</span>, <span class="fl">0.2</span>, <span class="fl">0.14</span>, <span class="fl">0.18</span>, <span class="fl">0.02</span>, <span class="fl">0.08</span>, <span class="fl">0.02</span>,</span>
<span id="cb722-11"><a href="customer-behavior.html#cb722-11" aria-hidden="true" tabindex="-1"></a>                                                      <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,</span>
<span id="cb722-12"><a href="customer-behavior.html#cb722-12" aria-hidden="true" tabindex="-1"></a>                                                      <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">nrow =</span> <span class="dv">9</span>),</span>
<span id="cb722-13"><a href="customer-behavior.html#cb722-13" aria-hidden="true" tabindex="-1"></a>                          <span class="at">meanLength =</span> <span class="dv">50</span>, <span class="at">n =</span> <span class="dv">100000</span>)</span>
<span id="cb722-14"><a href="customer-behavior.html#cb722-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb722-15"><a href="customer-behavior.html#cb722-15" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cls)</span></code></pre></div>
<pre><code>## Observations: 100000
## 
## Click Frequencies:
##    Buy  Defer     P1     P2     P3     P4     P5     P6     P7 
##  22087  77813 108767 113760  86334 111054  97129  93397  89521</code></pre>
<p>Here we want to select the right orders. Here we test all the models in order 1 to 5 and then we evaluate BIC for each.</p>
<div class="sourceCode" id="cb724"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb724-1"><a href="customer-behavior.html#cb724-1" aria-hidden="true" tabindex="-1"></a>maxOrder <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="co">#Max no. of previous steps to evaluate</span></span>
<span id="cb724-2"><a href="customer-behavior.html#cb724-2" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb724-3"><a href="customer-behavior.html#cb724-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>maxOrder) {</span>
<span id="cb724-4"><a href="customer-behavior.html#cb724-4" aria-hidden="true" tabindex="-1"></a>  mc <span class="ot">&lt;-</span> <span class="fu">fitMarkovChain</span>(<span class="at">clickstreamList =</span> cls, <span class="at">order =</span> k)</span>
<span id="cb724-5"><a href="customer-behavior.html#cb724-5" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">rbind</span>(result, <span class="fu">c</span>(k, <span class="fu">summary</span>(mc)<span class="sc">$</span>aic, <span class="fu">summary</span>(mc)<span class="sc">$</span>bic))</span>
<span id="cb724-6"><a href="customer-behavior.html#cb724-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb724-7"><a href="customer-behavior.html#cb724-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(result) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Order&quot;</span>, <span class="st">&quot;AIC&quot;</span>, <span class="st">&quot;BIC&quot;</span>)</span>
<span id="cb724-8"><a href="customer-behavior.html#cb724-8" aria-hidden="true" tabindex="-1"></a>result</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">Order</th>
<th align="right">AIC</th>
<th align="right">BIC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">2685427</td>
<td align="right">2685543</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">2684008</td>
<td align="right">2684240</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">2684028</td>
<td align="right">2684376</td>
</tr>
</tbody>
</table>
</div>
<p>We see that order 2 has the BIC closest to 0, hence we go for order 2.</p>
<p>Now we can fit the model with order of 2.</p>
<div class="sourceCode" id="cb725"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb725-1"><a href="customer-behavior.html#cb725-1" aria-hidden="true" tabindex="-1"></a>mc <span class="ot">&lt;-</span> <span class="fu">fitMarkovChain</span>(<span class="at">clickstreamList =</span> cls, <span class="at">order =</span> <span class="dv">2</span>,<span class="at">control =</span> <span class="fu">list</span>(<span class="at">optimizer =</span> <span class="st">&quot;quadratic&quot;</span>)) </span>
<span id="cb725-2"><a href="customer-behavior.html#cb725-2" aria-hidden="true" tabindex="-1"></a>mc</span></code></pre></div>
<pre><code>## Higher-Order Markov Chain (order=2)
## 
## Transition Probabilities:
## 
## Lag:  1 
## lambda:  7.079784e-07 
##       Buy Defer          P1         P2         P3         P4          P5
## Buy     0     0 0.039501632 0.00000000 0.03064073 0.07110759 0.009401419
## Defer   0     0 0.199503471 0.10094510 0.12058200 0.09960106 0.060650994
## P1      0     0 0.009930578 0.09992527 0.06965699 0.15993804 0.239370630
## P2      0     0 0.089559101 0.00000000 0.15996895 0.14024297 0.270169802
## P3      0     0 0.050360903 0.28887424 0.03023528 0.07051322 0.170749539
## P4      0     0 0.211217875 0.06064442 0.25092965 0.00000000 0.129766355
## P5      0     0 0.119792193 0.10907732 0.22918573 0.04959340 0.000000000
## P6      0     0 0.170373776 0.12951778 0.07977017 0.21838387 0.030088660
## P7      0     0 0.109760471 0.21101587 0.02903050 0.19061985 0.089802601
##               P6         P7
## Buy   0.04810452 0.02061383
## Defer 0.10859927 0.07970683
## P1    0.10997001 0.21173592
## P2    0.18031698 0.07041105
## P3    0.04091883 0.07967331
## P4    0.15257014 0.19915534
## P5    0.25834226 0.13887803
## P6    0.00000000 0.17937946
## P7    0.10117798 0.02044624
## 
## Lag:  2 
## lambda:  0.9999993 
##       Buy Defer         P1         P2         P3         P4         P5
## Buy     0     0 0.03672596 0.03262847 0.03258258 0.02782575 0.02884072
## Defer   0     0 0.09619568 0.10976898 0.09852580 0.11737426 0.12829913
## P1      0     0 0.15427563 0.12793177 0.15196560 0.11579942 0.09013280
## P2      0     0 0.14320588 0.14653469 0.14737920 0.11048842 0.08503804
## P3      0     0 0.10326534 0.06499286 0.13355173 0.10050721 0.12078991
## P4      0     0 0.10973075 0.18770173 0.09423969 0.16624852 0.14390457
## P5      0     0 0.12147726 0.15971910 0.08050778 0.16132851 0.13310592
## P6      0     0 0.11518103 0.10580779 0.12027027 0.10367860 0.14296315
## P7      0     0 0.11994248 0.06491461 0.14097734 0.09674932 0.12692576
##               P6         P7
## Buy   0.02682348 0.03923590
## Defer 0.09854325 0.11979432
## P1    0.15346025 0.11550930
## P2    0.13606056 0.14726814
## P3    0.14350305 0.08999789
## P4    0.11552383 0.13125831
## P5    0.07559343 0.12250196
## P6    0.12466820 0.11341026
## P7    0.12582395 0.12102393
## 
## Start Probabilities:
## 
##      P1      P2      P3      P4      P5      P6      P7 
## 0.20082 0.25261 0.10025 0.14850 0.09849 0.10023 0.09910 
## 
## End Probabilities:
## 
##     Buy   Defer      P1      P2      P3      P4      P5      P6      P7 
## 0.22087 0.77813 0.00012 0.00015 0.00011 0.00011 0.00016 0.00017 0.00018</code></pre>
<p>We see:</p>
<ol style="list-style-type: decimal">
<li>Transition probabilities between different pages and outcomes both at lag 1 and lag 2 (that is two steps back)</li>
<li>Start probabilities: there is the highest chance of starting on page 2.</li>
<li>End probabilities: We see the probabilities of ending on different pages or in the absorbing stages, buying or deferring.</li>
</ol>
<p>Now we can start making predictions.</p>
<p>We see that for a customer visits product 3 and 4</p>
<div class="sourceCode" id="cb727"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb727-1"><a href="customer-behavior.html#cb727-1" aria-hidden="true" tabindex="-1"></a>pattern <span class="ot">&lt;-</span> <span class="fu">new</span>(<span class="st">&quot;Pattern&quot;</span>, <span class="at">sequence =</span> <span class="fu">c</span>(<span class="st">&quot;P3&quot;</span>, <span class="st">&quot;P4&quot;</span>) <span class="co">#If a person visit P3 and then P4</span></span>
<span id="cb727-2"><a href="customer-behavior.html#cb727-2" aria-hidden="true" tabindex="-1"></a>               , <span class="at">absorbingProbabilities =</span> <span class="fu">data.frame</span>(<span class="at">Buy =</span> <span class="fl">0.22</span> <span class="co">#mc@end[&quot;Buy&quot;] </span></span>
<span id="cb727-3"><a href="customer-behavior.html#cb727-3" aria-hidden="true" tabindex="-1"></a>                                                     , <span class="at">Defer =</span> <span class="fl">0.78</span> <span class="co">#mc@end[&quot;Defer&quot;]</span></span>
<span id="cb727-4"><a href="customer-behavior.html#cb727-4" aria-hidden="true" tabindex="-1"></a>                                                     )</span>
<span id="cb727-5"><a href="customer-behavior.html#cb727-5" aria-hidden="true" tabindex="-1"></a>               )</span>
<span id="cb727-6"><a href="customer-behavior.html#cb727-6" aria-hidden="true" tabindex="-1"></a>resultPattern <span class="ot">&lt;-</span> <span class="fu">predict</span>(mc, <span class="at">startPattern =</span> pattern, <span class="at">dist =</span> <span class="dv">1</span>) <span class="co">#Pred one step ahead</span></span>
<span id="cb727-7"><a href="customer-behavior.html#cb727-7" aria-hidden="true" tabindex="-1"></a>resultPattern</span></code></pre></div>
<pre><code>## Sequence: P1
## Probability: 0.1535398
## Absorbing Probabilities: 
##          Buy     Defer
## 1 0.06993633 0.9300637</code></pre>
<p>We see that there is a 15% chance of visiting page 1, and 7% chance of buying.</p>
<p>Now we do some <strong>clustering.</strong> Hence, we predict for clusters instead of depicted clickstreams.</p>
<div class="sourceCode" id="cb729"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb729-1"><a href="customer-behavior.html#cb729-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doParallel)</span>
<span id="cb729-2"><a href="customer-behavior.html#cb729-2" aria-hidden="true" tabindex="-1"></a>CoreCount  <span class="ot">&lt;-</span> <span class="fu">makePSOCKcluster</span>(<span class="fu">detectCores</span>()<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb729-3"><a href="customer-behavior.html#cb729-3" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoParallel</span>(CoreCount)</span>
<span id="cb729-4"><a href="customer-behavior.html#cb729-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb729-5"><a href="customer-behavior.html#cb729-5" aria-hidden="true" tabindex="-1"></a>clusters_sim <span class="ot">&lt;-</span> <span class="fu">clusterClickstreams</span>(<span class="at">clickstreamList =</span> cls, <span class="at">order =</span> <span class="dv">1</span>, <span class="at">centers =</span> <span class="dv">3</span>)  <span class="co"># takes 5-10 min. to converge</span></span>
<span id="cb729-6"><a href="customer-behavior.html#cb729-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb729-7"><a href="customer-behavior.html#cb729-7" aria-hidden="true" tabindex="-1"></a><span class="fu">stopCluster</span>(CoreCount)</span>
<span id="cb729-8"><a href="customer-behavior.html#cb729-8" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoSEQ</span>()</span>
<span id="cb729-9"><a href="customer-behavior.html#cb729-9" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(clusters_sim,<span class="st">&quot;Saved Objects/clusters_sim.rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb730"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb730-1"><a href="customer-behavior.html#cb730-1" aria-hidden="true" tabindex="-1"></a>clusters_sim <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;Saved Objects/clusters_sim.rds&quot;</span>)</span></code></pre></div>
<p>Now we could look at each cluster, I choose not to. It is basically what we have seen before with the transition probabilities, start and end probabilities.</p>
<div class="sourceCode" id="cb731"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb731-1"><a href="customer-behavior.html#cb731-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(clusters_sim<span class="sc">$</span>clusters[[<span class="dv">1</span>]]) </span>
<span id="cb731-2"><a href="customer-behavior.html#cb731-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(clusters_sim<span class="sc">$</span>clusters[[<span class="dv">2</span>]]) </span>
<span id="cb731-3"><a href="customer-behavior.html#cb731-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(clusters_sim<span class="sc">$</span>clusters[[<span class="dv">3</span>]])</span></code></pre></div>
<pre><code>## Observations: 17080
## 
## Click Frequencies:
##   Buy Defer    P1    P2    P3    P4    P5    P6    P7 
##  3918 13156 18019 30752 32478 22749 19522 15591 13843 
## Observations: 34059
## 
## Click Frequencies:
##   Buy Defer    P1    P2    P3    P4    P5    P6    P7 
##  7821 26144 59025 63554 39576 61161 62488 59616 57113 
## Observations: 48861
## 
## Click Frequencies:
##   Buy Defer    P1    P2    P3    P4    P5    P6    P7 
## 10348 38513 31723 19454 14280 27144 15119 18190 18565</code></pre>
<p>Now we can loop through the the no. of steps to use for prediction. The following is merely for cluster 1.</p>
<div class="sourceCode" id="cb733"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb733-1"><a href="customer-behavior.html#cb733-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mc for clu 1 </span></span>
<span id="cb733-2"><a href="customer-behavior.html#cb733-2" aria-hidden="true" tabindex="-1"></a>maxOrder <span class="ot">&lt;-</span> <span class="dv">3</span> </span>
<span id="cb733-3"><a href="customer-behavior.html#cb733-3" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb733-4"><a href="customer-behavior.html#cb733-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>maxOrder) {</span>
<span id="cb733-5"><a href="customer-behavior.html#cb733-5" aria-hidden="true" tabindex="-1"></a>  mc <span class="ot">&lt;-</span> <span class="fu">fitMarkovChain</span>(<span class="at">clickstreamList =</span> clusters_sim<span class="sc">$</span>clusters[[<span class="dv">1</span>]], <span class="at">order =</span> k)</span>
<span id="cb733-6"><a href="customer-behavior.html#cb733-6" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">rbind</span>(result, <span class="fu">c</span>(k, <span class="fu">summary</span>(mc)<span class="sc">$</span>aic, <span class="fu">summary</span>(mc)<span class="sc">$</span>bic))</span>
<span id="cb733-7"><a href="customer-behavior.html#cb733-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb733-8"><a href="customer-behavior.html#cb733-8" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(result) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Order&quot;</span>, <span class="st">&quot;AIC&quot;</span>, <span class="st">&quot;BIC&quot;</span>)</span>
<span id="cb733-9"><a href="customer-behavior.html#cb733-9" aria-hidden="true" tabindex="-1"></a>result</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">Order</th>
<th align="right">AIC</th>
<th align="right">BIC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">536232.5</td>
<td align="right">536333.0</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">536252.5</td>
<td align="right">536453.4</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">536272.5</td>
<td align="right">536573.8</td>
</tr>
</tbody>
</table>
</div>
<p>We see that the best model is an order 1, as BIC is closest to 0.</p>
<div class="sourceCode" id="cb734"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb734-1"><a href="customer-behavior.html#cb734-1" aria-hidden="true" tabindex="-1"></a>mc_clu1 <span class="ot">&lt;-</span> <span class="fu">fitMarkovChain</span>(<span class="at">clickstreamList =</span> clusters_sim<span class="sc">$</span>clusters[[<span class="dv">1</span>]], <span class="at">order =</span> <span class="dv">1</span>) </span>
<span id="cb734-2"><a href="customer-behavior.html#cb734-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mc_clu1)</span></code></pre></div>
<pre><code>## First-Order Markov Chain with 9 states.
##  The Markov Chain has absorbing states.
## 
## Observations: 170028
## LogLikelihood: -268106.3
## AIC: 536232.5
## BIC: 536333</code></pre>
<p>We see that there are states and also includes absorbing states. Based on this model we can also make predictions</p>
<div class="sourceCode" id="cb736"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb736-1"><a href="customer-behavior.html#cb736-1" aria-hidden="true" tabindex="-1"></a>pattern <span class="ot">&lt;-</span> <span class="fu">new</span>(<span class="st">&quot;Pattern&quot;</span>, <span class="at">sequence =</span> <span class="fu">c</span>(<span class="st">&quot;P1&quot;</span>, <span class="st">&quot;P4&quot;</span>, <span class="st">&quot;P6&quot;</span>)</span>
<span id="cb736-2"><a href="customer-behavior.html#cb736-2" aria-hidden="true" tabindex="-1"></a>               ,<span class="at">absorbingProbabilities =</span> <span class="fu">data.frame</span>(<span class="at">Buy =</span> <span class="fl">0.22</span>, <span class="at">Defer =</span> <span class="fl">0.78</span>))</span>
<span id="cb736-3"><a href="customer-behavior.html#cb736-3" aria-hidden="true" tabindex="-1"></a>resultPattern <span class="ot">&lt;-</span> <span class="fu">predict</span>(mc_clu1, <span class="at">startPattern =</span> pattern, <span class="at">dist =</span> <span class="dv">1</span>)</span>
<span id="cb736-4"><a href="customer-behavior.html#cb736-4" aria-hidden="true" tabindex="-1"></a>resultPattern</span></code></pre></div>
<pre><code>## Sequence: P2
## Probability: 0.2730418
## Absorbing Probabilities: 
##          Buy     Defer
## 1 0.07744942 0.9225506</code></pre>
<p>Hence a person that cluster of clickstreams will have a 7.7% chance of buying something.</p>
</div>
<div id="a-concrete-eaxmple-with-real-data" class="section level3" number="5.2.3">
<h3><span class="header-section-number">5.2.3</span> A concrete eaxmple with real data</h3>
<p>The following sections include four different options.</p>
<ol style="list-style-type: decimal">
<li>Applying the Markov Chain model.</li>
<li>Modeling click streams with higher-order. This is basically what we saw in the latent trait model, where we just needed to know the maturity to estimate how likely a person is to have other financial services.</li>
<li>Use frequencies of events instead of sequences.</li>
<li>Use neural networks, either with sequence data or not.</li>
</ol>
<div id="markov-chain" class="section level4" number="5.2.3.1">
<h4><span class="header-section-number">5.2.3.1</span> (1) Markov Chain</h4>
<p>Example with real data (A Danish company provided us with a file of clickstream data on their e-commerce customers).</p>
<div class="sourceCode" id="cb738"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb738-1"><a href="customer-behavior.html#cb738-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(clickstream)</span>
<span id="cb738-2"><a href="customer-behavior.html#cb738-2" aria-hidden="true" tabindex="-1"></a>mydata  <span class="ot">&lt;-</span> <span class="fu">readClickstreams</span>(<span class="at">file =</span> <span class="st">&quot;Data/Customer behavior/StepsDesktop.csv&quot;</span>, <span class="at">sep=</span><span class="st">&quot;,&quot;</span>,<span class="at">header =</span> T)</span>
<span id="cb738-3"><a href="customer-behavior.html#cb738-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mydata)</span></code></pre></div>
<pre><code>## Observations: 37644
## 
## Click Frequencies:
##            AddCartPage               CartPage           CategoryPage 
##                   6026                   7704                  76699 
##              ChannelAd    ChannelDirectAccess           ChannelOther 
##                  38483                  13052                    828 
## ChannelPriceComparison    ChannelSearchEngine  ChannelSocialNetworks 
##                   5294                  19093                    521 
##         ChannelWebmail             Conversion           DeliveryPage 
##                   3686                   2095                   2901 
##           DiscountPage              FrontPage            LandingPage 
##                  13887                  13932                   5976 
##              OtherPage         ProductDetails            ProductPage 
##                   7918                  60901                  82347 
##         Recommendation         SearchFunction 
##                   2002                   7015</code></pre>
<p>We see that there are 37k observations and then we can see the frequencies of the different events and 20 different pages.</p>
<p>Now we are going to analyze which order to apply.</p>
<div class="sourceCode" id="cb740"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb740-1"><a href="customer-behavior.html#cb740-1" aria-hidden="true" tabindex="-1"></a>maxOrder <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="co">#One could also use 5 for instance</span></span>
<span id="cb740-2"><a href="customer-behavior.html#cb740-2" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb740-3"><a href="customer-behavior.html#cb740-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>maxOrder) {</span>
<span id="cb740-4"><a href="customer-behavior.html#cb740-4" aria-hidden="true" tabindex="-1"></a>  mc <span class="ot">&lt;-</span> <span class="fu">fitMarkovChain</span>(<span class="at">clickstreamList =</span> mydata, <span class="at">order =</span> k)</span>
<span id="cb740-5"><a href="customer-behavior.html#cb740-5" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">rbind</span>(result, <span class="fu">c</span>(k, <span class="fu">summary</span>(mc)<span class="sc">$</span>aic, <span class="fu">summary</span>(mc)<span class="sc">$</span>bic))</span>
<span id="cb740-6"><a href="customer-behavior.html#cb740-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb740-7"><a href="customer-behavior.html#cb740-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(result) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Order&quot;</span>, <span class="st">&quot;AIC&quot;</span>, <span class="st">&quot;BIC&quot;</span>)</span>
<span id="cb740-8"><a href="customer-behavior.html#cb740-8" aria-hidden="true" tabindex="-1"></a>result</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">Order</th>
<th align="right">AIC</th>
<th align="right">BIC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">970364.6</td>
<td align="right">970591.8</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">970406.6</td>
<td align="right">970861.1</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">970448.6</td>
<td align="right">971130.4</td>
</tr>
</tbody>
</table>
</div>
<p>We see that order of 1, i.e., looking one step back in time is the most appropriate.</p>
<div class="sourceCode" id="cb741"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb741-1"><a href="customer-behavior.html#cb741-1" aria-hidden="true" tabindex="-1"></a>mc <span class="ot">&lt;-</span> <span class="fu">fitMarkovChain</span>(<span class="at">clickstreamList =</span> mydata, <span class="at">order =</span> <span class="dv">1</span></span>
<span id="cb741-2"><a href="customer-behavior.html#cb741-2" aria-hidden="true" tabindex="-1"></a>                     ,<span class="at">control =</span> <span class="fu">list</span>(<span class="at">optimizer =</span> <span class="st">&quot;quadratic&quot;</span>)) </span>
<span id="cb741-3"><a href="customer-behavior.html#cb741-3" aria-hidden="true" tabindex="-1"></a>mc</span></code></pre></div>
<pre><code>## First-Order Markov Chain
## 
## Transition Probabilities:
## 
## Lag:  1 
## lambda:  1 
##                         AddCartPage     CartPage CategoryPage    ChannelAd
## AddCartPage            0.0493515243 0.0019632590 2.818071e-04 7.800312e-05
## CartPage               0.6769412161 0.1681391109 5.102192e-03 1.040042e-04
## CategoryPage           0.1305373084 0.0607207965 3.514580e-01 3.218149e-01
## ChannelAd              0.0109482904 0.0841396719 7.780843e-02 1.333853e-02
## ChannelDirectAccess    0.0070742799 0.0556724162 2.705348e-02 1.300052e-04
## ChannelOther           0.0001684352 0.0162670032 1.542523e-03 2.600104e-05
## ChannelPriceComparison 0.0037055752 0.0192118917 4.360594e-03 2.600104e-05
## ChannelSearchEngine    0.0047161866 0.0152853737 3.381686e-02 7.800312e-05
## ChannelSocialNetworks  0.0001684352 0.0004206984 1.186556e-04 0.000000e+00
## ChannelWebmail         0.0016843524 0.0015425607 2.091306e-03 2.600104e-05
## Conversion             0.0001684352 0.2371336418 1.483195e-04 5.200208e-05
## DeliveryPage           0.0010106114 0.0440330949 1.231052e-03 1.976079e-03
## DiscountPage           0.0101061142 0.0025241902 8.973332e-03 4.581383e-02
## FrontPage              0.0020212228 0.0486607769 3.618997e-03 6.960478e-02
## LandingPage            0.0188647465 0.0186509606 1.256267e-02 4.394176e-03
## OtherPage              0.0026949638 0.0065909410 3.767316e-03 7.020281e-03
## ProductDetails         0.0375610578 0.0016827934 2.209961e-03 5.200208e-04
## ProductPage            0.0053899276 0.1918384518 4.446916e-01 5.348414e-01
## Recommendation         0.0028633990 0.0002804656 2.966391e-05 7.800312e-05
## SearchFunction         0.0340239178 0.0252419016 1.913322e-02 7.800312e-05
##                        ChannelDirectAccess ChannelOther ChannelPriceComparison
## AddCartPage                   0.000000e+00  0.000000000           0.0003779289
## CartPage                      7.444359e-03  0.001207729           0.0000000000
## CategoryPage                  1.336147e-01  0.304347826           0.0464852608
## ChannelAd                     3.837299e-03  0.006038647           0.0188964475
## ChannelDirectAccess           9.976976e-03  0.001207729           0.0003779289
## ChannelOther                  7.674597e-05  0.003623188           0.0000000000
## ChannelPriceComparison        1.534919e-04  0.000000000           0.0005668934
## ChannelSearchEngine           2.302379e-04  0.000000000           0.0001889645
## ChannelSocialNetworks         0.000000e+00  0.000000000           0.0000000000
## ChannelWebmail                0.000000e+00  0.000000000           0.0000000000
## Conversion                    6.139678e-04  0.111111111           0.0000000000
## DeliveryPage                  1.373753e-02  0.002415459           0.0000000000
## DiscountPage                  2.363776e-02  0.032608696           0.0001889645
## FrontPage                     4.698388e-01  0.068840580           0.0026455026
## LandingPage                   2.993093e-03  0.004830918           0.0003779289
## OtherPage                     1.106677e-01  0.251207729           0.0005668934
## ProductDetails                7.674597e-05  0.000000000           0.0005668934
## ProductPage                   2.214889e-01  0.212560386           0.9287603930
## Recommendation                0.000000e+00  0.000000000           0.0000000000
## SearchFunction                1.611665e-03  0.000000000           0.0000000000
##                        ChannelSearchEngine ChannelSocialNetworks ChannelWebmail
## AddCartPage                   0.000000e+00           0.000000000   0.0000000000
## CartPage                      0.000000e+00           0.000000000   0.0000000000
## CategoryPage                  3.674945e-01           0.015355086   0.0607869742
## ChannelAd                     8.959447e-03           0.011516315   0.0005427408
## ChannelDirectAccess           2.095777e-04           0.000000000   0.0000000000
## ChannelOther                  0.000000e+00           0.000000000   0.0000000000
## ChannelPriceComparison        0.000000e+00           0.000000000   0.0000000000
## ChannelSearchEngine           2.462538e-03           0.000000000   0.0000000000
## ChannelSocialNetworks         0.000000e+00           0.007677543   0.0000000000
## ChannelWebmail                0.000000e+00           0.000000000   0.0111261872
## Conversion                    0.000000e+00           0.000000000   0.0000000000
## DeliveryPage                  2.981243e-02           0.078694818   0.0008141113
## DiscountPage                  1.226030e-02           0.013435701   0.4770691995
## FrontPage                     1.822278e-01           0.032629559   0.0075983718
## LandingPage                   9.430997e-04           0.000000000   0.3869742198
## OtherPage                     5.464739e-02           0.163147793   0.0301221167
## ProductDetails                2.095777e-04           0.000000000   0.0000000000
## ProductPage                   3.406162e-01           0.677543186   0.0249660787
## Recommendation                5.239443e-05           0.000000000   0.0000000000
## SearchFunction                1.047889e-04           0.000000000   0.0000000000
##                        Conversion DeliveryPage DiscountPage    FrontPage
## AddCartPage                     0 0.0061269147 0.0023935716 9.869233e-04
## CartPage                        0 0.0695842451 0.0173533937 1.891603e-02
## CategoryPage                    0 0.1404814004 0.0877073004 4.233078e-01
## ChannelAd                       0 0.0783369803 0.0888186015 6.743976e-02
## ChannelDirectAccess             0 0.1982494530 0.0259018636 4.605642e-02
## ChannelOther                    0 0.0109409190 0.0022226022 2.796283e-03
## ChannelPriceComparison          0 0.0157549234 0.0056419901 2.467308e-03
## ChannelSearchEngine             0 0.0494529540 0.0199179347 4.079283e-02
## ChannelSocialNetworks           0 0.0035010941 0.0004274235 8.224361e-04
## ChannelWebmail                  0 0.0048140044 0.0379552060 1.069167e-03
## Conversion                      0 0.0678336980 0.0033339032 1.151410e-03
## DeliveryPage                    0 0.0879649891 0.0014532399 4.046385e-02
## DiscountPage                    0 0.0056892779 0.0999316122 5.567892e-02
## FrontPage                       0 0.0354485777 0.0090613780 1.982071e-02
## LandingPage                     0 0.0218818381 0.0830911267 6.143597e-02
## OtherPage                       0 0.1282275711 0.0039322961 3.939469e-02
## ProductDetails                  0 0.0135667396 0.0054710207 2.385065e-03
## ProductPage                     0 0.0297592998 0.4786288254 1.611975e-02
## Recommendation                  0 0.0008752735 0.0000854847 8.224361e-05
## SearchFunction                  0 0.0315098468 0.0266712259 1.588124e-01
##                         LandingPage    OtherPage ProductDetails  ProductPage
## AddCartPage            0.0007010165 0.0010223207   0.0267259774 0.0590180361
## CartPage               0.0089379600 0.0236837621   0.0065458754 0.0120240481
## CategoryPage           0.1025236593 0.0811041063   0.1618205490 0.1696822216
## ChannelAd              0.0378548896 0.0618504004   0.0702506238 0.1173203550
## ChannelDirectAccess    0.0092884683 0.1269381496   0.0198546165 0.0353564271
## ChannelOther           0.0005257624 0.0086897257   0.0017178402 0.0030346407
## ChannelPriceComparison 0.0045566071 0.0073266315   0.0094209974 0.0211279702
## ChannelSearchEngine    0.0099894848 0.0381666383   0.0284619001 0.0440881764
## ChannelSocialNetworks  0.0003505082 0.0020446413   0.0007233011 0.0010020040
## ChannelWebmail         0.0050823694 0.0103935935   0.0057683266 0.0054108216
## Conversion             0.0012267788 0.0032373488   0.0001627428 0.0006298311
## DeliveryPage           0.0015772871 0.1191003578   0.0010126216 0.0018608646
## DiscountPage           0.7313354364 0.0064746976   0.0232541319 0.0244918408
## FrontPage              0.0049071153 0.0153348100   0.0019890782 0.0032350415
## LandingPage            0.0241850683 0.0189129324   0.0077031572 0.0104494704
## OtherPage              0.0182264283 0.2361560743   0.0043940545 0.0073575723
## ProductDetails         0.0012267788 0.0023854149   0.5846623992 0.3992127111
## ProductPage            0.0154223624 0.1753279945   0.0283714875 0.0527626682
## Recommendation         0.0000000000 0.0001703868   0.0090412643 0.0128399656
## SearchFunction         0.0220820189 0.0616800136   0.0081190554 0.0190953335
##                        Recommendation SearchFunction
## AddCartPage              0.0051894136   0.0030684259
## CartPage                 0.0031136482   0.0076710647
## CategoryPage             0.0259470680   0.2339674747
## ChannelAd                0.0254281266   0.0328321571
## ChannelDirectAccess      0.0046704722   0.0170297637
## ChannelOther             0.0005189414   0.0006136852
## ChannelPriceComparison   0.0046704722   0.0053697453
## ChannelSearchEngine      0.0072651790   0.0173366063
## ChannelSocialNetworks    0.0000000000   0.0004602639
## ChannelWebmail           0.0010378827   0.0010739491
## Conversion               0.0000000000   0.0006136852
## DeliveryPage             0.0010378827   0.0033752685
## DiscountPage             0.0062272963   0.0042957963
## FrontPage                0.0015568241   0.0078244860
## LandingPage              0.0031136482   0.0070573796
## OtherPage                0.0015568241   0.2103405953
## ProductDetails           0.0295796575   0.0099723842
## ProductPage              0.5718733783   0.3275544646
## Recommendation           0.2968344577   0.0004602639
## SearchFunction           0.0103788272   0.1090825407
## 
## Start Probabilities:
## 
##              ChannelAd    ChannelDirectAccess           ChannelOther 
##            0.445329933            0.128705770            0.004011263 
## ChannelPriceComparison    ChannelSearchEngine  ChannelSocialNetworks 
##            0.068882159            0.284720009            0.009430454 
##         ChannelWebmail 
##            0.058920412 
## 
## End Probabilities:
## 
##            AddCartPage               CartPage           CategoryPage 
##           2.364255e-03           1.522155e-02           2.464403e-01 
##              ChannelAd    ChannelDirectAccess ChannelPriceComparison 
##           6.109871e-04           5.844225e-04           5.312932e-05 
##    ChannelSearchEngine         ChannelWebmail             Conversion 
##           1.859526e-04           2.656466e-05           5.565296e-02 
##           DeliveryPage           DiscountPage              FrontPage 
##           1.636383e-02           5.815004e-02           4.709914e-02 
##            LandingPage              OtherPage         ProductDetails 
##           7.172458e-03           5.443099e-02           1.487355e-01 
##            ProductPage         Recommendation         SearchFunction 
##           3.317129e-01           1.992349e-03           1.320264e-02</code></pre>
<p>Since we have names on the rows and columns, it is a bit more confusion to read. Although the principle is the same as we have seen previously.</p>
<p>We have to read it from column to row when interpreting probabilities of going from one page to another.</p>
<p>Notice that we are not having any absorbing states.</p>
<p>Lets predict what happens one step ahead given the different pages are visited.</p>
<div class="sourceCode" id="cb743"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb743-1"><a href="customer-behavior.html#cb743-1" aria-hidden="true" tabindex="-1"></a>pattern <span class="ot">&lt;-</span> <span class="fu">new</span>(<span class="st">&quot;Pattern&quot;</span>, <span class="at">sequence =</span> <span class="fu">c</span>(<span class="st">&quot;DeliveryPage&quot;</span>))</span>
<span id="cb743-2"><a href="customer-behavior.html#cb743-2" aria-hidden="true" tabindex="-1"></a>resultPattern <span class="ot">&lt;-</span> <span class="fu">predict</span>(mc, <span class="at">startPattern =</span> pattern, <span class="at">dist =</span> <span class="dv">1</span>)</span>
<span id="cb743-3"><a href="customer-behavior.html#cb743-3" aria-hidden="true" tabindex="-1"></a>resultPattern</span>
<span id="cb743-4"><a href="customer-behavior.html#cb743-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb743-5"><a href="customer-behavior.html#cb743-5" aria-hidden="true" tabindex="-1"></a><span class="co"># pattern &lt;- new(&quot;Pattern&quot;, sequence = c(&quot;AddCartPage&quot;))</span></span>
<span id="cb743-6"><a href="customer-behavior.html#cb743-6" aria-hidden="true" tabindex="-1"></a><span class="co"># resultPattern &lt;- predict(mc, startPattern = pattern, dist = 1)</span></span>
<span id="cb743-7"><a href="customer-behavior.html#cb743-7" aria-hidden="true" tabindex="-1"></a><span class="co"># resultPattern</span></span>
<span id="cb743-8"><a href="customer-behavior.html#cb743-8" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb743-9"><a href="customer-behavior.html#cb743-9" aria-hidden="true" tabindex="-1"></a><span class="co"># pattern &lt;- new(&quot;Pattern&quot;, sequence = c(&quot;AddCartPage&quot;, &quot;CartPage&quot;))</span></span>
<span id="cb743-10"><a href="customer-behavior.html#cb743-10" aria-hidden="true" tabindex="-1"></a><span class="co"># resultPattern &lt;- predict(mc, startPattern = pattern, dist = 1)</span></span>
<span id="cb743-11"><a href="customer-behavior.html#cb743-11" aria-hidden="true" tabindex="-1"></a><span class="co"># resultPattern</span></span>
<span id="cb743-12"><a href="customer-behavior.html#cb743-12" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb743-13"><a href="customer-behavior.html#cb743-13" aria-hidden="true" tabindex="-1"></a><span class="co"># pattern &lt;- new(&quot;Pattern&quot;, sequence = c(&quot;DeliveryPage&quot;))</span></span>
<span id="cb743-14"><a href="customer-behavior.html#cb743-14" aria-hidden="true" tabindex="-1"></a><span class="co"># resultPattern &lt;- predict(mc, startPattern = pattern, dist = 1)</span></span>
<span id="cb743-15"><a href="customer-behavior.html#cb743-15" aria-hidden="true" tabindex="-1"></a><span class="co"># resultPattern</span></span></code></pre></div>
<pre><code>## Sequence: ChannelDirectAccess
## Probability: 0.1982495
## Absorbing Probabilities: 
##   None
## 1  NaN</code></pre>
<p>We see that when you have visited the delivery page, then there is a 20% probability that you will go to the channel direct access, whatever that is.</p>
<p>Now we can cluster the different click streams and make predictions based on these.</p>
<div class="sourceCode" id="cb745"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb745-1"><a href="customer-behavior.html#cb745-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clustering first </span></span>
<span id="cb745-2"><a href="customer-behavior.html#cb745-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doParallel)</span>
<span id="cb745-3"><a href="customer-behavior.html#cb745-3" aria-hidden="true" tabindex="-1"></a>CoreCount  <span class="ot">&lt;-</span> <span class="fu">makePSOCKcluster</span>(<span class="fu">detectCores</span>()<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb745-4"><a href="customer-behavior.html#cb745-4" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoParallel</span>(CoreCount)</span>
<span id="cb745-5"><a href="customer-behavior.html#cb745-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb745-6"><a href="customer-behavior.html#cb745-6" aria-hidden="true" tabindex="-1"></a>clusters_ex <span class="ot">&lt;-</span> <span class="fu">clusterClickstreams</span>(<span class="at">clickstreamList =</span> mydata, <span class="at">order =</span> <span class="dv">1</span>, <span class="at">centers =</span> <span class="dv">3</span>)  <span class="co"># takes 5-10 min. to converge</span></span>
<span id="cb745-7"><a href="customer-behavior.html#cb745-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb745-8"><a href="customer-behavior.html#cb745-8" aria-hidden="true" tabindex="-1"></a><span class="fu">stopCluster</span>(CoreCount)</span>
<span id="cb745-9"><a href="customer-behavior.html#cb745-9" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoSEQ</span>()</span>
<span id="cb745-10"><a href="customer-behavior.html#cb745-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb745-11"><a href="customer-behavior.html#cb745-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(clusters_ex<span class="sc">$</span>clusters[[<span class="dv">1</span>]]) <span class="co"># clu 1</span></span>
<span id="cb745-12"><a href="customer-behavior.html#cb745-12" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(clusters_ex,<span class="st">&quot;Saved Objects/clusters_ex.rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb746"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb746-1"><a href="customer-behavior.html#cb746-1" aria-hidden="true" tabindex="-1"></a>clusters_ex <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;Saved Objects/clusters_ex.rds&quot;</span>)</span></code></pre></div>
<p>We see that the first cluster contain approx. 3.100 observations out of the 37.644 observations.</p>
<p><strong>Lets find optimal order based on AIC and BIC</strong></p>
<div class="sourceCode" id="cb747"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb747-1"><a href="customer-behavior.html#cb747-1" aria-hidden="true" tabindex="-1"></a>maxOrder <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb747-2"><a href="customer-behavior.html#cb747-2" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb747-3"><a href="customer-behavior.html#cb747-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>maxOrder) {</span>
<span id="cb747-4"><a href="customer-behavior.html#cb747-4" aria-hidden="true" tabindex="-1"></a>  mc <span class="ot">&lt;-</span> <span class="fu">fitMarkovChain</span>(<span class="at">clickstreamList =</span> clusters_ex<span class="sc">$</span>clusters[[<span class="dv">1</span>]], <span class="at">order =</span> k)</span>
<span id="cb747-5"><a href="customer-behavior.html#cb747-5" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">rbind</span>(result, <span class="fu">c</span>(k, <span class="fu">summary</span>(mc)<span class="sc">$</span>aic, <span class="fu">summary</span>(mc)<span class="sc">$</span>bic))</span>
<span id="cb747-6"><a href="customer-behavior.html#cb747-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb747-7"><a href="customer-behavior.html#cb747-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(result) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Order&quot;</span>, <span class="st">&quot;AIC&quot;</span>, <span class="st">&quot;BIC&quot;</span>)</span>
<span id="cb747-8"><a href="customer-behavior.html#cb747-8" aria-hidden="true" tabindex="-1"></a>result <span class="co">#Lag = 1 is the best.</span></span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">Order</th>
<th align="right">AIC</th>
<th align="right">BIC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">777749.9</td>
<td align="right">777972.2</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">777791.9</td>
<td align="right">778236.6</td>
</tr>
</tbody>
</table>
</div>
<p>Now we can do the same for the other clusters. Notice that I have commented out the prints, in general we just see that a lag of 1 is the most approapriate.</p>
<div class="sourceCode" id="cb748"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb748-1"><a href="customer-behavior.html#cb748-1" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(clusters_ex$clusters[[2]]) # clu 2</span></span>
<span id="cb748-2"><a href="customer-behavior.html#cb748-2" aria-hidden="true" tabindex="-1"></a><span class="co"># mc for clu 2 </span></span>
<span id="cb748-3"><a href="customer-behavior.html#cb748-3" aria-hidden="true" tabindex="-1"></a>maxOrder <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb748-4"><a href="customer-behavior.html#cb748-4" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb748-5"><a href="customer-behavior.html#cb748-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>maxOrder) {</span>
<span id="cb748-6"><a href="customer-behavior.html#cb748-6" aria-hidden="true" tabindex="-1"></a>  mc <span class="ot">&lt;-</span> <span class="fu">fitMarkovChain</span>(<span class="at">clickstreamList =</span> clusters_ex<span class="sc">$</span>clusters[[<span class="dv">2</span>]], <span class="at">order =</span> k)</span>
<span id="cb748-7"><a href="customer-behavior.html#cb748-7" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">rbind</span>(result, <span class="fu">c</span>(k, <span class="fu">summary</span>(mc)<span class="sc">$</span>aic, <span class="fu">summary</span>(mc)<span class="sc">$</span>bic))</span>
<span id="cb748-8"><a href="customer-behavior.html#cb748-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb748-9"><a href="customer-behavior.html#cb748-9" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(result) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Order&quot;</span>, <span class="st">&quot;AIC&quot;</span>, <span class="st">&quot;BIC&quot;</span>)</span>
<span id="cb748-10"><a href="customer-behavior.html#cb748-10" aria-hidden="true" tabindex="-1"></a>result</span>
<span id="cb748-11"><a href="customer-behavior.html#cb748-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb748-12"><a href="customer-behavior.html#cb748-12" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(clusters_ex$clusters[[3]]) # clu 3</span></span>
<span id="cb748-13"><a href="customer-behavior.html#cb748-13" aria-hidden="true" tabindex="-1"></a><span class="co"># mc for clu 3</span></span>
<span id="cb748-14"><a href="customer-behavior.html#cb748-14" aria-hidden="true" tabindex="-1"></a>maxOrder <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb748-15"><a href="customer-behavior.html#cb748-15" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb748-16"><a href="customer-behavior.html#cb748-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>maxOrder) {</span>
<span id="cb748-17"><a href="customer-behavior.html#cb748-17" aria-hidden="true" tabindex="-1"></a>  mc <span class="ot">&lt;-</span> <span class="fu">fitMarkovChain</span>(<span class="at">clickstreamList =</span> clusters_ex<span class="sc">$</span>clusters[[<span class="dv">3</span>]], <span class="at">order =</span> k)</span>
<span id="cb748-18"><a href="customer-behavior.html#cb748-18" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">rbind</span>(result, <span class="fu">c</span>(k, <span class="fu">summary</span>(mc)<span class="sc">$</span>aic, <span class="fu">summary</span>(mc)<span class="sc">$</span>bic))</span>
<span id="cb748-19"><a href="customer-behavior.html#cb748-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb748-20"><a href="customer-behavior.html#cb748-20" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(result) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Order&quot;</span>, <span class="st">&quot;AIC&quot;</span>, <span class="st">&quot;BIC&quot;</span>)</span>
<span id="cb748-21"><a href="customer-behavior.html#cb748-21" aria-hidden="true" tabindex="-1"></a>result</span></code></pre></div>
<p>Result = lag of 1 is the most appropriate.</p>
<div class="sourceCode" id="cb749"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb749-1"><a href="customer-behavior.html#cb749-1" aria-hidden="true" tabindex="-1"></a>mc_clu1 <span class="ot">&lt;-</span> <span class="fu">fitMarkovChain</span>(<span class="at">clickstreamList =</span> clusters_ex<span class="sc">$</span>clusters[[<span class="dv">1</span>]], <span class="at">order =</span> <span class="dv">1</span>)</span>
<span id="cb749-2"><a href="customer-behavior.html#cb749-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mc_clu1)</span>
<span id="cb749-3"><a href="customer-behavior.html#cb749-3" aria-hidden="true" tabindex="-1"></a>mc_clu2 <span class="ot">&lt;-</span> <span class="fu">fitMarkovChain</span>(<span class="at">clickstreamList =</span> clusters_ex<span class="sc">$</span>clusters[[<span class="dv">2</span>]], <span class="at">order =</span> <span class="dv">1</span>)</span>
<span id="cb749-4"><a href="customer-behavior.html#cb749-4" aria-hidden="true" tabindex="-1"></a>mc_clu3 <span class="ot">&lt;-</span> <span class="fu">fitMarkovChain</span>(<span class="at">clickstreamList =</span> clusters_ex<span class="sc">$</span>clusters[[<span class="dv">3</span>]], <span class="at">order =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## First-Order Markov Chain with 20 states.
##  The Markov Chain has absorbing states.
## 
## Observations: 292773
## LogLikelihood: -388854
## AIC: 777749.9
## BIC: 777972.2</code></pre>
<p>Plot some graphical representations. Although we see that there are so many outcomes making it difficult to interpret.</p>
<div class="sourceCode" id="cb751"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb751-1"><a href="customer-behavior.html#cb751-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)) <span class="co">#SEE IF THIS WORKS TO COLLECT THE PLOTS.</span></span>
<span id="cb751-2"><a href="customer-behavior.html#cb751-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mc_clu1, <span class="at">order =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-377-1.png" width="720" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb752"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb752-1"><a href="customer-behavior.html#cb752-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot(mc_clu2, order = 1)</span></span>
<span id="cb752-2"><a href="customer-behavior.html#cb752-2" aria-hidden="true" tabindex="-1"></a><span class="co">#plot(mc_clu3, order = 1)</span></span></code></pre></div>
<p>The following is another way of representing the same.</p>
<div class="sourceCode" id="cb753"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb753-1"><a href="customer-behavior.html#cb753-1" aria-hidden="true" tabindex="-1"></a><span class="co"># model graphical representation (ii)</span></span>
<span id="cb753-2"><a href="customer-behavior.html#cb753-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb753-3"><a href="customer-behavior.html#cb753-3" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">0</span>))</span>
<span id="cb753-4"><a href="customer-behavior.html#cb753-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">11</span>)</span>
<span id="cb753-5"><a href="customer-behavior.html#cb753-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mc_clu1, <span class="at">order =</span> <span class="dv">1</span>, <span class="at">digits =</span> <span class="dv">1</span>, <span class="at">minProbability =</span> <span class="fl">0.40</span>,</span>
<span id="cb753-6"><a href="customer-behavior.html#cb753-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.color=</span><span class="dv">0</span>,</span>
<span id="cb753-7"><a href="customer-behavior.html#cb753-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.frame.color=</span><span class="dv">0</span>,</span>
<span id="cb753-8"><a href="customer-behavior.html#cb753-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.shape=</span><span class="st">&quot;none&quot;</span>,</span>
<span id="cb753-9"><a href="customer-behavior.html#cb753-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.size=</span><span class="dv">8</span>, </span>
<span id="cb753-10"><a href="customer-behavior.html#cb753-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.size2=</span><span class="dv">3</span>,</span>
<span id="cb753-11"><a href="customer-behavior.html#cb753-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.label.dist=</span><span class="fl">0.4</span>, </span>
<span id="cb753-12"><a href="customer-behavior.html#cb753-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.color=</span><span class="st">&quot;transparent&quot;</span>,</span>
<span id="cb753-13"><a href="customer-behavior.html#cb753-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.label.font=</span><span class="dv">2</span>,</span>
<span id="cb753-14"><a href="customer-behavior.html#cb753-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.label.cex=</span><span class="fl">0.95</span>, </span>
<span id="cb753-15"><a href="customer-behavior.html#cb753-15" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.label.degree=</span><span class="dv">1</span>,</span>
<span id="cb753-16"><a href="customer-behavior.html#cb753-16" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.label.color=</span><span class="st">&quot;black&quot;</span>,</span>
<span id="cb753-17"><a href="customer-behavior.html#cb753-17" aria-hidden="true" tabindex="-1"></a>     <span class="at">edge.arrow.size=</span><span class="fl">0.2</span>,</span>
<span id="cb753-18"><a href="customer-behavior.html#cb753-18" aria-hidden="true" tabindex="-1"></a>     <span class="at">edge.label.cex =</span> <span class="fl">0.9</span>, </span>
<span id="cb753-19"><a href="customer-behavior.html#cb753-19" aria-hidden="true" tabindex="-1"></a>     <span class="at">edge.curved=</span><span class="dv">0</span>,</span>
<span id="cb753-20"><a href="customer-behavior.html#cb753-20" aria-hidden="true" tabindex="-1"></a>     <span class="at">edge.label.font=</span><span class="dv">4</span>,</span>
<span id="cb753-21"><a href="customer-behavior.html#cb753-21" aria-hidden="true" tabindex="-1"></a>     <span class="at">margin=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">0.15</span>),</span>
<span id="cb753-22"><a href="customer-behavior.html#cb753-22" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span><span class="st">&quot;Cluster 1&quot;</span>)</span>
<span id="cb753-23"><a href="customer-behavior.html#cb753-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb753-24"><a href="customer-behavior.html#cb753-24" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">11</span>)</span>
<span id="cb753-25"><a href="customer-behavior.html#cb753-25" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mc_clu2, <span class="at">order =</span> <span class="dv">1</span>, <span class="at">digits =</span> <span class="dv">1</span>, <span class="at">minProbability =</span> <span class="fl">0.40</span>,</span>
<span id="cb753-26"><a href="customer-behavior.html#cb753-26" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.color=</span><span class="dv">0</span>,</span>
<span id="cb753-27"><a href="customer-behavior.html#cb753-27" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.frame.color=</span><span class="dv">0</span>,</span>
<span id="cb753-28"><a href="customer-behavior.html#cb753-28" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.shape=</span><span class="st">&quot;none&quot;</span>,</span>
<span id="cb753-29"><a href="customer-behavior.html#cb753-29" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.size=</span><span class="dv">8</span>, </span>
<span id="cb753-30"><a href="customer-behavior.html#cb753-30" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.size2=</span><span class="dv">3</span>,</span>
<span id="cb753-31"><a href="customer-behavior.html#cb753-31" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.label.dist=</span><span class="fl">0.4</span>, </span>
<span id="cb753-32"><a href="customer-behavior.html#cb753-32" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.color=</span><span class="st">&quot;transparent&quot;</span>,</span>
<span id="cb753-33"><a href="customer-behavior.html#cb753-33" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.label.font=</span><span class="dv">2</span>,</span>
<span id="cb753-34"><a href="customer-behavior.html#cb753-34" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.label.cex=</span><span class="fl">0.95</span>, </span>
<span id="cb753-35"><a href="customer-behavior.html#cb753-35" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.label.degree=</span><span class="dv">1</span>,</span>
<span id="cb753-36"><a href="customer-behavior.html#cb753-36" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.label.color=</span><span class="st">&quot;black&quot;</span>,</span>
<span id="cb753-37"><a href="customer-behavior.html#cb753-37" aria-hidden="true" tabindex="-1"></a>     <span class="at">edge.arrow.size=</span><span class="fl">0.2</span>,</span>
<span id="cb753-38"><a href="customer-behavior.html#cb753-38" aria-hidden="true" tabindex="-1"></a>     <span class="at">edge.label.cex =</span> <span class="fl">0.9</span>, </span>
<span id="cb753-39"><a href="customer-behavior.html#cb753-39" aria-hidden="true" tabindex="-1"></a>     <span class="at">edge.curved=</span><span class="dv">0</span>,</span>
<span id="cb753-40"><a href="customer-behavior.html#cb753-40" aria-hidden="true" tabindex="-1"></a>     <span class="at">edge.label.font=</span><span class="dv">4</span>,</span>
<span id="cb753-41"><a href="customer-behavior.html#cb753-41" aria-hidden="true" tabindex="-1"></a>     <span class="at">margin=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">0.15</span>),</span>
<span id="cb753-42"><a href="customer-behavior.html#cb753-42" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span><span class="st">&quot;Cluster 2&quot;</span>)</span>
<span id="cb753-43"><a href="customer-behavior.html#cb753-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb753-44"><a href="customer-behavior.html#cb753-44" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">11</span>)</span>
<span id="cb753-45"><a href="customer-behavior.html#cb753-45" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mc_clu3, <span class="at">order =</span> <span class="dv">1</span>, <span class="at">digits =</span> <span class="dv">1</span>, <span class="at">minProbability =</span> <span class="fl">0.40</span>,</span>
<span id="cb753-46"><a href="customer-behavior.html#cb753-46" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.color=</span><span class="dv">0</span>,</span>
<span id="cb753-47"><a href="customer-behavior.html#cb753-47" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.frame.color=</span><span class="dv">0</span>,</span>
<span id="cb753-48"><a href="customer-behavior.html#cb753-48" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.shape=</span><span class="st">&quot;none&quot;</span>,</span>
<span id="cb753-49"><a href="customer-behavior.html#cb753-49" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.size=</span><span class="dv">8</span>, </span>
<span id="cb753-50"><a href="customer-behavior.html#cb753-50" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.size2=</span><span class="dv">3</span>,</span>
<span id="cb753-51"><a href="customer-behavior.html#cb753-51" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.label.dist=</span><span class="fl">0.4</span>, </span>
<span id="cb753-52"><a href="customer-behavior.html#cb753-52" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.color=</span><span class="st">&quot;transparent&quot;</span>,</span>
<span id="cb753-53"><a href="customer-behavior.html#cb753-53" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.label.font=</span><span class="dv">2</span>,</span>
<span id="cb753-54"><a href="customer-behavior.html#cb753-54" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.label.cex=</span><span class="fl">0.95</span>, </span>
<span id="cb753-55"><a href="customer-behavior.html#cb753-55" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.label.degree=</span><span class="dv">1</span>,</span>
<span id="cb753-56"><a href="customer-behavior.html#cb753-56" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.label.color=</span><span class="st">&quot;black&quot;</span>,</span>
<span id="cb753-57"><a href="customer-behavior.html#cb753-57" aria-hidden="true" tabindex="-1"></a>     <span class="at">edge.arrow.size=</span><span class="fl">0.2</span>,</span>
<span id="cb753-58"><a href="customer-behavior.html#cb753-58" aria-hidden="true" tabindex="-1"></a>     <span class="at">edge.label.cex =</span> <span class="fl">0.9</span>, </span>
<span id="cb753-59"><a href="customer-behavior.html#cb753-59" aria-hidden="true" tabindex="-1"></a>     <span class="at">edge.curved=</span><span class="dv">0</span>,</span>
<span id="cb753-60"><a href="customer-behavior.html#cb753-60" aria-hidden="true" tabindex="-1"></a>     <span class="at">edge.label.font=</span><span class="dv">4</span>,</span>
<span id="cb753-61"><a href="customer-behavior.html#cb753-61" aria-hidden="true" tabindex="-1"></a>     <span class="at">margin=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">0.15</span>),</span>
<span id="cb753-62"><a href="customer-behavior.html#cb753-62" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span><span class="st">&quot;Cluster 3&quot;</span>)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-378-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>Characterizing the clusters. Who are the customers underlying the three patterns of movement within the website?</p>
<p><em>Notice that this does not apply to her notes</em></p>
<ul>
<li>cl.2 and cl.3 search a lot through Category page</li>
<li>cl.1 search more through Product page</li>
<li>cl.1 and cl.3 search more varied (use more channels than cl.2)</li>
<li>cl.3 are more likely to enter through DirectAccess -&gt; Front page pattern than the other two clusterss.</li>
</ul>
<p>In this application the product page was generalized. However, if a more fine-grained clicktream data were available by product brand it will allow the manager to take informed decisions about the preferences of each cluster.</p>
<p>Now we can <strong>predict</strong> the next step for each cluster. Notice that the sequence for each prediction is the same.</p>
<div class="sourceCode" id="cb754"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb754-1"><a href="customer-behavior.html#cb754-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predicting the next steps</span></span>
<span id="cb754-2"><a href="customer-behavior.html#cb754-2" aria-hidden="true" tabindex="-1"></a>pattern <span class="ot">&lt;-</span> <span class="fu">new</span>(<span class="st">&quot;Pattern&quot;</span>, <span class="at">sequence =</span> <span class="fu">c</span>(<span class="st">&quot;AddCartPage&quot;</span>, <span class="st">&quot;CartPage&quot;</span>))</span>
<span id="cb754-3"><a href="customer-behavior.html#cb754-3" aria-hidden="true" tabindex="-1"></a>resultPattern <span class="ot">&lt;-</span> <span class="fu">predict</span>(mc_clu1, <span class="at">startPattern =</span> pattern, <span class="at">dist =</span> <span class="dv">1</span>)</span>
<span id="cb754-4"><a href="customer-behavior.html#cb754-4" aria-hidden="true" tabindex="-1"></a>resultPattern</span>
<span id="cb754-5"><a href="customer-behavior.html#cb754-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb754-6"><a href="customer-behavior.html#cb754-6" aria-hidden="true" tabindex="-1"></a>pattern <span class="ot">&lt;-</span> <span class="fu">new</span>(<span class="st">&quot;Pattern&quot;</span>, <span class="at">sequence =</span> <span class="fu">c</span>(<span class="st">&quot;AddCartPage&quot;</span>, <span class="st">&quot;CartPage&quot;</span>))</span>
<span id="cb754-7"><a href="customer-behavior.html#cb754-7" aria-hidden="true" tabindex="-1"></a>resultPattern <span class="ot">&lt;-</span> <span class="fu">predict</span>(mc_clu2, <span class="at">startPattern =</span> pattern, <span class="at">dist =</span> <span class="dv">1</span>)</span>
<span id="cb754-8"><a href="customer-behavior.html#cb754-8" aria-hidden="true" tabindex="-1"></a>resultPattern</span>
<span id="cb754-9"><a href="customer-behavior.html#cb754-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb754-10"><a href="customer-behavior.html#cb754-10" aria-hidden="true" tabindex="-1"></a>pattern <span class="ot">&lt;-</span> <span class="fu">new</span>(<span class="st">&quot;Pattern&quot;</span>, <span class="at">sequence =</span> <span class="fu">c</span>(<span class="st">&quot;AddCartPage&quot;</span>, <span class="st">&quot;CartPage&quot;</span>))</span>
<span id="cb754-11"><a href="customer-behavior.html#cb754-11" aria-hidden="true" tabindex="-1"></a>resultPattern <span class="ot">&lt;-</span> <span class="fu">predict</span>(mc_clu3, <span class="at">startPattern =</span> pattern, <span class="at">dist =</span> <span class="dv">1</span>)</span>
<span id="cb754-12"><a href="customer-behavior.html#cb754-12" aria-hidden="true" tabindex="-1"></a>resultPattern</span></code></pre></div>
<pre><code>## Sequence: Conversion
## Probability: 0.2248609
## Absorbing Probabilities: 
##   None
## 1  NaN
## 
## 
## Sequence: ProductPage
## Probability: 0.2165738
## Absorbing Probabilities: 
##   None
## 1  NaN
## 
## 
## Sequence: CartPage
## Probability: 0.1523567
## Absorbing Probabilities: 
##   None
## 1  NaN</code></pre>
<p>We see the following:</p>
<ul>
<li>Cluster 1 has 25% probability of going to conversion</li>
<li>Cluster 2 has 22% probability of going to the product page</li>
<li>Cluster 3 has 21% probability of going to the product page</li>
</ul>
</div>
<div id="using-association-rule-mining" class="section level4" number="5.2.3.2">
<h4><span class="header-section-number">5.2.3.2</span> (2) Using association rule mining</h4>
<p>Here we loose the sequence of events, but we use association rules. So like the maturity example we had with Hans, where if you have been at product 2 then you assume he has seen product 1.</p>
<p>That might not always be true. Hence we donât see how many times a customer has visited a product, as it is just looking at whether we visited a product or not.</p>
<p><em>Summary if the method:</em> we are going to apply arules to visualize association rules. Also we are going to calculate minsupport using the apropri algorithm.</p>
<p>Notice that we are going to apply three clusters again.</p>
<div class="sourceCode" id="cb756"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb756-1"><a href="customer-behavior.html#cb756-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;arules&quot;</span>)</span>
<span id="cb756-2"><a href="customer-behavior.html#cb756-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;arulesSequences&quot;</span>)</span>
<span id="cb756-3"><a href="customer-behavior.html#cb756-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb756-4"><a href="customer-behavior.html#cb756-4" aria-hidden="true" tabindex="-1"></a><span class="co"># looking by clustered data</span></span>
<span id="cb756-5"><a href="customer-behavior.html#cb756-5" aria-hidden="true" tabindex="-1"></a>trans_clu1 <span class="ot">&lt;-</span> <span class="fu">as.transactions</span>(clusters<span class="sc">$</span>clusters[[<span class="dv">1</span>]]) </span>
<span id="cb756-6"><a href="customer-behavior.html#cb756-6" aria-hidden="true" tabindex="-1"></a>sequences_clu1 <span class="ot">&lt;-</span> <span class="fu">as</span>(<span class="fu">apriori</span>(trans_clu1, <span class="at">parameter =</span> <span class="fu">list</span>(<span class="at">support =</span> <span class="fl">0.50</span>)), <span class="st">&quot;data.frame&quot;</span>) </span>
<span id="cb756-7"><a href="customer-behavior.html#cb756-7" aria-hidden="true" tabindex="-1"></a>sequences_clu1 <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span>
<span id="cb756-8"><a href="customer-behavior.html#cb756-8" aria-hidden="true" tabindex="-1"></a><span class="co"># subrules &lt;- subset(sequences_clu1, support&gt;0.05)</span></span></code></pre></div>
<pre><code>## Apriori
## 
## Parameter specification:
##  confidence minval smax arem  aval originalSupport maxtime support minlen
##         0.8    0.1    1 none FALSE            TRUE       5     0.5      1
##  maxlen target  ext
##      10  rules TRUE
## 
## Algorithmic control:
##  filter tree heap memopt load sort verbose
##     0.1 TRUE TRUE  FALSE TRUE    2    TRUE
## 
## Absolute minimum support count: 26376 
## 
## set item appearances ...[0 item(s)] done [0.00s].
## set transactions ...[9 item(s), 52752 transaction(s)] done [0.02s].
## sorting and recoding items ... [1 item(s)] done [0.00s].
## creating transaction tree ... done [0.00s].
## checking subsets of size 1 done [0.00s].
## writing ... [1 rule(s)] done [0.00s].
## creating S4 object  ... done [0.00s].</code></pre>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="left">rules</th>
<th align="right">support</th>
<th align="right">confidence</th>
<th align="right">coverage</th>
<th align="right">lift</th>
<th align="right">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">{} =&gt; {Defer}</td>
<td align="right">0.8245754</td>
<td align="right">0.8245754</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">43498</td>
</tr>
</tbody>
</table>
</div>
<p>We see the different rules in the rows above. The following runs the same for the other clusters.</p>
<div class="sourceCode" id="cb758"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb758-1"><a href="customer-behavior.html#cb758-1" aria-hidden="true" tabindex="-1"></a>trans_clu2 <span class="ot">&lt;-</span> <span class="fu">as.transactions</span>(clusters<span class="sc">$</span>clusters[[<span class="dv">2</span>]]) </span>
<span id="cb758-2"><a href="customer-behavior.html#cb758-2" aria-hidden="true" tabindex="-1"></a>sequences_clu2 <span class="ot">&lt;-</span> <span class="fu">as</span>(<span class="fu">apriori</span>(trans_clu2, <span class="at">parameter =</span> <span class="fu">list</span>(<span class="at">support =</span> <span class="fl">0.50</span>)), <span class="st">&quot;data.frame&quot;</span>)</span>
<span id="cb758-3"><a href="customer-behavior.html#cb758-3" aria-hidden="true" tabindex="-1"></a><span class="co">#sequences_clu2</span></span>
<span id="cb758-4"><a href="customer-behavior.html#cb758-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb758-5"><a href="customer-behavior.html#cb758-5" aria-hidden="true" tabindex="-1"></a>trans_clu3<span class="ot">&lt;-</span> <span class="fu">as.transactions</span>(clusters<span class="sc">$</span>clusters[[<span class="dv">3</span>]]) </span>
<span id="cb758-6"><a href="customer-behavior.html#cb758-6" aria-hidden="true" tabindex="-1"></a>sequences_clu3 <span class="ot">&lt;-</span> <span class="fu">as</span>(<span class="fu">apriori</span>(trans_clu3, <span class="at">parameter =</span> <span class="fu">list</span>(<span class="at">support =</span> <span class="fl">0.50</span>)), <span class="st">&quot;data.frame&quot;</span>)</span>
<span id="cb758-7"><a href="customer-behavior.html#cb758-7" aria-hidden="true" tabindex="-1"></a><span class="co">#sequences_clu3</span></span></code></pre></div>
<p>The corresponding output shows that pattern sequences are supported by at least 50% of the clickstreams in each cluster. cluster 1 of clickstream is the most heterogeneeous. The most common pattern <code>{ChannelAd} =&gt; {ProductPage}</code> has support in 41% of the clicks in clu1. This patterns reflects that this customers are most likely acquired through re-targeting.</p>
<p><strong>Visualizing</strong></p>
<div class="sourceCode" id="cb759"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb759-1"><a href="customer-behavior.html#cb759-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;arulesViz&quot;</span>)</span>
<span id="cb759-2"><a href="customer-behavior.html#cb759-2" aria-hidden="true" tabindex="-1"></a>sequences_clu1 <span class="ot">&lt;-</span> <span class="fu">apriori</span>(trans_clu1, <span class="at">parameter =</span> <span class="fu">list</span>(<span class="at">support =</span> <span class="fl">0.40</span>))</span>
<span id="cb759-3"><a href="customer-behavior.html#cb759-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ruleExplorer</span>(sequences_clu1)</span>
<span id="cb759-4"><a href="customer-behavior.html#cb759-4" aria-hidden="true" tabindex="-1"></a><span class="co"># sequences_clu2 &lt;- apriori(trans_clu2, parameter = list(support = 0.50))</span></span>
<span id="cb759-5"><a href="customer-behavior.html#cb759-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ruleExplorer(sequences_clu2)</span></span>
<span id="cb759-6"><a href="customer-behavior.html#cb759-6" aria-hidden="true" tabindex="-1"></a><span class="co"># sequences_clu3 &lt;- apriori(trans_clu3, parameter = list(support = 0.50))</span></span>
<span id="cb759-7"><a href="customer-behavior.html#cb759-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ruleExplorer(sequences_clu3)</span></span>
<span id="cb759-8"><a href="customer-behavior.html#cb759-8" aria-hidden="true" tabindex="-1"></a><span class="co"># this approach is also useful for discovering product/brands that are seen together</span></span></code></pre></div>
</div>
<div id="use-frequencies-instead-of-the-sequence" class="section level4" number="5.2.3.3">
<h4><span class="header-section-number">5.2.3.3</span> (3) Use frequencies instead of the sequence</h4>
<p>If we dont want to work with sequences, we just look at frequencies. This has the advantage as many machine learning methods now can be applied, for instance a random forest. Although we do completely miss out on the sequence.</p>
<div class="sourceCode" id="cb760"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb760-1"><a href="customer-behavior.html#cb760-1" aria-hidden="true" tabindex="-1"></a>frequencyDF <span class="ot">&lt;-</span> <span class="fu">frequencies</span>(mydata)</span>
<span id="cb760-2"><a href="customer-behavior.html#cb760-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(frequencyDF)</span></code></pre></div>
<div class="kable-table">
<table>
<colgroup>
<col width="13%" />
<col width="3%" />
<col width="3%" />
<col width="4%" />
<col width="6%" />
<col width="3%" />
<col width="3%" />
<col width="3%" />
<col width="6%" />
<col width="4%" />
<col width="3%" />
<col width="3%" />
<col width="3%" />
<col width="2%" />
<col width="3%" />
<col width="4%" />
<col width="7%" />
<col width="4%" />
<col width="3%" />
<col width="6%" />
<col width="3%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">ChannelAd</th>
<th align="right">ProductPage</th>
<th align="right">ProductDetails</th>
<th align="right">ChannelSearchEngine</th>
<th align="right">CategoryPage</th>
<th align="right">FrontPage</th>
<th align="right">DeliveryPage</th>
<th align="right">ChannelDirectAccess</th>
<th align="right">SearchFunction</th>
<th align="right">LandingPage</th>
<th align="right">DiscountPage</th>
<th align="right">AddCartPage</th>
<th align="right">CartPage</th>
<th align="right">OtherPage</th>
<th align="right">ChannelWebmail</th>
<th align="right">ChannelPriceComparison</th>
<th align="right">Recommendation</th>
<th align="right">Conversion</th>
<th align="right">ChannelSocialNetworks</th>
<th align="right">ChannelOther</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">0001d300-936c-402d-a7e0-daccc63a4965</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">0001fe38-9692-44bb-8c16-4382735d0db6</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">5</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">0002f4e7-57cd-469c-9131-52eefedab5b9</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">00063d31-2726-4ee4-a2b4-66758ef0b5c4</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">000ChannelAd9df-8f20-4a09-bfb1-59c14808b627</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">2</td>
<td align="right">4</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">000ef85d-cff3-47e4-a109-a078615de11a</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
<p>Here we just get a table showing each IDs for visitors and then you just get to see how many times the given person has visited the page.</p>
</div>
<div id="neural-networks" class="section level4" number="5.2.3.4">
<h4><span class="header-section-number">5.2.3.4</span> (4) Neural networks</h4>
<p>This is just using Neural Networks</p>
<div class="sourceCode" id="cb761"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb761-1"><a href="customer-behavior.html#cb761-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (6) A fourth option is to use Neural Networks (recurrent or not) with sequences </span></span>
<span id="cb761-2"><a href="customer-behavior.html#cb761-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># of clickstream data purely for prediction purposes.</span></span></code></pre></div>
</div>
</div>
<div id="optional-exercise" class="section level3" number="5.2.4">
<h3><span class="header-section-number">5.2.4</span> Optional exercise</h3>
<div class="sourceCode" id="cb762"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb762-1"><a href="customer-behavior.html#cb762-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (6) Optional</span></span>
<span id="cb762-2"><a href="customer-behavior.html#cb762-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Consider another real-life data set from Cadez, I., Heckerman, D., Meek, C., </span></span>
<span id="cb762-3"><a href="customer-behavior.html#cb762-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Smyth, P., White, S. (2003) Model-based clustering and visualization </span></span>
<span id="cb762-4"><a href="customer-behavior.html#cb762-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># of navigation patterns on a web site, Data Mining and Knowledge Discovery, 399-424.</span></span>
<span id="cb762-5"><a href="customer-behavior.html#cb762-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The dataset msnbc323 (Melnykov 2016a) is available </span></span>
<span id="cb762-6"><a href="customer-behavior.html#cb762-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># in data(&quot;msnbc323&quot;, package = &quot;ClickClust&quot;). </span></span>
<span id="cb762-7"><a href="customer-behavior.html#cb762-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># There are 323 clickstream sequences that involve 17 different states:</span></span>
<span id="cb762-8"><a href="customer-behavior.html#cb762-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb762-9"><a href="customer-behavior.html#cb762-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># (1) frontpage, (2) news, </span></span>
<span id="cb762-10"><a href="customer-behavior.html#cb762-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># (3) tech, (4) local, </span></span>
<span id="cb762-11"><a href="customer-behavior.html#cb762-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># (5) opinion, (6) on-air,</span></span>
<span id="cb762-12"><a href="customer-behavior.html#cb762-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># (7) miscellaneous, (8) weather, </span></span>
<span id="cb762-13"><a href="customer-behavior.html#cb762-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># (9) msn-news, (10) health-on-air, </span></span>
<span id="cb762-14"><a href="customer-behavior.html#cb762-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># (11) living, (12) business, </span></span>
<span id="cb762-15"><a href="customer-behavior.html#cb762-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># (13) msn-sports, (14) sports, </span></span>
<span id="cb762-16"><a href="customer-behavior.html#cb762-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># (15) summary-news, (16) bbs, </span></span>
<span id="cb762-17"><a href="customer-behavior.html#cb762-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># and (17) travel. </span></span>
<span id="cb762-18"><a href="customer-behavior.html#cb762-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb762-19"><a href="customer-behavior.html#cb762-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The length of sequences varies from 35 to 362. </span></span>
<span id="cb762-20"><a href="customer-behavior.html#cb762-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># There are 289 possible transitions among the 17 states. </span></span>
<span id="cb762-21"><a href="customer-behavior.html#cb762-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb762-22"><a href="customer-behavior.html#cb762-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(ClickClust)</span>
<span id="cb762-23"><a href="customer-behavior.html#cb762-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data</span>(<span class="st">&quot;msnbc323&quot;</span>, <span class="at">package =</span> <span class="st">&quot;ClickClust&quot;</span>)</span>
<span id="cb762-24"><a href="customer-behavior.html#cb762-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(msnbc323)</span>
<span id="cb762-25"><a href="customer-behavior.html#cb762-25" aria-hidden="true" tabindex="-1"></a>  clusters <span class="ot">&lt;-</span> <span class="fu">clusterClickstreams</span>(<span class="at">clickstreamList =</span> msnbc323, <span class="at">order =</span> <span class="dv">1</span>, <span class="at">centers =</span> <span class="dv">3</span>)  <span class="co"># takes 5-10 min. to converge</span></span>
<span id="cb762-26"><a href="customer-behavior.html#cb762-26" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb762-27"><a href="customer-behavior.html#cb762-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb762-28"><a href="customer-behavior.html#cb762-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mc for clu 1 </span></span>
<span id="cb762-29"><a href="customer-behavior.html#cb762-29" aria-hidden="true" tabindex="-1"></a>  maxOrder <span class="ot">&lt;-</span> <span class="dv">5</span> </span>
<span id="cb762-30"><a href="customer-behavior.html#cb762-30" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb762-31"><a href="customer-behavior.html#cb762-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>maxOrder) {</span>
<span id="cb762-32"><a href="customer-behavior.html#cb762-32" aria-hidden="true" tabindex="-1"></a>    mc <span class="ot">&lt;-</span> <span class="fu">fitMarkovChain</span>(<span class="at">clickstreamList =</span> clusters<span class="sc">$</span>clusters[[<span class="dv">1</span>]], <span class="at">order =</span> k)</span>
<span id="cb762-33"><a href="customer-behavior.html#cb762-33" aria-hidden="true" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="fu">rbind</span>(result, <span class="fu">c</span>(k, <span class="fu">summary</span>(mc)<span class="sc">$</span>aic, <span class="fu">summary</span>(mc)<span class="sc">$</span>bic))</span>
<span id="cb762-34"><a href="customer-behavior.html#cb762-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb762-35"><a href="customer-behavior.html#cb762-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(result) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Order&quot;</span>, <span class="st">&quot;AIC&quot;</span>, <span class="st">&quot;BIC&quot;</span>)</span>
<span id="cb762-36"><a href="customer-behavior.html#cb762-36" aria-hidden="true" tabindex="-1"></a>  result</span>
<span id="cb762-37"><a href="customer-behavior.html#cb762-37" aria-hidden="true" tabindex="-1"></a>  <span class="co">#1</span></span>
<span id="cb762-38"><a href="customer-behavior.html#cb762-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb762-39"><a href="customer-behavior.html#cb762-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mc for clu 2 </span></span>
<span id="cb762-40"><a href="customer-behavior.html#cb762-40" aria-hidden="true" tabindex="-1"></a>  maxOrder <span class="ot">&lt;-</span> <span class="dv">5</span> </span>
<span id="cb762-41"><a href="customer-behavior.html#cb762-41" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb762-42"><a href="customer-behavior.html#cb762-42" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>maxOrder) {</span>
<span id="cb762-43"><a href="customer-behavior.html#cb762-43" aria-hidden="true" tabindex="-1"></a>    mc <span class="ot">&lt;-</span> <span class="fu">fitMarkovChain</span>(<span class="at">clickstreamList =</span> clusters<span class="sc">$</span>clusters[[<span class="dv">2</span>]], <span class="at">order =</span> k)</span>
<span id="cb762-44"><a href="customer-behavior.html#cb762-44" aria-hidden="true" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="fu">rbind</span>(result, <span class="fu">c</span>(k, <span class="fu">summary</span>(mc)<span class="sc">$</span>aic, <span class="fu">summary</span>(mc)<span class="sc">$</span>bic))</span>
<span id="cb762-45"><a href="customer-behavior.html#cb762-45" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb762-46"><a href="customer-behavior.html#cb762-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(result) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Order&quot;</span>, <span class="st">&quot;AIC&quot;</span>, <span class="st">&quot;BIC&quot;</span>)</span>
<span id="cb762-47"><a href="customer-behavior.html#cb762-47" aria-hidden="true" tabindex="-1"></a>  result</span>
<span id="cb762-48"><a href="customer-behavior.html#cb762-48" aria-hidden="true" tabindex="-1"></a>  <span class="co">#1</span></span>
<span id="cb762-49"><a href="customer-behavior.html#cb762-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb762-50"><a href="customer-behavior.html#cb762-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb762-51"><a href="customer-behavior.html#cb762-51" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mc for clu 3</span></span>
<span id="cb762-52"><a href="customer-behavior.html#cb762-52" aria-hidden="true" tabindex="-1"></a>  maxOrder <span class="ot">&lt;-</span> <span class="dv">5</span> </span>
<span id="cb762-53"><a href="customer-behavior.html#cb762-53" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb762-54"><a href="customer-behavior.html#cb762-54" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>maxOrder) {</span>
<span id="cb762-55"><a href="customer-behavior.html#cb762-55" aria-hidden="true" tabindex="-1"></a>    mc <span class="ot">&lt;-</span> <span class="fu">fitMarkovChain</span>(<span class="at">clickstreamList =</span> clusters<span class="sc">$</span>clusters[[<span class="dv">3</span>]], <span class="at">order =</span> k)</span>
<span id="cb762-56"><a href="customer-behavior.html#cb762-56" aria-hidden="true" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="fu">rbind</span>(result, <span class="fu">c</span>(k, <span class="fu">summary</span>(mc)<span class="sc">$</span>aic, <span class="fu">summary</span>(mc)<span class="sc">$</span>bic))</span>
<span id="cb762-57"><a href="customer-behavior.html#cb762-57" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb762-58"><a href="customer-behavior.html#cb762-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(result) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Order&quot;</span>, <span class="st">&quot;AIC&quot;</span>, <span class="st">&quot;BIC&quot;</span>)</span>
<span id="cb762-59"><a href="customer-behavior.html#cb762-59" aria-hidden="true" tabindex="-1"></a>  result</span>
<span id="cb762-60"><a href="customer-behavior.html#cb762-60" aria-hidden="true" tabindex="-1"></a>  <span class="co">#1</span></span>
<span id="cb762-61"><a href="customer-behavior.html#cb762-61" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb762-62"><a href="customer-behavior.html#cb762-62" aria-hidden="true" tabindex="-1"></a>  mc_clu1 <span class="ot">&lt;-</span> <span class="fu">fitMarkovChain</span>(<span class="at">clickstreamList =</span> clusters<span class="sc">$</span>clusters[[<span class="dv">1</span>]], <span class="at">order =</span> <span class="dv">1</span>) </span>
<span id="cb762-63"><a href="customer-behavior.html#cb762-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(mc_clu1)</span>
<span id="cb762-64"><a href="customer-behavior.html#cb762-64" aria-hidden="true" tabindex="-1"></a>  mc_clu2 <span class="ot">&lt;-</span> <span class="fu">fitMarkovChain</span>(<span class="at">clickstreamList =</span> clusters<span class="sc">$</span>clusters[[<span class="dv">2</span>]], <span class="at">order =</span> <span class="dv">1</span>) </span>
<span id="cb762-65"><a href="customer-behavior.html#cb762-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(mc_clu2)</span>
<span id="cb762-66"><a href="customer-behavior.html#cb762-66" aria-hidden="true" tabindex="-1"></a>  mc_clu3 <span class="ot">&lt;-</span> <span class="fu">fitMarkovChain</span>(<span class="at">clickstreamList =</span> clusters<span class="sc">$</span>clusters[[<span class="dv">3</span>]], <span class="at">order =</span> <span class="dv">1</span>) </span>
<span id="cb762-67"><a href="customer-behavior.html#cb762-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(mc_clu3)</span>
<span id="cb762-68"><a href="customer-behavior.html#cb762-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb762-69"><a href="customer-behavior.html#cb762-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb762-70"><a href="customer-behavior.html#cb762-70" aria-hidden="true" tabindex="-1"></a>  <span class="co"># graphically</span></span>
<span id="cb762-71"><a href="customer-behavior.html#cb762-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb762-72"><a href="customer-behavior.html#cb762-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">0</span>))</span>
<span id="cb762-73"><a href="customer-behavior.html#cb762-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">11</span>)</span>
<span id="cb762-74"><a href="customer-behavior.html#cb762-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(mc_clu1, <span class="at">order =</span> <span class="dv">1</span>, <span class="at">digits =</span> <span class="dv">1</span>, <span class="at">minProbability =</span> <span class="fl">0.40</span>,</span>
<span id="cb762-75"><a href="customer-behavior.html#cb762-75" aria-hidden="true" tabindex="-1"></a>       <span class="at">vertex.color=</span><span class="dv">0</span>,</span>
<span id="cb762-76"><a href="customer-behavior.html#cb762-76" aria-hidden="true" tabindex="-1"></a>       <span class="at">vertex.frame.color=</span><span class="dv">0</span>,</span>
<span id="cb762-77"><a href="customer-behavior.html#cb762-77" aria-hidden="true" tabindex="-1"></a>       <span class="at">vertex.shape=</span><span class="st">&quot;none&quot;</span>,</span>
<span id="cb762-78"><a href="customer-behavior.html#cb762-78" aria-hidden="true" tabindex="-1"></a>       <span class="at">vertex.size=</span><span class="dv">8</span>, </span>
<span id="cb762-79"><a href="customer-behavior.html#cb762-79" aria-hidden="true" tabindex="-1"></a>       <span class="at">vertex.size2=</span><span class="dv">3</span>,</span>
<span id="cb762-80"><a href="customer-behavior.html#cb762-80" aria-hidden="true" tabindex="-1"></a>       <span class="at">vertex.label.dist=</span><span class="fl">0.4</span>, </span>
<span id="cb762-81"><a href="customer-behavior.html#cb762-81" aria-hidden="true" tabindex="-1"></a>       <span class="at">vertex.color=</span><span class="st">&quot;transparent&quot;</span>,</span>
<span id="cb762-82"><a href="customer-behavior.html#cb762-82" aria-hidden="true" tabindex="-1"></a>       <span class="at">vertex.label.font=</span><span class="dv">2</span>,</span>
<span id="cb762-83"><a href="customer-behavior.html#cb762-83" aria-hidden="true" tabindex="-1"></a>       <span class="at">vertex.label.cex=</span><span class="fl">0.95</span>, </span>
<span id="cb762-84"><a href="customer-behavior.html#cb762-84" aria-hidden="true" tabindex="-1"></a>       <span class="at">vertex.label.degree=</span><span class="dv">1</span>,</span>
<span id="cb762-85"><a href="customer-behavior.html#cb762-85" aria-hidden="true" tabindex="-1"></a>       <span class="at">vertex.label.color=</span><span class="st">&quot;black&quot;</span>,</span>
<span id="cb762-86"><a href="customer-behavior.html#cb762-86" aria-hidden="true" tabindex="-1"></a>       <span class="at">edge.arrow.size=</span><span class="fl">0.2</span>,</span>
<span id="cb762-87"><a href="customer-behavior.html#cb762-87" aria-hidden="true" tabindex="-1"></a>       <span class="at">edge.label.cex =</span> <span class="fl">0.9</span>, </span>
<span id="cb762-88"><a href="customer-behavior.html#cb762-88" aria-hidden="true" tabindex="-1"></a>       <span class="at">edge.curved=</span><span class="dv">0</span>,</span>
<span id="cb762-89"><a href="customer-behavior.html#cb762-89" aria-hidden="true" tabindex="-1"></a>       <span class="at">edge.label.font=</span><span class="dv">4</span>,</span>
<span id="cb762-90"><a href="customer-behavior.html#cb762-90" aria-hidden="true" tabindex="-1"></a>       <span class="at">margin=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">0.15</span>),</span>
<span id="cb762-91"><a href="customer-behavior.html#cb762-91" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span><span class="st">&quot;Cluster 1&quot;</span>)</span>
<span id="cb762-92"><a href="customer-behavior.html#cb762-92" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb762-93"><a href="customer-behavior.html#cb762-93" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb762-94"><a href="customer-behavior.html#cb762-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">11</span>)</span>
<span id="cb762-95"><a href="customer-behavior.html#cb762-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(mc_clu2, <span class="at">order =</span> <span class="dv">1</span>, <span class="at">digits =</span> <span class="dv">1</span>, <span class="at">minProbability =</span> <span class="fl">0.40</span>,</span>
<span id="cb762-96"><a href="customer-behavior.html#cb762-96" aria-hidden="true" tabindex="-1"></a>       <span class="at">vertex.color=</span><span class="dv">0</span>,</span>
<span id="cb762-97"><a href="customer-behavior.html#cb762-97" aria-hidden="true" tabindex="-1"></a>       <span class="at">vertex.frame.color=</span><span class="dv">0</span>,</span>
<span id="cb762-98"><a href="customer-behavior.html#cb762-98" aria-hidden="true" tabindex="-1"></a>       <span class="at">vertex.shape=</span><span class="st">&quot;none&quot;</span>,</span>
<span id="cb762-99"><a href="customer-behavior.html#cb762-99" aria-hidden="true" tabindex="-1"></a>       <span class="at">vertex.size=</span><span class="dv">8</span>, </span>
<span id="cb762-100"><a href="customer-behavior.html#cb762-100" aria-hidden="true" tabindex="-1"></a>       <span class="at">vertex.size2=</span><span class="dv">3</span>,</span>
<span id="cb762-101"><a href="customer-behavior.html#cb762-101" aria-hidden="true" tabindex="-1"></a>       <span class="at">vertex.label.dist=</span><span class="fl">0.4</span>, </span>
<span id="cb762-102"><a href="customer-behavior.html#cb762-102" aria-hidden="true" tabindex="-1"></a>       <span class="at">vertex.color=</span><span class="st">&quot;transparent&quot;</span>,</span>
<span id="cb762-103"><a href="customer-behavior.html#cb762-103" aria-hidden="true" tabindex="-1"></a>       <span class="at">vertex.label.font=</span><span class="dv">2</span>,</span>
<span id="cb762-104"><a href="customer-behavior.html#cb762-104" aria-hidden="true" tabindex="-1"></a>       <span class="at">vertex.label.cex=</span><span class="fl">0.95</span>, </span>
<span id="cb762-105"><a href="customer-behavior.html#cb762-105" aria-hidden="true" tabindex="-1"></a>       <span class="at">vertex.label.degree=</span><span class="dv">1</span>,</span>
<span id="cb762-106"><a href="customer-behavior.html#cb762-106" aria-hidden="true" tabindex="-1"></a>       <span class="at">vertex.label.color=</span><span class="st">&quot;black&quot;</span>,</span>
<span id="cb762-107"><a href="customer-behavior.html#cb762-107" aria-hidden="true" tabindex="-1"></a>       <span class="at">edge.arrow.size=</span><span class="fl">0.2</span>,</span>
<span id="cb762-108"><a href="customer-behavior.html#cb762-108" aria-hidden="true" tabindex="-1"></a>       <span class="at">edge.label.cex =</span> <span class="fl">0.9</span>, </span>
<span id="cb762-109"><a href="customer-behavior.html#cb762-109" aria-hidden="true" tabindex="-1"></a>       <span class="at">edge.curved=</span><span class="dv">0</span>,</span>
<span id="cb762-110"><a href="customer-behavior.html#cb762-110" aria-hidden="true" tabindex="-1"></a>       <span class="at">edge.label.font=</span><span class="dv">4</span>,</span>
<span id="cb762-111"><a href="customer-behavior.html#cb762-111" aria-hidden="true" tabindex="-1"></a>       <span class="at">margin=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">0.15</span>),</span>
<span id="cb762-112"><a href="customer-behavior.html#cb762-112" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span><span class="st">&quot;Cluster 2&quot;</span>)</span>
<span id="cb762-113"><a href="customer-behavior.html#cb762-113" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb762-114"><a href="customer-behavior.html#cb762-114" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb762-115"><a href="customer-behavior.html#cb762-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">11</span>)</span>
<span id="cb762-116"><a href="customer-behavior.html#cb762-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(mc_clu3, <span class="at">order =</span> <span class="dv">1</span>, <span class="at">digits =</span> <span class="dv">1</span>, <span class="at">minProbability =</span> <span class="fl">0.40</span>,</span>
<span id="cb762-117"><a href="customer-behavior.html#cb762-117" aria-hidden="true" tabindex="-1"></a>       <span class="at">vertex.color=</span><span class="dv">0</span>,</span>
<span id="cb762-118"><a href="customer-behavior.html#cb762-118" aria-hidden="true" tabindex="-1"></a>       <span class="at">vertex.frame.color=</span><span class="dv">0</span>,</span>
<span id="cb762-119"><a href="customer-behavior.html#cb762-119" aria-hidden="true" tabindex="-1"></a>       <span class="at">vertex.shape=</span><span class="st">&quot;none&quot;</span>,</span>
<span id="cb762-120"><a href="customer-behavior.html#cb762-120" aria-hidden="true" tabindex="-1"></a>       <span class="at">vertex.size=</span><span class="dv">8</span>, </span>
<span id="cb762-121"><a href="customer-behavior.html#cb762-121" aria-hidden="true" tabindex="-1"></a>       <span class="at">vertex.size2=</span><span class="dv">3</span>,</span>
<span id="cb762-122"><a href="customer-behavior.html#cb762-122" aria-hidden="true" tabindex="-1"></a>       <span class="at">vertex.label.dist=</span><span class="fl">0.4</span>, </span>
<span id="cb762-123"><a href="customer-behavior.html#cb762-123" aria-hidden="true" tabindex="-1"></a>       <span class="at">vertex.color=</span><span class="st">&quot;transparent&quot;</span>,</span>
<span id="cb762-124"><a href="customer-behavior.html#cb762-124" aria-hidden="true" tabindex="-1"></a>       <span class="at">vertex.label.font=</span><span class="dv">2</span>,</span>
<span id="cb762-125"><a href="customer-behavior.html#cb762-125" aria-hidden="true" tabindex="-1"></a>       <span class="at">vertex.label.cex=</span><span class="fl">0.95</span>, </span>
<span id="cb762-126"><a href="customer-behavior.html#cb762-126" aria-hidden="true" tabindex="-1"></a>       <span class="at">vertex.label.degree=</span><span class="dv">1</span>,</span>
<span id="cb762-127"><a href="customer-behavior.html#cb762-127" aria-hidden="true" tabindex="-1"></a>       <span class="at">vertex.label.color=</span><span class="st">&quot;black&quot;</span>,</span>
<span id="cb762-128"><a href="customer-behavior.html#cb762-128" aria-hidden="true" tabindex="-1"></a>       <span class="at">edge.arrow.size=</span><span class="fl">0.2</span>,</span>
<span id="cb762-129"><a href="customer-behavior.html#cb762-129" aria-hidden="true" tabindex="-1"></a>       <span class="at">edge.label.cex =</span> <span class="fl">0.9</span>, </span>
<span id="cb762-130"><a href="customer-behavior.html#cb762-130" aria-hidden="true" tabindex="-1"></a>       <span class="at">edge.curved=</span><span class="dv">0</span>,</span>
<span id="cb762-131"><a href="customer-behavior.html#cb762-131" aria-hidden="true" tabindex="-1"></a>       <span class="at">edge.label.font=</span><span class="dv">4</span>,</span>
<span id="cb762-132"><a href="customer-behavior.html#cb762-132" aria-hidden="true" tabindex="-1"></a>       <span class="at">margin=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">0.15</span>),</span>
<span id="cb762-133"><a href="customer-behavior.html#cb762-133" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span><span class="st">&quot;Cluster 3&quot;</span>)</span>
<span id="cb762-134"><a href="customer-behavior.html#cb762-134" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb762-135"><a href="customer-behavior.html#cb762-135" aria-hidden="true" tabindex="-1"></a>  <span class="co"># interpret: </span></span>
<span id="cb762-136"><a href="customer-behavior.html#cb762-136" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb762-137"><a href="customer-behavior.html#cb762-137" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cluster 2 is entirely driven by transitions within the same categories</span></span>
<span id="cb762-138"><a href="customer-behavior.html#cb762-138" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Thus, this group represents people who make the majority of transitions within their </span></span>
<span id="cb762-139"><a href="customer-behavior.html#cb762-139" aria-hidden="true" tabindex="-1"></a>  <span class="co"># preferred category and do not change categories frequently.</span></span>
<span id="cb762-140"><a href="customer-behavior.html#cb762-140" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb762-141"><a href="customer-behavior.html#cb762-141" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cluster 1 The second cluster is characterized by higher probabilities of transitions </span></span>
<span id="cb762-142"><a href="customer-behavior.html#cb762-142" aria-hidden="true" tabindex="-1"></a>  <span class="co"># front pageânews, newsânews, msn-news, and summaryânews. </span></span>
<span id="cb762-143"><a href="customer-behavior.html#cb762-143" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The transition front pageânews reï¬ects the common pattern for the users starting with </span></span>
<span id="cb762-144"><a href="customer-behavior.html#cb762-144" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the category front page to proceed directly to the category news. </span></span>
<span id="cb762-145"><a href="customer-behavior.html#cb762-145" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Once the reader gets to the category news, he or she typically stays within it or proceeds </span></span>
<span id="cb762-146"><a href="customer-behavior.html#cb762-146" aria-hidden="true" tabindex="-1"></a>  <span class="co"># to summary.Thus, the second cluster consists of people mostly concerned with news. </span></span>
<span id="cb762-147"><a href="customer-behavior.html#cb762-147" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb762-148"><a href="customer-behavior.html#cb762-148" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cluster 3 is characterized by transitions travel-health-on-air, travel-frontpage, </span></span>
<span id="cb762-149"><a href="customer-behavior.html#cb762-149" aria-hidden="true" tabindex="-1"></a>  <span class="co"># consisting of the people concerned about travelling issues.</span></span>
<span id="cb762-150"><a href="customer-behavior.html#cb762-150" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb762-151"><a href="customer-behavior.html#cb762-151" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The analysis of this dataset illustrates how click-plots can </span></span>
<span id="cb762-152"><a href="customer-behavior.html#cb762-152" aria-hidden="true" tabindex="-1"></a>  <span class="co"># be used and interpreted to discover interesting navigation patterns common for </span></span>
<span id="cb762-153"><a href="customer-behavior.html#cb762-153" aria-hidden="true" tabindex="-1"></a>  <span class="co"># observations within detected clusters.</span></span></code></pre></div>
</div>
</div>
<div id="ab-testing" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> AB Testing</h2>
<p>Basically this is experimenting with for instance a website. For instance changing the location of the basket. The ultimate goal is to be able to find out what works on a website, and what does not.</p>
<p>The lecture had the following outline:</p>
<ol style="list-style-type: decimal">
<li>What is A/B testing?</li>
<li>When is the organization ready to use A/B test and why should you use A/B test?</li>
<li>How to perform an A/B test?</li>
<li>Pitfalls and challenges.</li>
<li>A/B tests and bandits.</li>
</ol>
<div id="what-is-it-and-when-to-apply-it" class="section level3" number="5.3.1">
<h3><span class="header-section-number">5.3.1</span> (1 + 2): What is it and when to apply it</h3>
<p>Basically you just funnel some visitors into one website layout and the other to another.</p>
<p>Then one of the groups is a control group and the other, the treatment group. Then you want to assess if the treatment group is actually buying more stuff. To evaluate this, one can apply statistical tests.</p>
<p>You want to apply it if you have operate in different countries, as the one culture may prefer one layout over another. Hence you want to collect that information.</p>
<p>Hence instead of just making something that looks good, you want to make something that also works.</p>
</div>
<div id="how-to-perform-an-ab-test" class="section level3" number="5.3.2">
<h3><span class="header-section-number">5.3.2</span> (3): How to perform an A/B test</h3>
<p>The is two steps:</p>
<ol style="list-style-type: decimal">
<li>Agree on what you want to optimize, e.g., basket size, conversion rates, amount of visitors, the time a person is on the website etc. Then you must select an appropriate metric for this. This must be distributed throughout the organization. This is also known as the <strong>Overall Evaluation Criterion (OEC).</strong></li>
<li>Report many other metrics and diagnostics to support the OEC.</li>
</ol>
<p>Now you must find out:</p>
<ul>
<li>What sample size do you need? The more variance that that a metric contains, the more samples do you also need.</li>
<li>How long will you be experimenting. Often it goes over one or two weeks</li>
</ul>
<p><strong>Making statistical test of different means</strong></p>
<p>We want to find n</p>
<div class="sourceCode" id="cb763"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb763-1"><a href="customer-behavior.html#cb763-1" aria-hidden="true" tabindex="-1"></a>avg_rev_pr_user <span class="ot">&lt;-</span> <span class="fl">3.75</span> <span class="co">#I.e. the control</span></span>
<span id="cb763-2"><a href="customer-behavior.html#cb763-2" aria-hidden="true" tabindex="-1"></a>change_rev <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb763-3"><a href="customer-behavior.html#cb763-3" aria-hidden="true" tabindex="-1"></a>delta <span class="ot">&lt;-</span> change_rev <span class="sc">*</span> avg_rev_pr_user</span>
<span id="cb763-4"><a href="customer-behavior.html#cb763-4" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb763-5"><a href="customer-behavior.html#cb763-5" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb763-6"><a href="customer-behavior.html#cb763-6" aria-hidden="true" tabindex="-1"></a>power <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">-</span>beta <span class="co">#Statistical power we want to achieve</span></span>
<span id="cb763-7"><a href="customer-behavior.html#cb763-7" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb763-8"><a href="customer-behavior.html#cb763-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb763-9"><a href="customer-behavior.html#cb763-9" aria-hidden="true" tabindex="-1"></a>z1 <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">qnorm</span>(a<span class="sc">/</span><span class="dv">2</span>)) <span class="co">#Because it is double sided</span></span>
<span id="cb763-10"><a href="customer-behavior.html#cb763-10" aria-hidden="true" tabindex="-1"></a>z2 <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">qnorm</span>(power))</span>
<span id="cb763-11"><a href="customer-behavior.html#cb763-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb763-12"><a href="customer-behavior.html#cb763-12" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">*</span>((z1 <span class="sc">+</span> z2)<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>sigma<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(delta<span class="sc">^</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 401862.6</code></pre>
<p>We see that we need 401.863 observations.</p>
<p><strong>An R example</strong></p>
<div class="sourceCode" id="cb765"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb765-1"><a href="customer-behavior.html#cb765-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pwr)</span>
<span id="cb765-2"><a href="customer-behavior.html#cb765-2" aria-hidden="true" tabindex="-1"></a>mde <span class="ot">&lt;-</span> <span class="fl">0.1</span> <span class="co">#minimum detectable effect</span></span>
<span id="cb765-3"><a href="customer-behavior.html#cb765-3" aria-hidden="true" tabindex="-1"></a>cr_a <span class="ot">&lt;-</span> <span class="fl">0.25</span> <span class="co">#The expected conversion rate for group A (the control group)</span></span>
<span id="cb765-4"><a href="customer-behavior.html#cb765-4" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span> <span class="co">#The false positive rate - significance level</span></span>
<span id="cb765-5"><a href="customer-behavior.html#cb765-5" aria-hidden="true" tabindex="-1"></a>power <span class="ot">&lt;-</span> <span class="fl">0.8</span> <span class="co">#Statistical power</span></span>
<span id="cb765-6"><a href="customer-behavior.html#cb765-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb765-7"><a href="customer-behavior.html#cb765-7" aria-hidden="true" tabindex="-1"></a>ptpt <span class="ot">&lt;-</span> <span class="fu">pwr.2p.test</span>(<span class="at">h =</span> <span class="fu">ES.h</span>(<span class="at">p1 =</span> cr_a,<span class="at">p2 =</span> (<span class="dv">1</span><span class="sc">+</span>mde)<span class="sc">*</span>cr_a)</span>
<span id="cb765-8"><a href="customer-behavior.html#cb765-8" aria-hidden="true" tabindex="-1"></a>                    ,<span class="at">sig.level =</span> alpha</span>
<span id="cb765-9"><a href="customer-behavior.html#cb765-9" aria-hidden="true" tabindex="-1"></a>                    ,<span class="at">power =</span> power)</span>
<span id="cb765-10"><a href="customer-behavior.html#cb765-10" aria-hidden="true" tabindex="-1"></a>n_obs <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(ptpt<span class="sc">$</span>n)</span>
<span id="cb765-11"><a href="customer-behavior.html#cb765-11" aria-hidden="true" tabindex="-1"></a>n_obs <span class="co">#Required pairs of observations (1 pair = 1 control + 1 treatment)</span></span></code></pre></div>
<pre><code>## [1] 4860</code></pre>
<p>We see that we need 4.860 observations, that is for both the control and the treatment.</p>
</div>
<div id="pitfalls-and-challenges." class="section level3" number="5.3.3">
<h3><span class="header-section-number">5.3.3</span> (4): Pitfalls and challenges.</h3>
<p><strong>Rampup</strong></p>
<p>He talks about slowly scaling up the treatment group to find bugs. Then you should start small and monitor the visitors that enter the website.</p>
<p><strong>Common problems</strong></p>
<ul>
<li>Looking at too many metrics - the more measures you look at, the greater is the cahnce of observing random fluctuations.</li>
<li>One must be aware of robots, we do not want to count these as a visitor.</li>
<li>Many managers donât let the tests run their course</li>
<li>Not keeping it simple. Too many changes on the website will make the conclusions vague, because you donât know what worked and what no.</li>
<li>You must be aware of the surroundings, like what dates are your comparing, different timezone? time periods? What browser? What device is used?</li>
</ul>
<p>To deal with the latter, one could make clusters, for instance we only want to make the test on phone or tablet visitors.</p>
</div>
<div id="ab-tests-and-bandits." class="section level3" number="5.3.4">
<h3><span class="header-section-number">5.3.4</span> (5): A/B tests and bandits.</h3>
<p>We have to terms that must be clarified first:</p>
<ol style="list-style-type: decimal">
<li><strong>Exploration</strong>: That is where you are actually making the A/B testing, hence collecting all of your data. Running the test may not cost money, although if one landing page is better than the other, then you might be loosing revenue, hence it is costly in that way, or at least an opportunity cost.</li>
<li><strong>Exploitation</strong>: We see that what we find from the exploration we can start using and that is basically the exploitation. This is also called the bandit approach, as when we collect information we start using it to minimize the opportunity cost. This bandit approach has the following advnatages:</li>
<li>Earn while you learn</li>
<li>Automation of selection proces, he presented an example, where the algorithm could automatically select which add to show, based on the given information.</li>
<li>Introducing randomness: we give the bandit the ability to explore new information, so it does not only end up confirming itself, as one ad would be used 99% of the time, as it previously has been the best.</li>
</ol>
<p>To run the exploitations, we can apply two different algorithms:</p>
<ol style="list-style-type: decimal">
<li>Epsilon Greedy Policy</li>
<li>Thompson Sampling Policy</li>
</ol>
<p><strong>Simulations - example in R</strong></p>
<p>In the following we are going simulate the same example with two different types of simulators:</p>
<ol style="list-style-type: decimal">
<li>Epsilon Greedy Policy</li>
<li>Thompson Sampling Policy</li>
</ol>
<p><strong>Epsilon Greedy</strong></p>
<p>An epsilon-greedy policy is a randomized policy that mixes exploitation with a predetermined amount of exploration. For any epsilon <span class="math inline">\(\epsilon\)</span> <span class="math inline">\(\in\)</span> (in) [0,1] (meaning epsilons between 0 and 1), the policy randomly allocates <span class="math inline">\(\epsilon\)</span> of the observations allocated uniformly across the K ads, and allocates 1 - <span class="math inline">\(\epsilon\)</span> of observations to the ad with the largest observed mean.</p>
<div class="sourceCode" id="cb767"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb767-1"><a href="customer-behavior.html#cb767-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(contextual)</span>
<span id="cb767-2"><a href="customer-behavior.html#cb767-2" aria-hidden="true" tabindex="-1"></a>horizon <span class="ot">&lt;-</span> <span class="dv">1000</span> <span class="co">#1000 timesteps</span></span>
<span id="cb767-3"><a href="customer-behavior.html#cb767-3" aria-hidden="true" tabindex="-1"></a>simulations <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb767-4"><a href="customer-behavior.html#cb767-4" aria-hidden="true" tabindex="-1"></a><span class="co">#It means that simulator runs 1.000 simulations for each of the 1000 time steps</span></span>
<span id="cb767-5"><a href="customer-behavior.html#cb767-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb767-6"><a href="customer-behavior.html#cb767-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Epsilon greedy horizon &lt;- 1000 simulations &lt;- 1000</span></span>
<span id="cb767-7"><a href="customer-behavior.html#cb767-7" aria-hidden="true" tabindex="-1"></a>conversionProbabilities <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.05</span>,<span class="fl">0.10</span>,<span class="fl">0.15</span>,<span class="fl">0.20</span>,<span class="fl">0.25</span>)</span>
<span id="cb767-8"><a href="customer-behavior.html#cb767-8" aria-hidden="true" tabindex="-1"></a>bandit <span class="ot">&lt;-</span> BasicBernoulliBandit<span class="sc">$</span><span class="fu">new</span>(<span class="at">weights =</span> conversionProbabilities)</span>
<span id="cb767-9"><a href="customer-behavior.html#cb767-9" aria-hidden="true" tabindex="-1"></a>policy <span class="ot">&lt;-</span> EpsilonGreedyPolicy<span class="sc">$</span><span class="fu">new</span>(<span class="at">epsilon =</span> <span class="fl">0.10</span>)</span>
<span id="cb767-10"><a href="customer-behavior.html#cb767-10" aria-hidden="true" tabindex="-1"></a>agent <span class="ot">&lt;-</span> Agent<span class="sc">$</span><span class="fu">new</span>(<span class="at">policy =</span> policy,<span class="at">bandit =</span> bandit)</span>
<span id="cb767-11"><a href="customer-behavior.html#cb767-11" aria-hidden="true" tabindex="-1"></a>historyEG <span class="ot">&lt;-</span> Simulator<span class="sc">$</span><span class="fu">new</span>(<span class="at">agents =</span> agent,<span class="at">horizon =</span> horizon,<span class="at">simulations =</span> simulations)<span class="sc">$</span><span class="fu">run</span>()</span>
<span id="cb767-12"><a href="customer-behavior.html#cb767-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(historyEG,<span class="at">type =</span> <span class="st">&quot;arms&quot;</span>,<span class="at">legend_labels =</span> <span class="fu">c</span>(<span class="st">&quot;Ad 1&quot;</span>,<span class="st">&quot;Ad 2&quot;</span>,<span class="st">&quot;Ad 3&quot;</span>,<span class="st">&quot;Ad 4&quot;</span>,<span class="st">&quot;Ad 5&quot;</span>)</span>
<span id="cb767-13"><a href="customer-behavior.html#cb767-13" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">legend_title =</span> <span class="st">&quot;Epsilon Greedy&quot;</span>,<span class="at">legend_position =</span> <span class="st">&quot;topright&quot;</span>,<span class="at">smooth =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-388-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>We see that we feed the simulator information about the conversion probabilities for the given adds. Then we run 1000 simulations, and we see that there is a tendency towards selecting add 5, naturally because this has the highest conversion probabilities. If we for instance was to set add 5 conversion probability to 0.025 instead of 0.25, then we would see that add 4 would start dominate the add choices.</p>
<div class="sourceCode" id="cb768"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb768-1"><a href="customer-behavior.html#cb768-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(historyEG)</span></code></pre></div>
<pre><code>## 
## Agents:
## 
##   EpsilonGreedy
## 
## Cumulative regret:
## 
##          agent    t sims cum_regret cum_regret_var cum_regret_sd
##  EpsilonGreedy 1000 1000     31.752       592.2287      24.33575
## 
## 
## Cumulative reward:
## 
##          agent    t sims cum_reward cum_reward_var cum_reward_sd
##  EpsilonGreedy 1000 1000    218.111       711.9166      26.68177
## 
## 
## Cumulative reward rate:
## 
##          agent    t sims cur_reward cur_reward_var cur_reward_sd
##  EpsilonGreedy 1000 1000   0.218111      0.7119166    0.02668177</code></pre>
<p>we see that we had a reward of 21.81%, which is naturally lower than if we just used ad 5, which had a conversion of 25%. The variance is 71% and the standard deviation 2.66%</p>
<p><strong>Thompson Sampling Alogorithm</strong></p>
<p>Here we see the add to be presented is based upon probabilities. These are found by using beta distributions (recall the CLV lecture, where with alpha and beta we can basically make all kinds of beta distributions).</p>
<p>The following makes a Thompson sampling</p>
<div class="sourceCode" id="cb770"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb770-1"><a href="customer-behavior.html#cb770-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Thompson scaling</span></span>
<span id="cb770-2"><a href="customer-behavior.html#cb770-2" aria-hidden="true" tabindex="-1"></a>conversionProbabilities <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.05</span>,<span class="fl">0.10</span>,<span class="fl">0.15</span>,<span class="fl">0.20</span>,<span class="fl">0.25</span>)</span>
<span id="cb770-3"><a href="customer-behavior.html#cb770-3" aria-hidden="true" tabindex="-1"></a>bandit <span class="ot">&lt;-</span> BasicBernoulliBandit<span class="sc">$</span><span class="fu">new</span>(<span class="at">weights =</span> conversionProbabilities)</span>
<span id="cb770-4"><a href="customer-behavior.html#cb770-4" aria-hidden="true" tabindex="-1"></a>policy <span class="ot">&lt;-</span> ThompsonSamplingPolicy<span class="sc">$</span><span class="fu">new</span>(<span class="at">alpha =</span> <span class="dv">1</span>,<span class="at">beta =</span> <span class="dv">1</span>)</span>
<span id="cb770-5"><a href="customer-behavior.html#cb770-5" aria-hidden="true" tabindex="-1"></a>agent <span class="ot">&lt;-</span> Agent<span class="sc">$</span><span class="fu">new</span>(policy,bandit)</span>
<span id="cb770-6"><a href="customer-behavior.html#cb770-6" aria-hidden="true" tabindex="-1"></a>historyThompson <span class="ot">&lt;-</span> Simulator<span class="sc">$</span><span class="fu">new</span>(agent,horizon,simulations)<span class="sc">$</span><span class="fu">run</span>()</span>
<span id="cb770-7"><a href="customer-behavior.html#cb770-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(historyThompson,<span class="at">type =</span> <span class="st">&quot;arms&quot;</span>,<span class="at">legend_labels =</span> <span class="fu">c</span>(<span class="st">&quot;Ad 1&quot;</span>,<span class="st">&quot;Ad 2&quot;</span>,<span class="st">&quot;Ad 3&quot;</span>,<span class="st">&quot;Ad 4&quot;</span>,<span class="st">&quot;Ad 5&quot;</span>)</span>
<span id="cb770-8"><a href="customer-behavior.html#cb770-8" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">legend_title =</span> <span class="st">&quot;Thompson Sampling&quot;</span>,<span class="at">legend_position =</span> <span class="st">&quot;topright&quot;</span>,<span class="at">smooth =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-390-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>Here we practically see the same result. Although as he mentions, the Thompson sampling is better at exploiting the high probability adds, thus we see that it uses add 5 more often than the epsilon greedy function.</p>
<div class="sourceCode" id="cb771"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb771-1"><a href="customer-behavior.html#cb771-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(historyThompson)</span></code></pre></div>
<pre><code>## 
## Agents:
## 
##   ThompsonSampling
## 
## Cumulative regret:
## 
##             agent    t sims cum_regret cum_regret_var cum_regret_sd
##  ThompsonSampling 1000 1000     30.073       159.1688      12.61621
## 
## 
## Cumulative reward:
## 
##             agent    t sims cum_reward cum_reward_var cum_reward_sd
##  ThompsonSampling 1000 1000    219.968       328.3834      18.12135
## 
## 
## Cumulative reward rate:
## 
##             agent    t sims cur_reward cur_reward_var cur_reward_sd
##  ThompsonSampling 1000 1000   0.219968      0.3283834    0.01812135</code></pre>
<p>We see that the reward (conversion) is 21.99% hence slightly higher, while the variance is 32.83% variance and 1.81% standard deviation.</p>
<p><strong><em>Comparison between Greedy Search and Thompson Sampling</em></strong></p>
<p>We see that the Thompson sampling is having slightly better conversion rates, that is because it quicker picks up on ad 5 which is the most successful. Also we see that the variance and standard deviation is half the size of the Epsilon Greedy.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="probabilistic-models-for-customer-analytics.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="privacy.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
