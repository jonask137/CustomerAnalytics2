<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>1 Customer Lifetime Value | Customer Analytics</title>
  <meta name="description" content="1 Customer Lifetime Value | Customer Analytics" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="1 Customer Lifetime Value | Customer Analytics" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="1 Customer Lifetime Value | Customer Analytics" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="customer-satisfaction-and-loyalty.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>setup</a></li>
<li class="chapter" data-level="1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html"><i class="fa fa-check"></i><b>1</b> Customer Lifetime Value</a>
<ul>
<li class="chapter" data-level="1.1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#non-contractual-the-matrix-formulation"><i class="fa fa-check"></i><b>1.1</b> Non-contractual The matrix formulation</a></li>
<li class="chapter" data-level="1.2" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#contractual---valuing-customer-base-residual-lifetime-value"><i class="fa fa-check"></i><b>1.2</b> Contractual - Valuing customer base + residual lifetime value</a></li>
<li class="chapter" data-level="1.3" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#non-contractual-setting---probabilitic-models"><i class="fa fa-check"></i><b>1.3</b> Non-Contractual Setting - Probabilitic Models</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#paretonbd-vs.-bgnbd"><i class="fa fa-check"></i><b>1.3.1</b> Pareto/NBD vs. BG/NBD</a></li>
<li class="chapter" data-level="1.3.2" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#paretonbd"><i class="fa fa-check"></i><b>1.3.2</b> Pareto/NBD</a>
<ul>
<li class="chapter" data-level="1.3.2.1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#data-preparation"><i class="fa fa-check"></i><b>1.3.2.1</b> Data preparation</a></li>
<li class="chapter" data-level="1.3.2.2" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#parameter-estimation"><i class="fa fa-check"></i><b>1.3.2.2</b> Parameter Estimation</a></li>
<li class="chapter" data-level="1.3.2.3" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#individual-level-estimations"><i class="fa fa-check"></i><b>1.3.2.3</b> Individual Level Estimations</a></li>
<li class="chapter" data-level="1.3.2.4" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#plotting-goodness-of-fit"><i class="fa fa-check"></i><b>1.3.2.4</b> Plotting / Goodness-of-fit</a></li>
</ul></li>
<li class="chapter" data-level="1.3.3" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#bgnbd"><i class="fa fa-check"></i><b>1.3.3</b> BG/NBD</a>
<ul>
<li class="chapter" data-level="1.3.3.1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#data-preparation-1"><i class="fa fa-check"></i><b>1.3.3.1</b> Data Preparation</a></li>
<li class="chapter" data-level="1.3.3.2" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#parameter-estimation-1"><i class="fa fa-check"></i><b>1.3.3.2</b> Parameter Estimation</a></li>
<li class="chapter" data-level="1.3.3.3" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#individual-level-estimation"><i class="fa fa-check"></i><b>1.3.3.3</b> Individual Level Estimation</a></li>
<li class="chapter" data-level="1.3.3.4" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#plotting-goodness-of-fit-1"><i class="fa fa-check"></i><b>1.3.3.4</b> Plotting / Goodness-of-fit</a></li>
</ul></li>
<li class="chapter" data-level="1.3.4" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#bgbb"><i class="fa fa-check"></i><b>1.3.4</b> BG/BB</a>
<ul>
<li class="chapter" data-level="1.3.4.1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#data-preparation-2"><i class="fa fa-check"></i><b>1.3.4.1</b> Data Preparation</a></li>
<li class="chapter" data-level="1.3.4.2" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#parameter-estimation-2"><i class="fa fa-check"></i><b>1.3.4.2</b> Parameter Estimation</a></li>
<li class="chapter" data-level="1.3.4.3" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#individual-level-estimations-1"><i class="fa fa-check"></i><b>1.3.4.3</b> Individual Level Estimations</a></li>
<li class="chapter" data-level="1.3.4.4" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#plotting-goodness-of-fit-2"><i class="fa fa-check"></i><b>1.3.4.4</b> Plotting / Goodness-of-fit</a></li>
</ul></li>
<li class="chapter" data-level="1.3.5" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#examples-from-the-lecture"><i class="fa fa-check"></i><b>1.3.5</b> Examples from the lecture</a>
<ul>
<li class="chapter" data-level="1.3.5.1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#paretonbd-1"><i class="fa fa-check"></i><b>1.3.5.1</b> Pareto/NBD</a>
<ul>
<li class="chapter" data-level="1.3.5.1.1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#estimate-parameters-for-paretonbd-model-based-upon-calibration-data"><i class="fa fa-check"></i><b>1.3.5.1.1</b> Estimate parameters for Pareto/NBD model based upon calibration data</a></li>
</ul></li>
<li class="chapter" data-level="1.3.5.2" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#bgnbg-example"><i class="fa fa-check"></i><b>1.3.5.2</b> BG/NBG example</a></li>
</ul></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html"><i class="fa fa-check"></i><b>2</b> Customer Satisfaction and Loyalty</a>
<ul>
<li class="chapter" data-level="2.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#customer-surveys"><i class="fa fa-check"></i><b>2.1</b> Customer surveys</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#concepts-and-examples"><i class="fa fa-check"></i><b>2.1.1</b> (1) Concepts and examples</a></li>
<li class="chapter" data-level="2.1.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#sampling-and-response-rate"><i class="fa fa-check"></i><b>2.1.2</b> (2) Sampling and response rate</a></li>
<li class="chapter" data-level="2.1.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#pretesting-and-measurement-validity"><i class="fa fa-check"></i><b>2.1.3</b> (3) Pretesting and measurement validity</a></li>
<li class="chapter" data-level="2.1.4" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#questionnaire-design"><i class="fa fa-check"></i><b>2.1.4</b> (4) Questionnaire design</a></li>
<li class="chapter" data-level="2.1.5" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#simple-size"><i class="fa fa-check"></i><b>2.1.5</b> (5) Simple size</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#nps"><i class="fa fa-check"></i><b>2.2</b> NPS</a></li>
<li class="chapter" data-level="2.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#cfa-and-sem-application-lavann"><i class="fa fa-check"></i><b>2.3</b> CFA and SEM Application Lavann</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#business-problem-objectives"><i class="fa fa-check"></i><b>2.3.1</b> Business Problem &amp; Objectives</a></li>
<li class="chapter" data-level="2.3.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#data"><i class="fa fa-check"></i><b>2.3.2</b> Data</a>
<ul>
<li class="chapter" data-level="2.3.2.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#efa"><i class="fa fa-check"></i><b>2.3.2.1</b> EFA</a></li>
<li class="chapter" data-level="2.3.2.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#cfa-model"><i class="fa fa-check"></i><b>2.3.2.2</b> CFA model</a>
<ul>
<li class="chapter" data-level="2.3.2.2.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#initial-model"><i class="fa fa-check"></i><b>2.3.2.2.1</b> Initial model</a></li>
<li class="chapter" data-level="2.3.2.2.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#second-model"><i class="fa fa-check"></i><b>2.3.2.2.2</b> Second model</a>
<ul>
<li class="chapter" data-level="2.3.2.2.2.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#intepretation-of-the-model"><i class="fa fa-check"></i><b>2.3.2.2.2.1</b> Intepretation of the model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2.3.2.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#sem"><i class="fa fa-check"></i><b>2.3.2.3</b> SEM</a></li>
</ul></li>
<li class="chapter" data-level="2.3.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#plotting-the-model"><i class="fa fa-check"></i><b>2.3.3</b> Plotting the model</a></li>
<li class="chapter" data-level="2.3.4" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#consider-a-more-complex-sem-model-involving-a-mediating-effect."><i class="fa fa-check"></i><b>2.3.4</b> Consider a more complex SEM model involving a mediating effect.</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#pls"><i class="fa fa-check"></i><b>2.4</b> PLS</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#definition-of-pls"><i class="fa fa-check"></i><b>2.4.1</b> Definition of PLS</a></li>
<li class="chapter" data-level="2.4.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#when-to-use-pls-and-when-to-use-sem"><i class="fa fa-check"></i><b>2.4.2</b> When to use PLS and when to use SEM</a></li>
<li class="chapter" data-level="2.4.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#model-construction"><i class="fa fa-check"></i><b>2.4.3</b> Model construction</a></li>
<li class="chapter" data-level="2.4.4" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#model-estimation"><i class="fa fa-check"></i><b>2.4.4</b> Model Estimation</a></li>
<li class="chapter" data-level="2.4.5" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#model-evaluation"><i class="fa fa-check"></i><b>2.4.5</b> Model evaluation</a></li>
<li class="chapter" data-level="2.4.6" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#example-for-the-lecture"><i class="fa fa-check"></i><b>2.4.6</b> Example for the lecture</a>
<ul>
<li class="chapter" data-level="2.4.6.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#making-structural--and-measurement-model"><i class="fa fa-check"></i><b>2.4.6.1</b> Making structural- and measurement model</a></li>
<li class="chapter" data-level="2.4.6.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#now-we-can-estimate-the-model"><i class="fa fa-check"></i><b>2.4.6.2</b> Now we can estimate the model</a></li>
<li class="chapter" data-level="2.4.6.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#measuring-quality-of-the-constructs"><i class="fa fa-check"></i><b>2.4.6.3</b> Measuring quality of the constructs</a></li>
<li class="chapter" data-level="2.4.6.4" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#are-the-coefficients-significant"><i class="fa fa-check"></i><b>2.4.6.4</b> Are the coefficients significant?</a></li>
</ul></li>
<li class="chapter" data-level="2.4.7" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#revised-code"><i class="fa fa-check"></i><b>2.4.7</b> Revised code</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#segmentation-clustering"><i class="fa fa-check"></i><b>2.5</b> Segmentation (Clustering)</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#what-is-clustering"><i class="fa fa-check"></i><b>2.5.1</b> What is clustering</a></li>
<li class="chapter" data-level="2.5.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#clustering-techniques"><i class="fa fa-check"></i><b>2.5.2</b> Clustering techniques</a></li>
<li class="chapter" data-level="2.5.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#an-example"><i class="fa fa-check"></i><b>2.5.3</b> An example</a>
<ul>
<li class="chapter" data-level="2.5.3.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#background"><i class="fa fa-check"></i><b>2.5.3.1</b> 1. Background</a>
<ul>
<li class="chapter" data-level="2.5.3.1.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#the-primary-objective-is"><i class="fa fa-check"></i><b>2.5.3.1.1</b> 1.1. The primary objective is:</a></li>
</ul></li>
<li class="chapter" data-level="2.5.3.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#the-data-data-understanding-phase"><i class="fa fa-check"></i><b>2.5.3.2</b> 2. The data (Data Understanding Phase)</a>
<ul>
<li class="chapter" data-level="2.5.3.2.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#load-data-correctly"><i class="fa fa-check"></i><b>2.5.3.2.1</b> 2.1 Load data correctly</a></li>
<li class="chapter" data-level="2.5.3.2.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#check-if-the-data-is-numerical-or-categorical"><i class="fa fa-check"></i><b>2.5.3.2.2</b> 2.2 Check if the data is numerical or categorical</a></li>
<li class="chapter" data-level="2.5.3.2.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#missing-treatment"><i class="fa fa-check"></i><b>2.5.3.2.3</b> 2.3 Missing treatment</a></li>
<li class="chapter" data-level="2.5.3.2.4" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#select-relevant-variables"><i class="fa fa-check"></i><b>2.5.3.2.4</b> 2.4 Select relevant variables</a></li>
<li class="chapter" data-level="2.5.3.2.5" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#identify-extreme-outliers-the-most-dissimilar-customers"><i class="fa fa-check"></i><b>2.5.3.2.5</b> 2.5.Identify extreme outliers (the most dissimilar customers)</a></li>
<li class="chapter" data-level="2.5.3.2.6" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#standardize-the-variables-mean0-std.dev1"><i class="fa fa-check"></i><b>2.5.3.2.6</b> 2.6 Standardize the variables (mean=0, std.dev=1)</a></li>
</ul></li>
<li class="chapter" data-level="2.5.3.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#hierarchical-clustering-using-variables"><i class="fa fa-check"></i><b>2.5.3.3</b> 3. Hierarchical clustering (using variables)</a></li>
<li class="chapter" data-level="2.5.3.4" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#hierarchical-clustering-using-pcs-score-vectors"><i class="fa fa-check"></i><b>2.5.3.4</b> 4. Hierarchical clustering (using PCs score vectors)</a></li>
<li class="chapter" data-level="2.5.3.5" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#k-means"><i class="fa fa-check"></i><b>2.5.3.5</b> 5. K-means</a></li>
<li class="chapter" data-level="2.5.3.6" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#validation-and-profiling-the-clusters"><i class="fa fa-check"></i><b>2.5.3.6</b> 6. Validation and profiling the clusters</a>
<ul>
<li class="chapter" data-level="2.5.3.6.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#assessing-cluster-stability"><i class="fa fa-check"></i><b>2.5.3.6.1</b> 6.1. Assessing cluster stability</a></li>
<li class="chapter" data-level="2.5.3.6.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#assessing-criterion-predictive-validity"><i class="fa fa-check"></i><b>2.5.3.6.2</b> 6.2. Assessing criterion (predictive) validity</a></li>
<li class="chapter" data-level="2.5.3.6.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#profiling-the-final-cluster-solution"><i class="fa fa-check"></i><b>2.5.3.6.3</b> 6.3. Profiling the final cluster solution</a></li>
</ul></li>
<li class="chapter" data-level="2.5.3.7" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#final-remarks"><i class="fa fa-check"></i><b>2.5.3.7</b> 7. Final remarks</a></li>
</ul></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html"><i class="fa fa-check"></i><b>3</b> Recommender Systems and Customer Targeting</a>
<ul>
<li class="chapter" data-level="3.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#association-rule"><i class="fa fa-check"></i><b>3.1</b> Association rule</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#loading-and-data-exploration"><i class="fa fa-check"></i><b>3.1.1</b> Loading and data exploration</a></li>
<li class="chapter" data-level="3.1.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#data-preprocessing"><i class="fa fa-check"></i><b>3.1.2</b> Data preprocessing</a>
<ul>
<li class="chapter" data-level="3.1.2.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#encoding-to-correct-data-types"><i class="fa fa-check"></i><b>3.1.2.1</b> Encoding to correct data types</a></li>
<li class="chapter" data-level="3.1.2.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#create-a-data-frame-with-one-row-pr.-invoice"><i class="fa fa-check"></i><b>3.1.2.2</b> Create a data frame with one row pr. invoice</a></li>
</ul></li>
<li class="chapter" data-level="3.1.3" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#loading-transactions"><i class="fa fa-check"></i><b>3.1.3</b> Loading transactions</a></li>
<li class="chapter" data-level="3.1.4" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#plotting"><i class="fa fa-check"></i><b>3.1.4</b> Plotting</a></li>
<li class="chapter" data-level="3.1.5" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#apriori-calculation"><i class="fa fa-check"></i><b>3.1.5</b> Apriori calculation</a>
<ul>
<li class="chapter" data-level="3.1.5.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#another-example-where-maxlen-3"><i class="fa fa-check"></i><b>3.1.5.1</b> Another example where maxlen = 3</a></li>
<li class="chapter" data-level="3.1.5.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#filtering-on-right-hand-side.-an-example-with-the-item-metal"><i class="fa fa-check"></i><b>3.1.5.2</b> Filtering on right hand side. An example with the item {METAL}</a></li>
<li class="chapter" data-level="3.1.5.3" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#filtering-on-left-hand-side.-an-example-with-the-item-metal"><i class="fa fa-check"></i><b>3.1.5.3</b> Filtering on left hand side. An example with the item {METAL}</a></li>
</ul></li>
<li class="chapter" data-level="3.1.6" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#plotting-association-rules"><i class="fa fa-check"></i><b>3.1.6</b> Plotting association rules</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#colaborative-filtering"><i class="fa fa-check"></i><b>3.2</b> Colaborative filtering</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#loading-and-formatting-data"><i class="fa fa-check"></i><b>3.2.1</b> Loading and formatting data</a>
<ul>
<li class="chapter" data-level="3.2.1.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#loading-metadata-that-gets-loaded-with-main-dataset"><i class="fa fa-check"></i><b>3.2.1.1</b> Loading metadata that gets loaded with main dataset</a></li>
</ul></li>
<li class="chapter" data-level="3.2.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#data-exploration"><i class="fa fa-check"></i><b>3.2.2</b> Data Exploration</a>
<ul>
<li class="chapter" data-level="3.2.2.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#plotting-1"><i class="fa fa-check"></i><b>3.2.2.1</b> Plotting</a></li>
</ul></li>
<li class="chapter" data-level="3.2.3" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#what-models-can-we-use"><i class="fa fa-check"></i><b>3.2.3</b> What models can we use?</a></li>
<li class="chapter" data-level="3.2.4" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#training-and-test-set"><i class="fa fa-check"></i><b>3.2.4</b> Training and test set</a></li>
<li class="chapter" data-level="3.2.5" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#a-small-example-with-ibcf-item-based"><i class="fa fa-check"></i><b>3.2.5</b> A small example with IBCF (item based)</a></li>
<li class="chapter" data-level="3.2.6" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#ubcf---user-based-collaborative-based"><i class="fa fa-check"></i><b>3.2.6</b> UBCF - User based collaborative based</a>
<ul>
<li class="chapter" data-level="3.2.6.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#fitting-the-model"><i class="fa fa-check"></i><b>3.2.6.1</b> Fitting the model</a></li>
<li class="chapter" data-level="3.2.6.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#predicting-making-recommendations"><i class="fa fa-check"></i><b>3.2.6.2</b> Predicting (making) recommendations</a></li>
</ul></li>
<li class="chapter" data-level="3.2.7" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#cross-validation"><i class="fa fa-check"></i><b>3.2.7</b> Cross validation</a></li>
<li class="chapter" data-level="3.2.8" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#ibcf---item-based-collaborative-based"><i class="fa fa-check"></i><b>3.2.8</b> IBCF - Item based collaborative based</a>
<ul>
<li class="chapter" data-level="3.2.8.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#fitting-the-model-using-cv"><i class="fa fa-check"></i><b>3.2.8.1</b> Fitting the model (using CV)</a></li>
<li class="chapter" data-level="3.2.8.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#making-predictions"><i class="fa fa-check"></i><b>3.2.8.2</b> Making predictions</a></li>
<li class="chapter" data-level="3.2.8.3" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#performance-metrics"><i class="fa fa-check"></i><b>3.2.8.3</b> Performance metrics</a></li>
</ul></li>
<li class="chapter" data-level="3.2.9" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#building-roc-curve-and-precision-recall-rate"><i class="fa fa-check"></i><b>3.2.9</b> Building ROC curve and precision / recall rate</a></li>
<li class="chapter" data-level="3.2.10" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#comparing-ubcf-and-ibcf"><i class="fa fa-check"></i><b>3.2.10</b> Comparing UBCF and IBCF</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#latent-factor-models"><i class="fa fa-check"></i><b>3.3</b> Latent Factor Models</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#fitting-the-model-1"><i class="fa fa-check"></i><b>3.3.1</b> Fitting the model</a></li>
<li class="chapter" data-level="3.3.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#making-predictions-1"><i class="fa fa-check"></i><b>3.3.2</b> Making predictions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html"><i class="fa fa-check"></i><b>4</b> Probabilistic Models for Customer Analytics</a>
<ul>
<li class="chapter" data-level="4.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#bayesian-networks"><i class="fa fa-check"></i><b>4.1</b> Bayesian Networks</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#why-bayesian"><i class="fa fa-check"></i><b>4.1.1</b> <strong><em>Why Bayesian?</em></strong></a>
<ul>
<li class="chapter" data-level="4.1.1.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#many-names-for-bayesian-networks"><i class="fa fa-check"></i><b>4.1.1.1</b> <strong>Many names for Bayesian Networks</strong></a></li>
</ul></li>
<li class="chapter" data-level="4.1.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#terms-and-explanatory-examples"><i class="fa fa-check"></i><b>4.1.2</b> Terms and explanatory examples</a>
<ul>
<li class="chapter" data-level="4.1.2.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#types-of-connections"><i class="fa fa-check"></i><b>4.1.2.1</b> Types of connections</a></li>
<li class="chapter" data-level="4.1.2.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#variable-selection-based-on-a-bayesian-network"><i class="fa fa-check"></i><b>4.1.2.2</b> Variable selection based on a Bayesian Network</a></li>
</ul></li>
<li class="chapter" data-level="4.1.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#independence"><i class="fa fa-check"></i><b>4.1.3</b> Independence</a></li>
<li class="chapter" data-level="4.1.4" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#methods-for-identifying-the-network"><i class="fa fa-check"></i><b>4.1.4</b> Methods for identifying the network</a>
<ul>
<li class="chapter" data-level="4.1.4.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#algorithms-focused-on-causality-discovery"><i class="fa fa-check"></i><b>4.1.4.1</b> 1. <strong><em>Algorithms focused on causality discovery</em></strong></a></li>
<li class="chapter" data-level="4.1.4.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#algorithms-focused-on-prediction"><i class="fa fa-check"></i><b>4.1.4.2</b> 2. <strong><em>Algorithms focused on prediction</em></strong></a></li>
</ul></li>
<li class="chapter" data-level="4.1.5" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#real-life-application"><i class="fa fa-check"></i><b>4.1.5</b> <strong>Real life application</strong></a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#application-1-explaining-and-predicting-customer-retention-in-a-virtual-community"><i class="fa fa-check"></i><b>4.2</b> Application 1: Explaining and Predicting Customer Retention in a Virtual Community</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#getting-the-structure"><i class="fa fa-check"></i><b>4.2.1</b> 1. Getting the structure</a>
<ul>
<li class="chapter" data-level="4.2.1.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#a.-building-the-structure-and-parameters-manually"><i class="fa fa-check"></i><b>4.2.1.1</b> A. Building the structure and parameters manually</a>
<ul>
<li class="chapter" data-level="4.2.1.1.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#approaches-to-make-the-network"><i class="fa fa-check"></i><b>4.2.1.1.1</b> Approaches to make the network</a>
<ul>
<li class="chapter" data-level="4.2.1.1.1.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#first-approach"><i class="fa fa-check"></i><b>4.2.1.1.1.1</b> First approach</a></li>
<li class="chapter" data-level="4.2.1.1.1.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#second-approach"><i class="fa fa-check"></i><b>4.2.1.1.1.2</b> Second approach</a></li>
<li class="chapter" data-level="4.2.1.1.1.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#third-approach"><i class="fa fa-check"></i><b>4.2.1.1.1.3</b> Third approach</a></li>
</ul></li>
<li class="chapter" data-level="4.2.1.1.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#loadingentering-data"><i class="fa fa-check"></i><b>4.2.1.1.2</b> Loading/entering data</a></li>
<li class="chapter" data-level="4.2.1.1.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#conditional-probability-table-cpt"><i class="fa fa-check"></i><b>4.2.1.1.3</b> Conditional probability table (CPT)</a></li>
</ul></li>
<li class="chapter" data-level="4.2.1.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#b.-learning-the-structure-and-parameters-from-observational-data"><i class="fa fa-check"></i><b>4.2.1.2</b> B. Learning the structure and parameters from observational data</a>
<ul>
<li class="chapter" data-level="4.2.1.2.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#grow-shrink-gs---learning-a-structure-using-a-constrained-based-algorithm"><i class="fa fa-check"></i><b>4.2.1.2.1</b> Grow-shrink (gs) - Learning a structure using a constrained-based algorithm</a>
<ul>
<li class="chapter" data-level="4.2.1.2.1.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#identifying-undirectred-links"><i class="fa fa-check"></i><b>4.2.1.2.1.1</b> Identifying undirectred links</a></li>
</ul></li>
<li class="chapter" data-level="4.2.1.2.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#hill-climbing-hc---learning-the-structure-using-a-score-based-algorithm"><i class="fa fa-check"></i><b>4.2.1.2.2</b> Hill-Climbing (hc) - Learning the structure using a score-based algorithm</a></li>
<li class="chapter" data-level="4.2.1.2.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#fitting-the-model-to-the-data-learning-the-probabilities"><i class="fa fa-check"></i><b>4.2.1.2.3</b> Fitting the model to the data (learning the probabilities)</a></li>
<li class="chapter" data-level="4.2.1.2.4" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#alternatives-to-grow-shrink-and-hc"><i class="fa fa-check"></i><b>4.2.1.2.4</b> Alternatives to Grow-Shrink and HC</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4.2.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#model-evaluation-1"><i class="fa fa-check"></i><b>4.2.2</b> 2. Model evaluation</a>
<ul>
<li class="chapter" data-level="4.2.2.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#i.-metrics-of-model-complexity"><i class="fa fa-check"></i><b>4.2.2.1</b> I. Metrics of model complexity</a></li>
<li class="chapter" data-level="4.2.2.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#ii.-metrics-of-model-sensitivity"><i class="fa fa-check"></i><b>4.2.2.2</b> II. Metrics of model sensitivity</a></li>
<li class="chapter" data-level="4.2.2.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#iii.-evaluate-the-arc.strength"><i class="fa fa-check"></i><b>4.2.2.3</b> III. Evaluate the arc.strength()</a>
<ul>
<li class="chapter" data-level="4.2.2.3.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#for-the-growth-shrink"><i class="fa fa-check"></i><b>4.2.2.3.1</b> For the growth shrink</a></li>
<li class="chapter" data-level="4.2.2.3.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#for-the-hill-climbing-structure"><i class="fa fa-check"></i><b>4.2.2.3.2</b> For the hill-climbing structure</a></li>
<li class="chapter" data-level="4.2.2.3.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#different-information-criteria-evaluations"><i class="fa fa-check"></i><b>4.2.2.3.3</b> Different information criteria evaluations</a></li>
</ul></li>
<li class="chapter" data-level="4.2.2.4" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#iv.-metrics-of-predictive-accuracy-error-rate-confusion-matrix-auc"><i class="fa fa-check"></i><b>4.2.2.4</b> IV. Metrics of predictive accuracy (error rate, confusion matrix, AUC)</a>
<ul>
<li class="chapter" data-level="4.2.2.4.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#cross-validation-1"><i class="fa fa-check"></i><b>4.2.2.4.1</b> Cross validation</a></li>
<li class="chapter" data-level="4.2.2.4.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#alternative-approach-to-fit-and-predict-without-grain"><i class="fa fa-check"></i><b>4.2.2.4.2</b> Alternative approach to fit and predict (Without gRain)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4.2.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#making-inference-and-queries-based-on-the-model"><i class="fa fa-check"></i><b>4.2.3</b> 3. Making inference and queries based on the model</a>
<ul>
<li class="chapter" data-level="4.2.3.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#diagnostics-forward-inference"><i class="fa fa-check"></i><b>4.2.3.1</b> Diagnostics (Forward inference)</a>
<ul>
<li class="chapter" data-level="4.2.3.1.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#let-us-repeat-the-same-analysis-by-setting-evidence-in-pleasure"><i class="fa fa-check"></i><b>4.2.3.1.1</b> <em>let us repeat the same analysis by setting evidence in Pleasure</em></a></li>
</ul></li>
<li class="chapter" data-level="4.2.3.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#diagnostic-backward-inference"><i class="fa fa-check"></i><b>4.2.3.2</b> Diagnostic (Backward inference)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#application-2-identifying-populations-with-positive-expected-lift-in-profit-elp-and-targeting"><i class="fa fa-check"></i><b>4.3</b> Application 2: Identifying populations with Positive Expected Lift in Profit (ELP) and targeting</a></li>
<li class="chapter" data-level="4.4" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#application-3-product-recommendation-using-probabilistic-models-bn"><i class="fa fa-check"></i><b>4.4</b> Application 3: Product Recommendation using Probabilistic Models (BN)</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#method-1-learn-the-probabilistic-relationships-using-a-bayesian-network-learning"><i class="fa fa-check"></i><b>4.4.1</b> Method 1: Learn the probabilistic relationships using a Bayesian network learning</a></li>
<li class="chapter" data-level="4.4.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#method-2-finding-latent-segments"><i class="fa fa-check"></i><b>4.4.2</b> Method 2: Finding latent segments</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#latent-models-for-cross-selling-and-acquisition-sequence"><i class="fa fa-check"></i><b>4.5</b> Latent models for cross selling and acquisition sequence</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#latent-trait-model---applying-the-ltm-package-in-r"><i class="fa fa-check"></i><b>4.5.1</b> Latent Trait Model - Applying the LTM Package in R</a></li>
<li class="chapter" data-level="4.5.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#the-latent-hidden-markov-model"><i class="fa fa-check"></i><b>4.5.2</b> The latent (hidden) Markov model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="customer-behavior.html"><a href="customer-behavior.html"><i class="fa fa-check"></i><b>5</b> Customer behavior</a>
<ul>
<li class="chapter" data-level="5.1" data-path="customer-behavior.html"><a href="customer-behavior.html#characteristics-of-cliskstream"><i class="fa fa-check"></i><b>5.1</b> Characteristics of cliskstream</a></li>
<li class="chapter" data-level="5.2" data-path="customer-behavior.html"><a href="customer-behavior.html#applications-with-clickstream-data"><i class="fa fa-check"></i><b>5.2</b> Applications with clickstream data</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="customer-behavior.html"><a href="customer-behavior.html#a-motivating-example"><i class="fa fa-check"></i><b>5.2.1</b> A motivating example</a>
<ul>
<li class="chapter" data-level="5.2.1.1" data-path="customer-behavior.html"><a href="customer-behavior.html#i-predict-either-the-next-click-or-the-ﬁnal-click-state-of-a-customer."><i class="fa fa-check"></i><b>5.2.1.1</b> i) Predict either the next click or the ﬁnal click (state) of a customer.</a></li>
<li class="chapter" data-level="5.2.1.2" data-path="customer-behavior.html"><a href="customer-behavior.html#ii-clustering-and-generalizing-upon-clickstreams"><i class="fa fa-check"></i><b>5.2.1.2</b> ii) Clustering and generalizing upon clickstreams</a></li>
</ul></li>
<li class="chapter" data-level="5.2.2" data-path="customer-behavior.html"><a href="customer-behavior.html#second-exercise-clickstream-more-extensive"><i class="fa fa-check"></i><b>5.2.2</b> Second exercise (clickstream) more extensive</a></li>
<li class="chapter" data-level="5.2.3" data-path="customer-behavior.html"><a href="customer-behavior.html#a-concrete-eaxmple-with-real-data"><i class="fa fa-check"></i><b>5.2.3</b> A concrete eaxmple with real data</a>
<ul>
<li class="chapter" data-level="5.2.3.1" data-path="customer-behavior.html"><a href="customer-behavior.html#markov-chain"><i class="fa fa-check"></i><b>5.2.3.1</b> (1) Markov Chain</a></li>
<li class="chapter" data-level="5.2.3.2" data-path="customer-behavior.html"><a href="customer-behavior.html#using-association-rule-mining"><i class="fa fa-check"></i><b>5.2.3.2</b> (2) Using association rule mining</a></li>
<li class="chapter" data-level="5.2.3.3" data-path="customer-behavior.html"><a href="customer-behavior.html#use-frequencies-instead-of-the-sequence"><i class="fa fa-check"></i><b>5.2.3.3</b> (3) Use frequencies instead of the sequence</a></li>
<li class="chapter" data-level="5.2.3.4" data-path="customer-behavior.html"><a href="customer-behavior.html#neural-networks"><i class="fa fa-check"></i><b>5.2.3.4</b> (4) Neural networks</a></li>
</ul></li>
<li class="chapter" data-level="5.2.4" data-path="customer-behavior.html"><a href="customer-behavior.html#optional-exercise"><i class="fa fa-check"></i><b>5.2.4</b> Optional exercise</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="customer-behavior.html"><a href="customer-behavior.html#ab-testing"><i class="fa fa-check"></i><b>5.3</b> AB Testing</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="customer-behavior.html"><a href="customer-behavior.html#what-is-it-and-when-to-apply-it"><i class="fa fa-check"></i><b>5.3.1</b> (1 + 2): What is it and when to apply it</a></li>
<li class="chapter" data-level="5.3.2" data-path="customer-behavior.html"><a href="customer-behavior.html#how-to-perform-an-ab-test"><i class="fa fa-check"></i><b>5.3.2</b> (3): How to perform an A/B test</a></li>
<li class="chapter" data-level="5.3.3" data-path="customer-behavior.html"><a href="customer-behavior.html#pitfalls-and-challenges."><i class="fa fa-check"></i><b>5.3.3</b> (4): Pitfalls and challenges.</a></li>
<li class="chapter" data-level="5.3.4" data-path="customer-behavior.html"><a href="customer-behavior.html#ab-tests-and-bandits."><i class="fa fa-check"></i><b>5.3.4</b> (5): A/B tests and bandits.</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Customer Analytics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="customer-lifetime-value" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Customer Lifetime Value</h1>
<p>Contractual vs. non contractual:</p>
<ul>
<li>Contractual setting: We see that a customer pays a constant amount each month. Notice that one may also buy extra stuff.</li>
<li>Non contractual setting: We see that a customer can buy at any given time, e.g., a supermarket.</li>
<li>Discrete purchase: That is when a person makes purchase for a given time period, that is for instance subscriptions</li>
<li>Continuous purchase: That is a person is able to make a purchase at any given time.</li>
</ul>
<p>In the following we see an example of placing orders either in the beginning or at the end of the period. The difference between case 1 and 2, is that in case 2 it is not a new customer, as we do not have a purchase in time period 0.</p>
<div class="figure">
<img src="images/Descrete%20purchases.png" alt="" />
<p class="caption">Discrete purchases</p>
</div>
<p>See section <em>CLV continuous time accounting for when you get the money</em> in the CLV templates.</p>
<div id="non-contractual-the-matrix-formulation" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> Non-contractual The matrix formulation</h2>
<p>This is for a <strong>non contractual setting.</strong></p>
<p>This comes in relation to having different states, where the last state is an absorbing state, which indicates a lost customer. It can be shown with a Markov Chain.</p>
<div class="figure">
<img src="images/cohorts.png" alt="" />
<p class="caption">Different states</p>
</div>
<p>We see that there are different probabilities of starting in the different states. Then for that given state you can either move one down or move up to state one. Where state 1 = most recent purchase.</p>
<p>Notice that this illustration has four states, state one equal the most recent purchasers while state 5 is the absorbing state. In this state there is 0 probability of moving up to state 1, hence the customer is lost.</p>
<p>In the following example we have a scenario of the cost being 4 and a purchase giving a margin og 40</p>
<p><strong>For an infinite period</strong></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="customer-lifetime-value.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Facts</span></span>
<span id="cb1-2"><a href="customer-lifetime-value.html#cb1-2" aria-hidden="true" tabindex="-1"></a>margin <span class="ot">&lt;-</span> <span class="dv">40</span></span>
<span id="cb1-3"><a href="customer-lifetime-value.html#cb1-3" aria-hidden="true" tabindex="-1"></a>costs <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb1-4"><a href="customer-lifetime-value.html#cb1-4" aria-hidden="true" tabindex="-1"></a>discount_factor <span class="ot">&lt;-</span> <span class="fl">1.2</span></span>
<span id="cb1-5"><a href="customer-lifetime-value.html#cb1-5" aria-hidden="true" tabindex="-1"></a>states <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb1-6"><a href="customer-lifetime-value.html#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="customer-lifetime-value.html#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Transition probabilities</span></span>
<span id="cb1-8"><a href="customer-lifetime-value.html#cb1-8" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fl">0.3</span></span>
<span id="cb1-9"><a href="customer-lifetime-value.html#cb1-9" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb1-10"><a href="customer-lifetime-value.html#cb1-10" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fl">0.15</span></span>
<span id="cb1-11"><a href="customer-lifetime-value.html#cb1-11" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb1-12"><a href="customer-lifetime-value.html#cb1-12" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb1-13"><a href="customer-lifetime-value.html#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="customer-lifetime-value.html#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">#Transition probability matrix</span></span>
<span id="cb1-15"><a href="customer-lifetime-value.html#cb1-15" aria-hidden="true" tabindex="-1"></a>P <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> states,<span class="at">byrow =</span> <span class="cn">TRUE</span></span>
<span id="cb1-16"><a href="customer-lifetime-value.html#cb1-16" aria-hidden="true" tabindex="-1"></a>            ,<span class="fu">c</span>(p1,<span class="dv">1</span><span class="sc">-</span>p1,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb1-17"><a href="customer-lifetime-value.html#cb1-17" aria-hidden="true" tabindex="-1"></a>               p2,<span class="dv">0</span>,<span class="dv">1</span><span class="sc">-</span>p2,<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb1-18"><a href="customer-lifetime-value.html#cb1-18" aria-hidden="true" tabindex="-1"></a>               p3,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span><span class="sc">-</span>p3,<span class="dv">0</span>,</span>
<span id="cb1-19"><a href="customer-lifetime-value.html#cb1-19" aria-hidden="true" tabindex="-1"></a>               p4,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span><span class="sc">-</span>p4,</span>
<span id="cb1-20"><a href="customer-lifetime-value.html#cb1-20" aria-hidden="true" tabindex="-1"></a>               p5,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span><span class="sc">-</span>p5</span>
<span id="cb1-21"><a href="customer-lifetime-value.html#cb1-21" aria-hidden="true" tabindex="-1"></a>               )<span class="co"># </span><span class="al">NOTE</span><span class="co">, ADD STATES BELOW, AND EXTEND THE MATRIX</span></span>
<span id="cb1-22"><a href="customer-lifetime-value.html#cb1-22" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb1-23"><a href="customer-lifetime-value.html#cb1-23" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb1-24"><a href="customer-lifetime-value.html#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="customer-lifetime-value.html#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Profit vector (G for profit :) ) </span></span>
<span id="cb1-26"><a href="customer-lifetime-value.html#cb1-26" aria-hidden="true" tabindex="-1"></a>G <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> states</span>
<span id="cb1-27"><a href="customer-lifetime-value.html#cb1-27" aria-hidden="true" tabindex="-1"></a>            ,<span class="fu">c</span>(margin <span class="sc">-</span> costs, <span class="co">#Purchase only occurs in state 1</span></span>
<span id="cb1-28"><a href="customer-lifetime-value.html#cb1-28" aria-hidden="true" tabindex="-1"></a>               <span class="sc">-</span>costs,</span>
<span id="cb1-29"><a href="customer-lifetime-value.html#cb1-29" aria-hidden="true" tabindex="-1"></a>               <span class="sc">-</span>costs,</span>
<span id="cb1-30"><a href="customer-lifetime-value.html#cb1-30" aria-hidden="true" tabindex="-1"></a>               <span class="sc">-</span>costs,</span>
<span id="cb1-31"><a href="customer-lifetime-value.html#cb1-31" aria-hidden="true" tabindex="-1"></a>               <span class="dv">0</span>)) <span class="co">#We spend no money on the last recency state, because we dont mail them</span></span>
<span id="cb1-32"><a href="customer-lifetime-value.html#cb1-32" aria-hidden="true" tabindex="-1"></a>            <span class="co"># </span><span class="al">NOTE</span><span class="co"> THE AMOUNT OF LINES MUST = STATES</span></span>
<span id="cb1-33"><a href="customer-lifetime-value.html#cb1-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-34"><a href="customer-lifetime-value.html#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="co">#Identify matrix</span></span>
<span id="cb1-35"><a href="customer-lifetime-value.html#cb1-35" aria-hidden="true" tabindex="-1"></a>I <span class="ot">&lt;-</span> <span class="fu">diag</span>(states)</span>
<span id="cb1-36"><a href="customer-lifetime-value.html#cb1-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-37"><a href="customer-lifetime-value.html#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="co">#Customer lifetime value</span></span>
<span id="cb1-38"><a href="customer-lifetime-value.html#cb1-38" aria-hidden="true" tabindex="-1"></a>CLV <span class="ot">&lt;-</span> <span class="fu">solve</span>(I<span class="dv">-1</span><span class="sc">/</span>(discount_factor)<span class="sc">*</span>P) <span class="sc">%*%</span> G</span>
<span id="cb1-39"><a href="customer-lifetime-value.html#cb1-39" aria-hidden="true" tabindex="-1"></a>CLV</span></code></pre></div>
<pre><code>##           [,1]
## [1,] 52.319609
## [2,]  5.553784
## [3,]  1.250773
## [4,] -1.820016
## [5,]  0.000000</code></pre>
<p>We see that for customers starting in state 1, we have a profit of 52, if the customer is starting in state 2, then the profit is 5.6, if starting in state three then 1.25 and fourth they are not positive.</p>
<p>Notice that the approach above show the infinite lifetime of the customers. We may be interested in finding out what the lifetime of a customer is, given a certain period. That we look into in the following</p>
<p><strong>Infinite modified CLV</strong></p>
<p><em>It is modified as the infinite solution, does not tell what they earn after a certain period, the following does, i guess that is why it is called modified</em></p>
<p>We can also calculate the infinite <em>modified</em> solution, where we apply the transition probabilities and assess how the lifetime value of a customer starting in a specific state is. Notice, we are already having the customer.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="customer-lifetime-value.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Note, it is prerequisite to run the code above first</span></span>
<span id="cb3-2"><a href="customer-lifetime-value.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Infinite modified solution *</span></span>
<span id="cb3-3"><a href="customer-lifetime-value.html#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="customer-lifetime-value.html#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Transition probabilities</span></span>
<span id="cb3-5"><a href="customer-lifetime-value.html#cb3-5" aria-hidden="true" tabindex="-1"></a>p1<span class="ot">=</span><span class="fl">0.3</span></span>
<span id="cb3-6"><a href="customer-lifetime-value.html#cb3-6" aria-hidden="true" tabindex="-1"></a>p2<span class="ot">=</span><span class="fl">0.2</span></span>
<span id="cb3-7"><a href="customer-lifetime-value.html#cb3-7" aria-hidden="true" tabindex="-1"></a>p3<span class="ot">=</span><span class="fl">0.15</span></span>
<span id="cb3-8"><a href="customer-lifetime-value.html#cb3-8" aria-hidden="true" tabindex="-1"></a>p4<span class="ot">=</span><span class="dv">0</span> <span class="co">#Notice, that we discovered above that recency state 4 where negative, so we will not invest in these. Then we also assume, that they will not buy anything. One may also have kept p = 0.05</span></span>
<span id="cb3-9"><a href="customer-lifetime-value.html#cb3-9" aria-hidden="true" tabindex="-1"></a>p5<span class="ot">=</span><span class="dv">0</span></span>
<span id="cb3-10"><a href="customer-lifetime-value.html#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="customer-lifetime-value.html#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Transition probability matrix</span></span>
<span id="cb3-12"><a href="customer-lifetime-value.html#cb3-12" aria-hidden="true" tabindex="-1"></a>Pmod<span class="ot">=</span><span class="fu">matrix</span>(<span class="at">nrow=</span>states,<span class="at">byrow=</span>T,</span>
<span id="cb3-13"><a href="customer-lifetime-value.html#cb3-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">c</span>(p1,<span class="dv">1</span><span class="sc">-</span>p1,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb3-14"><a href="customer-lifetime-value.html#cb3-14" aria-hidden="true" tabindex="-1"></a>              p2,<span class="dv">0</span>,<span class="dv">1</span><span class="sc">-</span>p2,<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb3-15"><a href="customer-lifetime-value.html#cb3-15" aria-hidden="true" tabindex="-1"></a>              p3,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span><span class="sc">-</span>p3,<span class="dv">0</span>,</span>
<span id="cb3-16"><a href="customer-lifetime-value.html#cb3-16" aria-hidden="true" tabindex="-1"></a>              p4,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span><span class="sc">-</span>p4,</span>
<span id="cb3-17"><a href="customer-lifetime-value.html#cb3-17" aria-hidden="true" tabindex="-1"></a>              p5,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span><span class="sc">-</span>p5</span>
<span id="cb3-18"><a href="customer-lifetime-value.html#cb3-18" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb3-19"><a href="customer-lifetime-value.html#cb3-19" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb3-20"><a href="customer-lifetime-value.html#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="customer-lifetime-value.html#cb3-21" aria-hidden="true" tabindex="-1"></a>Gmod<span class="ot">=</span><span class="fu">matrix</span>(<span class="fu">c</span>(margin<span class="sc">-</span>costs,  <span class="co">#G for profit :)</span></span>
<span id="cb3-22"><a href="customer-lifetime-value.html#cb3-22" aria-hidden="true" tabindex="-1"></a>              <span class="sc">-</span>costs,</span>
<span id="cb3-23"><a href="customer-lifetime-value.html#cb3-23" aria-hidden="true" tabindex="-1"></a>              <span class="sc">-</span>costs,</span>
<span id="cb3-24"><a href="customer-lifetime-value.html#cb3-24" aria-hidden="true" tabindex="-1"></a>              <span class="dv">0</span>, <span class="co">#Notice, that we remove the cost, that is also why we know that p4 = 0</span></span>
<span id="cb3-25"><a href="customer-lifetime-value.html#cb3-25" aria-hidden="true" tabindex="-1"></a>              <span class="dv">0</span>)</span>
<span id="cb3-26"><a href="customer-lifetime-value.html#cb3-26" aria-hidden="true" tabindex="-1"></a>            ,<span class="at">nrow=</span>states)</span>
<span id="cb3-27"><a href="customer-lifetime-value.html#cb3-27" aria-hidden="true" tabindex="-1"></a>Gmod</span></code></pre></div>
<pre><code>##      [,1]
## [1,]   36
## [2,]   -4
## [3,]   -4
## [4,]    0
## [5,]    0</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="customer-lifetime-value.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Customer lifetime value</span></span>
<span id="cb5-2"><a href="customer-lifetime-value.html#cb5-2" aria-hidden="true" tabindex="-1"></a>CLV <span class="ot">=</span> <span class="fu">solve</span>(I<span class="dv">-1</span><span class="sc">/</span>(discount_factor)<span class="sc">*</span>Pmod) <span class="sc">%*%</span> Gmod</span>
<span id="cb5-3"><a href="customer-lifetime-value.html#cb5-3" aria-hidden="true" tabindex="-1"></a>CLV</span></code></pre></div>
<pre><code>##           [,1]
## [1,] 53.149425
## [2,]  6.620690
## [3,]  2.643678
## [4,]  0.000000
## [5,]  0.000000</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="customer-lifetime-value.html#cb7-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Now we see that we do not loose money on cohort 4</span></span></code></pre></div>
<p><strong>Finite period</strong></p>
<p>Notice that the following is just for a finite period, where the calculations above are infinite. We see that the result is not really different, just as we saw in the example in excel.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="customer-lifetime-value.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 4 periods **</span></span>
<span id="cb8-2"><a href="customer-lifetime-value.html#cb8-2" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> P <span class="sc">%*%</span> P <span class="co">#P = the first period</span></span>
<span id="cb8-3"><a href="customer-lifetime-value.html#cb8-3" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> p2 <span class="sc">%*%</span> P <span class="co">#By matrix multiplication can we find the proportions in consecutive periods</span></span>
<span id="cb8-4"><a href="customer-lifetime-value.html#cb8-4" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> p3 <span class="sc">%*%</span> P</span>
<span id="cb8-5"><a href="customer-lifetime-value.html#cb8-5" aria-hidden="true" tabindex="-1"></a>P</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5]
## [1,] 0.30  0.7  0.0 0.00 0.00
## [2,] 0.20  0.0  0.8 0.00 0.00
## [3,] 0.15  0.0  0.0 0.85 0.00
## [4,] 0.05  0.0  0.0 0.00 0.95
## [5,] 0.00  0.0  0.0 0.00 1.00</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="customer-lifetime-value.html#cb10-1" aria-hidden="true" tabindex="-1"></a>p4</span></code></pre></div>
<pre><code>##          [,1]     [,2]   [,3]   [,4]   [,5]
## [1,] 0.139700 0.136500 0.1288 0.1428 0.4522
## [2,] 0.076800 0.081200 0.1008 0.0952 0.6460
## [3,] 0.039025 0.033075 0.0490 0.0714 0.8075
## [4,] 0.009750 0.008050 0.0084 0.0238 0.9500
## [5,] 0.000000 0.000000 0.0000 0.0000 1.0000</code></pre>
<p>What do we see from this. We see that in period 1 recency 1, we have 30% stayers and 70% that moves to recency 2, notice that the stayers, will be those that actually buy something.</p>
<p>Then by matrix multiplication we can see that 13.97% of those originally in state 1 is still in state 1. On the other hand can we see that 45% of the customers are lost. That is because in this scenario, there is always a greater chance of loosing the customer rather than them staying. Thus if we had more than 50% of staying, then naturally we would have more people staying in state one (repetitive buys) compared to completely lost customers (those in the absorbing state.)</p>
<p>In the following we can replicate the lifetime value through matrix multiplication as well.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="customer-lifetime-value.html#cb12-1" aria-hidden="true" tabindex="-1"></a>res1 <span class="ot">&lt;-</span> </span>
<span id="cb12-2"><a href="customer-lifetime-value.html#cb12-2" aria-hidden="true" tabindex="-1"></a>  G <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span>discount_factor <span class="sc">*</span> P <span class="sc">%*%</span> </span>
<span id="cb12-3"><a href="customer-lifetime-value.html#cb12-3" aria-hidden="true" tabindex="-1"></a>  G <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span>discount_factor<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> p2 <span class="sc">%*%</span> </span>
<span id="cb12-4"><a href="customer-lifetime-value.html#cb12-4" aria-hidden="true" tabindex="-1"></a>  G <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span>discount_factor<span class="sc">^</span><span class="dv">3</span> <span class="sc">*</span> p3 <span class="sc">%*%</span> </span>
<span id="cb12-5"><a href="customer-lifetime-value.html#cb12-5" aria-hidden="true" tabindex="-1"></a>  G <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span>discount_factor<span class="sc">^</span><span class="dv">4</span> <span class="sc">*</span> p4 <span class="sc">%*%</span> </span>
<span id="cb12-6"><a href="customer-lifetime-value.html#cb12-6" aria-hidden="true" tabindex="-1"></a>  G</span>
<span id="cb12-7"><a href="customer-lifetime-value.html#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="customer-lifetime-value.html#cb12-8" aria-hidden="true" tabindex="-1"></a>res1</span></code></pre></div>
<pre><code>##            [,1]
## [1,] 50.1149691
## [2,]  4.2199074
## [3,]  0.5921103
## [4,] -1.9801312
## [5,]  0.0000000</code></pre>
</div>
<div id="contractual---valuing-customer-base-residual-lifetime-value" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> Contractual - Valuing customer base + residual lifetime value</h2>
<p>We see that the customer base can be estimated with the sBG approach. In this scenario we have different cohorts, for instance all those that that signed up in a given period. Hence we are working in a contratual setting.</p>
<p>We see that we are able to measure how many customers that are actually left in the different cohorts.</p>
<div class="figure">
<img src="images/customerbase.png" alt="" />
<p class="caption">Customer base</p>
</div>
<p>Then we can also show the retention rates for the given cohorts.</p>
<div class="figure">
<img src="images/sbgRetentionRate.png" alt="" />
<p class="caption">Customer base retention rates</p>
</div>
<p>We see that the retention rate is actually increasing. Two explanations could be:</p>
<ol style="list-style-type: decimal">
<li>Getting more loyal customers</li>
<li>Filtering out in the heterogeneous customer base - <em>this also implies that we assume heterogeneity</em></li>
</ol>
<p>Then you may ask, how do we get the retention rates and hence the survival rates? This is estimated with the sBG (Shifted-Beta-Geometric model), with a beta distribution you are able to reflect many different shapes, hence we can also replicate the retention rates. Examples of different outcomes can be seen in the following picture.</p>
<p><em>Why is it called ‘shifted’? That is because a customer cannot leave in time period 0, as they have paid for that period.</em></p>
<div class="figure">
<img src="images/ShiftedBetaGeometricModel.png" alt="" />
<p class="caption">Shifted-Beta-Geometric model (sBG)</p>
</div>
<p>Application of this is made in the excel sheet.</p>
<p>The following also simulate two different scenarios.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="customer-lifetime-value.html#cb14-1" aria-hidden="true" tabindex="-1"></a>alpha1 <span class="ot">&lt;-</span> <span class="fl">0.676</span></span>
<span id="cb14-2"><a href="customer-lifetime-value.html#cb14-2" aria-hidden="true" tabindex="-1"></a>beta1 <span class="ot">&lt;-</span> <span class="fl">3.86</span></span>
<span id="cb14-3"><a href="customer-lifetime-value.html#cb14-3" aria-hidden="true" tabindex="-1"></a>alpha2 <span class="ot">&lt;-</span> <span class="fl">0.7009</span></span>
<span id="cb14-4"><a href="customer-lifetime-value.html#cb14-4" aria-hidden="true" tabindex="-1"></a>beta2 <span class="ot">&lt;-</span> <span class="fl">1.1712</span></span>
<span id="cb14-5"><a href="customer-lifetime-value.html#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="customer-lifetime-value.html#cb14-6" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">99</span>)<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb14-7"><a href="customer-lifetime-value.html#cb14-7" aria-hidden="true" tabindex="-1"></a>p.beta_high <span class="ot">=</span> <span class="fu">dbeta</span>(theta,alpha1,beta1)</span>
<span id="cb14-8"><a href="customer-lifetime-value.html#cb14-8" aria-hidden="true" tabindex="-1"></a>p.beta.reg <span class="ot">=</span> <span class="fu">dbeta</span>(theta,alpha2,beta2)</span>
<span id="cb14-9"><a href="customer-lifetime-value.html#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="fu">matplot</span>(theta,<span class="fu">cbind</span>(p.beta_high,p.beta.reg),<span class="at">xlab =</span> <span class="st">&quot;Churn probability&quot;</span></span>
<span id="cb14-10"><a href="customer-lifetime-value.html#cb14-10" aria-hidden="true" tabindex="-1"></a>        ,<span class="at">ylab =</span> <span class="st">&quot;Density&quot;</span>,<span class="at">type =</span> <span class="st">&quot;l&quot;</span>,<span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>,<span class="st">&quot;red&quot;</span>)</span>
<span id="cb14-11"><a href="customer-lifetime-value.html#cb14-11" aria-hidden="true" tabindex="-1"></a>        ,<span class="at">main =</span> <span class="st">&quot;Composition of customers with respect to churn&quot;</span>)</span>
<span id="cb14-12"><a href="customer-lifetime-value.html#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="fl">0.7</span>,<span class="dv">7</span>,<span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;High_end&quot;</span>,<span class="st">&quot;Regular&quot;</span>),<span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">16</span>,<span class="dv">1</span>)</span>
<span id="cb14-13"><a href="customer-lifetime-value.html#cb14-13" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>,<span class="st">&quot;red&quot;</span>),<span class="at">cex =</span> <span class="fl">0.7</span>)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-7-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>We can also calculate the amount of people that are expected to churn in period one, for this we just need the alpha and the beta values (or at least the estimated values).</p>
<p>That is done with <span class="math inline">\(P = \frac{\alpha}{\alpha + \beta}\)</span></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="customer-lifetime-value.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb15-2"><a href="customer-lifetime-value.html#cb15-2" aria-hidden="true" tabindex="-1"></a>alpha1<span class="sc">/</span>(alpha1 <span class="sc">+</span> beta1) <span class="co">#0.149</span></span>
<span id="cb15-3"><a href="customer-lifetime-value.html#cb15-3" aria-hidden="true" tabindex="-1"></a>alpha2<span class="sc">/</span>(alpha2 <span class="sc">+</span> beta2) <span class="co">#0.374</span></span></code></pre></div>
<pre><code>## [1] 0.149
## [1] 0.374</code></pre>
<p>Hence we see that 37% of the regular customers will churn, while only 15% of the high end customers will churn (leave). That is as expected as we see the greatest density of the of regular churners is higher than the high end, where we see that most lie in the lower region.</p>
</div>
<div id="non-contractual-setting---probabilitic-models" class="section level2" number="1.3">
<h2><span class="header-section-number">1.3</span> Non-Contractual Setting - Probabilitic Models</h2>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="customer-lifetime-value.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(BTYD) <span class="co">#Buy till you die.</span></span></code></pre></div>
<p>Now we are going to move into non-contractual models estimate the lifetime value of such a customer base, we are going to apply probabilistic models to estimate the churn rate but also the rate of purchase (transaction rate).</p>
<p>We are working with a non-contratual setting. Also these models are specifically applicable when the company is not able to point out the exact time, that the customer will drop out, so the opposite of when we have a contratual setting, where we know exactly if the customer does not renew his contract.</p>
<p><em>I have put notes to to BG/NBD, hence one may go directly to that section to see some details. It is put as a note to describe the other approaches.</em></p>
<p><strong>Summary of the models:</strong></p>
<p>We see the following summary:</p>
<div class="figure">
<img src="images/CLVProbabilityModels.png" alt="" />
<p class="caption">Summary of probability models</p>
</div>
<p><em>Individual level = drop out of a given customer</em></p>
<p><em>Heterogeneity = difference in customers, hence difference in when customers tend to drop out, e.g., some drops out quickly while others will stay long.</em></p>
<p><em>Counting = about estimating no. of transactions</em></p>
<p><em>Timing = Estimating when a customer will leave in the future</em></p>
<p><em><strong>What defines the model?</strong> We see that the individual level and heterogeneity are described by different distributions. These combinations make up the model, e.g., Poisson and Gamma distrbution combination to estimate respectively Individual level and Heterogeneity, is called the NBD (negative binomial distribution). And the combination of Exponential and Gamma distribution is called the Pareto distribution. Hence to estimate the Pareto distribution, you naturally need the parameters estimating both the Exponential and Gamma distribution.</em></p>
<p><strong>Notice that we are not going to look at the BB distribution!!</strong></p>
<p>We are going to apply integrated models. <strong>What is integrated models?</strong>:</p>
<p>These models apply the the different combinations seen in the first table. Hence we want a distribution both for estimating no. of transactions but also a model to describe when a customer will leave and that is why we both use NBD with BG and Pareto.</p>
<p>We see that the integrated models yields two distributions, one for the dropout (Pareto or BG) and one for the transactions (NBD).</p>
<p>We see that from the table above:</p>
<ul>
<li><p>If we are in a continuous setting and want to count no. of transactions, then we go with <strong>NBD</strong>. This is reflected by the poisson distribution and the heterogenirty of the customers can be estimated by a gamma distribution.</p></li>
<li><p>If we have a discrete time period (hence not continous purchase = contractual), we can estimate the transaction rate with a shifted geometirc model and the heterogenity (dropout rate) can be estimated with a Beta distribution. This is applied with the <strong>sBG</strong> model.</p></li>
<li><p>If we have a timing model, this is basically where we do not know when a customer makes a purchase and they can dropout at any given time. We assume that any customer is having lifetime, and this can be estimated with an exponential distribution. We also assume heterogeneity in the customers, i.e., different tendencies to drop out, this is estimated with a beta distribution. We use the <strong>Pareto</strong> model for this approach.</p></li>
</ul>
<div id="paretonbd-vs.-bgnbd" class="section level3" number="1.3.1">
<h3><span class="header-section-number">1.3.1</span> Pareto/NBD vs. BG/NBD</h3>
<p>The difference between these is the timing, meaning when a customer will leave. In the Pareto estimate of timing, a customer can leave at any point in time, where the BG model only allows to leave after a purchase.</p>
<p>That makes the Pareto model more flexible than the BG model.</p>
<p>Lets take an example of the BG/NBD:</p>
<div class="figure">
<img src="images/BGNBDExample.png" alt="" />
<p class="caption">BG/NBD Example</p>
</div>
<p>We see in section (a), that the higher the death rate the fewer purchases do we expect a customer to make, and the higher the purchase rate, the more transactions do we estimate him to have.</p>
<p>Although, the probability of customer being alive is is actually decreasing when we increase purchase rate while holding death rate constant. That is due to how the model is build, as the BG model only allows for a customer dying after a purchase.</p>
<p>Therefore when the purchase rate is higher, then he will also make more purchases, but for each purchase there is also a probability of dying.</p>
<p>Therefore we also see in the last table, we see that we observe a customer in 10 periods, 1 being the first and 10 the last.</p>
<p>We see that the more recent the customer has placed a purchase, the greater is the expected number of purchases in a 24 period. Hence implying that the longer time since the last purchase, the greater is the probability it is just because the customer is lost.</p>
<p>In the CDNow case, he compared the two models, and we see that they are very similar.</p>
<div class="figure">
<img src="images/ParetoNBDvs.BGNBD.png" alt="" />
<p class="caption">Pareto/NBD vs. BG/NBD</p>
</div>
<p>We see that they are very similar in the way they replicate the actual data.</p>
</div>
<div id="paretonbd" class="section level3" number="1.3.2">
<h3><span class="header-section-number">1.3.2</span> Pareto/NBD</h3>
<p><em>NBD = Negative Binomial Distribution</em></p>
<p>Here we have a model, that aim to predict (or estimate) the transaction rate and the dropout rate. Also the model allows for heterogeneity in the customers, meaning that all are not the same and so will the dropout not be. We are working with 4 parameters, two for estimating the transaction rate and two for estimating the dropout rate.</p>
<p>Notice that the model is similar to the e.g., the BG/NBD, that is because this is the foundation hereof.</p>
<p>We see that the Pareto/NBD is from 1959 and the BG/NBD is from 2005, hence it builds on the Pareto/NBD.</p>
<p>The reason for making the BG/NDB is to make it less cumbersome to estimate, although with the computing power now, we see that the Pareto/NBD model can easily be estimated. Therefore the Pareto/NBD is often preferred over the BG/NBD.</p>
<p><br />
</p>
<div id="data-preparation" class="section level4" number="1.3.2.1">
<h4><span class="header-section-number">1.3.2.1</span> Data preparation</h4>
<p>We only need three pieces of information for every person:</p>
<ol style="list-style-type: decimal">
<li>How many transactions the customer in the training period - <strong>Frequency</strong>
<ol style="list-style-type: lower-alpha">
<li>Denoted as <span class="math inline">\(x\)</span></li>
</ol></li>
<li>The time of their last transaction - <strong>Recency</strong>
<ol style="list-style-type: lower-alpha">
<li>Denoted as <span class="math inline">\(t.x\)</span></li>
</ol></li>
<li>The total time for which they were observed
<ol style="list-style-type: lower-alpha">
<li>Denoted as <span class="math inline">\(T.cal\)</span>. For time of the calibration period.</li>
</ol></li>
</ol>
<p>Thus we must construct a data frame with a row for each customer and the information above.</p>
<p>We use <code>dc.ReadLines</code>, this is basically the same as <code>read.csv</code>. Notice that elog is a file with a lot of transactions. Thus we have customer identifier, date and amount.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="customer-lifetime-value.html#cb18-1" aria-hidden="true" tabindex="-1"></a>cdnowElog <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;data/cdnowElog.csv&quot;</span>, <span class="at">package =</span> <span class="st">&quot;BTYD&quot;</span>)</span>
<span id="cb18-2"><a href="customer-lifetime-value.html#cb18-2" aria-hidden="true" tabindex="-1"></a>elog <span class="ot">&lt;-</span> <span class="fu">dc.ReadLines</span>(cdnowElog, <span class="at">cust.idx =</span> <span class="dv">2</span></span>
<span id="cb18-3"><a href="customer-lifetime-value.html#cb18-3" aria-hidden="true" tabindex="-1"></a>                     ,<span class="at">date.idx =</span> <span class="dv">3</span>, <span class="at">sales.idx =</span> <span class="dv">5</span>)</span>
<span id="cb18-4"><a href="customer-lifetime-value.html#cb18-4" aria-hidden="true" tabindex="-1"></a>elog[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,]</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="left">cust</th>
<th align="left">date</th>
<th align="right">sales</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">19970101</td>
<td align="right">29.3</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">19970118</td>
<td align="right">29.7</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">19970802</td>
<td align="right">15.0</td>
</tr>
</tbody>
</table>
</div>
<p>Notice the name ‘elog’, that is for event log. Hence it logs all of the events.</p>
<p>We want to transform the date to a date type instead.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="customer-lifetime-value.html#cb19-1" aria-hidden="true" tabindex="-1"></a>elog<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(elog<span class="sc">$</span>date, <span class="st">&quot;%Y%m%d&quot;</span>);</span>
<span id="cb19-2"><a href="customer-lifetime-value.html#cb19-2" aria-hidden="true" tabindex="-1"></a>elog[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,]</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="left">cust</th>
<th align="left">date</th>
<th align="right">sales</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">1997-01-01</td>
<td align="right">29.3</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">1997-01-18</td>
<td align="right">29.7</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">1997-08-02</td>
<td align="right">15.0</td>
</tr>
</tbody>
</table>
</div>
<p>The following is able to merge transactions in the same customer. Before running the code we have 6919 observations (events).</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="customer-lifetime-value.html#cb20-1" aria-hidden="true" tabindex="-1"></a>elog <span class="ot">&lt;-</span> <span class="fu">dc.MergeTransactionsOnSameDate</span>(elog);</span></code></pre></div>
<p>After merging we have 6696 events. Thus it appears that some customers made several purchases on the same day.</p>
<p>Now we can <strong>split the data</strong> to get a train (calibration) and test period.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="customer-lifetime-value.html#cb21-1" aria-hidden="true" tabindex="-1"></a>end.of.cal.period <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;1997-09-30&quot;</span>) <span class="co">#Insert the last date in the train period.</span></span>
<span id="cb21-2"><a href="customer-lifetime-value.html#cb21-2" aria-hidden="true" tabindex="-1"></a>elog.cal <span class="ot">&lt;-</span> elog[<span class="fu">which</span>(elog<span class="sc">$</span>date <span class="sc">&lt;=</span> end.of.cal.period), ]</span></code></pre></div>
<p><strong><em>Notice, the BG/NBD model deals with repeat transactions, hence the first transaction is ignored.</em></strong></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="customer-lifetime-value.html#cb22-1" aria-hidden="true" tabindex="-1"></a>split.data <span class="ot">&lt;-</span> <span class="fu">dc.SplitUpElogForRepeatTrans</span>(elog.cal);</span>
<span id="cb22-2"><a href="customer-lifetime-value.html#cb22-2" aria-hidden="true" tabindex="-1"></a>clean.elog <span class="ot">&lt;-</span> split.data<span class="sc">$</span>repeat.trans.elog;</span></code></pre></div>
<p>Now we are going to create a customer-by-time matrix. That is simply a matrix with each customer on each row and then days as columns. The following is just a snip.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="customer-lifetime-value.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Customer-by-time: Repeatitive transactions</span></span>
<span id="cb23-2"><a href="customer-lifetime-value.html#cb23-2" aria-hidden="true" tabindex="-1"></a>freq.cbt <span class="ot">&lt;-</span> <span class="fu">dc.CreateFreqCBT</span>(clean.elog);</span>
<span id="cb23-3"><a href="customer-lifetime-value.html#cb23-3" aria-hidden="true" tabindex="-1"></a>freq.cbt[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code></pre></div>
<pre><code>##     date
## cust 1997-01-08 1997-01-09 1997-01-10 1997-01-11 1997-01-12
##    1          0          0          0          0          0
##    2          0          0          0          0          0
##    6          0          0          0          1          0</code></pre>
<p>Since we initially deleted all first transactions, the frequence customer-by-time matrix does not have any of the customer who made zero repeat transactions. These customers are still important hence they will be included in the matrix with the following.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="customer-lifetime-value.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Customer-by-time: All first transactions transactions</span></span>
<span id="cb25-2"><a href="customer-lifetime-value.html#cb25-2" aria-hidden="true" tabindex="-1"></a>tot.cbt <span class="ot">&lt;-</span> <span class="fu">dc.CreateFreqCBT</span>(elog)</span>
<span id="cb25-3"><a href="customer-lifetime-value.html#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="customer-lifetime-value.html#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Merging both customer-by-time matrices.</span></span>
<span id="cb25-5"><a href="customer-lifetime-value.html#cb25-5" aria-hidden="true" tabindex="-1"></a>cal.cbt <span class="ot">&lt;-</span> <span class="fu">dc.MergeCustomers</span>(tot.cbt, freq.cbt)</span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="customer-lifetime-value.html#cb26-1" aria-hidden="true" tabindex="-1"></a>birth.periods <span class="ot">&lt;-</span> split.data<span class="sc">$</span>cust.data<span class="sc">$</span>birth.per</span>
<span id="cb26-2"><a href="customer-lifetime-value.html#cb26-2" aria-hidden="true" tabindex="-1"></a>last.dates <span class="ot">&lt;-</span> split.data<span class="sc">$</span>cust.data<span class="sc">$</span>last.date</span>
<span id="cb26-3"><a href="customer-lifetime-value.html#cb26-3" aria-hidden="true" tabindex="-1"></a>cal.cbs.dates <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(birth.periods, last.dates</span>
<span id="cb26-4"><a href="customer-lifetime-value.html#cb26-4" aria-hidden="true" tabindex="-1"></a>                            ,end.of.cal.period)</span>
<span id="cb26-5"><a href="customer-lifetime-value.html#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="customer-lifetime-value.html#cb26-6" aria-hidden="true" tabindex="-1"></a>cal.cbs <span class="ot">&lt;-</span> <span class="fu">dc.BuildCBSFromCBTAndDates</span>(cal.cbt</span>
<span id="cb26-7"><a href="customer-lifetime-value.html#cb26-7" aria-hidden="true" tabindex="-1"></a>                                      ,cal.cbs.dates</span>
<span id="cb26-8"><a href="customer-lifetime-value.html#cb26-8" aria-hidden="true" tabindex="-1"></a>                                      ,<span class="at">per=</span><span class="st">&quot;week&quot;</span>) <span class="co"># we want to see weekly data</span></span></code></pre></div>
<p><em>Notes:</em></p>
<p><em>1. cbs = customer-by-sufficient-statistics</em>
<em>2. We use <code>per = "week"</code> to get data shown per week, as ultimately it show the same as pr. day and returns a more simple data frame.</em></p>
<p>In general the procedure above can be executed in the following command: <code>dc.ElogToCbsCbt()</code>. But they have chosen to show the process, so one is able to make iterations to the data if that is needed in other applications.</p>
<p>You’ll be glad to hear that, for the process described above, the package contains a single function to do everything for you: <code>dc.ElogToCbsCbt</code>.</p>
</div>
<div id="parameter-estimation" class="section level4" number="1.3.2.2">
<h4><span class="header-section-number">1.3.2.2</span> Parameter Estimation</h4>
<p>First we must estimate the parameters. Notice that the function takes a starting point with the following values for the parameters (1,1,1,1).</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="customer-lifetime-value.html#cb27-1" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">pnbd.EstimateParameters</span>(cal.cbs);</span>
<span id="cb27-2"><a href="customer-lifetime-value.html#cb27-2" aria-hidden="true" tabindex="-1"></a>params</span></code></pre></div>
<pre><code>## [1]  0.553 10.580  0.606 11.656</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="customer-lifetime-value.html#cb29-1" aria-hidden="true" tabindex="-1"></a>LL <span class="ot">&lt;-</span> <span class="fu">pnbd.cbs.LL</span>(params, cal.cbs);</span>
<span id="cb29-2"><a href="customer-lifetime-value.html#cb29-2" aria-hidden="true" tabindex="-1"></a>LL</span></code></pre></div>
<pre><code>## [1] -9595</code></pre>
<p>The log likelihood estimates the fit to the data, thus we have a log-likelihood of -9494.98. We are not able to deduct much from the number itself. But we are able to compare it with other models. Basically, we want to select the model with a log-likelihood that is as close to 0 as possible.</p>
<p>In the following we run consecutive estimations with its own output as its starting point.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="customer-lifetime-value.html#cb31-1" aria-hidden="true" tabindex="-1"></a>p.matrix <span class="ot">&lt;-</span> <span class="fu">c</span>(params, LL);</span>
<span id="cb31-2"><a href="customer-lifetime-value.html#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>){</span>
<span id="cb31-3"><a href="customer-lifetime-value.html#cb31-3" aria-hidden="true" tabindex="-1"></a>  params <span class="ot">&lt;-</span> <span class="fu">pnbd.EstimateParameters</span>(cal.cbs, params);</span>
<span id="cb31-4"><a href="customer-lifetime-value.html#cb31-4" aria-hidden="true" tabindex="-1"></a>  LL <span class="ot">&lt;-</span> <span class="fu">pnbd.cbs.LL</span>(params, cal.cbs);</span>
<span id="cb31-5"><a href="customer-lifetime-value.html#cb31-5" aria-hidden="true" tabindex="-1"></a>  p.matrix.row <span class="ot">&lt;-</span> <span class="fu">c</span>(params, LL);</span>
<span id="cb31-6"><a href="customer-lifetime-value.html#cb31-6" aria-hidden="true" tabindex="-1"></a>  p.matrix <span class="ot">&lt;-</span> <span class="fu">rbind</span>(p.matrix, p.matrix.row);</span>
<span id="cb31-7"><a href="customer-lifetime-value.html#cb31-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-8"><a href="customer-lifetime-value.html#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(p.matrix) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;r&quot;</span>, <span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;s&quot;</span>, <span class="st">&quot;beta&quot;</span>, <span class="st">&quot;LL&quot;</span>);</span>
<span id="cb31-9"><a href="customer-lifetime-value.html#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(p.matrix) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>;</span>
<span id="cb31-10"><a href="customer-lifetime-value.html#cb31-10" aria-hidden="true" tabindex="-1"></a>p.matrix</span></code></pre></div>
<pre><code>##       r alpha     s beta    LL
## 1 0.553  10.6 0.606 11.7 -9595
## 2 0.553  10.6 0.606 11.7 -9595
## 3 0.553  10.6 0.606 11.7 -9595</code></pre>
<p>We see that the log-likelihood, hence the fit, is the same, but some of the parameters are changing slightly. We have the following parameters:</p>
<p><strong>Describing the the gamma mixing distribution of the NBD transaction process</strong></p>
<ul>
<li>r</li>
<li>Alpha</li>
</ul>
<p>See figure <a href="customer-lifetime-value.html#fig:pnbd1">1.1</a></p>
<p><strong>Describing the gamme mixing distrbibution of the Pareto (or gamma exponentiated) dropout process</strong></p>
<ul>
<li>s</li>
<li>beta</li>
</ul>
<p>See figure <a href="customer-lifetime-value.html#fig:pnbd2">1.2</a></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="customer-lifetime-value.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pnbd.PlotTransactionRateHeterogeneity</span>(params)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:pnbd1"></span>
<img src="Customer-Analytics-Notes_files/figure-html/pnbd1-1.png" alt="Transaction rate heterogeneity of estimated parameters" width="720" />
<p class="caption">
Figure 1.1: Transaction rate heterogeneity of estimated parameters
</p>
</div>
<p>Few have a very high transaction rate, where the majority lies in the south eastern region.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="customer-lifetime-value.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pnbd.PlotDropoutRateHeterogeneity</span>(params)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:pnbd2"></span>
<img src="Customer-Analytics-Notes_files/figure-html/pnbd2-1.png" alt="Dropout rate heterogeneity of estimated parameters" width="720" />
<p class="caption">
Figure 1.2: Dropout rate heterogeneity of estimated parameters
</p>
</div>
<p>Few have a very high dropout rate, where the majority lies in the south eastern region.</p>
</div>
<div id="individual-level-estimations" class="section level4" number="1.3.2.3">
<h4><span class="header-section-number">1.3.2.3</span> Individual Level Estimations</h4>
<p>Now we can also make some estimations on the individual level. We can do:</p>
<ol style="list-style-type: decimal">
<li>Estimating purchases in the calibration period and hold out period.</li>
<li>Calculating probability that the customer is still alive at the end of the calibration period.</li>
</ol>
<p><strong>First</strong> we can estimate the number of transactions we expect a newly acquired customer to make in a given time period.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="customer-lifetime-value.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pnbd.Expectation</span>(params</span>
<span id="cb35-2"><a href="customer-lifetime-value.html#cb35-2" aria-hidden="true" tabindex="-1"></a>                 ,<span class="at">t=</span><span class="dv">52</span> <span class="co">#We have weekly data</span></span>
<span id="cb35-3"><a href="customer-lifetime-value.html#cb35-3" aria-hidden="true" tabindex="-1"></a>                 )</span></code></pre></div>
<pre><code>## [1] 1.47</code></pre>
<p>We expect a newly acquired customer to make 1.47 repeat purchases in a time period of one year.</p>
<p>Calling information from an individual customer.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="customer-lifetime-value.html#cb37-1" aria-hidden="true" tabindex="-1"></a>cal.cbs[<span class="st">&quot;1516&quot;</span>,]</span></code></pre></div>
<pre><code>##     x   t.x T.cal 
##  26.0  30.9  31.0</code></pre>
<p>Now we can store the information, to be used for estimating purchases in the holdout period.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="customer-lifetime-value.html#cb39-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> cal.cbs[<span class="st">&quot;1516&quot;</span>, <span class="st">&quot;x&quot;</span>]</span>
<span id="cb39-2"><a href="customer-lifetime-value.html#cb39-2" aria-hidden="true" tabindex="-1"></a>t.x <span class="ot">&lt;-</span> cal.cbs[<span class="st">&quot;1516&quot;</span>, <span class="st">&quot;t.x&quot;</span>]</span>
<span id="cb39-3"><a href="customer-lifetime-value.html#cb39-3" aria-hidden="true" tabindex="-1"></a>T.cal <span class="ot">&lt;-</span> cal.cbs[<span class="st">&quot;1516&quot;</span>, <span class="st">&quot;T.cal&quot;</span>]</span>
<span id="cb39-4"><a href="customer-lifetime-value.html#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="fu">pnbd.ConditionalExpectedTransactions</span>(params</span>
<span id="cb39-5"><a href="customer-lifetime-value.html#cb39-5" aria-hidden="true" tabindex="-1"></a>                                     ,<span class="at">T.star =</span> <span class="dv">52</span></span>
<span id="cb39-6"><a href="customer-lifetime-value.html#cb39-6" aria-hidden="true" tabindex="-1"></a>                                     ,x</span>
<span id="cb39-7"><a href="customer-lifetime-value.html#cb39-7" aria-hidden="true" tabindex="-1"></a>                                     ,t.x</span>
<span id="cb39-8"><a href="customer-lifetime-value.html#cb39-8" aria-hidden="true" tabindex="-1"></a>                                     ,T.cal)</span></code></pre></div>
<pre><code>## [1] 25.5</code></pre>
<p>We expect 25 purchases in the hold out period.</p>
<p><strong>Second</strong> we can calculate the probability that the customer is still alive in the end of the hold out period.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="customer-lifetime-value.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pnbd.PAlive</span>(params, x, t.x, T.cal)</span></code></pre></div>
<pre><code>## [1] 0.998</code></pre>
<p>We see that there is a probability of 99%, hence it is almost certain.</p>
<p><strong>Conditional expectation function</strong></p>
<p>We see the increasing frequency paradox in action: (<strong>What ever this is</strong>)</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="customer-lifetime-value.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">5</span>)){</span>
<span id="cb43-2"><a href="customer-lifetime-value.html#cb43-2" aria-hidden="true" tabindex="-1"></a>  cond.expectation <span class="ot">&lt;-</span> <span class="fu">pnbd.ConditionalExpectedTransactions</span>(</span>
<span id="cb43-3"><a href="customer-lifetime-value.html#cb43-3" aria-hidden="true" tabindex="-1"></a>  params, <span class="at">T.star =</span> <span class="dv">52</span>, <span class="at">x =</span> i,</span>
<span id="cb43-4"><a href="customer-lifetime-value.html#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">t.x =</span> <span class="dv">20</span>, <span class="at">T.cal =</span> <span class="dv">39</span>)</span>
<span id="cb43-5"><a href="customer-lifetime-value.html#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span> (<span class="st">&quot;x:&quot;</span>,i,<span class="st">&quot;</span><span class="sc">\t</span><span class="st"> Expectation:&quot;</span>,cond.expectation, <span class="at">fill =</span> <span class="cn">TRUE</span>)</span>
<span id="cb43-6"><a href="customer-lifetime-value.html#cb43-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## x: 10     Expectation: 0.706
## x: 15     Expectation: 0.144
## x: 20     Expectation: 0.0225
## x: 25     Expectation: 0.00309</code></pre>
</div>
<div id="plotting-goodness-of-fit" class="section level4" number="1.3.2.4">
<h4><span class="header-section-number">1.3.2.4</span> Plotting / Goodness-of-fit</h4>
<p><strong>In the training period</strong></p>
<p>We want to assess how the model fits the actual transactions</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="customer-lifetime-value.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pnbd.PlotFrequencyInCalibration</span>(params, cal.cbs</span>
<span id="cb45-2"><a href="customer-lifetime-value.html#cb45-2" aria-hidden="true" tabindex="-1"></a>                                ,<span class="at">censor =</span>  <span class="dv">7</span> <span class="co">#The frequency groups</span></span>
<span id="cb45-3"><a href="customer-lifetime-value.html#cb45-3" aria-hidden="true" tabindex="-1"></a>                                )</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-26-1.png" width="720" style="display: block; margin: auto;" /></p>
<pre><code>##              freq.0 freq.1 freq.2 freq.3 freq.4 freq.5 freq.6 freq.7+
## n.x.actual     1411    439    214    100   62.0   38.0   29.0    64.0
## n.x.expected   1434    397    194    112   70.6   46.4   31.5    70.8</code></pre>
<p>Notice that all bins reflect the frequency and then the y show the amount of customers in the repeat transactions group, notice that group 0 only made one purchase</p>
<p>We see that the model estimates the actual transactions very well.</p>
<p><strong>The hold out period</strong></p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="customer-lifetime-value.html#cb47-1" aria-hidden="true" tabindex="-1"></a>elog <span class="ot">&lt;-</span> <span class="fu">dc.SplitUpElogForRepeatTrans</span>(elog)<span class="sc">$</span>repeat.trans.elog;</span>
<span id="cb47-2"><a href="customer-lifetime-value.html#cb47-2" aria-hidden="true" tabindex="-1"></a>x.star <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(cal.cbs));</span>
<span id="cb47-3"><a href="customer-lifetime-value.html#cb47-3" aria-hidden="true" tabindex="-1"></a>cal.cbs <span class="ot">&lt;-</span> <span class="fu">cbind</span>(cal.cbs, x.star);</span>
<span id="cb47-4"><a href="customer-lifetime-value.html#cb47-4" aria-hidden="true" tabindex="-1"></a>elog.custs <span class="ot">&lt;-</span> elog<span class="sc">$</span>cust;</span>
<span id="cb47-5"><a href="customer-lifetime-value.html#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(cal.cbs)){</span>
<span id="cb47-6"><a href="customer-lifetime-value.html#cb47-6" aria-hidden="true" tabindex="-1"></a>  current.cust <span class="ot">&lt;-</span> <span class="fu">rownames</span>(cal.cbs)[i]</span>
<span id="cb47-7"><a href="customer-lifetime-value.html#cb47-7" aria-hidden="true" tabindex="-1"></a>  tot.cust.trans <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">which</span>(elog.custs <span class="sc">==</span> current.cust))</span>
<span id="cb47-8"><a href="customer-lifetime-value.html#cb47-8" aria-hidden="true" tabindex="-1"></a>  cal.trans <span class="ot">&lt;-</span> cal.cbs[i, <span class="st">&quot;x&quot;</span>]</span>
<span id="cb47-9"><a href="customer-lifetime-value.html#cb47-9" aria-hidden="true" tabindex="-1"></a>  cal.cbs[i, <span class="st">&quot;x.star&quot;</span>] <span class="ot">&lt;-</span> tot.cust.trans <span class="sc">-</span> cal.trans</span>
<span id="cb47-10"><a href="customer-lifetime-value.html#cb47-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb47-11"><a href="customer-lifetime-value.html#cb47-11" aria-hidden="true" tabindex="-1"></a>cal.cbs[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,]</span></code></pre></div>
<pre><code>##   x   t.x T.cal x.star
## 1 2 30.43  38.9      1
## 2 1  1.71  38.9      0
## 3 0  0.00  38.9      0</code></pre>
<p>Now we can plot the expected frequency.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="customer-lifetime-value.html#cb49-1" aria-hidden="true" tabindex="-1"></a>T.star <span class="ot">&lt;-</span> <span class="dv">39</span> <span class="co"># length of the holdout period</span></span>
<span id="cb49-2"><a href="customer-lifetime-value.html#cb49-2" aria-hidden="true" tabindex="-1"></a>censor <span class="ot">&lt;-</span> <span class="dv">7</span> <span class="co"># This censor serves the same purpose described above</span></span>
<span id="cb49-3"><a href="customer-lifetime-value.html#cb49-3" aria-hidden="true" tabindex="-1"></a>x.star <span class="ot">&lt;-</span> cal.cbs[,<span class="st">&quot;x.star&quot;</span>]</span>
<span id="cb49-4"><a href="customer-lifetime-value.html#cb49-4" aria-hidden="true" tabindex="-1"></a>comp <span class="ot">&lt;-</span> <span class="fu">pnbd.PlotFreqVsConditionalExpectedFrequency</span>(params, T.star,</span>
<span id="cb49-5"><a href="customer-lifetime-value.html#cb49-5" aria-hidden="true" tabindex="-1"></a>cal.cbs, x.star, censor)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-28-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>We see that the hold out period is estimated very well in this example. Instead of looking at the plot, we can also show a matrix containing the numbers.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="customer-lifetime-value.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(comp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;act&quot;</span>, <span class="st">&quot;exp&quot;</span>, <span class="st">&quot;bin&quot;</span>)</span>
<span id="cb50-2"><a href="customer-lifetime-value.html#cb50-2" aria-hidden="true" tabindex="-1"></a>comp</span></code></pre></div>
<pre><code>##       freq.0  freq.1 freq.2 freq.3 freq.4 freq.5 freq.6 freq.7+
## act    0.237   0.697   1.39   1.56   2.53   2.95   3.86    6.36
## exp    0.138   0.600   1.20   1.71   2.40   2.91   3.82    6.40
## bin 1411.000 439.000 214.00 100.00  62.00  38.00  29.00   64.00</code></pre>
<p>Now we want to look at weekly transactions.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="customer-lifetime-value.html#cb52-1" aria-hidden="true" tabindex="-1"></a>tot.cbt <span class="ot">&lt;-</span> <span class="fu">dc.CreateFreqCBT</span>(elog)</span>
<span id="cb52-2"><a href="customer-lifetime-value.html#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="customer-lifetime-value.html#cb52-3" aria-hidden="true" tabindex="-1"></a>d.track.data <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">7</span> <span class="sc">*</span> <span class="dv">78</span>)</span>
<span id="cb52-4"><a href="customer-lifetime-value.html#cb52-4" aria-hidden="true" tabindex="-1"></a>origin <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;1997-01-01&quot;</span>)</span>
<span id="cb52-5"><a href="customer-lifetime-value.html#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">colnames</span>(tot.cbt)){</span>
<span id="cb52-6"><a href="customer-lifetime-value.html#cb52-6" aria-hidden="true" tabindex="-1"></a>  date.index <span class="ot">&lt;-</span> <span class="fu">difftime</span>(<span class="fu">as.Date</span>(i), origin) <span class="sc">+</span> <span class="dv">1</span>;</span>
<span id="cb52-7"><a href="customer-lifetime-value.html#cb52-7" aria-hidden="true" tabindex="-1"></a>  d.track.data[date.index] <span class="ot">&lt;-</span> <span class="fu">sum</span>(tot.cbt[,i]);</span>
<span id="cb52-8"><a href="customer-lifetime-value.html#cb52-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-9"><a href="customer-lifetime-value.html#cb52-9" aria-hidden="true" tabindex="-1"></a>w.track.data <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">78</span>)</span>
<span id="cb52-10"><a href="customer-lifetime-value.html#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">78</span>){</span>
<span id="cb52-11"><a href="customer-lifetime-value.html#cb52-11" aria-hidden="true" tabindex="-1"></a>  w.track.data[j] <span class="ot">&lt;-</span> <span class="fu">sum</span>(d.track.data[(j<span class="sc">*</span><span class="dv">7-6</span>)<span class="sc">:</span>(j<span class="sc">*</span><span class="dv">7</span>)])</span>
<span id="cb52-12"><a href="customer-lifetime-value.html#cb52-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="customer-lifetime-value.html#cb53-1" aria-hidden="true" tabindex="-1"></a>T.cal <span class="ot">&lt;-</span> cal.cbs[,<span class="st">&quot;T.cal&quot;</span>]</span>
<span id="cb53-2"><a href="customer-lifetime-value.html#cb53-2" aria-hidden="true" tabindex="-1"></a>T.tot <span class="ot">&lt;-</span> <span class="dv">78</span></span>
<span id="cb53-3"><a href="customer-lifetime-value.html#cb53-3" aria-hidden="true" tabindex="-1"></a>n.periods.final <span class="ot">&lt;-</span> <span class="dv">78</span></span>
<span id="cb53-4"><a href="customer-lifetime-value.html#cb53-4" aria-hidden="true" tabindex="-1"></a>inc.tracking <span class="ot">&lt;-</span> <span class="fu">pnbd.PlotTrackingInc</span>(params, T.cal,</span>
<span id="cb53-5"><a href="customer-lifetime-value.html#cb53-5" aria-hidden="true" tabindex="-1"></a>T.tot, w.track.data,</span>
<span id="cb53-6"><a href="customer-lifetime-value.html#cb53-6" aria-hidden="true" tabindex="-1"></a>n.periods.final)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-31-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>We see that the model generalizes pretty well the period. Instead of looking at the plot we can also show the underlying numbers.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="customer-lifetime-value.html#cb54-1" aria-hidden="true" tabindex="-1"></a>inc.tracking[,<span class="dv">20</span><span class="sc">:</span><span class="dv">25</span>]</span></code></pre></div>
<pre><code>##          [,1] [,2] [,3] [,4] [,5] [,6]
## actual   73.0 55.0 70.0   33 56.0 99.0
## expected 78.3 76.4 74.6   73 71.4 69.9</code></pre>
<p>We can also show a cummulated sum over the weeks, notice that the hold period and the training period is separated by the dashed line.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="customer-lifetime-value.html#cb56-1" aria-hidden="true" tabindex="-1"></a>cum.tracking.data <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(w.track.data)</span>
<span id="cb56-2"><a href="customer-lifetime-value.html#cb56-2" aria-hidden="true" tabindex="-1"></a>cum.tracking <span class="ot">&lt;-</span> <span class="fu">pnbd.PlotTrackingCum</span>(params</span>
<span id="cb56-3"><a href="customer-lifetime-value.html#cb56-3" aria-hidden="true" tabindex="-1"></a>                                     ,T.cal</span>
<span id="cb56-4"><a href="customer-lifetime-value.html#cb56-4" aria-hidden="true" tabindex="-1"></a>                                     ,T.tot</span>
<span id="cb56-5"><a href="customer-lifetime-value.html#cb56-5" aria-hidden="true" tabindex="-1"></a>                                     ,cum.tracking.data</span>
<span id="cb56-6"><a href="customer-lifetime-value.html#cb56-6" aria-hidden="true" tabindex="-1"></a>                                     ,n.periods.final)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-33-1.png" width="720" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="customer-lifetime-value.html#cb57-1" aria-hidden="true" tabindex="-1"></a>cum.tracking[,<span class="dv">20</span><span class="sc">:</span><span class="dv">25</span>]</span></code></pre></div>
<pre><code>##          [,1] [,2] [,3] [,4] [,5] [,6]
## actual   1359 1414 1484 1517 1573 1672
## expected 1309 1385 1460 1533 1604 1674</code></pre>
</div>
</div>
<div id="bgnbd" class="section level3" number="1.3.3">
<h3><span class="header-section-number">1.3.3</span> BG/NBD</h3>
<p>Used in a non-contractual situation in which customers can make a purchase at any time. The model describes the rate at which customers make purchases and the rate at which they drop out. This is done with four parameters and also allowing for heterogeneity.</p>
<p>The following is the BG/NBD model on the CDNow data.</p>
<p><em>Note: calibration = training</em></p>
<div id="data-preparation-1" class="section level4" number="1.3.3.1">
<h4><span class="header-section-number">1.3.3.1</span> Data Preparation</h4>
<p>We only need three pieces of information for every person:</p>
<ol style="list-style-type: decimal">
<li>How many transactions the customer in the training period - <strong>Frequency</strong>
<ol style="list-style-type: lower-alpha">
<li>Denoted as <span class="math inline">\(x\)</span></li>
</ol></li>
<li>The time of their last transaction - <strong>Recency</strong>
<ol style="list-style-type: lower-alpha">
<li>Denoted as <span class="math inline">\(t.x\)</span></li>
</ol></li>
<li>The total time for which they were observed
<ol style="list-style-type: lower-alpha">
<li>Denoted as <span class="math inline">\(T.cal\)</span>. For time of the calibration period.</li>
</ol></li>
</ol>
<p>Thus we must construct a data frame with a row for each customer and the information above.</p>
<p>We use <code>dc.ReadLines</code>, this is basically the same as <code>read.csv</code>. Notice that elog is a file with a lot of transactions. Thus we have customer identifier, date and amount.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="customer-lifetime-value.html#cb59-1" aria-hidden="true" tabindex="-1"></a>cdnowElog <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;data/cdnowElog.csv&quot;</span>, <span class="at">package =</span> <span class="st">&quot;BTYD&quot;</span>)</span>
<span id="cb59-2"><a href="customer-lifetime-value.html#cb59-2" aria-hidden="true" tabindex="-1"></a>elog <span class="ot">&lt;-</span> <span class="fu">dc.ReadLines</span>(cdnowElog, <span class="at">cust.idx =</span> <span class="dv">2</span></span>
<span id="cb59-3"><a href="customer-lifetime-value.html#cb59-3" aria-hidden="true" tabindex="-1"></a>                     ,<span class="at">date.idx =</span> <span class="dv">3</span>, <span class="at">sales.idx =</span> <span class="dv">5</span>)</span>
<span id="cb59-4"><a href="customer-lifetime-value.html#cb59-4" aria-hidden="true" tabindex="-1"></a>elog[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,]</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="left">cust</th>
<th align="left">date</th>
<th align="right">sales</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">19970101</td>
<td align="right">29.3</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">19970118</td>
<td align="right">29.7</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">19970802</td>
<td align="right">15.0</td>
</tr>
</tbody>
</table>
</div>
<p>Notice the name ‘elog’, that is for event log. Hence it logs all of the events.</p>
<p>We want to transform the date to a date type instead.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="customer-lifetime-value.html#cb60-1" aria-hidden="true" tabindex="-1"></a>elog<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(elog<span class="sc">$</span>date, <span class="st">&quot;%Y%m%d&quot;</span>);</span>
<span id="cb60-2"><a href="customer-lifetime-value.html#cb60-2" aria-hidden="true" tabindex="-1"></a>elog[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,]</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="left">cust</th>
<th align="left">date</th>
<th align="right">sales</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">1997-01-01</td>
<td align="right">29.3</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">1997-01-18</td>
<td align="right">29.7</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">1997-08-02</td>
<td align="right">15.0</td>
</tr>
</tbody>
</table>
</div>
<p>The following is able to merge transactions in the same customer. Before running the code we have 6919 observations (events).</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="customer-lifetime-value.html#cb61-1" aria-hidden="true" tabindex="-1"></a>elog <span class="ot">&lt;-</span> <span class="fu">dc.MergeTransactionsOnSameDate</span>(elog);</span></code></pre></div>
<p>After merging we have 6696 events. Thus it appears that some customers made several purchases on the same day.</p>
<p>Now we can <strong>split the data</strong> to get a train (calibration) and test period.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="customer-lifetime-value.html#cb62-1" aria-hidden="true" tabindex="-1"></a>end.of.cal.period <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;1997-09-30&quot;</span>) <span class="co">#Insert the last date in the train period.</span></span>
<span id="cb62-2"><a href="customer-lifetime-value.html#cb62-2" aria-hidden="true" tabindex="-1"></a>elog.cal <span class="ot">&lt;-</span> elog[<span class="fu">which</span>(elog<span class="sc">$</span>date <span class="sc">&lt;=</span> end.of.cal.period), ]</span></code></pre></div>
<p><strong><em>Notice, the BG/NBD model deals with repeat transactions, hence the first transaction is ignored.</em></strong></p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="customer-lifetime-value.html#cb63-1" aria-hidden="true" tabindex="-1"></a>split.data <span class="ot">&lt;-</span> <span class="fu">dc.SplitUpElogForRepeatTrans</span>(elog.cal);</span>
<span id="cb63-2"><a href="customer-lifetime-value.html#cb63-2" aria-hidden="true" tabindex="-1"></a>clean.elog <span class="ot">&lt;-</span> split.data<span class="sc">$</span>repeat.trans.elog;</span></code></pre></div>
<p>Now we are going to create a customer-by-time matrix. That is simply a matrix with each customer on each row and then days as columns. The following is just a snip.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="customer-lifetime-value.html#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Customer-by-time: Repeatitive transactions</span></span>
<span id="cb64-2"><a href="customer-lifetime-value.html#cb64-2" aria-hidden="true" tabindex="-1"></a>freq.cbt <span class="ot">&lt;-</span> <span class="fu">dc.CreateFreqCBT</span>(clean.elog);</span>
<span id="cb64-3"><a href="customer-lifetime-value.html#cb64-3" aria-hidden="true" tabindex="-1"></a>freq.cbt[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code></pre></div>
<pre><code>##     date
## cust 1997-01-08 1997-01-09 1997-01-10 1997-01-11 1997-01-12
##    1          0          0          0          0          0
##    2          0          0          0          0          0
##    6          0          0          0          1          0</code></pre>
<p>Since we initially deleted all first transactions, the frequence customer-by-time matrix does not have any of the customer who made zero repeat transactions. These customers are still important hence they will be included in the matrix with the following.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="customer-lifetime-value.html#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Customer-by-time: All first transactions transactions</span></span>
<span id="cb66-2"><a href="customer-lifetime-value.html#cb66-2" aria-hidden="true" tabindex="-1"></a>tot.cbt <span class="ot">&lt;-</span> <span class="fu">dc.CreateFreqCBT</span>(elog)</span>
<span id="cb66-3"><a href="customer-lifetime-value.html#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="customer-lifetime-value.html#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Merging both customer-by-time matrices.</span></span>
<span id="cb66-5"><a href="customer-lifetime-value.html#cb66-5" aria-hidden="true" tabindex="-1"></a>cal.cbt <span class="ot">&lt;-</span> <span class="fu">dc.MergeCustomers</span>(tot.cbt, freq.cbt)</span></code></pre></div>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="customer-lifetime-value.html#cb67-1" aria-hidden="true" tabindex="-1"></a>birth.periods <span class="ot">&lt;-</span> split.data<span class="sc">$</span>cust.data<span class="sc">$</span>birth.per</span>
<span id="cb67-2"><a href="customer-lifetime-value.html#cb67-2" aria-hidden="true" tabindex="-1"></a>last.dates <span class="ot">&lt;-</span> split.data<span class="sc">$</span>cust.data<span class="sc">$</span>last.date</span>
<span id="cb67-3"><a href="customer-lifetime-value.html#cb67-3" aria-hidden="true" tabindex="-1"></a>cal.cbs.dates <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(birth.periods, last.dates</span>
<span id="cb67-4"><a href="customer-lifetime-value.html#cb67-4" aria-hidden="true" tabindex="-1"></a>                            ,end.of.cal.period)</span>
<span id="cb67-5"><a href="customer-lifetime-value.html#cb67-5" aria-hidden="true" tabindex="-1"></a>cal.cbs <span class="ot">&lt;-</span> <span class="fu">dc.BuildCBSFromCBTAndDates</span>(cal.cbt</span>
<span id="cb67-6"><a href="customer-lifetime-value.html#cb67-6" aria-hidden="true" tabindex="-1"></a>                                      ,cal.cbs.dates</span>
<span id="cb67-7"><a href="customer-lifetime-value.html#cb67-7" aria-hidden="true" tabindex="-1"></a>                                      ,<span class="at">per=</span><span class="st">&quot;week&quot;</span>) <span class="co"># we want to see weekly data</span></span></code></pre></div>
<p><em>Notes:</em></p>
<p><em>1. cbs = customer-by-sufficient-statistics</em>
<em>2. We use <code>per = "week"</code> to get data shown per week, as ultimately it show the same as pr. day and returns a more simple data frame.</em></p>
<p>In general the procedure above can be executed in the following command: <code>dc.ElogToCbsCbt()</code>. But they have chosen to show the process, so one is able to make iterations to the data if that is needed in other applications.</p>
</div>
<div id="parameter-estimation-1" class="section level4" number="1.3.3.2">
<h4><span class="header-section-number">1.3.3.2</span> Parameter Estimation</h4>
<p>We use the following formula to estiamte the parameters. They take starting point in par.start = c(1, 3, 1, 3), and iterate from there.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="customer-lifetime-value.html#cb68-1" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">bgnbd.EstimateParameters</span>(cal.cbs);</span>
<span id="cb68-2"><a href="customer-lifetime-value.html#cb68-2" aria-hidden="true" tabindex="-1"></a>params</span></code></pre></div>
<pre><code>##    p1    p2    p3    p4 
## 0.243 4.414 0.793 2.426</code></pre>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="customer-lifetime-value.html#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Log-Likelyhood of parameters</span></span>
<span id="cb70-2"><a href="customer-lifetime-value.html#cb70-2" aria-hidden="true" tabindex="-1"></a>LL <span class="ot">&lt;-</span> <span class="fu">bgnbd.cbs.LL</span>(params, cal.cbs);</span>
<span id="cb70-3"><a href="customer-lifetime-value.html#cb70-3" aria-hidden="true" tabindex="-1"></a>LL</span></code></pre></div>
<pre><code>## [1] -9582</code></pre>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="customer-lifetime-value.html#cb72-1" aria-hidden="true" tabindex="-1"></a>p.matrix <span class="ot">&lt;-</span> <span class="fu">c</span>(params, LL);</span>
<span id="cb72-2"><a href="customer-lifetime-value.html#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="customer-lifetime-value.html#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>){</span>
<span id="cb72-4"><a href="customer-lifetime-value.html#cb72-4" aria-hidden="true" tabindex="-1"></a>  params <span class="ot">&lt;-</span> <span class="fu">bgnbd.EstimateParameters</span>(cal.cbs, params);</span>
<span id="cb72-5"><a href="customer-lifetime-value.html#cb72-5" aria-hidden="true" tabindex="-1"></a>  LL <span class="ot">&lt;-</span> <span class="fu">bgnbd.cbs.LL</span>(params, cal.cbs);</span>
<span id="cb72-6"><a href="customer-lifetime-value.html#cb72-6" aria-hidden="true" tabindex="-1"></a>  p.matrix.row <span class="ot">&lt;-</span> <span class="fu">c</span>(params, LL);</span>
<span id="cb72-7"><a href="customer-lifetime-value.html#cb72-7" aria-hidden="true" tabindex="-1"></a>  p.matrix <span class="ot">&lt;-</span> <span class="fu">rbind</span>(p.matrix, p.matrix.row);</span>
<span id="cb72-8"><a href="customer-lifetime-value.html#cb72-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb72-9"><a href="customer-lifetime-value.html#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(p.matrix) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;r&quot;</span>, <span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;LL&quot;</span>);</span>
<span id="cb72-10"><a href="customer-lifetime-value.html#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(p.matrix) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>;</span>
<span id="cb72-11"><a href="customer-lifetime-value.html#cb72-11" aria-hidden="true" tabindex="-1"></a>p.matrix</span></code></pre></div>
<pre><code>##       r alpha     a    b    LL
## 1 0.243  4.41 0.793 2.43 -9582
## 2 0.243  4.41 0.793 2.43 -9582
## 3 0.243  4.41 0.793 2.43 -9582</code></pre>
<p>We have the following parameters:</p>
<ul>
<li>r = referring to the transaction - <strong>describes the gamma mixing distribution of the NBD transaction process</strong>. See figure <a href="customer-lifetime-value.html#fig:bgnbd1">1.3</a></li>
<li>alpha = refers to the transaction - <strong>describes the gamma mixing distribution of the NBD transaction process</strong>. See figure <a href="customer-lifetime-value.html#fig:bgnbd1">1.3</a></li>
<li>a = alpha that manipulates the beta distribution - <strong>explains dropout rate</strong>. See figure <a href="customer-lifetime-value.html#fig:bgnbd2">1.4</a></li>
<li>b = beta, that manipulates the beta distribution - <strong>explains dropout rate</strong>. See figure <a href="customer-lifetime-value.html#fig:bgnbd2">1.4</a></li>
</ul>
<p>They mention that it is good to try different starting points, i guess that could merely be incorporated into the loop.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="customer-lifetime-value.html#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bgnbd.PlotTransactionRateHeterogeneity</span>(params)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:bgnbd1"></span>
<img src="Customer-Analytics-Notes_files/figure-html/bgnbd1-1.png" alt="Transaction rate heterogeneity of estimated parameters" width="720" />
<p class="caption">
Figure 1.3: Transaction rate heterogeneity of estimated parameters
</p>
</div>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="customer-lifetime-value.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bgnbd.PlotDropoutRateHeterogeneity</span>(params)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:bgnbd2"></span>
<img src="Customer-Analytics-Notes_files/figure-html/bgnbd2-1.png" alt="Dropout probability heterogeneity of estimated parameters" width="720" />
<p class="caption">
Figure 1.4: Dropout probability heterogeneity of estimated parameters
</p>
</div>
</div>
<div id="individual-level-estimation" class="section level4" number="1.3.3.3">
<h4><span class="header-section-number">1.3.3.3</span> Individual Level Estimation</h4>
<p>This is about predicting on individual customer level. First we can estimate the number of transactions we expect a newly acquired customer to make in a give time period.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="customer-lifetime-value.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bgnbd.Expectation</span>(params</span>
<span id="cb76-2"><a href="customer-lifetime-value.html#cb76-2" aria-hidden="true" tabindex="-1"></a>                  ,<span class="at">t=</span><span class="dv">52</span>) <span class="co"># = 1 year, has we have 52 weeks</span></span></code></pre></div>
<pre><code>##   p3 
## 1.44</code></pre>
<p>We see that he is expected to make 1.44 purchases.</p>
<p>The follwing show customer 1516.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="customer-lifetime-value.html#cb78-1" aria-hidden="true" tabindex="-1"></a>cal.cbs[<span class="st">&quot;1516&quot;</span>,]</span></code></pre></div>
<pre><code>##     x   t.x T.cal 
##  26.0  30.9  31.0</code></pre>
<p>We see that he made 26 repeat transactions in the calibration period. Period 30.8 was the most recent period of a purchase, indicating that he bought towards the end of period 30.</p>
<p>Now we can save the attributes in objects.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="customer-lifetime-value.html#cb80-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> cal.cbs[<span class="st">&quot;1516&quot;</span>, <span class="st">&quot;x&quot;</span>]</span>
<span id="cb80-2"><a href="customer-lifetime-value.html#cb80-2" aria-hidden="true" tabindex="-1"></a>t.x <span class="ot">&lt;-</span> cal.cbs[<span class="st">&quot;1516&quot;</span>, <span class="st">&quot;t.x&quot;</span>]</span>
<span id="cb80-3"><a href="customer-lifetime-value.html#cb80-3" aria-hidden="true" tabindex="-1"></a>T.cal <span class="ot">&lt;-</span> cal.cbs[<span class="st">&quot;1516&quot;</span>, <span class="st">&quot;T.cal&quot;</span>]</span></code></pre></div>
<p>Finally we can calculate the expected number of purchases in the holdout period.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="customer-lifetime-value.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bgnbd.ConditionalExpectedTransactions</span>(params</span>
<span id="cb81-2"><a href="customer-lifetime-value.html#cb81-2" aria-hidden="true" tabindex="-1"></a>                                      ,<span class="at">T.star =</span> <span class="dv">52</span> <span class="co">#Prediction period, hence 52 weeks.</span></span>
<span id="cb81-3"><a href="customer-lifetime-value.html#cb81-3" aria-hidden="true" tabindex="-1"></a>                                      ,<span class="at">x =</span> x <span class="co">#No. of repeat trans. in cal. period.</span></span>
<span id="cb81-4"><a href="customer-lifetime-value.html#cb81-4" aria-hidden="true" tabindex="-1"></a>                                      ,<span class="at">t.x =</span> t.x <span class="co">#Most recent period with purchase</span></span>
<span id="cb81-5"><a href="customer-lifetime-value.html#cb81-5" aria-hidden="true" tabindex="-1"></a>                                      ,<span class="at">T.cal =</span> T.cal) <span class="co">#Length of cal. period.</span></span></code></pre></div>
<pre><code>##   p3 
## 25.8</code></pre>
<p>We see that the customer is expected to make 25.76 purchases in the hold-out-period.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="customer-lifetime-value.html#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bgnbd.PAlive</span>(<span class="at">params =</span> params</span>
<span id="cb83-2"><a href="customer-lifetime-value.html#cb83-2" aria-hidden="true" tabindex="-1"></a>             ,<span class="at">x =</span> x <span class="co">#No. of repeat transactions in the cal period</span></span>
<span id="cb83-3"><a href="customer-lifetime-value.html#cb83-3" aria-hidden="true" tabindex="-1"></a>             ,<span class="at">t.x =</span> t.x <span class="co">#Time of most recent repeat transaction</span></span>
<span id="cb83-4"><a href="customer-lifetime-value.html#cb83-4" aria-hidden="true" tabindex="-1"></a>             ,<span class="at">T.cal =</span> T.cal) <span class="co">#Length of calibration period</span></span></code></pre></div>
<pre><code>##    p3 
## 0.969</code></pre>
<p>We see that there is a probability of 96.8% that he will be alive after the end of the calibration period. That also seems intuitively high, as customer with the most recent transaction was in 38.4, hence this customer must also be close to the end of the calibration period.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="customer-lifetime-value.html#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">5</span>)){</span>
<span id="cb85-2"><a href="customer-lifetime-value.html#cb85-2" aria-hidden="true" tabindex="-1"></a>  cond.expectation <span class="ot">&lt;-</span> <span class="fu">bgnbd.ConditionalExpectedTransactions</span>(</span>
<span id="cb85-3"><a href="customer-lifetime-value.html#cb85-3" aria-hidden="true" tabindex="-1"></a>  params, <span class="at">T.star =</span> <span class="dv">52</span>, <span class="at">x =</span> i,</span>
<span id="cb85-4"><a href="customer-lifetime-value.html#cb85-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">t.x =</span> <span class="dv">20</span>, <span class="at">T.cal =</span> <span class="dv">39</span>)</span>
<span id="cb85-5"><a href="customer-lifetime-value.html#cb85-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span> (<span class="st">&quot;x:&quot;</span>,i,<span class="st">&quot;</span><span class="sc">\t</span><span class="st"> Expectation:&quot;</span>,cond.expectation, <span class="at">fill =</span> <span class="cn">TRUE</span>)</span>
<span id="cb85-6"><a href="customer-lifetime-value.html#cb85-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## x: 10     Expectation: 0.347
## x: 15     Expectation: 0.0428
## x: 20     Expectation: 0.00416
## x: 25     Expectation: 0.000358</code></pre>
<p><strong>I am not entirely sure what is meant by the ‘increasing frequency paradox’ as of the conditional expectation</strong></p>
</div>
<div id="plotting-goodness-of-fit-1" class="section level4" number="1.3.3.4">
<h4><span class="header-section-number">1.3.3.4</span> Plotting / Goodness-of-fit</h4>
<p>First of all we can plot the actual vs. predicted in the calibration period.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="customer-lifetime-value.html#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bgnbd.PlotFrequencyInCalibration</span>(<span class="at">params =</span> params</span>
<span id="cb87-2"><a href="customer-lifetime-value.html#cb87-2" aria-hidden="true" tabindex="-1"></a>                                 ,<span class="at">cal.cbs =</span> cal.cbs</span>
<span id="cb87-3"><a href="customer-lifetime-value.html#cb87-3" aria-hidden="true" tabindex="-1"></a>                                 ,<span class="at">censor =</span> <span class="dv">7</span> <span class="co">#All 7+ are binned.</span></span>
<span id="cb87-4"><a href="customer-lifetime-value.html#cb87-4" aria-hidden="true" tabindex="-1"></a>                                 )</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-52-1.png" width="720" style="display: block; margin: auto;" /></p>
<pre><code>##              freq.0 freq.1 freq.2 freq.3 freq.4 freq.5 freq.6 freq.7+
## n.x.actual     1411    439    214    100   62.0   38.0   29.0    64.0
## n.x.expected   1408    460    192    101   59.8   38.1   25.5    71.2</code></pre>
<p>We see that the model replicates the variance that we observe in the data very well.</p>
<p>What we see is amount of customers on y and amount of transactinos in training period.</p>
<p>Now we construct the hold/out period.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="customer-lifetime-value.html#cb89-1" aria-hidden="true" tabindex="-1"></a>elog <span class="ot">&lt;-</span> <span class="fu">dc.SplitUpElogForRepeatTrans</span>(elog)<span class="sc">$</span>repeat.trans.elog;</span>
<span id="cb89-2"><a href="customer-lifetime-value.html#cb89-2" aria-hidden="true" tabindex="-1"></a>x.star <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(cal.cbs));</span>
<span id="cb89-3"><a href="customer-lifetime-value.html#cb89-3" aria-hidden="true" tabindex="-1"></a>cal.cbs <span class="ot">&lt;-</span> <span class="fu">cbind</span>(cal.cbs, x.star);</span>
<span id="cb89-4"><a href="customer-lifetime-value.html#cb89-4" aria-hidden="true" tabindex="-1"></a>elog.custs <span class="ot">&lt;-</span> elog<span class="sc">$</span>cust;</span>
<span id="cb89-5"><a href="customer-lifetime-value.html#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(cal.cbs)){</span>
<span id="cb89-6"><a href="customer-lifetime-value.html#cb89-6" aria-hidden="true" tabindex="-1"></a>  current.cust <span class="ot">&lt;-</span> <span class="fu">rownames</span>(cal.cbs)[i]</span>
<span id="cb89-7"><a href="customer-lifetime-value.html#cb89-7" aria-hidden="true" tabindex="-1"></a>  tot.cust.trans <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">which</span>(elog.custs <span class="sc">==</span> current.cust))</span>
<span id="cb89-8"><a href="customer-lifetime-value.html#cb89-8" aria-hidden="true" tabindex="-1"></a>  cal.trans <span class="ot">&lt;-</span> cal.cbs[i, <span class="st">&quot;x&quot;</span>]</span>
<span id="cb89-9"><a href="customer-lifetime-value.html#cb89-9" aria-hidden="true" tabindex="-1"></a>  cal.cbs[i, <span class="st">&quot;x.star&quot;</span>] <span class="ot">&lt;-</span> tot.cust.trans <span class="sc">-</span> cal.trans</span>
<span id="cb89-10"><a href="customer-lifetime-value.html#cb89-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb89-11"><a href="customer-lifetime-value.html#cb89-11" aria-hidden="true" tabindex="-1"></a>cal.cbs[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,]</span></code></pre></div>
<pre><code>##   x   t.x T.cal x.star
## 1 2 30.43  38.9      1
## 2 1  1.71  38.9      0
## 3 0  0.00  38.9      0</code></pre>
<p>We fill in the characteristics to the model. And we can plot</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="customer-lifetime-value.html#cb91-1" aria-hidden="true" tabindex="-1"></a>T.star <span class="ot">&lt;-</span> <span class="dv">39</span> <span class="co"># length of the holdout period</span></span>
<span id="cb91-2"><a href="customer-lifetime-value.html#cb91-2" aria-hidden="true" tabindex="-1"></a>censor <span class="ot">&lt;-</span> <span class="dv">7</span> <span class="co"># This censor serves the same purpose described above</span></span>
<span id="cb91-3"><a href="customer-lifetime-value.html#cb91-3" aria-hidden="true" tabindex="-1"></a>x.star <span class="ot">&lt;-</span> cal.cbs[,<span class="st">&quot;x.star&quot;</span>]</span>
<span id="cb91-4"><a href="customer-lifetime-value.html#cb91-4" aria-hidden="true" tabindex="-1"></a>comp <span class="ot">&lt;-</span> <span class="fu">bgnbd.PlotFreqVsConditionalExpectedFrequency</span>(params</span>
<span id="cb91-5"><a href="customer-lifetime-value.html#cb91-5" aria-hidden="true" tabindex="-1"></a>                                                     ,T.star</span>
<span id="cb91-6"><a href="customer-lifetime-value.html#cb91-6" aria-hidden="true" tabindex="-1"></a>                                                     ,cal.cbs</span>
<span id="cb91-7"><a href="customer-lifetime-value.html#cb91-7" aria-hidden="true" tabindex="-1"></a>                                                     ,x.star</span>
<span id="cb91-8"><a href="customer-lifetime-value.html#cb91-8" aria-hidden="true" tabindex="-1"></a>                                                     ,censor)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-54"></span>
<img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-54-1.png" alt="Actual vs. conditional expected transactions in the holdout period." width="720" />
<p class="caption">
Figure 1.5: Actual vs. conditional expected transactions in the holdout period.
</p>
</div>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="customer-lifetime-value.html#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(comp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;act&quot;</span>, <span class="st">&quot;exp&quot;</span>, <span class="st">&quot;bin&quot;</span>)</span>
<span id="cb92-2"><a href="customer-lifetime-value.html#cb92-2" aria-hidden="true" tabindex="-1"></a>comp</span></code></pre></div>
<pre><code>##       freq.0  freq.1 freq.2 freq.3 freq.4 freq.5 freq.6 freq.7+
## act    0.237   0.697   1.39   1.56   2.53   2.95   3.86    6.36
## exp    0.225   0.523   1.04   1.52   2.16   2.65   3.50    6.16
## bin 1411.000 439.000 214.00 100.00  62.00  38.00  29.00   64.00</code></pre>
<p>Now we can assess how well the our model predict how many transactions will occur in each week.</p>
<p>First, we need to convert the total transactions pr. day into a customer-by-time matrix (cbt). And then we can transform them into weekly observations instead of daily.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="customer-lifetime-value.html#cb94-1" aria-hidden="true" tabindex="-1"></a>tot.cbt <span class="ot">&lt;-</span> <span class="fu">dc.CreateFreqCBT</span>(elog)</span></code></pre></div>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="customer-lifetime-value.html#cb95-1" aria-hidden="true" tabindex="-1"></a>d.track.data <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">7</span> <span class="sc">*</span> <span class="dv">78</span>) <span class="co">#Corresponding to the amount of daily transactions in the holdout</span></span>
<span id="cb95-2"><a href="customer-lifetime-value.html#cb95-2" aria-hidden="true" tabindex="-1"></a>origin <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;1997-01-01&quot;</span>)</span>
<span id="cb95-3"><a href="customer-lifetime-value.html#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">colnames</span>(tot.cbt)){</span>
<span id="cb95-4"><a href="customer-lifetime-value.html#cb95-4" aria-hidden="true" tabindex="-1"></a>  date.index <span class="ot">&lt;-</span> <span class="fu">difftime</span>(<span class="fu">as.Date</span>(i), origin) <span class="sc">+</span> <span class="dv">1</span>;</span>
<span id="cb95-5"><a href="customer-lifetime-value.html#cb95-5" aria-hidden="true" tabindex="-1"></a>  d.track.data[date.index] <span class="ot">&lt;-</span> <span class="fu">sum</span>(tot.cbt[,i]);</span>
<span id="cb95-6"><a href="customer-lifetime-value.html#cb95-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb95-7"><a href="customer-lifetime-value.html#cb95-7" aria-hidden="true" tabindex="-1"></a>w.track.data <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">78</span>)</span>
<span id="cb95-8"><a href="customer-lifetime-value.html#cb95-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">78</span>){</span>
<span id="cb95-9"><a href="customer-lifetime-value.html#cb95-9" aria-hidden="true" tabindex="-1"></a>  w.track.data[j] <span class="ot">&lt;-</span> <span class="fu">sum</span>(d.track.data[(j<span class="sc">*</span><span class="dv">7-6</span>)<span class="sc">:</span>(j<span class="sc">*</span><span class="dv">7</span>)])</span>
<span id="cb95-10"><a href="customer-lifetime-value.html#cb95-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Now we can plot and compare the number of transactions with the predicted (expected).</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="customer-lifetime-value.html#cb96-1" aria-hidden="true" tabindex="-1"></a>T.cal <span class="ot">&lt;-</span> cal.cbs[,<span class="st">&quot;T.cal&quot;</span>]</span>
<span id="cb96-2"><a href="customer-lifetime-value.html#cb96-2" aria-hidden="true" tabindex="-1"></a>T.tot <span class="ot">&lt;-</span> <span class="dv">78</span> <span class="co">#78 because we have 78 weeks in total, if daily then 7*78=546</span></span>
<span id="cb96-3"><a href="customer-lifetime-value.html#cb96-3" aria-hidden="true" tabindex="-1"></a>n.periods.final <span class="ot">&lt;-</span> <span class="dv">78</span> <span class="co">#Notice, often this will just be the same, but does not have to be</span></span>
<span id="cb96-4"><a href="customer-lifetime-value.html#cb96-4" aria-hidden="true" tabindex="-1"></a>inc.tracking <span class="ot">&lt;-</span> <span class="fu">bgnbd.PlotTrackingInc</span>(params, T.cal</span>
<span id="cb96-5"><a href="customer-lifetime-value.html#cb96-5" aria-hidden="true" tabindex="-1"></a>                                      ,T.tot, w.track.data</span>
<span id="cb96-6"><a href="customer-lifetime-value.html#cb96-6" aria-hidden="true" tabindex="-1"></a>                                      ,n.periods.final)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-58"></span>
<img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-58-1.png" alt="Actual vs. expected incremental purchasing behaviour." width="720" />
<p class="caption">
Figure 1.6: Actual vs. expected incremental purchasing behaviour.
</p>
</div>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="customer-lifetime-value.html#cb97-1" aria-hidden="true" tabindex="-1"></a>inc.tracking[,<span class="dv">20</span><span class="sc">:</span><span class="dv">25</span>]</span></code></pre></div>
<pre><code>##          [,1] [,2] [,3] [,4] [,5] [,6]
## actual   73.0 55.0   70 33.0 56.0 99.0
## expected 76.9 74.9   73 71.3 69.7 68.2</code></pre>
<p>We can now plot the following with the actual vs. the expected (predicted).</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="customer-lifetime-value.html#cb99-1" aria-hidden="true" tabindex="-1"></a>cum.tracking.data <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(w.track.data)</span>
<span id="cb99-2"><a href="customer-lifetime-value.html#cb99-2" aria-hidden="true" tabindex="-1"></a>cum.tracking <span class="ot">&lt;-</span> <span class="fu">bgnbd.PlotTrackingCum</span>(params, T.cal</span>
<span id="cb99-3"><a href="customer-lifetime-value.html#cb99-3" aria-hidden="true" tabindex="-1"></a>                                      ,T.tot, cum.tracking.data</span>
<span id="cb99-4"><a href="customer-lifetime-value.html#cb99-4" aria-hidden="true" tabindex="-1"></a>                                      ,n.periods.final)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-59"></span>
<img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-59-1.png" alt="Actual vs. expected cumulative purchasing behaviour." width="720" />
<p class="caption">
Figure 1.7: Actual vs. expected cumulative purchasing behaviour.
</p>
</div>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="customer-lifetime-value.html#cb100-1" aria-hidden="true" tabindex="-1"></a>cum.tracking[,<span class="dv">20</span><span class="sc">:</span><span class="dv">25</span>]</span></code></pre></div>
<pre><code>##          [,1] [,2] [,3] [,4] [,5] [,6]
## actual   1359 1414 1484 1517 1573 1672
## expected 1312 1387 1460 1532 1601 1670</code></pre>
<p><em>Notice that the dashed line show the shift from calibration to hold out sample.</em></p>
<p>We see that our model fits the data very well! And also captures the trend.</p>
</div>
</div>
<div id="bgbb" class="section level3" number="1.3.4">
<h3><span class="header-section-number">1.3.4</span> BG/BB</h3>
<p><strong>I am not sure if this is a part of the curriculum</strong></p>
<div id="data-preparation-2" class="section level4" number="1.3.4.1">
<h4><span class="header-section-number">1.3.4.1</span> Data Preparation</h4>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="customer-lifetime-value.html#cb102-1" aria-hidden="true" tabindex="-1"></a>simElog <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;data/discreteSimElog.csv&quot;</span></span>
<span id="cb102-2"><a href="customer-lifetime-value.html#cb102-2" aria-hidden="true" tabindex="-1"></a>                       ,<span class="at">package =</span> <span class="st">&quot;BTYD&quot;</span>)</span>
<span id="cb102-3"><a href="customer-lifetime-value.html#cb102-3" aria-hidden="true" tabindex="-1"></a>elog <span class="ot">&lt;-</span> <span class="fu">dc.ReadLines</span>(simElog, <span class="at">cust.idx =</span> <span class="dv">1</span>, <span class="at">date.idx =</span> <span class="dv">2</span>)</span>
<span id="cb102-4"><a href="customer-lifetime-value.html#cb102-4" aria-hidden="true" tabindex="-1"></a>elog[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,]</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="left">cust</th>
<th align="left">date</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">1970-01-01</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">1975-01-01</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">1977-01-01</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="customer-lifetime-value.html#cb103-1" aria-hidden="true" tabindex="-1"></a>elog<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(elog<span class="sc">$</span>date, <span class="st">&quot;%Y-%m-%d&quot;</span>)</span>
<span id="cb103-2"><a href="customer-lifetime-value.html#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(elog<span class="sc">$</span>date);</span></code></pre></div>
<pre><code>## [1] &quot;1983-01-01&quot;</code></pre>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="customer-lifetime-value.html#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(elog<span class="sc">$</span>date);</span></code></pre></div>
<pre><code>## [1] &quot;1970-01-01&quot;</code></pre>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="customer-lifetime-value.html#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># let&#39;s make the calibration period end somewhere in-between</span></span>
<span id="cb107-2"><a href="customer-lifetime-value.html#cb107-2" aria-hidden="true" tabindex="-1"></a>T.cal <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;1977-01-01&quot;</span>)</span>
<span id="cb107-3"><a href="customer-lifetime-value.html#cb107-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-4"><a href="customer-lifetime-value.html#cb107-4" aria-hidden="true" tabindex="-1"></a>simData <span class="ot">&lt;-</span> <span class="fu">dc.ElogToCbsCbt</span>(elog, <span class="at">per=</span><span class="st">&quot;year&quot;</span>, T.cal)</span>
<span id="cb107-5"><a href="customer-lifetime-value.html#cb107-5" aria-hidden="true" tabindex="-1"></a>cal.cbs <span class="ot">&lt;-</span> simData<span class="sc">$</span>cal<span class="sc">$</span>cbs</span>
<span id="cb107-6"><a href="customer-lifetime-value.html#cb107-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-7"><a href="customer-lifetime-value.html#cb107-7" aria-hidden="true" tabindex="-1"></a>freq<span class="ot">&lt;-</span> cal.cbs[,<span class="st">&quot;x&quot;</span>]</span>
<span id="cb107-8"><a href="customer-lifetime-value.html#cb107-8" aria-hidden="true" tabindex="-1"></a>rec <span class="ot">&lt;-</span> cal.cbs[,<span class="st">&quot;t.x&quot;</span>]</span>
<span id="cb107-9"><a href="customer-lifetime-value.html#cb107-9" aria-hidden="true" tabindex="-1"></a>trans.opp <span class="ot">&lt;-</span> <span class="dv">7</span> <span class="co"># transaction opportunities</span></span>
<span id="cb107-10"><a href="customer-lifetime-value.html#cb107-10" aria-hidden="true" tabindex="-1"></a>cal.rf.matrix <span class="ot">&lt;-</span> <span class="fu">dc.MakeRFmatrixCal</span>(freq, rec, trans.opp)</span>
<span id="cb107-11"><a href="customer-lifetime-value.html#cb107-11" aria-hidden="true" tabindex="-1"></a>cal.rf.matrix[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span></code></pre></div>
<pre><code>##      x t.x n.cal custs
## [1,] 0   0     7  2900
## [2,] 1   1     7   933
## [3,] 1   2     7   218
## [4,] 2   2     7   489
## [5,] 1   3     7    95</code></pre>
</div>
<div id="parameter-estimation-2" class="section level4" number="1.3.4.2">
<h4><span class="header-section-number">1.3.4.2</span> Parameter Estimation</h4>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="customer-lifetime-value.html#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(donationsSummary);</span>
<span id="cb109-2"><a href="customer-lifetime-value.html#cb109-2" aria-hidden="true" tabindex="-1"></a>rf.matrix <span class="ot">&lt;-</span> donationsSummary<span class="sc">$</span>rf.matrix</span>
<span id="cb109-3"><a href="customer-lifetime-value.html#cb109-3" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">bgbb.EstimateParameters</span>(rf.matrix);</span>
<span id="cb109-4"><a href="customer-lifetime-value.html#cb109-4" aria-hidden="true" tabindex="-1"></a>LL <span class="ot">&lt;-</span> <span class="fu">bgbb.rf.matrix.LL</span>(params, rf.matrix);</span>
<span id="cb109-5"><a href="customer-lifetime-value.html#cb109-5" aria-hidden="true" tabindex="-1"></a>p.matrix <span class="ot">&lt;-</span> <span class="fu">c</span>(params, LL);</span>
<span id="cb109-6"><a href="customer-lifetime-value.html#cb109-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-7"><a href="customer-lifetime-value.html#cb109-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>){</span>
<span id="cb109-8"><a href="customer-lifetime-value.html#cb109-8" aria-hidden="true" tabindex="-1"></a>  params <span class="ot">&lt;-</span> <span class="fu">bgbb.EstimateParameters</span>(rf.matrix, params);</span>
<span id="cb109-9"><a href="customer-lifetime-value.html#cb109-9" aria-hidden="true" tabindex="-1"></a>  LL <span class="ot">&lt;-</span> <span class="fu">bgbb.rf.matrix.LL</span>(params, rf.matrix);</span>
<span id="cb109-10"><a href="customer-lifetime-value.html#cb109-10" aria-hidden="true" tabindex="-1"></a>  p.matrix.row <span class="ot">&lt;-</span> <span class="fu">c</span>(params, LL);</span>
<span id="cb109-11"><a href="customer-lifetime-value.html#cb109-11" aria-hidden="true" tabindex="-1"></a>  p.matrix <span class="ot">&lt;-</span> <span class="fu">rbind</span>(p.matrix, p.matrix.row);</span>
<span id="cb109-12"><a href="customer-lifetime-value.html#cb109-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb109-13"><a href="customer-lifetime-value.html#cb109-13" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(p.matrix) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;beta&quot;</span>, <span class="st">&quot;gamma&quot;</span>, <span class="st">&quot;delta&quot;</span>, <span class="st">&quot;LL&quot;</span>);</span>
<span id="cb109-14"><a href="customer-lifetime-value.html#cb109-14" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(p.matrix) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>;</span>
<span id="cb109-15"><a href="customer-lifetime-value.html#cb109-15" aria-hidden="true" tabindex="-1"></a>p.matrix;</span></code></pre></div>
<pre><code>##   alpha beta gamma delta     LL
## 1   1.2 0.75 0.657  2.78 -33226
## 2   1.2 0.75 0.657  2.78 -33226
## 3   1.2 0.75 0.657  2.78 -33226</code></pre>
</div>
<div id="individual-level-estimations-1" class="section level4" number="1.3.4.3">
<h4><span class="header-section-number">1.3.4.3</span> Individual Level Estimations</h4>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="customer-lifetime-value.html#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bgbb.Expectation</span>(params, <span class="at">n=</span><span class="dv">10</span>);</span></code></pre></div>
<pre><code>## [1] 3.18</code></pre>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="customer-lifetime-value.html#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co"># customer A</span></span>
<span id="cb113-2"><a href="customer-lifetime-value.html#cb113-2" aria-hidden="true" tabindex="-1"></a>n.cal <span class="ot">=</span> <span class="dv">6</span></span>
<span id="cb113-3"><a href="customer-lifetime-value.html#cb113-3" aria-hidden="true" tabindex="-1"></a>n.star <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb113-4"><a href="customer-lifetime-value.html#cb113-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb113-5"><a href="customer-lifetime-value.html#cb113-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-6"><a href="customer-lifetime-value.html#cb113-6" aria-hidden="true" tabindex="-1"></a>t.x <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb113-7"><a href="customer-lifetime-value.html#cb113-7" aria-hidden="true" tabindex="-1"></a><span class="fu">bgbb.ConditionalExpectedTransactions</span>(params, n.cal</span>
<span id="cb113-8"><a href="customer-lifetime-value.html#cb113-8" aria-hidden="true" tabindex="-1"></a>                                     ,n.star, x, t.x)</span></code></pre></div>
<pre><code>## [1] 0.13</code></pre>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="customer-lifetime-value.html#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># customer B</span></span>
<span id="cb115-2"><a href="customer-lifetime-value.html#cb115-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="dv">4</span></span>
<span id="cb115-3"><a href="customer-lifetime-value.html#cb115-3" aria-hidden="true" tabindex="-1"></a>t.x <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb115-4"><a href="customer-lifetime-value.html#cb115-4" aria-hidden="true" tabindex="-1"></a><span class="fu">bgbb.ConditionalExpectedTransactions</span>(params, n.cal</span>
<span id="cb115-5"><a href="customer-lifetime-value.html#cb115-5" aria-hidden="true" tabindex="-1"></a>                                     ,n.star, x, t.x)</span></code></pre></div>
<pre><code>## [1] 3.63</code></pre>
</div>
<div id="plotting-goodness-of-fit-2" class="section level4" number="1.3.4.4">
<h4><span class="header-section-number">1.3.4.4</span> Plotting / Goodness-of-fit</h4>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="customer-lifetime-value.html#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bgbb.PlotFrequencyInCalibration</span>(params, rf.matrix)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-68-1.png" width="720" style="display: block; margin: auto;" /></p>
<pre><code>##                       0    1    2    3    4    5    6
## actual.frequency   3464 1823 1430 1085 1036 1063 1203
## expected.frequency 3455 1889 1349 1113 1018 1027 1253</code></pre>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="customer-lifetime-value.html#cb119-1" aria-hidden="true" tabindex="-1"></a>holdout.cbs <span class="ot">&lt;-</span> simData<span class="sc">$</span>holdout<span class="sc">$</span>cbs</span>
<span id="cb119-2"><a href="customer-lifetime-value.html#cb119-2" aria-hidden="true" tabindex="-1"></a>x.star <span class="ot">&lt;-</span> holdout.cbs[,<span class="st">&quot;x.star&quot;</span>]</span></code></pre></div>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="customer-lifetime-value.html#cb120-1" aria-hidden="true" tabindex="-1"></a>n.star <span class="ot">&lt;-</span> <span class="dv">5</span> <span class="co"># length of the holdout period</span></span>
<span id="cb120-2"><a href="customer-lifetime-value.html#cb120-2" aria-hidden="true" tabindex="-1"></a>x.star <span class="ot">&lt;-</span> donationsSummary<span class="sc">$</span>x.star</span>
<span id="cb120-3"><a href="customer-lifetime-value.html#cb120-3" aria-hidden="true" tabindex="-1"></a>comp <span class="ot">&lt;-</span> <span class="fu">bgbb.PlotFreqVsConditionalExpectedFrequency</span>(params, n.star,</span>
<span id="cb120-4"><a href="customer-lifetime-value.html#cb120-4" aria-hidden="true" tabindex="-1"></a>rf.matrix, x.star)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-70-1.png" width="720" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="customer-lifetime-value.html#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(comp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;act&quot;</span>, <span class="st">&quot;exp&quot;</span>, <span class="st">&quot;bin&quot;</span>)</span>
<span id="cb121-2"><a href="customer-lifetime-value.html#cb121-2" aria-hidden="true" tabindex="-1"></a>comp</span></code></pre></div>
<pre><code>##       freq.0   freq.1   freq.2  freq.3  freq.4  freq.5  freq.6
## act 1.74e-01    0.433    0.813    1.39    2.06    2.64    3.53
## exp 7.29e-02    0.325    0.709    1.33    2.03    2.78    3.75
## bin 3.46e+03 1823.000 1430.000 1085.00 1036.00 1063.00 1203.00</code></pre>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="customer-lifetime-value.html#cb123-1" aria-hidden="true" tabindex="-1"></a>comp <span class="ot">&lt;-</span> <span class="fu">bgbb.PlotRecVsConditionalExpectedFrequency</span>(params, n.star,</span>
<span id="cb123-2"><a href="customer-lifetime-value.html#cb123-2" aria-hidden="true" tabindex="-1"></a>rf.matrix, x.star)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-72-1.png" width="720" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="customer-lifetime-value.html#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(comp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;act&quot;</span>, <span class="st">&quot;exp&quot;</span>, <span class="st">&quot;bin&quot;</span>)</span>
<span id="cb124-2"><a href="customer-lifetime-value.html#cb124-2" aria-hidden="true" tabindex="-1"></a>comp</span></code></pre></div>
<pre><code>##        rec.0    rec.1  rec.2   rec.3   rec.4   rec.5   rec.6
## act 1.74e-01 2.18e-01   0.39   0.487   0.809    1.65    2.95
## exp 7.29e-02 8.57e-02   0.18   0.404   0.851    1.73    3.03
## bin 3.46e+03 1.09e+03 890.00 706.000 654.000 1136.00 3163.00</code></pre>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="customer-lifetime-value.html#cb126-1" aria-hidden="true" tabindex="-1"></a>inc.track.data <span class="ot">&lt;-</span> donationsSummary<span class="sc">$</span>annual.trans</span>
<span id="cb126-2"><a href="customer-lifetime-value.html#cb126-2" aria-hidden="true" tabindex="-1"></a>n.cal <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb126-3"><a href="customer-lifetime-value.html#cb126-3" aria-hidden="true" tabindex="-1"></a>xtickmarks <span class="ot">&lt;-</span> <span class="dv">1996</span><span class="sc">:</span><span class="dv">2006</span></span>
<span id="cb126-4"><a href="customer-lifetime-value.html#cb126-4" aria-hidden="true" tabindex="-1"></a>inc.tracking <span class="ot">&lt;-</span> <span class="fu">bgbb.PlotTrackingInc</span>(params, rf.matrix</span>
<span id="cb126-5"><a href="customer-lifetime-value.html#cb126-5" aria-hidden="true" tabindex="-1"></a>                                     ,inc.track.data</span>
<span id="cb126-6"><a href="customer-lifetime-value.html#cb126-6" aria-hidden="true" tabindex="-1"></a>                                     ,<span class="at">xticklab =</span> xtickmarks)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-74-1.png" width="720" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="customer-lifetime-value.html#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(inc.tracking) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;act&quot;</span>, <span class="st">&quot;exp&quot;</span>)</span>
<span id="cb127-2"><a href="customer-lifetime-value.html#cb127-2" aria-hidden="true" tabindex="-1"></a>inc.tracking</span></code></pre></div>
<pre><code>##     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11]
## act 5652 4674 4019 3552 3555 3163 3110 2938 2703  2573  1936
## exp 5536 4717 4148 3725 3396 3132 2914 2730 2574  2438  2319</code></pre>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="customer-lifetime-value.html#cb129-1" aria-hidden="true" tabindex="-1"></a>cum.track.data <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(inc.track.data)</span>
<span id="cb129-2"><a href="customer-lifetime-value.html#cb129-2" aria-hidden="true" tabindex="-1"></a>cum.tracking <span class="ot">&lt;-</span> <span class="fu">bgbb.PlotTrackingCum</span>(params, rf.matrix, cum.track.data</span>
<span id="cb129-3"><a href="customer-lifetime-value.html#cb129-3" aria-hidden="true" tabindex="-1"></a>                                     ,<span class="at">xticklab =</span> xtickmarks)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-76-1.png" width="720" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="customer-lifetime-value.html#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(cum.tracking) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;act&quot;</span>, <span class="st">&quot;exp&quot;</span>)</span>
<span id="cb130-2"><a href="customer-lifetime-value.html#cb130-2" aria-hidden="true" tabindex="-1"></a>cum.tracking</span></code></pre></div>
<pre><code>##     [,1]  [,2]  [,3]  [,4]  [,5]  [,6]  [,7]  [,8]  [,9] [,10] [,11]
## act 5652 10326 14345 17897 21452 24615 27725 30663 33366 35939 37875
## exp 5536 10253 14401 18125 21521 24653 27566 30297 32871 35309 37627</code></pre>
</div>
</div>
<div id="examples-from-the-lecture" class="section level3" number="1.3.5">
<h3><span class="header-section-number">1.3.5</span> Examples from the lecture</h3>
<div id="paretonbd-1" class="section level4" number="1.3.5.1">
<h4><span class="header-section-number">1.3.5.1</span> Pareto/NBD</h4>
<p>PREDICTING LONG TERM CUSTOMER VALUE WITH BTYD PACKAGE</p>
<ul>
<li>Pareto/NBD (negative binomial distribution) modeling of</li>
<li>repeat-buying behavior in a noncontractual setting</li>
</ul>
<p>Based on Schmittlein, Morrison, and Colombo (1987), “Counting Your Customers:
Who Are They and What Will They Do Next?” Management Science, 33, 1-24.</p>
<p>Required data for model is:</p>
<p>“customer-by-sufficient-statistic” (cbs) matrix with the ‘sufficient’ stats being: <strong>This is the most important table, this is the information that is needed to run the model.</strong></p>
<ul>
<li>frequency of transaction (no of repeat transactions)</li>
<li>recency (time of last transaction) and</li>
<li>total time observed</li>
</ul>
<p>Main model params are:</p>
<ul>
<li>beta unobserved shape parameter for Pareto dropout process</li>
<li>s unobserved scale parameter for Pareto dropout process</li>
<li>r unobserved shape parameter for NBD transaction</li>
<li>alpha unobserved scale parameter for NBD transaction</li>
</ul>
<p>Data are divided into earlier calibration and later holdout segments,
using a single date as the cut point. “cal” data are used
to predict “holdout” data</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="customer-lifetime-value.html#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(BTYD)</span>
<span id="cb132-2"><a href="customer-lifetime-value.html#cb132-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in data</span></span>
<span id="cb132-3"><a href="customer-lifetime-value.html#cb132-3" aria-hidden="true" tabindex="-1"></a>cdnowElog <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;data/cdnowElog.csv&quot;</span>, <span class="at">package =</span> <span class="st">&quot;BTYD&quot;</span>)</span>
<span id="cb132-4"><a href="customer-lifetime-value.html#cb132-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-5"><a href="customer-lifetime-value.html#cb132-5" aria-hidden="true" tabindex="-1"></a><span class="co"># The raw data file</span></span>
<span id="cb132-6"><a href="customer-lifetime-value.html#cb132-6" aria-hidden="true" tabindex="-1"></a>raw <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(cdnowElog)</span>
<span id="cb132-7"><a href="customer-lifetime-value.html#cb132-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(raw)</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">masterid</th>
<th align="right">sampleid</th>
<th align="right">date</th>
<th align="right">cds</th>
<th align="right">sales</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">4</td>
<td align="right">1</td>
<td align="right">2e+07</td>
<td align="right">2</td>
<td align="right">29.3</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">1</td>
<td align="right">2e+07</td>
<td align="right">2</td>
<td align="right">29.7</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">1</td>
<td align="right">2e+07</td>
<td align="right">1</td>
<td align="right">15.0</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">1</td>
<td align="right">2e+07</td>
<td align="right">2</td>
<td align="right">26.5</td>
</tr>
<tr class="odd">
<td align="right">21</td>
<td align="right">2</td>
<td align="right">2e+07</td>
<td align="right">3</td>
<td align="right">63.3</td>
</tr>
<tr class="even">
<td align="right">21</td>
<td align="right">2</td>
<td align="right">2e+07</td>
<td align="right">1</td>
<td align="right">11.8</td>
</tr>
</tbody>
</table>
</div>
<p>We see the id of the customer and the date of transactions, and also amount of cd’s purchases and with the amount of sale.s</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="customer-lifetime-value.html#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create event log from file &quot;cdnowElog.csv&quot;, which has</span></span>
<span id="cb133-2"><a href="customer-lifetime-value.html#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="co"># customer IDs in the second column, dates in the third column, and</span></span>
<span id="cb133-3"><a href="customer-lifetime-value.html#cb133-3" aria-hidden="true" tabindex="-1"></a><span class="co"># sales numbers in the fifth column.</span></span>
<span id="cb133-4"><a href="customer-lifetime-value.html#cb133-4" aria-hidden="true" tabindex="-1"></a>elog <span class="ot">&lt;-</span> <span class="fu">dc.ReadLines</span>(<span class="fu">system.file</span>(<span class="st">&quot;data/cdnowElog.csv&quot;</span>, <span class="at">package=</span><span class="st">&quot;BTYD&quot;</span>),<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">5</span>)</span>
<span id="cb133-5"><a href="customer-lifetime-value.html#cb133-5" aria-hidden="true" tabindex="-1"></a>elog[,<span class="st">&quot;date&quot;</span>] <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(elog[,<span class="st">&quot;date&quot;</span>], <span class="st">&quot;%Y%m%d&quot;</span>)</span>
<span id="cb133-6"><a href="customer-lifetime-value.html#cb133-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-7"><a href="customer-lifetime-value.html#cb133-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(elog)  <span class="co">#take a look on the raw data</span></span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="left">cust</th>
<th align="left">date</th>
<th align="right">sales</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">1997-01-01</td>
<td align="right">29.3</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">1997-01-18</td>
<td align="right">29.7</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">1997-08-02</td>
<td align="right">15.0</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">1997-12-12</td>
<td align="right">26.5</td>
</tr>
<tr class="odd">
<td align="left">2</td>
<td align="left">1997-01-01</td>
<td align="right">63.3</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">1997-01-13</td>
<td align="right">11.8</td>
</tr>
</tbody>
</table>
</div>
<p>This is a new dataset where we have changed the names and formated the date.</p>
<p><strong>Notice, that this should be the format of all tables if you want to run the model</strong></p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="customer-lifetime-value.html#cb134-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">dc.ElogToCbsCbt</span>(elog, <span class="at">per=</span><span class="st">&quot;week&quot;</span>, <span class="at">T.cal=</span><span class="fu">as.Date</span>(<span class="st">&quot;1997-09-30&quot;</span>))</span>
<span id="cb134-2"><a href="customer-lifetime-value.html#cb134-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3"><a href="customer-lifetime-value.html#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(data)</span></code></pre></div>
<pre><code>## $names
## [1] &quot;cal&quot;       &quot;holdout&quot;   &quot;cust.data&quot;</code></pre>
<p>We see that we have different attributes on the data. Notice that it is stored as a list.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="customer-lifetime-value.html#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(data<span class="sc">$</span>cal)</span></code></pre></div>
<pre><code>## $names
## [1] &quot;cbs&quot; &quot;cbt&quot;</code></pre>
<p>We see that the calibration data has both tables cbs and cbt.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="customer-lifetime-value.html#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data<span class="sc">$</span>cal<span class="sc">$</span>cbs) <span class="co">#take a look on the calibration data</span></span></code></pre></div>
<pre><code>##   x   t.x T.cal
## 1 2 30.43  38.9
## 2 1  1.71  38.9
## 3 0  0.00  38.9
## 4 0  0.00  38.9
## 5 0  0.00  38.9
## 6 7 29.43  38.9</code></pre>
<p>We get the information:</p>
<ul>
<li>x = number of transactions. We see that there are only two transactions now, before we had 4, that is because one is in the hold out sample and we removed the first transaction.</li>
</ul>
<div id="estimate-parameters-for-paretonbd-model-based-upon-calibration-data" class="section level5" number="1.3.5.1.1">
<h5><span class="header-section-number">1.3.5.1.1</span> Estimate parameters for Pareto/NBD model based upon calibration data</h5>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="customer-lifetime-value.html#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co"># initial estimate</span></span>
<span id="cb140-2"><a href="customer-lifetime-value.html#cb140-2" aria-hidden="true" tabindex="-1"></a>(params2 <span class="ot">&lt;-</span> <span class="fu">pnbd.EstimateParameters</span>(data<span class="sc">$</span>cal<span class="sc">$</span>cbs))</span></code></pre></div>
<pre><code>## [1]  0.553 10.580  0.606 11.656</code></pre>
<p>We see the four params in the following order, r, alpha, s, beta</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="customer-lifetime-value.html#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co"># look at log likelihood</span></span>
<span id="cb142-2"><a href="customer-lifetime-value.html#cb142-2" aria-hidden="true" tabindex="-1"></a>(LL <span class="ot">&lt;-</span> <span class="fu">pnbd.cbs.LL</span>(params2, data<span class="sc">$</span>cal<span class="sc">$</span>cbs))</span></code></pre></div>
<pre><code>## [1] -9595</code></pre>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="customer-lifetime-value.html#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make a series of estimates, see if they converge to the same solution</span></span>
<span id="cb144-2"><a href="customer-lifetime-value.html#cb144-2" aria-hidden="true" tabindex="-1"></a>p.matrix <span class="ot">&lt;-</span> <span class="fu">c</span>(params2, LL)</span>
<span id="cb144-3"><a href="customer-lifetime-value.html#cb144-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>) {</span>
<span id="cb144-4"><a href="customer-lifetime-value.html#cb144-4" aria-hidden="true" tabindex="-1"></a>  params2 <span class="ot">&lt;-</span> <span class="fu">pnbd.EstimateParameters</span>(data<span class="sc">$</span>cal<span class="sc">$</span>cbs, params2)</span>
<span id="cb144-5"><a href="customer-lifetime-value.html#cb144-5" aria-hidden="true" tabindex="-1"></a>  LL <span class="ot">&lt;-</span> <span class="fu">pnbd.cbs.LL</span>(params2, data<span class="sc">$</span>cal<span class="sc">$</span>cbs)</span>
<span id="cb144-6"><a href="customer-lifetime-value.html#cb144-6" aria-hidden="true" tabindex="-1"></a>  p.matrix.row <span class="ot">&lt;-</span> <span class="fu">c</span>(params2, LL)</span>
<span id="cb144-7"><a href="customer-lifetime-value.html#cb144-7" aria-hidden="true" tabindex="-1"></a>  p.matrix <span class="ot">&lt;-</span> <span class="fu">rbind</span>(p.matrix, p.matrix.row)</span>
<span id="cb144-8"><a href="customer-lifetime-value.html#cb144-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb144-9"><a href="customer-lifetime-value.html#cb144-9" aria-hidden="true" tabindex="-1"></a><span class="co">#colnames(p.matrix) &lt;- c(&quot;beta&quot;,&quot;s&quot;,&quot;r&quot;,&quot;Alpha&quot;,&quot;LL&quot;)</span></span>
<span id="cb144-10"><a href="customer-lifetime-value.html#cb144-10" aria-hidden="true" tabindex="-1"></a><span class="co"># examine</span></span>
<span id="cb144-11"><a href="customer-lifetime-value.html#cb144-11" aria-hidden="true" tabindex="-1"></a>p.matrix</span></code></pre></div>
<pre><code>##               [,1] [,2]  [,3] [,4]  [,5]
## p.matrix     0.553 10.6 0.606 11.7 -9595
## p.matrix.row 0.553 10.6 0.606 11.7 -9595
## p.matrix.row 0.553 10.6 0.606 11.7 -9595
## p.matrix.row 0.553 10.6 0.606 11.7 -9595
## p.matrix.row 0.553 10.6 0.606 11.7 -9595
## p.matrix.row 0.553 10.6 0.606 11.7 -9595
## p.matrix.row 0.553 10.6 0.606 11.7 -9595
## p.matrix.row 0.553 10.6 0.606 11.7 -9595
## p.matrix.row 0.553 10.6 0.606 11.7 -9595
## p.matrix.row 0.553 10.6 0.606 11.7 -9595
## p.matrix.row 0.553 10.6 0.606 11.7 -9595
## p.matrix.row 0.553 10.6 0.606 11.7 -9595
## p.matrix.row 0.553 10.6 0.606 11.7 -9595
## p.matrix.row 0.553 10.6 0.606 11.7 -9595
## p.matrix.row 0.553 10.6 0.606 11.7 -9595
## p.matrix.row 0.553 10.6 0.606 11.7 -9595
## p.matrix.row 0.553 10.6 0.606 11.7 -9595
## p.matrix.row 0.553 10.6 0.606 11.7 -9595
## p.matrix.row 0.553 10.6 0.606 11.7 -9595
## p.matrix.row 0.553 10.6 0.606 11.7 -9595
## p.matrix.row 0.553 10.6 0.606 11.7 -9595</code></pre>
<p>We see that the parameters are very stable, hence they dont change much in the iterations.</p>
<p>We see the average dropout rate: s/beta</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="customer-lifetime-value.html#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co">#The average dropout rate</span></span>
<span id="cb146-2"><a href="customer-lifetime-value.html#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="fl">0.6060</span><span class="sc">/</span><span class="fl">11.65</span> <span class="co"># = 0.05201717. i.e.</span></span></code></pre></div>
<pre><code>## [1] 0.052</code></pre>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="customer-lifetime-value.html#cb148-1" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">=</span> p.matrix[<span class="dv">1</span>,<span class="dv">3</span>]</span>
<span id="cb148-2"><a href="customer-lifetime-value.html#cb148-2" aria-hidden="true" tabindex="-1"></a>  Alpha <span class="ot">=</span> p.matrix[<span class="dv">1</span>,<span class="dv">4</span>]</span>
<span id="cb148-3"><a href="customer-lifetime-value.html#cb148-3" aria-hidden="true" tabindex="-1"></a>  r<span class="sc">/</span>Alpha</span></code></pre></div>
<pre><code>## p.matrix 
##    0.052</code></pre>
<p>We see the average transaction rate:</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="customer-lifetime-value.html#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="co">#THe average transaction rate</span></span>
<span id="cb150-2"><a href="customer-lifetime-value.html#cb150-2" aria-hidden="true" tabindex="-1"></a><span class="fl">0.5533</span><span class="sc">/</span><span class="fl">10.58</span> <span class="co">#=0.05229679 i.e.</span></span></code></pre></div>
<pre><code>## [1] 0.0523</code></pre>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="customer-lifetime-value.html#cb152-1" aria-hidden="true" tabindex="-1"></a>  beta <span class="ot">=</span> p.matrix[<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb152-2"><a href="customer-lifetime-value.html#cb152-2" aria-hidden="true" tabindex="-1"></a>  s <span class="ot">=</span> p.matrix[<span class="dv">1</span>,<span class="dv">2</span>]</span>
<span id="cb152-3"><a href="customer-lifetime-value.html#cb152-3" aria-hidden="true" tabindex="-1"></a>  beta<span class="sc">/</span>s</span></code></pre></div>
<pre><code>## p.matrix 
##   0.0523</code></pre>
<p><strong><em>Notice, it is a miracle that it so similar to the dropout rate.</em></strong></p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="customer-lifetime-value.html#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use final set of values</span></span>
<span id="cb154-2"><a href="customer-lifetime-value.html#cb154-2" aria-hidden="true" tabindex="-1"></a>(params2 <span class="ot">&lt;-</span> p.matrix[<span class="fu">dim</span>(p.matrix)[<span class="dv">1</span>],<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>])</span></code></pre></div>
<pre><code>## [1]  0.553 10.578  0.606 11.660</code></pre>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="customer-lifetime-value.html#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="co">#The drop-out rate - Pareto part</span></span>
<span id="cb156-2"><a href="customer-lifetime-value.html#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pnbd.PlotDropoutRateHeterogeneity</span>(params2)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-89-1.png" width="720" style="display: block; margin: auto;" /></p>
<pre><code>##               [,1]     [,2]     [,3]     [,4]    [,5]    [,6]    [,7]   [,8]
## x.axis.ticks     0  0.00314  0.00628  0.00942  0.0126  0.0157  0.0188  0.022
## heterogeneity  Inf 28.04491 20.57566 16.90749 14.5532 12.8494 11.5290 10.460
##                 [,9]  [,10]  [,11]  [,12]  [,13]  [,14]  [,15]  [,16]  [,17]
## x.axis.ticks  0.0251 0.0282 0.0314 0.0345 0.0377 0.0408 0.0439 0.0471 0.0502
## heterogeneity 9.5670 8.8049 8.1434 7.5614 7.0440 6.5800 6.1610 5.7803 5.4327
##                [,18]  [,19]  [,20]  [,21]  [,22]  [,23]  [,24]  [,25]  [,26]
## x.axis.ticks  0.0534 0.0565 0.0596 0.0628 0.0659 0.0691 0.0722 0.0753 0.0785
## heterogeneity 5.1138 4.8203 4.5491 4.2979 4.0645 3.8473 3.6446 3.4552 3.2779
##                [,27]  [,28]  [,29] [,30]  [,31]  [,32] [,33] [,34] [,35] [,36]
## x.axis.ticks  0.0816 0.0847 0.0879 0.091 0.0942 0.0973   0.1 0.104 0.107  0.11
## heterogeneity 3.1117 2.9556 2.8088 2.671 2.5406 2.4178   2.3 2.192 2.089  1.99
##               [,37] [,38] [,39] [,40] [,41] [,42] [,43] [,44] [,45] [,46] [,47]
## x.axis.ticks  0.113 0.116 0.119 0.122 0.126 0.129 0.132 0.135 0.138 0.141 0.144
## heterogeneity 1.898 1.810 1.727 1.648 1.573 1.502 1.434 1.370 1.309 1.251 1.195
##               [,48] [,49] [,50] [,51] [,52] [,53] [,54] [,55] [,56] [,57] [,58]
## x.axis.ticks  0.148 0.151 0.154 0.157 0.160 0.163 0.166 0.169 0.173 0.176 0.179
## heterogeneity 1.143 1.092 1.045 0.999 0.956 0.914 0.875 0.837 0.801 0.767 0.734
##               [,59] [,60] [,61] [,62] [,63] [,64] [,65] [,66] [,67] [,68] [,69]
## x.axis.ticks  0.182 0.185 0.188 0.191 0.195 0.198 0.201 0.204 0.207 0.210 0.213
## heterogeneity 0.703 0.673 0.645 0.618 0.592 0.567 0.543 0.520 0.499 0.478 0.458
##               [,70] [,71] [,72] [,73] [,74] [,75] [,76] [,77] [,78] [,79] [,80]
## x.axis.ticks  0.217 0.220 0.223 0.226 0.229 0.232 0.235 0.239 0.242 0.245 0.248
## heterogeneity 0.439 0.421 0.404 0.387 0.371 0.356 0.341 0.327 0.314 0.301 0.289
##               [,81] [,82] [,83] [,84] [,85] [,86] [,87] [,88] [,89] [,90] [,91]
## x.axis.ticks  0.251 0.254 0.257 0.261 0.264 0.267 0.270 0.273 0.276 0.279 0.282
## heterogeneity 0.277 0.266 0.255 0.245 0.235 0.225 0.216 0.207 0.199 0.191 0.183
##               [,92] [,93] [,94] [,95] [,96] [,97] [,98] [,99] [,100]
## x.axis.ticks  0.286 0.289 0.292 0.295 0.298 0.301 0.304 0.308  0.311
## heterogeneity 0.176 0.169 0.162 0.156 0.149 0.144 0.138 0.132  0.127</code></pre>
<p>The average lifetime:</p>
<p>Hence we take one and divide it by the average dropout rate.</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="customer-lifetime-value.html#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">/</span>(<span class="fl">0.6060</span><span class="sc">/</span><span class="fl">11.65</span>) <span class="co">#i.e.</span></span></code></pre></div>
<pre><code>## [1] 19.2</code></pre>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="customer-lifetime-value.html#cb160-1" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">=</span> p.matrix[<span class="dv">1</span>,<span class="dv">3</span>]</span>
<span id="cb160-2"><a href="customer-lifetime-value.html#cb160-2" aria-hidden="true" tabindex="-1"></a>  Alpha <span class="ot">=</span> p.matrix[<span class="dv">1</span>,<span class="dv">4</span>]</span>
<span id="cb160-3"><a href="customer-lifetime-value.html#cb160-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">/</span>(r<span class="sc">/</span>Alpha)</span></code></pre></div>
<pre><code>## p.matrix 
##     19.2</code></pre>
<p>We can then plot what characterizes the unobserved lifetime for a customer with an average dropoutrate</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="customer-lifetime-value.html#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot average tendency to drop-out</span></span>
<span id="cb162-2"><a href="customer-lifetime-value.html#cb162-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">40</span>, <span class="at">length.out=</span><span class="dv">1000</span>)</span>
<span id="cb162-3"><a href="customer-lifetime-value.html#cb162-3" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x=</span>x, <span class="at">densx=</span><span class="fu">dexp</span>(x, <span class="at">rate=</span><span class="fl">0.052</span>)) <span class="co">#Notice, 0.052 is the average dropout rate</span></span>
<span id="cb162-4"><a href="customer-lifetime-value.html#cb162-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb162-5"><a href="customer-lifetime-value.html#cb162-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>densx)) <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-91-1.png" width="720" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="customer-lifetime-value.html#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The transaction rate - NBD part</span></span>
<span id="cb163-2"><a href="customer-lifetime-value.html#cb163-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pnbd.PlotTransactionRateHeterogeneity</span>(params2)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-92-1.png" width="720" style="display: block; margin: auto;" /></p>
<pre><code>##               [,1]     [,2]     [,3]     [,4]    [,5]    [,6]    [,7]   [,8]
## x.axis.ticks     0  0.00332  0.00664  0.00995  0.0133  0.0166  0.0199 0.0232
## heterogeneity  Inf 28.37867 20.10409 16.19515 13.7510 12.0172 10.6953 9.6393
##                 [,9]  [,10]  [,11]  [,12]  [,13]  [,14]  [,15]  [,16]  [,17]
## x.axis.ticks  0.0265 0.0299 0.0332 0.0365 0.0398 0.0431 0.0464 0.0498 0.0531
## heterogeneity 8.7680 8.0318 7.3983 6.8454 6.3574 5.9225 5.5321 5.1792 4.8585
##                [,18]  [,19] [,20]  [,21]  [,22] [,23]  [,24]  [,25]  [,26]
## x.axis.ticks  0.0564 0.0597 0.063 0.0664 0.0697 0.073 0.0763 0.0796 0.0829
## heterogeneity 4.5656 4.2970 4.050 3.8216 3.6102 3.414 3.2315 3.0613 2.9023
##                [,27]  [,28]  [,29]  [,30]  [,31] [,32] [,33] [,34] [,35] [,36]
## x.axis.ticks  0.0863 0.0896 0.0929 0.0962 0.0995 0.103 0.106 0.109 0.113 0.116
## heterogeneity 2.7536 2.6142 2.4833 2.3604 2.2447 2.136 2.033 1.936 1.845 1.758
##               [,37] [,38] [,39] [,40] [,41] [,42] [,43] [,44] [,45] [,46] [,47]
## x.axis.ticks  0.119 0.123 0.126 0.129 0.133 0.136 0.139 0.143 0.146 0.149 0.153
## heterogeneity 1.676 1.599 1.525 1.456 1.390 1.327 1.268 1.211 1.157 1.106 1.058
##               [,48] [,49] [,50] [,51] [,52] [,53] [,54] [,55] [,56] [,57] [,58]
## x.axis.ticks  0.156 0.159 0.163 0.166 0.169 0.173 0.176 0.179 0.182 0.186 0.189
## heterogeneity 1.011 0.967 0.926 0.886 0.848 0.811 0.777 0.744 0.712 0.682 0.653
##               [,59] [,60] [,61] [,62] [,63] [,64] [,65] [,66] [,67] [,68] [,69]
## x.axis.ticks  0.192 0.196 0.199 0.202 0.206 0.209 0.212 0.216 0.219 0.222 0.226
## heterogeneity 0.626 0.600 0.575 0.551 0.528 0.506 0.485 0.465 0.446 0.428 0.410
##               [,70] [,71] [,72] [,73] [,74] [,75] [,76] [,77] [,78] [,79] [,80]
## x.axis.ticks  0.229 0.232 0.236 0.239 0.242 0.246 0.249 0.252 0.255 0.259 0.262
## heterogeneity 0.394 0.378 0.362 0.348 0.334 0.320 0.307 0.295 0.283 0.272 0.261
##               [,81] [,82] [,83] [,84] [,85] [,86] [,87] [,88] [,89] [,90] [,91]
## x.axis.ticks  0.265 0.269 0.272 0.275 0.279 0.282 0.285 0.289 0.292 0.295 0.299
## heterogeneity 0.250 0.241 0.231 0.222 0.213 0.205 0.196 0.189 0.181 0.174 0.167
##               [,92] [,93] [,94] [,95] [,96] [,97] [,98] [,99] [,100]
## x.axis.ticks  0.302 0.305 0.309 0.312 0.315 0.319 0.322 0.325  0.328
## heterogeneity 0.161 0.154 0.148 0.143 0.137 0.132 0.127 0.122  0.117</code></pre>
<p>So what is the interpretation of 0.0523, which is the average transaction rate. It means that on average the customers have 0.05 transactions per period (week). So the customer buys a CD every 20 week</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="customer-lifetime-value.html#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Overall fit - Calibration data</span></span>
<span id="cb165-2"><a href="customer-lifetime-value.html#cb165-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate plots</span></span>
<span id="cb165-3"><a href="customer-lifetime-value.html#cb165-3" aria-hidden="true" tabindex="-1"></a><span class="fu">pnbd.PlotFrequencyInCalibration</span>(params2, data<span class="sc">$</span>cal<span class="sc">$</span>cbs, <span class="dv">7</span>)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-93-1.png" width="720" style="display: block; margin: auto;" /></p>
<pre><code>##              freq.0 freq.1 freq.2 freq.3 freq.4 freq.5 freq.6 freq.7+
## n.x.actual     1411    439    214    100   62.0   38.0   29.0    64.0
## n.x.expected   1434    397    194    112   70.6   46.4   31.5    70.8</code></pre>
<p><strong>Using the holdout period</strong></p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="customer-lifetime-value.html#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit Holdout period</span></span>
<span id="cb167-2"><a href="customer-lifetime-value.html#cb167-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-3"><a href="customer-lifetime-value.html#cb167-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot of performance in hold-out period</span></span>
<span id="cb167-4"><a href="customer-lifetime-value.html#cb167-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-5"><a href="customer-lifetime-value.html#cb167-5" aria-hidden="true" tabindex="-1"></a>T.star <span class="ot">&lt;-</span> <span class="dv">39</span> <span class="co"># length of the holdout period</span></span>
<span id="cb167-6"><a href="customer-lifetime-value.html#cb167-6" aria-hidden="true" tabindex="-1"></a>censor <span class="ot">&lt;-</span> <span class="dv">7</span> <span class="co"># This censor serves the same purpose as above</span></span>
<span id="cb167-7"><a href="customer-lifetime-value.html#cb167-7" aria-hidden="true" tabindex="-1"></a>x.star <span class="ot">&lt;-</span> data<span class="sc">$</span>holdout<span class="sc">$</span>cbs[,<span class="st">&quot;x.star&quot;</span>]</span>
<span id="cb167-8"><a href="customer-lifetime-value.html#cb167-8" aria-hidden="true" tabindex="-1"></a>comp <span class="ot">&lt;-</span> <span class="fu">pnbd.PlotFreqVsConditionalExpectedFrequency</span>(params2, T.star,</span>
<span id="cb167-9"><a href="customer-lifetime-value.html#cb167-9" aria-hidden="true" tabindex="-1"></a>                                                    data<span class="sc">$</span>cal<span class="sc">$</span>cbs, x.star, censor)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-94-1.png" width="720" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="customer-lifetime-value.html#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(comp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;act&quot;</span>, <span class="st">&quot;exp&quot;</span>, <span class="st">&quot;bin&quot;</span>)</span>
<span id="cb168-2"><a href="customer-lifetime-value.html#cb168-2" aria-hidden="true" tabindex="-1"></a>comp</span></code></pre></div>
<pre><code>##       freq.0  freq.1 freq.2 freq.3 freq.4 freq.5 freq.6 freq.7+
## act    0.237   0.697   1.39   1.56   2.53   2.95   3.86    6.36
## exp    0.138   0.600   1.20   1.71   2.40   2.91   3.82    6.40
## bin 1411.000 439.000 214.00 100.00  62.00  38.00  29.00   64.00</code></pre>
<p>The plot compares what we have observed and what we expect from the model.</p>
<p>The following calculates the expected number of transactions in a given period.</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="customer-lifetime-value.html#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A randomly selected individual</span></span>
<span id="cb170-2"><a href="customer-lifetime-value.html#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pnbd.Expectation</span>(params2,<span class="dv">78</span>)</span></code></pre></div>
<pre><code>## [1] 1.91</code></pre>
<p>We see that for any given customer we expect around 2 purchases for the period.</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="customer-lifetime-value.html#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Probability that a randomly selected customer makes 0 purchases in the hold-out period</span></span>
<span id="cb172-2"><a href="customer-lifetime-value.html#cb172-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pnbd.pmf.General</span>(params2,T.star,<span class="at">t.end =</span> <span class="dv">78</span>,<span class="dv">0</span>)</span></code></pre></div>
<pre><code>## [1] 0.811</code></pre>
<p>That is a probability of 81%</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="customer-lifetime-value.html#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Analysing a specific customer - No of transactions</span></span>
<span id="cb174-2"><a href="customer-lifetime-value.html#cb174-2" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>cal<span class="sc">$</span>cbs[<span class="st">&quot;1516&quot;</span>,]</span></code></pre></div>
<pre><code>##     x   t.x T.cal 
##  26.0  30.9  31.0</code></pre>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="customer-lifetime-value.html#cb176-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> data<span class="sc">$</span>cal<span class="sc">$</span>cbs[<span class="st">&quot;1516&quot;</span>, <span class="st">&quot;x&quot;</span>]</span>
<span id="cb176-2"><a href="customer-lifetime-value.html#cb176-2" aria-hidden="true" tabindex="-1"></a>t.x <span class="ot">&lt;-</span> data<span class="sc">$</span>cal<span class="sc">$</span>cbs[<span class="st">&quot;1516&quot;</span>, <span class="st">&quot;t.x&quot;</span>]</span>
<span id="cb176-3"><a href="customer-lifetime-value.html#cb176-3" aria-hidden="true" tabindex="-1"></a>T.cal <span class="ot">&lt;-</span> data<span class="sc">$</span>cal<span class="sc">$</span>cbs[<span class="st">&quot;1516&quot;</span>, <span class="st">&quot;T.cal&quot;</span>]</span></code></pre></div>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="customer-lifetime-value.html#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="co"># x</span></span>
<span id="cb177-2"><a href="customer-lifetime-value.html#cb177-2" aria-hidden="true" tabindex="-1"></a><span class="co"># t.x</span></span>
<span id="cb177-3"><a href="customer-lifetime-value.html#cb177-3" aria-hidden="true" tabindex="-1"></a><span class="co"># T.cal</span></span></code></pre></div>
<p>We see that the customer has made 26 purchases in the calibration period. He bought something in period 30.8 and we see the holdout period is 31 periods, hence we expect him to be alive in the end of the hold out period.</p>
<p>Now we want to calculate the number of transactions n period ahead given the information that we have about the customer.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="customer-lifetime-value.html#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="co"># T.star no of periods ahead</span></span>
<span id="cb178-2"><a href="customer-lifetime-value.html#cb178-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">pnbd.ConditionalExpectedTransactions</span>(params2,<span class="at">T.star=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,x,t.x,T.cal)</span>
<span id="cb178-3"><a href="customer-lifetime-value.html#cb178-3" aria-hidden="true" tabindex="-1"></a><span class="fu">t</span>(<span class="fu">t</span>(df))</span></code></pre></div>
<pre><code>##       [,1]
## [1,] 0.633
## [2,] 1.257
## [3,] 1.873
## [4,] 2.480
## [5,] 3.080</code></pre>
<p>Notice, that the table is accumulated, hence in period 1 we expect 0.63 transactions, then in period 1 and 2 we expect 1.25 transactions and lastly in period etc.</p>
<p>The following show how much it changes from period to period (week).</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="customer-lifetime-value.html#cb180-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">diff</span>(<span class="fu">as.matrix</span>(df)))</span>
<span id="cb180-2"><a href="customer-lifetime-value.html#cb180-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(res)</span></code></pre></div>
<pre><code>##   diff.as.matrix.df..
## 1               0.624
## 2               0.616
## 3               0.608
## 4               0.600</code></pre>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="customer-lifetime-value.html#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="co"># DERT discounted expected residual no. of transactions</span></span>
<span id="cb182-2"><a href="customer-lifetime-value.html#cb182-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-3"><a href="customer-lifetime-value.html#cb182-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 15% compounded annually has been converted to 0.0027 compounded continuously,</span></span>
<span id="cb182-4"><a href="customer-lifetime-value.html#cb182-4" aria-hidden="true" tabindex="-1"></a><span class="co"># as we are dealing with weekly data and not annual data.</span></span>
<span id="cb182-5"><a href="customer-lifetime-value.html#cb182-5" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fl">0.0027</span></span>
<span id="cb182-6"><a href="customer-lifetime-value.html#cb182-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-7"><a href="customer-lifetime-value.html#cb182-7" aria-hidden="true" tabindex="-1"></a><span class="fu">pnbd.DERT</span>(params2,x,t.x,T.cal,d)</span></code></pre></div>
<pre><code>## [1] 86</code></pre>
<p>We see that the DERT = 86, hence we see that the later we get the transactions, that amount is not as valuable today.</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="customer-lifetime-value.html#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the discounted expected residual transactions of a customer</span></span>
<span id="cb184-2"><a href="customer-lifetime-value.html#cb184-2" aria-hidden="true" tabindex="-1"></a><span class="co"># who made 2 repeat transactions in a calibration period that was 38.86</span></span>
<span id="cb184-3"><a href="customer-lifetime-value.html#cb184-3" aria-hidden="true" tabindex="-1"></a><span class="co"># weeks long, with the last transaction occurring in the middle of</span></span>
<span id="cb184-4"><a href="customer-lifetime-value.html#cb184-4" aria-hidden="true" tabindex="-1"></a><span class="co"># the 31th week.</span></span>
<span id="cb184-5"><a href="customer-lifetime-value.html#cb184-5" aria-hidden="true" tabindex="-1"></a><span class="fu">pnbd.DERT</span>(params2, <span class="at">x=</span><span class="dv">2</span>, <span class="at">t.x=</span><span class="fl">30.43</span>, <span class="at">T.cal=</span><span class="fl">38.86</span>, d)</span></code></pre></div>
<pre><code>## [1] 6.48</code></pre>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="customer-lifetime-value.html#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We can also use vectors to compute DERT for several customers:</span></span>
<span id="cb186-2"><a href="customer-lifetime-value.html#cb186-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pnbd.DERT</span>(params2, <span class="at">x=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">t.x =</span> <span class="fl">30.43</span>, <span class="at">T.cal=</span><span class="fl">38.86</span>, d)</span></code></pre></div>
<pre><code>##  [1]  3.99  6.48  8.90 11.22 13.44 15.54 17.51 19.33 20.98 22.45</code></pre>
<p>We see that x iterates form 1 to 10, hence customers with 10 repeatative purchases in the calibration has a discounted expected residual no. of transactions that is increasing.</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="customer-lifetime-value.html#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pnbd.Plot.DERT</span>(params2, <span class="at">x=</span><span class="dv">0</span><span class="sc">:</span><span class="dv">14</span>, <span class="at">t.x=</span><span class="dv">0</span><span class="sc">:</span><span class="dv">38</span>, <span class="at">T.cal=</span><span class="fl">38.86</span>, d, <span class="at">type=</span><span class="st">&quot;contour&quot;</span>)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-104-1.png" width="720" style="display: block; margin: auto;" /></p>
<pre><code>##        0     1     2      3       4       5        6        7        8        9
## 0  0.477 0.578 0.320  0.129  0.0446  0.0140  0.00411  0.00116 3.16e-04 8.38e-05
## 1  0.518 0.683 0.417  0.186  0.0702  0.0241  0.00776  0.00239 7.14e-04 2.07e-04
## 2  0.559 0.795 0.530  0.258  0.1064  0.0397  0.01391  0.00466 1.51e-03 4.76e-04
## 3  0.599 0.912 0.660  0.349  0.1561  0.0630  0.02385  0.00862 3.02e-03 1.03e-03
## 4  0.639 1.033 0.807  0.462  0.2226  0.0968  0.03935  0.01528 5.74e-03 2.10e-03
## 5  0.677 1.158 0.970  0.598  0.3098  0.1443  0.06280  0.02608 1.05e-02 4.09e-03
## 6  0.715 1.286 1.150  0.760  0.4216  0.2098  0.09734  0.04306 1.84e-02 7.65e-03
## 7  0.753 1.416 1.344  0.950  0.5622  0.2980  0.14697  0.06902 3.13e-02 1.38e-02
## 8  0.789 1.547 1.553  1.167  0.7358  0.4144  0.21671  0.10773 5.16e-02 2.41e-02
## 9  0.825 1.679 1.773  1.414  0.9466  0.5652  0.31270  0.16419 8.30e-02 4.08e-02
## 10 0.860 1.811 2.005  1.689  1.1980  0.7570  0.44229  0.24479 1.30e-01 6.74e-02
## 11 0.894 1.942 2.245  1.992  1.4930  0.9967  0.61399  0.35761 2.00e-01 1.09e-01
## 12 0.928 2.073 2.492  2.320  1.8334  1.2908  0.83734  0.51255 3.01e-01 1.71e-01
## 13 0.961 2.202 2.744  2.672  2.2199  1.6454  1.12262  0.72141 4.44e-01 2.64e-01
## 14 0.993 2.329 2.999  3.044  2.6515  2.0653  1.48030  0.99777 6.43e-01 4.00e-01
## 15 1.025 2.454 3.254  3.432  3.1256  2.5535  1.92033  1.35654 9.14e-01 5.95e-01
## 16 1.056 2.576 3.509  3.832  3.6381  3.1104  2.45105  1.81323 1.28e+00 8.68e-01
## 17 1.086 2.696 3.762  4.241  4.1834  3.7337  3.07813  2.38262 1.76e+00 1.24e+00
## 18 1.116 2.812 4.011  4.653  4.7544  4.4179  3.80333  3.07706 2.37e+00 1.75e+00
## 19 1.145 2.926 4.255  5.065  5.3436  5.1545  4.62353  3.90439 3.14e+00 2.42e+00
## 20 1.174 3.036 4.493  5.472  5.9425  5.9324  5.53010  4.86577 4.08e+00 3.28e+00
## 21 1.202 3.144 4.723  5.871  6.5431  6.7382  6.50899  5.95400 5.20e+00 4.36e+00
## 22 1.229 3.248 4.947  6.260  7.1376  7.5579  7.54146  7.15262 6.49e+00 5.66e+00
## 23 1.256 3.348 5.161  6.636  7.7190  8.3770  8.60554  8.43647 7.94e+00 7.20e+00
## 24 1.282 3.446 5.368  6.996  8.2812  9.1822  9.67791  9.77366 9.50e+00 8.93e+00
## 25 1.308 3.540 5.565  7.340  8.8195  9.9616 10.73584 11.12873 1.11e+01 1.08e+01
## 26 1.333 3.630 5.754  7.667  9.3302 10.7055 11.75906 12.46636 1.28e+01 1.28e+01
## 27 1.358 3.718 5.934  7.975  9.8108 11.4068 12.73091 13.75483 1.45e+01 1.48e+01
## 28 1.382 3.802 6.104  8.266 10.2600 12.0605 13.63911 14.96851 1.60e+01 1.68e+01
## 29 1.406 3.884 6.267  8.538 10.6771 12.6640 14.47577 16.08925 1.75e+01 1.86e+01
## 30 1.429 3.962 6.420  8.792 11.0624 13.2164 15.23707 17.10641 1.88e+01 2.03e+01
## 31 1.452 4.037 6.566  9.029 11.4167 13.7185 15.92256 18.01606 2.00e+01 2.18e+01
## 32 1.474 4.110 6.704  9.249 11.7412 14.1721 16.53441 18.81965 2.10e+01 2.31e+01
## 33 1.496 4.180 6.834  9.454 12.0376 14.5800 17.07664 19.52246 2.19e+01 2.42e+01
## 34 1.518 4.247 6.956  9.644 12.3076 14.9453 17.55440 20.13226 2.27e+01 2.52e+01
## 35 1.539 4.312 7.072  9.820 12.5530 15.2714 17.97347 20.65808 2.33e+01 2.60e+01
## 36 1.560 4.374 7.181  9.982 12.7757 15.5618 18.33981 21.10938 2.39e+01 2.66e+01
## 37 1.580 4.433 7.284 10.132 12.9776 15.8199 18.65923 21.49540 2.43e+01 2.72e+01
## 38 1.600 4.491 7.381 10.271 13.1604 16.0491 18.93728 21.82485 2.47e+01 2.76e+01
##          10       11       12       13       14
## 0  2.18e-05 5.57e-06 1.40e-06 3.49e-07 8.58e-08
## 1  5.90e-05 1.65e-05 4.55e-06 1.24e-06 3.33e-07
## 2  1.47e-04 4.47e-05 1.34e-05 3.96e-06 1.16e-06
## 3  3.43e-04 1.12e-04 3.63e-05 1.16e-05 3.66e-06
## 4  7.52e-04 2.65e-04 9.18e-05 3.15e-05 1.07e-05
## 5  1.57e-03 5.89e-04 2.18e-04 8.00e-05 2.90e-05
## 6  3.12e-03 1.25e-03 4.92e-04 1.92e-04 7.40e-05
## 7  5.96e-03 2.53e-03 1.06e-03 4.37e-04 1.79e-04
## 8  1.10e-02 4.93e-03 2.18e-03 9.53e-04 4.12e-04
## 9  1.97e-02 9.29e-03 4.33e-03 1.99e-03 9.08e-04
## 10 3.41e-02 1.70e-02 8.31e-03 4.02e-03 1.92e-03
## 11 5.77e-02 3.01e-02 1.55e-02 7.84e-03 3.94e-03
## 12 9.53e-02 5.20e-02 2.80e-02 1.48e-02 7.80e-03
## 13 1.54e-01 8.77e-02 4.93e-02 2.73e-02 1.50e-02
## 14 2.43e-01 1.45e-01 8.48e-02 4.90e-02 2.81e-02
## 15 3.77e-01 2.34e-01 1.43e-01 8.60e-02 5.12e-02
## 16 5.73e-01 3.71e-01 2.35e-01 1.47e-01 9.13e-02
## 17 8.57e-01 5.76e-01 3.80e-01 2.48e-01 1.59e-01
## 18 1.26e+00 8.79e-01 6.03e-01 4.08e-01 2.72e-01
## 19 1.81e+00 1.32e+00 9.38e-01 6.58e-01 4.55e-01
## 20 2.55e+00 1.93e+00 1.43e+00 1.04e+00 7.47e-01
## 21 3.53e+00 2.78e+00 2.14e+00 1.62e+00 1.20e+00
## 22 4.78e+00 3.92e+00 3.13e+00 2.46e+00 1.90e+00
## 23 6.32e+00 5.39e+00 4.48e+00 3.65e+00 2.92e+00
## 24 8.14e+00 7.22e+00 6.24e+00 5.28e+00 4.39e+00
## 25 1.02e+01 9.41e+00 8.45e+00 7.43e+00 6.41e+00
## 26 1.25e+01 1.19e+01 1.11e+01 1.01e+01 9.06e+00
## 27 1.49e+01 1.46e+01 1.41e+01 1.33e+01 1.24e+01
## 28 1.72e+01 1.74e+01 1.73e+01 1.68e+01 1.62e+01
## 29 1.95e+01 2.01e+01 2.05e+01 2.05e+01 2.03e+01
## 30 2.16e+01 2.27e+01 2.35e+01 2.41e+01 2.45e+01
## 31 2.35e+01 2.50e+01 2.63e+01 2.75e+01 2.84e+01
## 32 2.51e+01 2.70e+01 2.88e+01 3.04e+01 3.18e+01
## 33 2.65e+01 2.87e+01 3.08e+01 3.28e+01 3.47e+01
## 34 2.76e+01 3.01e+01 3.24e+01 3.48e+01 3.70e+01
## 35 2.86e+01 3.12e+01 3.38e+01 3.63e+01 3.88e+01
## 36 2.94e+01 3.21e+01 3.48e+01 3.75e+01 4.02e+01
## 37 3.00e+01 3.28e+01 3.56e+01 3.84e+01 4.12e+01
## 38 3.05e+01 3.34e+01 3.63e+01 3.91e+01 4.20e+01</code></pre>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="customer-lifetime-value.html#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="co"># P(alive) </span></span>
<span id="cb190-2"><a href="customer-lifetime-value.html#cb190-2" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>cal<span class="sc">$</span>cbs[<span class="st">&quot;1516&quot;</span>,]</span></code></pre></div>
<pre><code>##     x   t.x T.cal 
##  26.0  30.9  31.0</code></pre>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="customer-lifetime-value.html#cb192-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> data<span class="sc">$</span>cal<span class="sc">$</span>cbs[<span class="st">&quot;1516&quot;</span>, <span class="st">&quot;x&quot;</span>]</span>
<span id="cb192-2"><a href="customer-lifetime-value.html#cb192-2" aria-hidden="true" tabindex="-1"></a>t.x <span class="ot">&lt;-</span> data<span class="sc">$</span>cal<span class="sc">$</span>cbs[<span class="st">&quot;1516&quot;</span>, <span class="st">&quot;t.x&quot;</span>]</span>
<span id="cb192-3"><a href="customer-lifetime-value.html#cb192-3" aria-hidden="true" tabindex="-1"></a>T.cal <span class="ot">&lt;-</span> data<span class="sc">$</span>cal<span class="sc">$</span>cbs[<span class="st">&quot;1516&quot;</span>, <span class="st">&quot;T.cal&quot;</span>]</span></code></pre></div>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="customer-lifetime-value.html#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="co"># x</span></span>
<span id="cb193-2"><a href="customer-lifetime-value.html#cb193-2" aria-hidden="true" tabindex="-1"></a><span class="co"># t.x</span></span>
<span id="cb193-3"><a href="customer-lifetime-value.html#cb193-3" aria-hidden="true" tabindex="-1"></a><span class="co"># T.cal</span></span></code></pre></div>
<ul>
<li>x = 26</li>
<li>t.x = 30.85</li>
<li>T.cal = 31</li>
</ul>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="customer-lifetime-value.html#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pnbd.PAlive</span>(params2, x, t.x, T.cal)</span></code></pre></div>
<pre><code>## [1] 0.998</code></pre>
<p>We see that he has a probability of 99% of being alive at the end of the calibration period.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="customer-lifetime-value.html#cb196-1" aria-hidden="true" tabindex="-1"></a>palive.pnbd <span class="ot">&lt;-</span> <span class="fu">pnbd.PAlive</span>(params2,</span>
<span id="cb196-2"><a href="customer-lifetime-value.html#cb196-2" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">t.x =</span> <span class="dv">12</span>, <span class="at">T.cal =</span> <span class="dv">39</span>)</span>
<span id="cb196-3"><a href="customer-lifetime-value.html#cb196-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) {</span>
<span id="cb196-4"><a href="customer-lifetime-value.html#cb196-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;x =&quot;</span>, i, <span class="st">&quot;:&quot;</span>, <span class="fu">sprintf</span>(<span class="st">&quot;%5.2f %%&quot;</span>, <span class="dv">100</span><span class="sc">*</span>palive.pnbd[i]), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb196-5"><a href="customer-lifetime-value.html#cb196-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## x = 1 : 45.49 % 
## x = 2 : 33.19 % 
## x = 3 : 22.14 % 
## x = 4 : 13.61 % 
## x = 5 :  7.83 %</code></pre>
<p>We see that as number of transactions inceases the probability of being alive decrease. The reason for this is that we se that the t.x. is in period 12 (the most recent purchase). We see that the customer who has bought five times before period 12, hence i bought a lot. is pretty certain that he is not a customer anymore. Where the customer who only made one purchase before period 12, may still be a customer, bu his pattern just tells that he does not buy that often.</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="customer-lifetime-value.html#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="co"># P(Alive) across customers</span></span>
<span id="cb198-2"><a href="customer-lifetime-value.html#cb198-2" aria-hidden="true" tabindex="-1"></a>p.alives <span class="ot">&lt;-</span> <span class="fu">pnbd.PAlive</span>(params2,data<span class="sc">$</span>cal<span class="sc">$</span>cbs[,<span class="st">&quot;x&quot;</span>],data<span class="sc">$</span>cal<span class="sc">$</span>cbs[,<span class="st">&quot;t.x&quot;</span>],data<span class="sc">$</span>cal<span class="sc">$</span>cbs[,<span class="st">&quot;T.cal&quot;</span>])</span>
<span id="cb198-3"><a href="customer-lifetime-value.html#cb198-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(p.alives))</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-109-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>The figure explains where the customers mainly lie of being alive. Hence in the region between 0.3 and 0.4, the most customers lie.</p>
<p>Now we can try to calculate the number of active customers.</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="customer-lifetime-value.html#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of active customers</span></span>
<span id="cb199-2"><a href="customer-lifetime-value.html#cb199-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb199-3"><a href="customer-lifetime-value.html#cb199-3" aria-hidden="true" tabindex="-1"></a>no_of_active <span class="ot">&lt;-</span> <span class="fu">sum</span>(p.alives)</span>
<span id="cb199-4"><a href="customer-lifetime-value.html#cb199-4" aria-hidden="true" tabindex="-1"></a>no_of_active</span></code></pre></div>
<pre><code>## [1] 1052</code></pre>
<p>That is the sum of the probability of p.alives. This is an estimate of how many customers that are actually alive. One could also have made a cutoff saying that we will not accumulate on customer that have less than a certain threshold, e.g., 20%.</p>
<p>This is what he does in the following, where he does:</p>
<ol style="list-style-type: decimal">
<li>Creating a data frame</li>
<li>Sorting the customers</li>
<li>Plotting the spread</li>
<li>Calculating how many active customers there are in the specific scenario.</li>
</ol>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="customer-lifetime-value.html#cb201-1" aria-hidden="true" tabindex="-1"></a>p.alive1 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(p.alives)</span>
<span id="cb201-2"><a href="customer-lifetime-value.html#cb201-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(p.alive1)</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">p.alives</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.869</td>
</tr>
<tr class="even">
<td align="right">0.168</td>
</tr>
<tr class="odd">
<td align="right">0.295</td>
</tr>
<tr class="even">
<td align="right">0.295</td>
</tr>
<tr class="odd">
<td align="right">0.295</td>
</tr>
<tr class="even">
<td align="right">0.749</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="customer-lifetime-value.html#cb202-1" aria-hidden="true" tabindex="-1"></a>p.alive2 <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">rowid_to_column</span>(p.alive1, <span class="st">&quot;ID&quot;</span>)</span>
<span id="cb202-2"><a href="customer-lifetime-value.html#cb202-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(p.alive2)</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">ID</th>
<th align="right">p.alives</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">0.869</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">0.168</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">0.295</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">0.295</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">0.295</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">0.749</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="customer-lifetime-value.html#cb203-1" aria-hidden="true" tabindex="-1"></a>newalive <span class="ot">&lt;-</span> <span class="fu">arrange</span>(p.alive2,<span class="fu">desc</span>(p.alives))</span>
<span id="cb203-2"><a href="customer-lifetime-value.html#cb203-2" aria-hidden="true" tabindex="-1"></a>newalive2 <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">rowid_to_column</span>(newalive, <span class="st">&quot;ID1&quot;</span>)</span>
<span id="cb203-3"><a href="customer-lifetime-value.html#cb203-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(newalive2,<span class="dv">6</span>)</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">ID1</th>
<th align="right">ID</th>
<th align="right">p.alives</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">59</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">495</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">519</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">584</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">720</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">761</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="customer-lifetime-value.html#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(newalive2<span class="sc">$</span>ID1,newalive2<span class="sc">$</span>p.alives,<span class="at">xlab=</span><span class="st">&quot;Sorted customers&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;P(Alive)&quot;</span>)</span>
<span id="cb204-2"><a href="customer-lifetime-value.html#cb204-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span><span class="fl">0.5</span>)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-113-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>We see that there are approximately 500 active customers.</p>
</div>
</div>
<div id="bgnbg-example" class="section level4" number="1.3.5.2">
<h4><span class="header-section-number">1.3.5.2</span> BG/NBG example</h4>
<p><strong>Notice, this is showing how this can be applied to any data set.</strong></p>
<p><strong><em>Remember that that column names should be x, t.x, T.cal</em></strong></p>
<p>Notice, that this is not a super good files, as it is with customer with a loyalty cards, to they make many repeatitive purchases</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="customer-lifetime-value.html#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(BTYD)</span>
<span id="cb205-2"><a href="customer-lifetime-value.html#cb205-2" aria-hidden="true" tabindex="-1"></a>cal1 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;Data/BTYD/cal2010.csv&quot;</span>, <span class="at">header=</span><span class="cn">TRUE</span>,<span class="at">sep=</span><span class="st">&#39;;&#39;</span>)</span>
<span id="cb205-3"><a href="customer-lifetime-value.html#cb205-3" aria-hidden="true" tabindex="-1"></a>cal2010 <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(cal1,<span class="at">nrow=</span><span class="dv">3084</span>,<span class="at">ncol=</span><span class="dv">3</span>)</span>
<span id="cb205-4"><a href="customer-lifetime-value.html#cb205-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(cal2010) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;t.x&quot;</span>,<span class="st">&quot;T.cal&quot;</span>)</span>
<span id="cb205-5"><a href="customer-lifetime-value.html#cb205-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-6"><a href="customer-lifetime-value.html#cb205-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(cal2010,<span class="dv">10</span>)</span></code></pre></div>
<pre><code>##        x t.x T.cal
##  [1,] 77  85    85
##  [2,] 83  85    85
##  [3,] 56  83    85
##  [4,] 65  85    85
##  [5,] 77  85    85
##  [6,] 78  85    85
##  [7,] 78  85    85
##  [8,] 57  83    85
##  [9,] 83  85    85
## [10,] 79  85    85</code></pre>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="customer-lifetime-value.html#cb207-1" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">bgnbd.EstimateParameters</span>(cal2010,<span class="at">par.start =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>), <span class="at">max.param.value =</span> <span class="dv">10000</span>)</span>
<span id="cb207-2"><a href="customer-lifetime-value.html#cb207-2" aria-hidden="true" tabindex="-1"></a>params</span></code></pre></div>
<pre><code>##      p1      p2      p3      p4 
## 11.9792 14.7594  0.0047  6.5050</code></pre>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="customer-lifetime-value.html#cb209-1" aria-hidden="true" tabindex="-1"></a>LL <span class="ot">&lt;-</span> <span class="fu">bgnbd.cbs.LL</span>(params, cal2010)</span>
<span id="cb209-2"><a href="customer-lifetime-value.html#cb209-2" aria-hidden="true" tabindex="-1"></a>LL</span></code></pre></div>
<pre><code>## [1] -251854</code></pre>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="customer-lifetime-value.html#cb211-1" aria-hidden="true" tabindex="-1"></a>p.matrix <span class="ot">&lt;-</span> <span class="fu">c</span>(params, LL);</span>
<span id="cb211-2"><a href="customer-lifetime-value.html#cb211-2" aria-hidden="true" tabindex="-1"></a>p.matrix</span></code></pre></div>
<pre><code>##        p1        p2        p3        p4           
##  1.20e+01  1.48e+01  4.70e-03  6.51e+00 -2.52e+05</code></pre>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="customer-lifetime-value.html#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>){</span>
<span id="cb213-2"><a href="customer-lifetime-value.html#cb213-2" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">bgnbd.EstimateParameters</span>(cal2010, params);</span>
<span id="cb213-3"><a href="customer-lifetime-value.html#cb213-3" aria-hidden="true" tabindex="-1"></a>LL <span class="ot">&lt;-</span> <span class="fu">bgnbd.cbs.LL</span>(params, cal2010);</span>
<span id="cb213-4"><a href="customer-lifetime-value.html#cb213-4" aria-hidden="true" tabindex="-1"></a>p.matrix.row <span class="ot">&lt;-</span> <span class="fu">c</span>(params, LL);</span>
<span id="cb213-5"><a href="customer-lifetime-value.html#cb213-5" aria-hidden="true" tabindex="-1"></a>p.matrix <span class="ot">&lt;-</span> <span class="fu">rbind</span>(p.matrix, p.matrix.row);</span>
<span id="cb213-6"><a href="customer-lifetime-value.html#cb213-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb213-7"><a href="customer-lifetime-value.html#cb213-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(p.matrix) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;r&quot;</span>, <span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;LL&quot;</span>);</span>
<span id="cb213-8"><a href="customer-lifetime-value.html#cb213-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(p.matrix) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>;</span>
<span id="cb213-9"><a href="customer-lifetime-value.html#cb213-9" aria-hidden="true" tabindex="-1"></a>p.matrix;</span></code></pre></div>
<pre><code>##    r alpha      a    b      LL
## 1 12  14.8 0.0047 6.51 -251854
## 2 12  14.8 0.0047 6.51 -251854
## 3 12  14.8 0.0047 6.51 -251854</code></pre>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="customer-lifetime-value.html#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bgnbd.PlotTransactionRateHeterogeneity</span>(params)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-118-1.png" width="720" style="display: block; margin: auto;" /></p>
<pre><code>##               [,1]     [,2]     [,3]     [,4]     [,5]     [,6]     [,7]
## x.axis.ticks     0 1.47e-02 2.94e-02 4.41e-02 5.88e-02 7.34e-02 8.81e-02
## heterogeneity    0 1.61e-14 2.61e-11 1.80e-09 3.42e-08 3.19e-07 1.90e-06
##                   [,8]     [,9]    [,10]    [,11]    [,12]   [,13]   [,14]
## x.axis.ticks  1.03e-01 0.117505 0.132193 0.146881 0.161569 0.17626 0.19095
## heterogeneity 8.31e-06 0.000029 0.000085 0.000218 0.000499 0.00104 0.00203
##                 [,15]   [,16]  [,17]  [,18]  [,19]  [,20]  [,21]  [,22]  [,23]
## x.axis.ticks  0.20563 0.22032 0.2350 0.2497 0.2644 0.2791 0.2938 0.3085 0.3231
## heterogeneity 0.00368 0.00632 0.0103 0.0162 0.0244 0.0356 0.0503 0.0692 0.0928
##               [,24] [,25] [,26] [,27] [,28] [,29] [,30] [,31] [,32] [,33] [,34]
## x.axis.ticks  0.338 0.353 0.367 0.382 0.397 0.411 0.426 0.441 0.455  0.47 0.485
## heterogeneity 0.122 0.156 0.197 0.244 0.297 0.357 0.422 0.494 0.569  0.65 0.733
##               [,35] [,36] [,37] [,38] [,39] [,40] [,41] [,42] [,43] [,44] [,45]
## x.axis.ticks  0.499 0.514 0.529 0.543 0.558 0.573 0.588 0.602 0.617 0.632 0.646
## heterogeneity 0.819 0.907 0.995 1.082 1.167 1.250 1.329 1.403 1.472 1.534 1.590
##               [,46] [,47] [,48] [,49] [,50] [,51] [,52] [,53] [,54] [,55] [,56]
## x.axis.ticks  0.661 0.676  0.69 0.705  0.72 0.734 0.749 0.764 0.778 0.793 0.808
## heterogeneity 1.638 1.679  1.71 1.736  1.75 1.762 1.763 1.757 1.743 1.723 1.697
##               [,57] [,58] [,59] [,60] [,61] [,62] [,63] [,64] [,65] [,66] [,67]
## x.axis.ticks  0.823 0.837 0.852 0.867 0.881 0.896 0.911 0.925  0.94 0.955 0.969
## heterogeneity 1.665 1.628 1.587 1.541 1.492 1.441 1.386 1.331  1.27 1.216 1.157
##               [,68] [,69] [,70] [,71] [,72] [,73] [,74] [,75] [,76] [,77] [,78]
## x.axis.ticks  0.984 0.999 1.013 1.028 1.043 1.058 1.072 1.087 1.102 1.116 1.131
## heterogeneity 1.099 1.041 0.984 0.928 0.873 0.819 0.767 0.717 0.669 0.623 0.579
##               [,79] [,80] [,81] [,82] [,83] [,84] [,85] [,86] [,87] [,88] [,89]
## x.axis.ticks  1.146 1.160  1.18 1.190 1.204 1.219  1.23 1.248 1.263 1.278 1.293
## heterogeneity 0.537 0.497  0.46 0.424 0.391 0.359  0.33 0.303 0.277 0.253 0.231
##               [,90] [,91] [,92] [,93] [,94] [,95] [,96] [,97]  [,98]  [,99]
## x.axis.ticks  1.307 1.322 1.337 1.351 1.366  1.38 1.395 1.410 1.4247 1.4394
## heterogeneity 0.211 0.192 0.174 0.158 0.143  0.13 0.117 0.106 0.0957 0.0862
##               [,100]
## x.axis.ticks  1.4541
## heterogeneity 0.0776</code></pre>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="customer-lifetime-value.html#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bgnbd.PlotDropoutRateHeterogeneity</span>(params)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-119-1.png" width="720" style="display: block; margin: auto;" /></p>
<pre><code>##               [,1]     [,2]     [,3]     [,4]     [,5]     [,6]     [,7]
## x.axis.ticks     0 1.19e-04 2.37e-04 3.56e-04 0.000475 0.000594 0.000712
## heterogeneity  Inf 3.83e+01 1.92e+01 1.28e+01 9.624085 7.702304 6.419886
##                   [,8]    [,9]   [,10]   [,11]   [,12]   [,13]   [,14]   [,15]
## x.axis.ticks  0.000831 0.00095 0.00107 0.00119 0.00131 0.00142 0.00154 0.00166
## heterogeneity 5.503145 4.81512 4.27968 3.85109 3.50027 3.20779 2.96022 2.74793
##                 [,16]  [,17]   [,18]   [,19]   [,20]   [,21]   [,22]   [,23]
## x.axis.ticks  0.00178 0.0019 0.00202 0.00214 0.00226 0.00237 0.00249 0.00261
## heterogeneity 2.56389 2.4028 2.26062 2.13421 2.02107 1.91922 1.82705 1.74324
##                 [,24]   [,25]   [,26]   [,27]   [,28]   [,29]   [,30]   [,31]
## x.axis.ticks  0.00273 0.00285 0.00297 0.00309 0.00321 0.00332 0.00344 0.00356
## heterogeneity 1.66670 1.59653 1.53196 1.47234 1.41713 1.36586 1.31811 1.27354
##                 [,32]  [,33]   [,34]   [,35]   [,36]   [,37]   [,38]   [,39]
## x.axis.ticks  0.00368 0.0038 0.00392 0.00404 0.00415 0.00427 0.00439 0.00451
## heterogeneity 1.23184 1.1927 1.15601 1.12143 1.08882 1.05802 1.02889 1.00128
##                 [,40]   [,41]   [,42]   [,43]  [,44]   [,45]   [,46]   [,47]
## x.axis.ticks  0.00463 0.00475 0.00487 0.00499 0.0051 0.00522 0.00534 0.00546
## heterogeneity 0.97508 0.95019 0.92652 0.90397 0.8825 0.86193 0.84231 0.82355
##                 [,48]  [,49]   [,50]   [,51]   [,52]   [,53]   [,54]   [,55]
## x.axis.ticks  0.00558 0.0057 0.00582 0.00594 0.00605 0.00617 0.00629 0.00641
## heterogeneity 0.80558 0.7884 0.77183 0.75597 0.74073 0.72607 0.71197 0.69839
##                 [,56]   [,57]   [,58]   [,59] [,60]   [,61]   [,62]   [,63]
## x.axis.ticks  0.00653 0.00665 0.00677 0.00689 0.007 0.00712 0.00724 0.00736
## heterogeneity 0.68530 0.67267 0.66049 0.64873 0.637 0.62638 0.61575 0.60547
##                 [,64]  [,65]   [,66]   [,67]   [,68]   [,69]   [,70]   [,71]
## x.axis.ticks  0.00748 0.0076 0.00772 0.00783 0.00795 0.00807 0.00819 0.00831
## heterogeneity 0.59551 0.5859 0.57651 0.56745 0.55865 0.55011 0.54182 0.53376
##                 [,72]   [,73]   [,74]   [,75]  [,76]   [,77]   [,78]   [,79]
## x.axis.ticks  0.00843 0.00855 0.00867 0.00878 0.0089 0.00902 0.00914 0.00926
## heterogeneity 0.52593 0.51832 0.51091 0.50371 0.4967 0.48987 0.48322 0.47674
##                 [,80]  [,81]   [,82]   [,83]   [,84]   [,85]  [,86]  [,87]
## x.axis.ticks  0.00938 0.0095 0.00962 0.00973 0.00985 0.00997 0.0101 0.0102
## heterogeneity 0.47042 0.4643 0.45825 0.45239 0.44667 0.44109 0.4356 0.4303
##                [,88]  [,89]  [,90]  [,91]  [,92]  [,93] [,94]  [,95]  [,96]
## x.axis.ticks  0.0103 0.0104 0.0106 0.0107 0.0108 0.0109 0.011 0.0112 0.0113
## heterogeneity 0.4251 0.4200 0.4150 0.4102 0.4054 0.4008 0.396 0.3918 0.3874
##                [,97]  [,98]  [,99] [,100]
## x.axis.ticks  0.0114 0.0115 0.0116 0.0118
## heterogeneity 0.3831 0.3790 0.3749 0.3709</code></pre>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="customer-lifetime-value.html#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bgnbd.Expectation</span>(params, <span class="at">t=</span><span class="dv">52</span>)</span></code></pre></div>
<pre><code>##   p3 
## 41.9</code></pre>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="customer-lifetime-value.html#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bgnbd.PlotFrequencyInCalibration</span>(params, cal2010, <span class="dv">85</span>)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-121-1.png" width="720" style="display: block; margin: auto;" /></p>
<pre><code>##                freq.0 freq.1 freq.2 freq.3 freq.4 freq.5 freq.6 freq.7 freq.8
## n.x.actual   0.00e+00   4.00   2.00    4.0   2.00   4.00   2.00   3.00   6.00
## n.x.expected 3.53e-07   2.23   1.93    1.7   1.52   1.38   1.26   1.16   1.08
##              freq.9 freq.10 freq.11 freq.12 freq.13 freq.14 freq.15 freq.16
## n.x.actual     4.00   5.000   5.000   3.000   3.000   3.000   5.000    6.00
## n.x.expected   1.01   0.955   0.915   0.892   0.886   0.902   0.944    1.02
##              freq.17 freq.18 freq.19 freq.20 freq.21 freq.22 freq.23 freq.24
## n.x.actual     10.00    5.00   12.00    9.00    9.00    6.00   10.00    4.00
## n.x.expected    1.13    1.28    1.48    1.75    2.08    2.48    2.97    3.55
##              freq.25 freq.26 freq.27 freq.28 freq.29 freq.30 freq.31 freq.32
## n.x.actual      7.00       4   12.00    5.00      16   10.00     7.0      14
## n.x.expected    4.22       5    5.89    6.89       8    9.23    10.6      12
##              freq.33 freq.34 freq.35 freq.36 freq.37 freq.38 freq.39 freq.40
## n.x.actual       7.0    15.0       9    17.0    12.0    15.0    17.0      11
## n.x.expected    13.6    15.3      17    18.9    20.8    22.8    24.9      27
##              freq.41 freq.42 freq.43 freq.44 freq.45 freq.46 freq.47 freq.48
## n.x.actual      18.0    16.0    36.0    15.0    22.0    22.0    16.0    19.0
## n.x.expected    29.1    31.3    33.4    35.5    37.6    39.7    41.7    43.6
##              freq.49 freq.50 freq.51 freq.52 freq.53 freq.54 freq.55 freq.56
## n.x.actual      20.0    23.0    25.0    17.0    30.0    22.0    24.0    27.0
## n.x.expected    45.5    47.3    48.9    50.5    51.9    53.2    54.3    55.4
##              freq.57 freq.58 freq.59 freq.60 freq.61 freq.62 freq.63 freq.64
## n.x.actual      29.0      31    33.0      23    31.0    31.0    35.0    28.0
## n.x.expected    56.3      57    57.6      58    58.3    58.5    58.5    58.4
##              freq.65 freq.66 freq.67 freq.68 freq.69 freq.70 freq.71 freq.72
## n.x.actual      34.0    51.0    47.0    47.0      41    62.0    61.0    45.0
## n.x.expected    58.2    57.8    57.3    56.7      56    55.2    54.3    53.3
##              freq.73 freq.74 freq.75 freq.76 freq.77 freq.78 freq.79 freq.80
## n.x.actual      53.0    74.0    73.0    78.0    93.0     109    94.0   123.0
## n.x.expected    52.2    51.1    49.9    48.7    47.4      46    44.7    43.3
##              freq.81 freq.82 freq.83 freq.84 freq.85+
## n.x.actual     161.0   184.0     205   225.0    327.0
## n.x.expected    41.9    40.5      39    37.6     36.2</code></pre>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="customer-satisfaction-and-loyalty.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
