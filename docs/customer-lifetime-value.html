<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>1 Customer Lifetime Value | Customer Analytics</title>
  <meta name="description" content="1 Customer Lifetime Value | Customer Analytics" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="1 Customer Lifetime Value | Customer Analytics" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="1 Customer Lifetime Value | Customer Analytics" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="customer-satisfaction-and-loyalty.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>setup</a></li>
<li class="chapter" data-level="1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html"><i class="fa fa-check"></i><b>1</b> Customer Lifetime Value</a>
<ul>
<li class="chapter" data-level="1.1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#the-matrix-formulation"><i class="fa fa-check"></i><b>1.1</b> The matrix formulation</a></li>
<li class="chapter" data-level="1.2" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#btyd"><i class="fa fa-check"></i><b>1.2</b> BTYD</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#paretonbd"><i class="fa fa-check"></i><b>1.2.1</b> Pareto/NBD</a>
<ul>
<li class="chapter" data-level="1.2.1.1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#data-preparation"><i class="fa fa-check"></i><b>1.2.1.1</b> Data preparation</a></li>
<li class="chapter" data-level="1.2.1.2" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#parameter-estimation"><i class="fa fa-check"></i><b>1.2.1.2</b> Parameter Estimation</a></li>
<li class="chapter" data-level="1.2.1.3" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#individual-level-estimations"><i class="fa fa-check"></i><b>1.2.1.3</b> Individual Level Estimations</a></li>
<li class="chapter" data-level="1.2.1.4" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#plotting-goodness-of-fit"><i class="fa fa-check"></i><b>1.2.1.4</b> Plotting / Goodness-of-fit</a></li>
</ul></li>
<li class="chapter" data-level="1.2.2" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#bgnbd"><i class="fa fa-check"></i><b>1.2.2</b> BG/NBD</a>
<ul>
<li class="chapter" data-level="1.2.2.1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#data-preparation-1"><i class="fa fa-check"></i><b>1.2.2.1</b> Data Preparation</a></li>
<li class="chapter" data-level="1.2.2.2" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#parameter-estimation-1"><i class="fa fa-check"></i><b>1.2.2.2</b> Parameter Estimation</a></li>
<li class="chapter" data-level="1.2.2.3" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#individual-level-estimation"><i class="fa fa-check"></i><b>1.2.2.3</b> Individual Level Estimation</a></li>
<li class="chapter" data-level="1.2.2.4" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#plotting-goodness-of-fit-1"><i class="fa fa-check"></i><b>1.2.2.4</b> Plotting / Goodness-of-fit</a></li>
</ul></li>
<li class="chapter" data-level="1.2.3" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#bgbb"><i class="fa fa-check"></i><b>1.2.3</b> BG/BB</a>
<ul>
<li class="chapter" data-level="1.2.3.1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#data-preparation-2"><i class="fa fa-check"></i><b>1.2.3.1</b> Data Preparation</a></li>
<li class="chapter" data-level="1.2.3.2" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#parameter-estimation-2"><i class="fa fa-check"></i><b>1.2.3.2</b> Parameter Estimation</a></li>
<li class="chapter" data-level="1.2.3.3" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#individual-level-estimations-1"><i class="fa fa-check"></i><b>1.2.3.3</b> Individual Level Estimations</a></li>
<li class="chapter" data-level="1.2.3.4" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#plotting-goodness-of-fit-2"><i class="fa fa-check"></i><b>1.2.3.4</b> Plotting / Goodness-of-fit</a></li>
</ul></li>
<li class="chapter" data-level="1.2.4" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#examples-from-the-lecture"><i class="fa fa-check"></i><b>1.2.4</b> Examples from the lecture</a>
<ul>
<li class="chapter" data-level="1.2.4.1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#paretonbd-1"><i class="fa fa-check"></i><b>1.2.4.1</b> Pareto/NBD</a>
<ul>
<li class="chapter" data-level="1.2.4.1.1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#estimate-parameters-for-paretonbd-model-based-upon-calibration-data"><i class="fa fa-check"></i><b>1.2.4.1.1</b> Estimate parameters for Pareto/NBD model based upon calibration data</a></li>
</ul></li>
<li class="chapter" data-level="1.2.4.2" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#bgnbg-example"><i class="fa fa-check"></i><b>1.2.4.2</b> BG/NBG example</a></li>
</ul></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html"><i class="fa fa-check"></i><b>2</b> Customer Satisfaction and Loyalty</a>
<ul>
<li class="chapter" data-level="2.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#customer-surveys"><i class="fa fa-check"></i><b>2.1</b> Customer surveys</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#concepts-and-examples"><i class="fa fa-check"></i><b>2.1.1</b> (1) Concepts and examples</a></li>
<li class="chapter" data-level="2.1.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#sampling-and-response-rate"><i class="fa fa-check"></i><b>2.1.2</b> (2) Sampling and response rate</a></li>
<li class="chapter" data-level="2.1.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#pretesting-and-measurement-validity"><i class="fa fa-check"></i><b>2.1.3</b> (3) Pretesting and measurement validity</a></li>
<li class="chapter" data-level="2.1.4" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#questionnaire-design"><i class="fa fa-check"></i><b>2.1.4</b> (4) Questionnaire design</a></li>
<li class="chapter" data-level="2.1.5" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#simple-size"><i class="fa fa-check"></i><b>2.1.5</b> (5) Simple size</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#nps"><i class="fa fa-check"></i><b>2.2</b> NPS</a></li>
<li class="chapter" data-level="2.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#cfa-and-sem-application-lavann"><i class="fa fa-check"></i><b>2.3</b> CFA and SEM Application Lavann</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#business-problem-objectives"><i class="fa fa-check"></i><b>2.3.1</b> Business Problem &amp; Objectives</a></li>
<li class="chapter" data-level="2.3.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#data"><i class="fa fa-check"></i><b>2.3.2</b> Data</a>
<ul>
<li class="chapter" data-level="2.3.2.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#efa"><i class="fa fa-check"></i><b>2.3.2.1</b> EFA</a></li>
<li class="chapter" data-level="2.3.2.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#cfa-model"><i class="fa fa-check"></i><b>2.3.2.2</b> CFA model</a>
<ul>
<li class="chapter" data-level="2.3.2.2.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#initial-model"><i class="fa fa-check"></i><b>2.3.2.2.1</b> Initial model</a></li>
<li class="chapter" data-level="2.3.2.2.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#second-model"><i class="fa fa-check"></i><b>2.3.2.2.2</b> Second model</a>
<ul>
<li class="chapter" data-level="2.3.2.2.2.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#intepretation-of-the-model"><i class="fa fa-check"></i><b>2.3.2.2.2.1</b> Intepretation of the model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2.3.2.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#sem"><i class="fa fa-check"></i><b>2.3.2.3</b> SEM</a></li>
</ul></li>
<li class="chapter" data-level="2.3.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#plotting-the-model"><i class="fa fa-check"></i><b>2.3.3</b> Plotting the model</a></li>
<li class="chapter" data-level="2.3.4" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#consider-a-more-complex-sem-model-involving-a-mediating-effect."><i class="fa fa-check"></i><b>2.3.4</b> Consider a more complex SEM model involving a mediating effect.</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#pls"><i class="fa fa-check"></i><b>2.4</b> PLS</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#definition-of-pls"><i class="fa fa-check"></i><b>2.4.1</b> Definition of PLS</a></li>
<li class="chapter" data-level="2.4.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#when-to-use-pls-and-when-to-use-sem"><i class="fa fa-check"></i><b>2.4.2</b> When to use PLS and when to use SEM</a></li>
<li class="chapter" data-level="2.4.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#model-construction"><i class="fa fa-check"></i><b>2.4.3</b> Model construction</a></li>
<li class="chapter" data-level="2.4.4" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#model-estimation"><i class="fa fa-check"></i><b>2.4.4</b> Model Estimation</a></li>
<li class="chapter" data-level="2.4.5" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#model-evaluation"><i class="fa fa-check"></i><b>2.4.5</b> Model evaluation</a></li>
<li class="chapter" data-level="2.4.6" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#example-for-the-lecture"><i class="fa fa-check"></i><b>2.4.6</b> Example for the lecture</a>
<ul>
<li class="chapter" data-level="2.4.6.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#making-structural--and-measurement-model"><i class="fa fa-check"></i><b>2.4.6.1</b> Making structural- and measurement model</a></li>
<li class="chapter" data-level="2.4.6.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#now-we-can-estimate-the-model"><i class="fa fa-check"></i><b>2.4.6.2</b> Now we can estimate the model</a></li>
<li class="chapter" data-level="2.4.6.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#measuring-quality-of-the-constructs"><i class="fa fa-check"></i><b>2.4.6.3</b> Measuring quality of the constructs</a></li>
<li class="chapter" data-level="2.4.6.4" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#are-the-coefficients-significant"><i class="fa fa-check"></i><b>2.4.6.4</b> Are the coefficients significant?</a></li>
</ul></li>
<li class="chapter" data-level="2.4.7" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#revised-code"><i class="fa fa-check"></i><b>2.4.7</b> Revised code</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#segmentation-clustering"><i class="fa fa-check"></i><b>2.5</b> Segmentation (Clustering)</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#what-is-clustering"><i class="fa fa-check"></i><b>2.5.1</b> What is clustering</a></li>
<li class="chapter" data-level="2.5.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#clustering-techniques"><i class="fa fa-check"></i><b>2.5.2</b> Clustering techniques</a></li>
<li class="chapter" data-level="2.5.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#an-example"><i class="fa fa-check"></i><b>2.5.3</b> An example</a>
<ul>
<li class="chapter" data-level="2.5.3.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#background"><i class="fa fa-check"></i><b>2.5.3.1</b> 1. Background</a>
<ul>
<li class="chapter" data-level="2.5.3.1.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#the-primary-objective-is"><i class="fa fa-check"></i><b>2.5.3.1.1</b> 1.1. The primary objective is:</a></li>
</ul></li>
<li class="chapter" data-level="2.5.3.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#the-data-data-understanding-phase"><i class="fa fa-check"></i><b>2.5.3.2</b> 2. The data (Data Understanding Phase)</a>
<ul>
<li class="chapter" data-level="2.5.3.2.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#load-data-correctly"><i class="fa fa-check"></i><b>2.5.3.2.1</b> 2.1 Load data correctly</a></li>
<li class="chapter" data-level="2.5.3.2.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#check-if-the-data-is-numerical-or-categorical"><i class="fa fa-check"></i><b>2.5.3.2.2</b> 2.2 Check if the data is numerical or categorical</a></li>
<li class="chapter" data-level="2.5.3.2.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#missing-treatment"><i class="fa fa-check"></i><b>2.5.3.2.3</b> 2.3 Missing treatment</a></li>
<li class="chapter" data-level="2.5.3.2.4" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#select-relevant-variables"><i class="fa fa-check"></i><b>2.5.3.2.4</b> 2.4 Select relevant variables</a></li>
<li class="chapter" data-level="2.5.3.2.5" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#identify-extreme-outliers-the-most-dissimilar-customers"><i class="fa fa-check"></i><b>2.5.3.2.5</b> 2.5.Identify extreme outliers (the most dissimilar customers)</a></li>
<li class="chapter" data-level="2.5.3.2.6" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#standardize-the-variables-mean0-std.dev1"><i class="fa fa-check"></i><b>2.5.3.2.6</b> 2.6 Standardize the variables (mean=0, std.dev=1)</a></li>
</ul></li>
<li class="chapter" data-level="2.5.3.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#hierarchical-clustering-using-variables"><i class="fa fa-check"></i><b>2.5.3.3</b> 3. Hierarchical clustering (using variables)</a></li>
<li class="chapter" data-level="2.5.3.4" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#hierarchical-clustering-using-pcs-score-vectors"><i class="fa fa-check"></i><b>2.5.3.4</b> 4. Hierarchical clustering (using PCs score vectors)</a></li>
<li class="chapter" data-level="2.5.3.5" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#k-means"><i class="fa fa-check"></i><b>2.5.3.5</b> 5. K-means</a></li>
<li class="chapter" data-level="2.5.3.6" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#validation-and-profiling-the-clusters"><i class="fa fa-check"></i><b>2.5.3.6</b> 6. Validation and profiling the clusters</a>
<ul>
<li class="chapter" data-level="2.5.3.6.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#assessing-cluster-stability"><i class="fa fa-check"></i><b>2.5.3.6.1</b> 6.1. Assessing cluster stability</a></li>
<li class="chapter" data-level="2.5.3.6.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#assessing-criterion-predictive-validity"><i class="fa fa-check"></i><b>2.5.3.6.2</b> 6.2. Assessing criterion (predictive) validity</a></li>
<li class="chapter" data-level="2.5.3.6.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#profiling-the-final-cluster-solution"><i class="fa fa-check"></i><b>2.5.3.6.3</b> 6.3. Profiling the final cluster solution</a></li>
</ul></li>
<li class="chapter" data-level="2.5.3.7" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#final-remarks"><i class="fa fa-check"></i><b>2.5.3.7</b> 7. Final remarks</a></li>
</ul></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html"><i class="fa fa-check"></i><b>3</b> Recommender Systems and Customer Targeting</a>
<ul>
<li class="chapter" data-level="3.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#association-rule"><i class="fa fa-check"></i><b>3.1</b> Association rule</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#loading-and-data-exploration"><i class="fa fa-check"></i><b>3.1.1</b> Loading and data exploration</a></li>
<li class="chapter" data-level="3.1.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#data-preprocessing"><i class="fa fa-check"></i><b>3.1.2</b> Data preprocessing</a>
<ul>
<li class="chapter" data-level="3.1.2.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#encoding-to-correct-data-types"><i class="fa fa-check"></i><b>3.1.2.1</b> Encoding to correct data types</a></li>
<li class="chapter" data-level="3.1.2.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#create-a-data-frame-with-one-row-pr.-invoice"><i class="fa fa-check"></i><b>3.1.2.2</b> Create a data frame with one row pr. invoice</a></li>
</ul></li>
<li class="chapter" data-level="3.1.3" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#loading-transactions"><i class="fa fa-check"></i><b>3.1.3</b> Loading transactions</a></li>
<li class="chapter" data-level="3.1.4" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#plotting"><i class="fa fa-check"></i><b>3.1.4</b> Plotting</a></li>
<li class="chapter" data-level="3.1.5" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#apriori-calculation"><i class="fa fa-check"></i><b>3.1.5</b> Apriori calculation</a>
<ul>
<li class="chapter" data-level="3.1.5.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#another-example-where-maxlen-3"><i class="fa fa-check"></i><b>3.1.5.1</b> Another example where maxlen = 3</a></li>
<li class="chapter" data-level="3.1.5.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#filtering-on-right-hand-side.-an-example-with-the-item-metal"><i class="fa fa-check"></i><b>3.1.5.2</b> Filtering on right hand side. An example with the item {METAL}</a></li>
<li class="chapter" data-level="3.1.5.3" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#filtering-on-left-hand-side.-an-example-with-the-item-metal"><i class="fa fa-check"></i><b>3.1.5.3</b> Filtering on left hand side. An example with the item {METAL}</a></li>
</ul></li>
<li class="chapter" data-level="3.1.6" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#plotting-association-rules"><i class="fa fa-check"></i><b>3.1.6</b> Plotting association rules</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#colaborative-filtering"><i class="fa fa-check"></i><b>3.2</b> Colaborative filtering</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#loading-and-formatting-data"><i class="fa fa-check"></i><b>3.2.1</b> Loading and formatting data</a>
<ul>
<li class="chapter" data-level="3.2.1.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#loading-metadata-that-gets-loaded-with-main-dataset"><i class="fa fa-check"></i><b>3.2.1.1</b> Loading metadata that gets loaded with main dataset</a></li>
</ul></li>
<li class="chapter" data-level="3.2.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#data-exploration"><i class="fa fa-check"></i><b>3.2.2</b> Data Exploration</a>
<ul>
<li class="chapter" data-level="3.2.2.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#plotting-1"><i class="fa fa-check"></i><b>3.2.2.1</b> Plotting</a></li>
</ul></li>
<li class="chapter" data-level="3.2.3" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#what-models-can-we-use"><i class="fa fa-check"></i><b>3.2.3</b> What models can we use?</a></li>
<li class="chapter" data-level="3.2.4" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#training-and-test-set"><i class="fa fa-check"></i><b>3.2.4</b> Training and test set</a></li>
<li class="chapter" data-level="3.2.5" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#a-small-example-with-ibcf-item-based"><i class="fa fa-check"></i><b>3.2.5</b> A small example with IBCF (item based)</a></li>
<li class="chapter" data-level="3.2.6" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#ubcf---user-based-collaborative-based"><i class="fa fa-check"></i><b>3.2.6</b> UBCF - User based collaborative based</a>
<ul>
<li class="chapter" data-level="3.2.6.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#fitting-the-model"><i class="fa fa-check"></i><b>3.2.6.1</b> Fitting the model</a></li>
<li class="chapter" data-level="3.2.6.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#predicting-making-recommendations"><i class="fa fa-check"></i><b>3.2.6.2</b> Predicting (making) recommendations</a></li>
</ul></li>
<li class="chapter" data-level="3.2.7" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#cross-validation"><i class="fa fa-check"></i><b>3.2.7</b> Cross validation</a></li>
<li class="chapter" data-level="3.2.8" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#ibcf---item-based-collaborative-based"><i class="fa fa-check"></i><b>3.2.8</b> IBCF - Item based collaborative based</a>
<ul>
<li class="chapter" data-level="3.2.8.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#fitting-the-model-using-cv"><i class="fa fa-check"></i><b>3.2.8.1</b> Fitting the model (using CV)</a></li>
<li class="chapter" data-level="3.2.8.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#making-predictions"><i class="fa fa-check"></i><b>3.2.8.2</b> Making predictions</a></li>
<li class="chapter" data-level="3.2.8.3" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#performance-metrics"><i class="fa fa-check"></i><b>3.2.8.3</b> Performance metrics</a></li>
</ul></li>
<li class="chapter" data-level="3.2.9" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#building-roc-curve-and-precision-recall-rate"><i class="fa fa-check"></i><b>3.2.9</b> Building ROC curve and precision / recall rate</a></li>
<li class="chapter" data-level="3.2.10" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#comparing-ubcf-and-ibcf"><i class="fa fa-check"></i><b>3.2.10</b> Comparing UBCF and IBCF</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#latent-factor-models"><i class="fa fa-check"></i><b>3.3</b> Latent Factor Models</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#fitting-the-model-1"><i class="fa fa-check"></i><b>3.3.1</b> Fitting the model</a></li>
<li class="chapter" data-level="3.3.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#making-predictions-1"><i class="fa fa-check"></i><b>3.3.2</b> Making predictions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html"><i class="fa fa-check"></i><b>4</b> Probabilistic Models for Customer Analytics</a>
<ul>
<li class="chapter" data-level="4.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#bayesian-networks"><i class="fa fa-check"></i><b>4.1</b> Bayesian Networks</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#why-bayesian"><i class="fa fa-check"></i><b>4.1.1</b> <strong><em>Why Bayesian?</em></strong></a>
<ul>
<li class="chapter" data-level="4.1.1.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#many-names-for-bayesian-networks"><i class="fa fa-check"></i><b>4.1.1.1</b> <strong>Many names for Bayesian Networks</strong></a></li>
</ul></li>
<li class="chapter" data-level="4.1.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#terms-and-explanatory-examples"><i class="fa fa-check"></i><b>4.1.2</b> Terms and explanatory examples</a>
<ul>
<li class="chapter" data-level="4.1.2.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#types-of-connections"><i class="fa fa-check"></i><b>4.1.2.1</b> Types of connections</a></li>
<li class="chapter" data-level="4.1.2.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#variable-selection-based-on-a-bayesian-network"><i class="fa fa-check"></i><b>4.1.2.2</b> Variable selection based on a Bayesian Network</a></li>
</ul></li>
<li class="chapter" data-level="4.1.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#independence"><i class="fa fa-check"></i><b>4.1.3</b> Independence</a></li>
<li class="chapter" data-level="4.1.4" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#methods-for-identifying-the-network"><i class="fa fa-check"></i><b>4.1.4</b> Methods for identifying the network</a>
<ul>
<li class="chapter" data-level="4.1.4.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#algorithms-focused-on-causality-discovery"><i class="fa fa-check"></i><b>4.1.4.1</b> 1. <strong><em>Algorithms focused on causality discovery</em></strong></a></li>
<li class="chapter" data-level="4.1.4.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#algorithms-focused-on-prediction"><i class="fa fa-check"></i><b>4.1.4.2</b> 2. <strong><em>Algorithms focused on prediction</em></strong></a></li>
</ul></li>
<li class="chapter" data-level="4.1.5" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#real-life-application"><i class="fa fa-check"></i><b>4.1.5</b> <strong>Real life application</strong></a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#application-1-explaining-and-predicting-customer-retention-in-a-virtual-community"><i class="fa fa-check"></i><b>4.2</b> Application 1: Explaining and Predicting Customer Retention in a Virtual Community</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#getting-the-structure"><i class="fa fa-check"></i><b>4.2.1</b> 1. Getting the structure</a>
<ul>
<li class="chapter" data-level="4.2.1.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#a.-building-the-structure-and-parameters-manually"><i class="fa fa-check"></i><b>4.2.1.1</b> A. Building the structure and parameters manually</a>
<ul>
<li class="chapter" data-level="4.2.1.1.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#approaches-to-make-the-network"><i class="fa fa-check"></i><b>4.2.1.1.1</b> Approaches to make the network</a>
<ul>
<li class="chapter" data-level="4.2.1.1.1.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#first-approach"><i class="fa fa-check"></i><b>4.2.1.1.1.1</b> First approach</a></li>
<li class="chapter" data-level="4.2.1.1.1.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#second-approach"><i class="fa fa-check"></i><b>4.2.1.1.1.2</b> Second approach</a></li>
<li class="chapter" data-level="4.2.1.1.1.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#third-approach"><i class="fa fa-check"></i><b>4.2.1.1.1.3</b> Third approach</a></li>
</ul></li>
<li class="chapter" data-level="4.2.1.1.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#loadingentering-data"><i class="fa fa-check"></i><b>4.2.1.1.2</b> Loading/entering data</a></li>
<li class="chapter" data-level="4.2.1.1.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#conditional-probability-table-cpt"><i class="fa fa-check"></i><b>4.2.1.1.3</b> Conditional probability table (CPT)</a></li>
</ul></li>
<li class="chapter" data-level="4.2.1.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#b.-learning-the-structure-and-parameters-from-observational-data"><i class="fa fa-check"></i><b>4.2.1.2</b> B. Learning the structure and parameters from observational data</a>
<ul>
<li class="chapter" data-level="4.2.1.2.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#grow-shrink-gs---learning-a-structure-using-a-constrained-based-algorithm"><i class="fa fa-check"></i><b>4.2.1.2.1</b> Grow-shrink (gs) - Learning a structure using a constrained-based algorithm</a>
<ul>
<li class="chapter" data-level="4.2.1.2.1.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#identifying-undirectred-links"><i class="fa fa-check"></i><b>4.2.1.2.1.1</b> Identifying undirectred links</a></li>
</ul></li>
<li class="chapter" data-level="4.2.1.2.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#hill-climbing-hc---learning-the-structure-using-a-score-based-algorithm"><i class="fa fa-check"></i><b>4.2.1.2.2</b> Hill-Climbing (hc) - Learning the structure using a score-based algorithm</a></li>
<li class="chapter" data-level="4.2.1.2.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#fitting-the-model-to-the-data-learning-the-probabilities"><i class="fa fa-check"></i><b>4.2.1.2.3</b> Fitting the model to the data (learning the probabilities)</a></li>
<li class="chapter" data-level="4.2.1.2.4" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#alternatives-to-grow-shrink-and-hc"><i class="fa fa-check"></i><b>4.2.1.2.4</b> Alternatives to Grow-Shrink and HC</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4.2.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#model-evaluation-1"><i class="fa fa-check"></i><b>4.2.2</b> 2. Model evaluation</a>
<ul>
<li class="chapter" data-level="4.2.2.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#i.-metrics-of-model-complexity"><i class="fa fa-check"></i><b>4.2.2.1</b> I. Metrics of model complexity</a></li>
<li class="chapter" data-level="4.2.2.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#ii.-metrics-of-model-sensitivity"><i class="fa fa-check"></i><b>4.2.2.2</b> II. Metrics of model sensitivity</a></li>
<li class="chapter" data-level="4.2.2.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#iii.-evaluate-the-arc.strength"><i class="fa fa-check"></i><b>4.2.2.3</b> III. Evaluate the arc.strength()</a>
<ul>
<li class="chapter" data-level="4.2.2.3.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#for-the-growth-shrink"><i class="fa fa-check"></i><b>4.2.2.3.1</b> For the growth shrink</a></li>
<li class="chapter" data-level="4.2.2.3.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#for-the-hill-climbing-structure"><i class="fa fa-check"></i><b>4.2.2.3.2</b> For the hill-climbing structure</a></li>
<li class="chapter" data-level="4.2.2.3.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#different-information-criteria-evaluations"><i class="fa fa-check"></i><b>4.2.2.3.3</b> Different information criteria evaluations</a></li>
</ul></li>
<li class="chapter" data-level="4.2.2.4" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#iv.-metrics-of-predictive-accuracy-error-rate-confusion-matrix-auc"><i class="fa fa-check"></i><b>4.2.2.4</b> IV. Metrics of predictive accuracy (error rate, confusion matrix, AUC)</a>
<ul>
<li class="chapter" data-level="4.2.2.4.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#cross-validation-1"><i class="fa fa-check"></i><b>4.2.2.4.1</b> Cross validation</a></li>
<li class="chapter" data-level="4.2.2.4.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#alternative-approach-to-fit-and-predict-without-grain"><i class="fa fa-check"></i><b>4.2.2.4.2</b> Alternative approach to fit and predict (Without gRain)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4.2.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#making-inference-and-queries-based-on-the-model"><i class="fa fa-check"></i><b>4.2.3</b> 3. Making inference and queries based on the model</a>
<ul>
<li class="chapter" data-level="4.2.3.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#diagnostics-forward-inference"><i class="fa fa-check"></i><b>4.2.3.1</b> Diagnostics (Forward inference)</a>
<ul>
<li class="chapter" data-level="4.2.3.1.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#let-us-repeat-the-same-analysis-by-setting-evidence-in-pleasure"><i class="fa fa-check"></i><b>4.2.3.1.1</b> <em>let us repeat the same analysis by setting evidence in Pleasure</em></a></li>
</ul></li>
<li class="chapter" data-level="4.2.3.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#diagnostic-backward-inference"><i class="fa fa-check"></i><b>4.2.3.2</b> Diagnostic (Backward inference)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#application-2-identifying-populations-with-positive-expected-lift-in-profit-elp-and-targeting"><i class="fa fa-check"></i><b>4.3</b> Application 2: Identifying populations with Positive Expected Lift in Profit (ELP) and targeting</a></li>
<li class="chapter" data-level="4.4" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#application-3-product-recommendation-using-probabilistic-models-bn"><i class="fa fa-check"></i><b>4.4</b> Application 3: Product Recommendation using Probabilistic Models (BN)</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#method-1-learn-the-probabilistic-relationships-using-a-bayesian-network-learning"><i class="fa fa-check"></i><b>4.4.1</b> Method 1: Learn the probabilistic relationships using a Bayesian network learning</a></li>
<li class="chapter" data-level="4.4.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#method-2-finding-latent-segments"><i class="fa fa-check"></i><b>4.4.2</b> Method 2: Finding latent segments</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#latent-models-for-cross-selling-and-acquisition-sequence"><i class="fa fa-check"></i><b>4.5</b> Latent models for cross selling and acquisition sequence</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#latent-trait-model---applying-the-ltm-package-in-r"><i class="fa fa-check"></i><b>4.5.1</b> Latent Trait Model - Applying the LTM Package in R</a></li>
<li class="chapter" data-level="4.5.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#the-latent-hidden-markov-model"><i class="fa fa-check"></i><b>4.5.2</b> The latent (hidden) Markov model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="customer-behavior.html"><a href="customer-behavior.html"><i class="fa fa-check"></i><b>5</b> Customer behavior</a>
<ul>
<li class="chapter" data-level="5.1" data-path="customer-behavior.html"><a href="customer-behavior.html#characteristics-of-cliskstream"><i class="fa fa-check"></i><b>5.1</b> Characteristics of cliskstream</a></li>
<li class="chapter" data-level="5.2" data-path="customer-behavior.html"><a href="customer-behavior.html#applications-with-clickstream-data"><i class="fa fa-check"></i><b>5.2</b> Applications with clickstream data</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="customer-behavior.html"><a href="customer-behavior.html#a-motivating-example"><i class="fa fa-check"></i><b>5.2.1</b> A motivating example</a>
<ul>
<li class="chapter" data-level="5.2.1.1" data-path="customer-behavior.html"><a href="customer-behavior.html#i-predict-either-the-next-click-or-the-ﬁnal-click-state-of-a-customer."><i class="fa fa-check"></i><b>5.2.1.1</b> i) Predict either the next click or the ﬁnal click (state) of a customer.</a></li>
<li class="chapter" data-level="5.2.1.2" data-path="customer-behavior.html"><a href="customer-behavior.html#ii-clustering-and-generalizing-upon-clickstreams"><i class="fa fa-check"></i><b>5.2.1.2</b> ii) Clustering and generalizing upon clickstreams</a></li>
</ul></li>
<li class="chapter" data-level="5.2.2" data-path="customer-behavior.html"><a href="customer-behavior.html#second-exercise-clickstream-more-extensive"><i class="fa fa-check"></i><b>5.2.2</b> Second exercise (clickstream) more extensive</a></li>
<li class="chapter" data-level="5.2.3" data-path="customer-behavior.html"><a href="customer-behavior.html#a-concrete-eaxmple-with-real-data"><i class="fa fa-check"></i><b>5.2.3</b> A concrete eaxmple with real data</a>
<ul>
<li class="chapter" data-level="5.2.3.1" data-path="customer-behavior.html"><a href="customer-behavior.html#markov-chain"><i class="fa fa-check"></i><b>5.2.3.1</b> (1) Markov Chain</a></li>
<li class="chapter" data-level="5.2.3.2" data-path="customer-behavior.html"><a href="customer-behavior.html#using-association-rule-mining"><i class="fa fa-check"></i><b>5.2.3.2</b> (2) Using association rule mining</a></li>
<li class="chapter" data-level="5.2.3.3" data-path="customer-behavior.html"><a href="customer-behavior.html#use-frequencies-instead-of-the-sequence"><i class="fa fa-check"></i><b>5.2.3.3</b> (3) Use frequencies instead of the sequence</a></li>
<li class="chapter" data-level="5.2.3.4" data-path="customer-behavior.html"><a href="customer-behavior.html#neural-networks"><i class="fa fa-check"></i><b>5.2.3.4</b> (4) Neural networks</a></li>
</ul></li>
<li class="chapter" data-level="5.2.4" data-path="customer-behavior.html"><a href="customer-behavior.html#optional-exercise"><i class="fa fa-check"></i><b>5.2.4</b> Optional exercise</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="customer-behavior.html"><a href="customer-behavior.html#ab-testing"><i class="fa fa-check"></i><b>5.3</b> AB Testing</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="customer-behavior.html"><a href="customer-behavior.html#what-is-it-and-when-to-apply-it"><i class="fa fa-check"></i><b>5.3.1</b> (1 + 2): What is it and when to apply it</a></li>
<li class="chapter" data-level="5.3.2" data-path="customer-behavior.html"><a href="customer-behavior.html#how-to-perform-an-ab-test"><i class="fa fa-check"></i><b>5.3.2</b> (3): How to perform an A/B test</a></li>
<li class="chapter" data-level="5.3.3" data-path="customer-behavior.html"><a href="customer-behavior.html#pitfalls-and-challenges."><i class="fa fa-check"></i><b>5.3.3</b> (4): Pitfalls and challenges.</a></li>
<li class="chapter" data-level="5.3.4" data-path="customer-behavior.html"><a href="customer-behavior.html#ab-tests-and-bandits."><i class="fa fa-check"></i><b>5.3.4</b> (5): A/B tests and bandits.</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Customer Analytics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="customer-lifetime-value" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Customer Lifetime Value</h1>
<div id="the-matrix-formulation" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> The matrix formulation</h2>
<p><strong>For an infinite period</strong></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="customer-lifetime-value.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Facts</span></span>
<span id="cb1-2"><a href="customer-lifetime-value.html#cb1-2" aria-hidden="true" tabindex="-1"></a>margin <span class="ot">&lt;-</span> <span class="dv">40</span></span>
<span id="cb1-3"><a href="customer-lifetime-value.html#cb1-3" aria-hidden="true" tabindex="-1"></a>costs <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb1-4"><a href="customer-lifetime-value.html#cb1-4" aria-hidden="true" tabindex="-1"></a>discount_factor <span class="ot">&lt;-</span> <span class="fl">1.2</span></span>
<span id="cb1-5"><a href="customer-lifetime-value.html#cb1-5" aria-hidden="true" tabindex="-1"></a>states <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb1-6"><a href="customer-lifetime-value.html#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="customer-lifetime-value.html#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Transition probabilities</span></span>
<span id="cb1-8"><a href="customer-lifetime-value.html#cb1-8" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fl">0.3</span></span>
<span id="cb1-9"><a href="customer-lifetime-value.html#cb1-9" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb1-10"><a href="customer-lifetime-value.html#cb1-10" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fl">0.15</span></span>
<span id="cb1-11"><a href="customer-lifetime-value.html#cb1-11" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb1-12"><a href="customer-lifetime-value.html#cb1-12" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb1-13"><a href="customer-lifetime-value.html#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="customer-lifetime-value.html#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">#Transition probability matrix</span></span>
<span id="cb1-15"><a href="customer-lifetime-value.html#cb1-15" aria-hidden="true" tabindex="-1"></a>P <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> states,<span class="at">byrow =</span> <span class="cn">TRUE</span></span>
<span id="cb1-16"><a href="customer-lifetime-value.html#cb1-16" aria-hidden="true" tabindex="-1"></a>            ,<span class="fu">c</span>(p1,<span class="dv">1</span><span class="sc">-</span>p1,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb1-17"><a href="customer-lifetime-value.html#cb1-17" aria-hidden="true" tabindex="-1"></a>               p2,<span class="dv">0</span>,<span class="dv">1</span><span class="sc">-</span>p2,<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb1-18"><a href="customer-lifetime-value.html#cb1-18" aria-hidden="true" tabindex="-1"></a>               p3,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span><span class="sc">-</span>p3,<span class="dv">0</span>,</span>
<span id="cb1-19"><a href="customer-lifetime-value.html#cb1-19" aria-hidden="true" tabindex="-1"></a>               p4,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span><span class="sc">-</span>p4,</span>
<span id="cb1-20"><a href="customer-lifetime-value.html#cb1-20" aria-hidden="true" tabindex="-1"></a>               p5,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span><span class="sc">-</span>p5</span>
<span id="cb1-21"><a href="customer-lifetime-value.html#cb1-21" aria-hidden="true" tabindex="-1"></a>               )<span class="co"># </span><span class="al">NOTE</span><span class="co">, ADD STATES BELOW, AND EXTEND THE MATRIX</span></span>
<span id="cb1-22"><a href="customer-lifetime-value.html#cb1-22" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb1-23"><a href="customer-lifetime-value.html#cb1-23" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb1-24"><a href="customer-lifetime-value.html#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="customer-lifetime-value.html#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Profit vector (G for profit :) ) </span></span>
<span id="cb1-26"><a href="customer-lifetime-value.html#cb1-26" aria-hidden="true" tabindex="-1"></a>G <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> states</span>
<span id="cb1-27"><a href="customer-lifetime-value.html#cb1-27" aria-hidden="true" tabindex="-1"></a>            ,<span class="fu">c</span>(margin <span class="sc">-</span> costs, <span class="co">#Purchase only occurs in state 1</span></span>
<span id="cb1-28"><a href="customer-lifetime-value.html#cb1-28" aria-hidden="true" tabindex="-1"></a>               <span class="sc">-</span>costs,</span>
<span id="cb1-29"><a href="customer-lifetime-value.html#cb1-29" aria-hidden="true" tabindex="-1"></a>               <span class="sc">-</span>costs,</span>
<span id="cb1-30"><a href="customer-lifetime-value.html#cb1-30" aria-hidden="true" tabindex="-1"></a>               <span class="sc">-</span>costs,</span>
<span id="cb1-31"><a href="customer-lifetime-value.html#cb1-31" aria-hidden="true" tabindex="-1"></a>               <span class="dv">0</span>)) <span class="co">#We spend no money on the last recency state, because we dont mail them</span></span>
<span id="cb1-32"><a href="customer-lifetime-value.html#cb1-32" aria-hidden="true" tabindex="-1"></a>            <span class="co"># </span><span class="al">NOTE</span><span class="co"> THE AMOUNT OF LINES MUST = STATES</span></span>
<span id="cb1-33"><a href="customer-lifetime-value.html#cb1-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-34"><a href="customer-lifetime-value.html#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="co">#Identify matrix</span></span>
<span id="cb1-35"><a href="customer-lifetime-value.html#cb1-35" aria-hidden="true" tabindex="-1"></a>I <span class="ot">&lt;-</span> <span class="fu">diag</span>(states)</span>
<span id="cb1-36"><a href="customer-lifetime-value.html#cb1-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-37"><a href="customer-lifetime-value.html#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="co">#Customer lifetime value</span></span>
<span id="cb1-38"><a href="customer-lifetime-value.html#cb1-38" aria-hidden="true" tabindex="-1"></a>CLV <span class="ot">&lt;-</span> <span class="fu">solve</span>(I<span class="dv">-1</span><span class="sc">/</span>(discount_factor)<span class="sc">*</span>P) <span class="sc">%*%</span> G</span>
<span id="cb1-39"><a href="customer-lifetime-value.html#cb1-39" aria-hidden="true" tabindex="-1"></a>CLV</span></code></pre></div>
<pre><code>##           [,1]
## [1,] 52.319609
## [2,]  5.553784
## [3,]  1.250773
## [4,] -1.820016
## [5,]  0.000000</code></pre>
<p>We see that for customers starting in state 1, we have a profit of 52, if the customer is starting in state 2, then the profit is 5.6, if starting in state three then 1.25 and fourth they are not positive.</p>
<p>Notice that the approach above show the infinite lifetime of the customers. We may be interested in finding out what the lifetime of a customer is, given a certain period. That we look into in the following</p>
<p><strong>Infinite modified CLV</strong></p>
<p><em>It is modified as the infinite solution, does not tell what they earn after a certain period, the following does, i guess that is why it is called modified</em></p>
<p>We can also calculate the infinite <em>modified</em> solution, where we apply the transition probabilities and assess how the lifetime value of a customer starting in a specific state is. Notice, we are already having the customer.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="customer-lifetime-value.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Note, it is prerequisite to run the code above first</span></span>
<span id="cb3-2"><a href="customer-lifetime-value.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Infinite modified solution *</span></span>
<span id="cb3-3"><a href="customer-lifetime-value.html#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="customer-lifetime-value.html#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Transition probabilities</span></span>
<span id="cb3-5"><a href="customer-lifetime-value.html#cb3-5" aria-hidden="true" tabindex="-1"></a>p1<span class="ot">=</span><span class="fl">0.3</span></span>
<span id="cb3-6"><a href="customer-lifetime-value.html#cb3-6" aria-hidden="true" tabindex="-1"></a>p2<span class="ot">=</span><span class="fl">0.2</span></span>
<span id="cb3-7"><a href="customer-lifetime-value.html#cb3-7" aria-hidden="true" tabindex="-1"></a>p3<span class="ot">=</span><span class="fl">0.15</span></span>
<span id="cb3-8"><a href="customer-lifetime-value.html#cb3-8" aria-hidden="true" tabindex="-1"></a>p4<span class="ot">=</span><span class="dv">0</span> <span class="co">#Notice, that we discovered above that recency state 4 where negative, so we will not invest in these. Then we also assume, that they will not buy anything. One may also have kept p = 0.05</span></span>
<span id="cb3-9"><a href="customer-lifetime-value.html#cb3-9" aria-hidden="true" tabindex="-1"></a>p5<span class="ot">=</span><span class="dv">0</span></span>
<span id="cb3-10"><a href="customer-lifetime-value.html#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="customer-lifetime-value.html#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Transition probability matrix</span></span>
<span id="cb3-12"><a href="customer-lifetime-value.html#cb3-12" aria-hidden="true" tabindex="-1"></a>Pmod<span class="ot">=</span><span class="fu">matrix</span>(<span class="at">nrow=</span>states,<span class="at">byrow=</span>T,</span>
<span id="cb3-13"><a href="customer-lifetime-value.html#cb3-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">c</span>(p1,<span class="dv">1</span><span class="sc">-</span>p1,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb3-14"><a href="customer-lifetime-value.html#cb3-14" aria-hidden="true" tabindex="-1"></a>              p2,<span class="dv">0</span>,<span class="dv">1</span><span class="sc">-</span>p2,<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb3-15"><a href="customer-lifetime-value.html#cb3-15" aria-hidden="true" tabindex="-1"></a>              p3,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span><span class="sc">-</span>p3,<span class="dv">0</span>,</span>
<span id="cb3-16"><a href="customer-lifetime-value.html#cb3-16" aria-hidden="true" tabindex="-1"></a>              p4,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span><span class="sc">-</span>p4,</span>
<span id="cb3-17"><a href="customer-lifetime-value.html#cb3-17" aria-hidden="true" tabindex="-1"></a>              p5,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span><span class="sc">-</span>p5</span>
<span id="cb3-18"><a href="customer-lifetime-value.html#cb3-18" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb3-19"><a href="customer-lifetime-value.html#cb3-19" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb3-20"><a href="customer-lifetime-value.html#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="customer-lifetime-value.html#cb3-21" aria-hidden="true" tabindex="-1"></a>Gmod<span class="ot">=</span><span class="fu">matrix</span>(<span class="fu">c</span>(margin<span class="sc">-</span>costs,  <span class="co">#G for profit :)</span></span>
<span id="cb3-22"><a href="customer-lifetime-value.html#cb3-22" aria-hidden="true" tabindex="-1"></a>              <span class="sc">-</span>costs,</span>
<span id="cb3-23"><a href="customer-lifetime-value.html#cb3-23" aria-hidden="true" tabindex="-1"></a>              <span class="sc">-</span>costs,</span>
<span id="cb3-24"><a href="customer-lifetime-value.html#cb3-24" aria-hidden="true" tabindex="-1"></a>              <span class="dv">0</span>, <span class="co">#Notice, that we remove the cost, that is also why we know that p4 = 0</span></span>
<span id="cb3-25"><a href="customer-lifetime-value.html#cb3-25" aria-hidden="true" tabindex="-1"></a>              <span class="dv">0</span>)</span>
<span id="cb3-26"><a href="customer-lifetime-value.html#cb3-26" aria-hidden="true" tabindex="-1"></a>            ,<span class="at">nrow=</span>states)</span>
<span id="cb3-27"><a href="customer-lifetime-value.html#cb3-27" aria-hidden="true" tabindex="-1"></a>Gmod</span></code></pre></div>
<pre><code>##      [,1]
## [1,]   36
## [2,]   -4
## [3,]   -4
## [4,]    0
## [5,]    0</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="customer-lifetime-value.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Customer lifetime value</span></span>
<span id="cb5-2"><a href="customer-lifetime-value.html#cb5-2" aria-hidden="true" tabindex="-1"></a>CLV <span class="ot">=</span> <span class="fu">solve</span>(I<span class="dv">-1</span><span class="sc">/</span>(discount_factor)<span class="sc">*</span>Pmod) <span class="sc">%*%</span> Gmod</span>
<span id="cb5-3"><a href="customer-lifetime-value.html#cb5-3" aria-hidden="true" tabindex="-1"></a>CLV</span></code></pre></div>
<pre><code>##           [,1]
## [1,] 53.149425
## [2,]  6.620690
## [3,]  2.643678
## [4,]  0.000000
## [5,]  0.000000</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="customer-lifetime-value.html#cb7-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Now we see that we do not loose money on cohort 4</span></span></code></pre></div>
<p>Notice that the following is just for a finite period, where the calculations above are infinite. We see that the result is not really different, just as we saw in the example in excel.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="customer-lifetime-value.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 4 periods **</span></span>
<span id="cb8-2"><a href="customer-lifetime-value.html#cb8-2" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> P <span class="sc">%*%</span> P</span>
<span id="cb8-3"><a href="customer-lifetime-value.html#cb8-3" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> p2 <span class="sc">%*%</span> P</span>
<span id="cb8-4"><a href="customer-lifetime-value.html#cb8-4" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span>p3 <span class="sc">%*%</span> P</span>
<span id="cb8-5"><a href="customer-lifetime-value.html#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="customer-lifetime-value.html#cb8-6" aria-hidden="true" tabindex="-1"></a>res1 <span class="ot">&lt;-</span> G <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span>discount_factor <span class="sc">*</span> P <span class="sc">%*%</span> </span>
<span id="cb8-7"><a href="customer-lifetime-value.html#cb8-7" aria-hidden="true" tabindex="-1"></a>  G <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span>discount_factor<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> p2 <span class="sc">%*%</span> </span>
<span id="cb8-8"><a href="customer-lifetime-value.html#cb8-8" aria-hidden="true" tabindex="-1"></a>  G <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span>discount_factor<span class="sc">^</span><span class="dv">3</span> <span class="sc">*</span> p3 <span class="sc">%*%</span> </span>
<span id="cb8-9"><a href="customer-lifetime-value.html#cb8-9" aria-hidden="true" tabindex="-1"></a>  G <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span>discount_factor<span class="sc">^</span><span class="dv">4</span> <span class="sc">*</span> p4 <span class="sc">%*%</span> </span>
<span id="cb8-10"><a href="customer-lifetime-value.html#cb8-10" aria-hidden="true" tabindex="-1"></a>  G</span>
<span id="cb8-11"><a href="customer-lifetime-value.html#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="customer-lifetime-value.html#cb8-12" aria-hidden="true" tabindex="-1"></a>res1</span></code></pre></div>
<pre><code>##            [,1]
## [1,] 50.1149691
## [2,]  4.2199074
## [3,]  0.5921103
## [4,] -1.9801312
## [5,]  0.0000000</code></pre>
</div>
<div id="btyd" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> BTYD</h2>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="customer-lifetime-value.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(BTYD)</span></code></pre></div>
<p>Buy till you die.</p>
<p>I have put notes to to BG/NBD, hence one may go directly to that section to see some details. It is put as a note to describe the other approaches.</p>
<p>We are working with a non-contratual setting. Also these models are specifically applicable when the company is not able to point out the exact time, that the customer will drop out, so the opposite of when we have a contratual setting, where we know exactly if the customer does not renew his contract.</p>
<div id="paretonbd" class="section level3" number="1.2.1">
<h3><span class="header-section-number">1.2.1</span> Pareto/NBD</h3>
<p>Here we have a model, that aim to predict (or estimate) the transaction rate and the dropout rate. Also the model allows for heterogeneity in the customers, meaning that all are not the same and soo will the dropout not be. We are working with 4 parameters, two for estimating the transaction rate and two for estimating the dropout rate.</p>
<p>Notice that the model is similar to the e.g., thne BG/NBD, that is because this is the foundation hereof.</p>
<p><br />
</p>
<div id="data-preparation" class="section level4" number="1.2.1.1">
<h4><span class="header-section-number">1.2.1.1</span> Data preparation</h4>
<p>We only need three pieces of information for every person:</p>
<ol style="list-style-type: decimal">
<li>How many transactions the customer in the training period - <strong>Frequency</strong>
<ol style="list-style-type: lower-alpha">
<li>Denoted as <span class="math inline">\(x\)</span></li>
</ol></li>
<li>The time of their last transaction - <strong>Recency</strong>
<ol style="list-style-type: lower-alpha">
<li>Denoted as <span class="math inline">\(t.x\)</span></li>
</ol></li>
<li>The total time for which they were observed
<ol style="list-style-type: lower-alpha">
<li>Denoted as <span class="math inline">\(T.cal\)</span>. For time of the calibration period.</li>
</ol></li>
</ol>
<p>Thus we must construct a data frame with a row for each customer and the information above.</p>
<p>We use <code>dc.ReadLines</code>, this is basically the same as <code>read.csv</code>. Notice that elog is a file with a lot of transactions. Thus we have customer identifier, date and amount.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="customer-lifetime-value.html#cb11-1" aria-hidden="true" tabindex="-1"></a>cdnowElog <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;data/cdnowElog.csv&quot;</span>, <span class="at">package =</span> <span class="st">&quot;BTYD&quot;</span>)</span>
<span id="cb11-2"><a href="customer-lifetime-value.html#cb11-2" aria-hidden="true" tabindex="-1"></a>elog <span class="ot">&lt;-</span> <span class="fu">dc.ReadLines</span>(cdnowElog, <span class="at">cust.idx =</span> <span class="dv">2</span></span>
<span id="cb11-3"><a href="customer-lifetime-value.html#cb11-3" aria-hidden="true" tabindex="-1"></a>                     ,<span class="at">date.idx =</span> <span class="dv">3</span>, <span class="at">sales.idx =</span> <span class="dv">5</span>)</span>
<span id="cb11-4"><a href="customer-lifetime-value.html#cb11-4" aria-hidden="true" tabindex="-1"></a>elog[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,]</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="left">cust</th>
<th align="left">date</th>
<th align="right">sales</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">19970101</td>
<td align="right">29.33</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">19970118</td>
<td align="right">29.73</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">19970802</td>
<td align="right">14.96</td>
</tr>
</tbody>
</table>
</div>
<p>Notice the name ‘elog’, that is for event log. Hence it logs all of the events.</p>
<p>We want to transform the date to a date type instead.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="customer-lifetime-value.html#cb12-1" aria-hidden="true" tabindex="-1"></a>elog<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(elog<span class="sc">$</span>date, <span class="st">&quot;%Y%m%d&quot;</span>);</span>
<span id="cb12-2"><a href="customer-lifetime-value.html#cb12-2" aria-hidden="true" tabindex="-1"></a>elog[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,]</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="left">cust</th>
<th align="left">date</th>
<th align="right">sales</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">1997-01-01</td>
<td align="right">29.33</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">1997-01-18</td>
<td align="right">29.73</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">1997-08-02</td>
<td align="right">14.96</td>
</tr>
</tbody>
</table>
</div>
<p>The following is able to merge transactions in the same customer. Before running the code we have 6919 observations (events).</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="customer-lifetime-value.html#cb13-1" aria-hidden="true" tabindex="-1"></a>elog <span class="ot">&lt;-</span> <span class="fu">dc.MergeTransactionsOnSameDate</span>(elog);</span></code></pre></div>
<p>After merging we have 6696 events. Thus it appears that some customers made several purchases on the same day.</p>
<p>Now we can <strong>split the data</strong> to get a train (calibration) and test period.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="customer-lifetime-value.html#cb14-1" aria-hidden="true" tabindex="-1"></a>end.of.cal.period <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;1997-09-30&quot;</span>) <span class="co">#Insert the last date in the train period.</span></span>
<span id="cb14-2"><a href="customer-lifetime-value.html#cb14-2" aria-hidden="true" tabindex="-1"></a>elog.cal <span class="ot">&lt;-</span> elog[<span class="fu">which</span>(elog<span class="sc">$</span>date <span class="sc">&lt;=</span> end.of.cal.period), ]</span></code></pre></div>
<p><strong><em>Notice, the BG/NBD model deals with repeat transactions, hence the first transaction is ignored.</em></strong></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="customer-lifetime-value.html#cb15-1" aria-hidden="true" tabindex="-1"></a>split.data <span class="ot">&lt;-</span> <span class="fu">dc.SplitUpElogForRepeatTrans</span>(elog.cal);</span>
<span id="cb15-2"><a href="customer-lifetime-value.html#cb15-2" aria-hidden="true" tabindex="-1"></a>clean.elog <span class="ot">&lt;-</span> split.data<span class="sc">$</span>repeat.trans.elog;</span></code></pre></div>
<p>Now we are going to create a customer-by-time matrix. That is simply a matrix with each customer on each row and then days as columns. The following is just a snip.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="customer-lifetime-value.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Customer-by-time: Repeatitive transactions</span></span>
<span id="cb16-2"><a href="customer-lifetime-value.html#cb16-2" aria-hidden="true" tabindex="-1"></a>freq.cbt <span class="ot">&lt;-</span> <span class="fu">dc.CreateFreqCBT</span>(clean.elog);</span>
<span id="cb16-3"><a href="customer-lifetime-value.html#cb16-3" aria-hidden="true" tabindex="-1"></a>freq.cbt[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code></pre></div>
<pre><code>##     date
## cust 1997-01-08 1997-01-09 1997-01-10 1997-01-11 1997-01-12
##    1          0          0          0          0          0
##    2          0          0          0          0          0
##    6          0          0          0          1          0</code></pre>
<p>Since we initially deleted all first transactions, the frequence customer-by-time matrix does not have any of the customer who made zero repeat transactions. These customers are still important hence they will be included in the matrix with the following.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="customer-lifetime-value.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Customer-by-time: All first transactions transactions</span></span>
<span id="cb18-2"><a href="customer-lifetime-value.html#cb18-2" aria-hidden="true" tabindex="-1"></a>tot.cbt <span class="ot">&lt;-</span> <span class="fu">dc.CreateFreqCBT</span>(elog)</span>
<span id="cb18-3"><a href="customer-lifetime-value.html#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="customer-lifetime-value.html#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Merging both customer-by-time matrices.</span></span>
<span id="cb18-5"><a href="customer-lifetime-value.html#cb18-5" aria-hidden="true" tabindex="-1"></a>cal.cbt <span class="ot">&lt;-</span> <span class="fu">dc.MergeCustomers</span>(tot.cbt, freq.cbt)</span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="customer-lifetime-value.html#cb19-1" aria-hidden="true" tabindex="-1"></a>birth.periods <span class="ot">&lt;-</span> split.data<span class="sc">$</span>cust.data<span class="sc">$</span>birth.per</span>
<span id="cb19-2"><a href="customer-lifetime-value.html#cb19-2" aria-hidden="true" tabindex="-1"></a>last.dates <span class="ot">&lt;-</span> split.data<span class="sc">$</span>cust.data<span class="sc">$</span>last.date</span>
<span id="cb19-3"><a href="customer-lifetime-value.html#cb19-3" aria-hidden="true" tabindex="-1"></a>cal.cbs.dates <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(birth.periods, last.dates</span>
<span id="cb19-4"><a href="customer-lifetime-value.html#cb19-4" aria-hidden="true" tabindex="-1"></a>                            ,end.of.cal.period)</span>
<span id="cb19-5"><a href="customer-lifetime-value.html#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="customer-lifetime-value.html#cb19-6" aria-hidden="true" tabindex="-1"></a>cal.cbs <span class="ot">&lt;-</span> <span class="fu">dc.BuildCBSFromCBTAndDates</span>(cal.cbt</span>
<span id="cb19-7"><a href="customer-lifetime-value.html#cb19-7" aria-hidden="true" tabindex="-1"></a>                                      ,cal.cbs.dates</span>
<span id="cb19-8"><a href="customer-lifetime-value.html#cb19-8" aria-hidden="true" tabindex="-1"></a>                                      ,<span class="at">per=</span><span class="st">&quot;week&quot;</span>) <span class="co"># we want to see weekly data</span></span></code></pre></div>
<p><em>Notes:</em></p>
<p><em>1. cbs = customer-by-sufficient-statistics</em>
<em>2. We use <code>per = "week"</code> to get data shown per week, as ultimately it show the same as pr. day and returns a more simple data frame.</em></p>
<p>In general the procedure above can be executed in the following command: <code>dc.ElogToCbsCbt()</code>. But they have chosen to show the process, so one is able to make iterations to the data if that is needed in other applications.</p>
<p>You’ll be glad to hear that, for the process described above, the package contains a single function to do everything for you: <code>dc.ElogToCbsCbt</code>.</p>
</div>
<div id="parameter-estimation" class="section level4" number="1.2.1.2">
<h4><span class="header-section-number">1.2.1.2</span> Parameter Estimation</h4>
<p>First we must estimate the parameters. Notice that the function takes a starting point with the following values for the parameters (1,1,1,1).</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="customer-lifetime-value.html#cb20-1" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">pnbd.EstimateParameters</span>(cal.cbs);</span>
<span id="cb20-2"><a href="customer-lifetime-value.html#cb20-2" aria-hidden="true" tabindex="-1"></a>params</span></code></pre></div>
<pre><code>## [1]  0.5533971 10.5801985  0.6060625 11.6562237</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="customer-lifetime-value.html#cb22-1" aria-hidden="true" tabindex="-1"></a>LL <span class="ot">&lt;-</span> <span class="fu">pnbd.cbs.LL</span>(params, cal.cbs);</span>
<span id="cb22-2"><a href="customer-lifetime-value.html#cb22-2" aria-hidden="true" tabindex="-1"></a>LL</span></code></pre></div>
<pre><code>## [1] -9594.976</code></pre>
<p>The log likelihood estimates the fit to the data, thus we have a log-likelihood of -9494.98. We are not able to deduct much from the number itself. But we are able to compare it with other models. Basically, we want to select the model with a log-likelihood that is as close to 0 as possible.</p>
<p>In the following we run consecutive estimations with its own output as its starting point.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="customer-lifetime-value.html#cb24-1" aria-hidden="true" tabindex="-1"></a>p.matrix <span class="ot">&lt;-</span> <span class="fu">c</span>(params, LL);</span>
<span id="cb24-2"><a href="customer-lifetime-value.html#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>){</span>
<span id="cb24-3"><a href="customer-lifetime-value.html#cb24-3" aria-hidden="true" tabindex="-1"></a>  params <span class="ot">&lt;-</span> <span class="fu">pnbd.EstimateParameters</span>(cal.cbs, params);</span>
<span id="cb24-4"><a href="customer-lifetime-value.html#cb24-4" aria-hidden="true" tabindex="-1"></a>  LL <span class="ot">&lt;-</span> <span class="fu">pnbd.cbs.LL</span>(params, cal.cbs);</span>
<span id="cb24-5"><a href="customer-lifetime-value.html#cb24-5" aria-hidden="true" tabindex="-1"></a>  p.matrix.row <span class="ot">&lt;-</span> <span class="fu">c</span>(params, LL);</span>
<span id="cb24-6"><a href="customer-lifetime-value.html#cb24-6" aria-hidden="true" tabindex="-1"></a>  p.matrix <span class="ot">&lt;-</span> <span class="fu">rbind</span>(p.matrix, p.matrix.row);</span>
<span id="cb24-7"><a href="customer-lifetime-value.html#cb24-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-8"><a href="customer-lifetime-value.html#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(p.matrix) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;r&quot;</span>, <span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;s&quot;</span>, <span class="st">&quot;beta&quot;</span>, <span class="st">&quot;LL&quot;</span>);</span>
<span id="cb24-9"><a href="customer-lifetime-value.html#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(p.matrix) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>;</span>
<span id="cb24-10"><a href="customer-lifetime-value.html#cb24-10" aria-hidden="true" tabindex="-1"></a>p.matrix</span></code></pre></div>
<pre><code>##           r    alpha         s     beta        LL
## 1 0.5533971 10.58020 0.6060625 11.65622 -9594.976
## 2 0.5534354 10.57952 0.6060276 11.65666 -9594.976
## 3 0.5533710 10.57952 0.6059074 11.65812 -9594.976</code></pre>
<p>We see that the log-likelihood, hence the fit, is the same, but some of the parameters are changing slightly. We have the following parameters:</p>
<p><strong>Describing the the gamma mixing distribution of the NBD transaction process</strong></p>
<ul>
<li>r</li>
<li>Alpha</li>
</ul>
<p>See figure <a href="customer-lifetime-value.html#fig:pnbd1">1.1</a></p>
<p><strong>Describing the gamme mixing distrbibution of the Pareto (or gamma exponentiated) dropout process</strong></p>
<ul>
<li>s</li>
<li>beta</li>
</ul>
<p>See figure <a href="customer-lifetime-value.html#fig:pnbd2">1.2</a></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="customer-lifetime-value.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pnbd.PlotTransactionRateHeterogeneity</span>(params)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:pnbd1"></span>
<img src="Customer-Analytics-Notes_files/figure-html/pnbd1-1.png" alt="Transaction rate heterogeneity of estimated parameters" width="720" />
<p class="caption">
Figure 1.1: Transaction rate heterogeneity of estimated parameters
</p>
</div>
<p>Few have a very high transaction rate, where the majority lies in the south eastern region.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="customer-lifetime-value.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pnbd.PlotDropoutRateHeterogeneity</span>(params)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:pnbd2"></span>
<img src="Customer-Analytics-Notes_files/figure-html/pnbd2-1.png" alt="Dropout rate heterogeneity of estimated parameters" width="720" />
<p class="caption">
Figure 1.2: Dropout rate heterogeneity of estimated parameters
</p>
</div>
<p>Few have a very high dropout rate, where the majority lies in the south eastern region.</p>
</div>
<div id="individual-level-estimations" class="section level4" number="1.2.1.3">
<h4><span class="header-section-number">1.2.1.3</span> Individual Level Estimations</h4>
<p>Now we can also make some estimations on the individual level. We can do:</p>
<ol style="list-style-type: decimal">
<li>Estimating purchases in the calibration period and hold out period.</li>
<li>Calculating probability that the customer is still alive at the end of the calibration period.</li>
</ol>
<p><strong>First</strong> we can estimate the number of transactions we expect a newly acquired customer to make in a given time period.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="customer-lifetime-value.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pnbd.Expectation</span>(params</span>
<span id="cb28-2"><a href="customer-lifetime-value.html#cb28-2" aria-hidden="true" tabindex="-1"></a>                 ,<span class="at">t=</span><span class="dv">52</span> <span class="co">#We have weekly data</span></span>
<span id="cb28-3"><a href="customer-lifetime-value.html#cb28-3" aria-hidden="true" tabindex="-1"></a>                 )</span></code></pre></div>
<pre><code>## [1] 1.473434</code></pre>
<p>We expect a newly acquired customer to make 1.47 repeat purchases in a time period of one year.</p>
<p>Calling information from an individual customer.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="customer-lifetime-value.html#cb30-1" aria-hidden="true" tabindex="-1"></a>cal.cbs[<span class="st">&quot;1516&quot;</span>,]</span></code></pre></div>
<pre><code>##        x      t.x    T.cal 
## 26.00000 30.85714 31.00000</code></pre>
<p>Now we can store the information, to be used for estimating purchases in the holdout period.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="customer-lifetime-value.html#cb32-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> cal.cbs[<span class="st">&quot;1516&quot;</span>, <span class="st">&quot;x&quot;</span>]</span>
<span id="cb32-2"><a href="customer-lifetime-value.html#cb32-2" aria-hidden="true" tabindex="-1"></a>t.x <span class="ot">&lt;-</span> cal.cbs[<span class="st">&quot;1516&quot;</span>, <span class="st">&quot;t.x&quot;</span>]</span>
<span id="cb32-3"><a href="customer-lifetime-value.html#cb32-3" aria-hidden="true" tabindex="-1"></a>T.cal <span class="ot">&lt;-</span> cal.cbs[<span class="st">&quot;1516&quot;</span>, <span class="st">&quot;T.cal&quot;</span>]</span>
<span id="cb32-4"><a href="customer-lifetime-value.html#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="fu">pnbd.ConditionalExpectedTransactions</span>(params</span>
<span id="cb32-5"><a href="customer-lifetime-value.html#cb32-5" aria-hidden="true" tabindex="-1"></a>                                     ,<span class="at">T.star =</span> <span class="dv">52</span></span>
<span id="cb32-6"><a href="customer-lifetime-value.html#cb32-6" aria-hidden="true" tabindex="-1"></a>                                     ,x</span>
<span id="cb32-7"><a href="customer-lifetime-value.html#cb32-7" aria-hidden="true" tabindex="-1"></a>                                     ,t.x</span>
<span id="cb32-8"><a href="customer-lifetime-value.html#cb32-8" aria-hidden="true" tabindex="-1"></a>                                     ,T.cal)</span></code></pre></div>
<pre><code>## [1] 25.45647</code></pre>
<p>We expect 25 purchases in the hold out period.</p>
<p><strong>Second</strong> we can calculate the probability that the customer is still alive in the end of the hold out period.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="customer-lifetime-value.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pnbd.PAlive</span>(params, x, t.x, T.cal)</span></code></pre></div>
<pre><code>## [1] 0.997874</code></pre>
<p>We see that there is a probability of 99%, hence it is almost certain.</p>
<p><strong>Conditional expectation function</strong></p>
<p>We see the increasing frequency paradox in action: (<strong>What ever this is</strong>)</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="customer-lifetime-value.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">5</span>)){</span>
<span id="cb36-2"><a href="customer-lifetime-value.html#cb36-2" aria-hidden="true" tabindex="-1"></a>  cond.expectation <span class="ot">&lt;-</span> <span class="fu">pnbd.ConditionalExpectedTransactions</span>(</span>
<span id="cb36-3"><a href="customer-lifetime-value.html#cb36-3" aria-hidden="true" tabindex="-1"></a>  params, <span class="at">T.star =</span> <span class="dv">52</span>, <span class="at">x =</span> i,</span>
<span id="cb36-4"><a href="customer-lifetime-value.html#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">t.x =</span> <span class="dv">20</span>, <span class="at">T.cal =</span> <span class="dv">39</span>)</span>
<span id="cb36-5"><a href="customer-lifetime-value.html#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span> (<span class="st">&quot;x:&quot;</span>,i,<span class="st">&quot;</span><span class="sc">\t</span><span class="st"> Expectation:&quot;</span>,cond.expectation, <span class="at">fill =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-6"><a href="customer-lifetime-value.html#cb36-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## x: 10     Expectation: 0.7062289
## x: 15     Expectation: 0.1442396
## x: 20     Expectation: 0.02250658
## x: 25     Expectation: 0.00309267</code></pre>
</div>
<div id="plotting-goodness-of-fit" class="section level4" number="1.2.1.4">
<h4><span class="header-section-number">1.2.1.4</span> Plotting / Goodness-of-fit</h4>
<p><strong>In the training period</strong></p>
<p>We want to assess how the model fits the actual transactions</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="customer-lifetime-value.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pnbd.PlotFrequencyInCalibration</span>(params, cal.cbs</span>
<span id="cb38-2"><a href="customer-lifetime-value.html#cb38-2" aria-hidden="true" tabindex="-1"></a>                                ,<span class="at">censor =</span>  <span class="dv">7</span> <span class="co">#The frequency groups</span></span>
<span id="cb38-3"><a href="customer-lifetime-value.html#cb38-3" aria-hidden="true" tabindex="-1"></a>                                )</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-23-1.png" width="720" style="display: block; margin: auto;" /></p>
<pre><code>##                freq.0   freq.1   freq.2   freq.3  freq.4   freq.5   freq.6
## n.x.actual   1411.000 439.0000 214.0000 100.0000 62.0000 38.00000 29.00000
## n.x.expected 1434.034 397.2457 194.0224 112.4039 70.5903 46.43514 31.47627
##               freq.7+
## n.x.actual   64.00000
## n.x.expected 70.79194</code></pre>
<p>Notice that all bins reflect the frequency and then the y show the amount of customers in the repeat transactions group, notice that group 0 only made one purchase</p>
<p>We see that the model estimates the actual transactions very well.</p>
<p><strong>The hold out period</strong></p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="customer-lifetime-value.html#cb40-1" aria-hidden="true" tabindex="-1"></a>elog <span class="ot">&lt;-</span> <span class="fu">dc.SplitUpElogForRepeatTrans</span>(elog)<span class="sc">$</span>repeat.trans.elog;</span>
<span id="cb40-2"><a href="customer-lifetime-value.html#cb40-2" aria-hidden="true" tabindex="-1"></a>x.star <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(cal.cbs));</span>
<span id="cb40-3"><a href="customer-lifetime-value.html#cb40-3" aria-hidden="true" tabindex="-1"></a>cal.cbs <span class="ot">&lt;-</span> <span class="fu">cbind</span>(cal.cbs, x.star);</span>
<span id="cb40-4"><a href="customer-lifetime-value.html#cb40-4" aria-hidden="true" tabindex="-1"></a>elog.custs <span class="ot">&lt;-</span> elog<span class="sc">$</span>cust;</span>
<span id="cb40-5"><a href="customer-lifetime-value.html#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(cal.cbs)){</span>
<span id="cb40-6"><a href="customer-lifetime-value.html#cb40-6" aria-hidden="true" tabindex="-1"></a>  current.cust <span class="ot">&lt;-</span> <span class="fu">rownames</span>(cal.cbs)[i]</span>
<span id="cb40-7"><a href="customer-lifetime-value.html#cb40-7" aria-hidden="true" tabindex="-1"></a>  tot.cust.trans <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">which</span>(elog.custs <span class="sc">==</span> current.cust))</span>
<span id="cb40-8"><a href="customer-lifetime-value.html#cb40-8" aria-hidden="true" tabindex="-1"></a>  cal.trans <span class="ot">&lt;-</span> cal.cbs[i, <span class="st">&quot;x&quot;</span>]</span>
<span id="cb40-9"><a href="customer-lifetime-value.html#cb40-9" aria-hidden="true" tabindex="-1"></a>  cal.cbs[i, <span class="st">&quot;x.star&quot;</span>] <span class="ot">&lt;-</span> tot.cust.trans <span class="sc">-</span> cal.trans</span>
<span id="cb40-10"><a href="customer-lifetime-value.html#cb40-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-11"><a href="customer-lifetime-value.html#cb40-11" aria-hidden="true" tabindex="-1"></a>cal.cbs[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,]</span></code></pre></div>
<pre><code>##   x       t.x    T.cal x.star
## 1 2 30.428571 38.85714      1
## 2 1  1.714286 38.85714      0
## 3 0  0.000000 38.85714      0</code></pre>
<p>Now we can plot the expected frequency.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="customer-lifetime-value.html#cb42-1" aria-hidden="true" tabindex="-1"></a>T.star <span class="ot">&lt;-</span> <span class="dv">39</span> <span class="co"># length of the holdout period</span></span>
<span id="cb42-2"><a href="customer-lifetime-value.html#cb42-2" aria-hidden="true" tabindex="-1"></a>censor <span class="ot">&lt;-</span> <span class="dv">7</span> <span class="co"># This censor serves the same purpose described above</span></span>
<span id="cb42-3"><a href="customer-lifetime-value.html#cb42-3" aria-hidden="true" tabindex="-1"></a>x.star <span class="ot">&lt;-</span> cal.cbs[,<span class="st">&quot;x.star&quot;</span>]</span>
<span id="cb42-4"><a href="customer-lifetime-value.html#cb42-4" aria-hidden="true" tabindex="-1"></a>comp <span class="ot">&lt;-</span> <span class="fu">pnbd.PlotFreqVsConditionalExpectedFrequency</span>(params, T.star,</span>
<span id="cb42-5"><a href="customer-lifetime-value.html#cb42-5" aria-hidden="true" tabindex="-1"></a>cal.cbs, x.star, censor)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-25-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>We see that the hold out period is estimated very well in this example. Instead of looking at the plot, we can also show a matrix containing the numbers.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="customer-lifetime-value.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(comp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;act&quot;</span>, <span class="st">&quot;exp&quot;</span>, <span class="st">&quot;bin&quot;</span>)</span>
<span id="cb43-2"><a href="customer-lifetime-value.html#cb43-2" aria-hidden="true" tabindex="-1"></a>comp</span></code></pre></div>
<pre><code>##           freq.0      freq.1     freq.2     freq.3    freq.4    freq.5
## act    0.2367116   0.6970387   1.392523   1.560000  2.532258  2.947368
## exp    0.1384724   0.5995607   1.195989   1.714041  2.398545  2.907467
## bin 1411.0000000 439.0000000 214.000000 100.000000 62.000000 38.000000
##        freq.6   freq.7+
## act  3.862069  6.359375
## exp  3.818906  6.403484
## bin 29.000000 64.000000</code></pre>
<p>Now we want to look at weekly transactions.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="customer-lifetime-value.html#cb45-1" aria-hidden="true" tabindex="-1"></a>tot.cbt <span class="ot">&lt;-</span> <span class="fu">dc.CreateFreqCBT</span>(elog)</span>
<span id="cb45-2"><a href="customer-lifetime-value.html#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="customer-lifetime-value.html#cb45-3" aria-hidden="true" tabindex="-1"></a>d.track.data <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">7</span> <span class="sc">*</span> <span class="dv">78</span>)</span>
<span id="cb45-4"><a href="customer-lifetime-value.html#cb45-4" aria-hidden="true" tabindex="-1"></a>origin <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;1997-01-01&quot;</span>)</span>
<span id="cb45-5"><a href="customer-lifetime-value.html#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">colnames</span>(tot.cbt)){</span>
<span id="cb45-6"><a href="customer-lifetime-value.html#cb45-6" aria-hidden="true" tabindex="-1"></a>  date.index <span class="ot">&lt;-</span> <span class="fu">difftime</span>(<span class="fu">as.Date</span>(i), origin) <span class="sc">+</span> <span class="dv">1</span>;</span>
<span id="cb45-7"><a href="customer-lifetime-value.html#cb45-7" aria-hidden="true" tabindex="-1"></a>  d.track.data[date.index] <span class="ot">&lt;-</span> <span class="fu">sum</span>(tot.cbt[,i]);</span>
<span id="cb45-8"><a href="customer-lifetime-value.html#cb45-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb45-9"><a href="customer-lifetime-value.html#cb45-9" aria-hidden="true" tabindex="-1"></a>w.track.data <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">78</span>)</span>
<span id="cb45-10"><a href="customer-lifetime-value.html#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">78</span>){</span>
<span id="cb45-11"><a href="customer-lifetime-value.html#cb45-11" aria-hidden="true" tabindex="-1"></a>  w.track.data[j] <span class="ot">&lt;-</span> <span class="fu">sum</span>(d.track.data[(j<span class="sc">*</span><span class="dv">7-6</span>)<span class="sc">:</span>(j<span class="sc">*</span><span class="dv">7</span>)])</span>
<span id="cb45-12"><a href="customer-lifetime-value.html#cb45-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="customer-lifetime-value.html#cb46-1" aria-hidden="true" tabindex="-1"></a>T.cal <span class="ot">&lt;-</span> cal.cbs[,<span class="st">&quot;T.cal&quot;</span>]</span>
<span id="cb46-2"><a href="customer-lifetime-value.html#cb46-2" aria-hidden="true" tabindex="-1"></a>T.tot <span class="ot">&lt;-</span> <span class="dv">78</span></span>
<span id="cb46-3"><a href="customer-lifetime-value.html#cb46-3" aria-hidden="true" tabindex="-1"></a>n.periods.final <span class="ot">&lt;-</span> <span class="dv">78</span></span>
<span id="cb46-4"><a href="customer-lifetime-value.html#cb46-4" aria-hidden="true" tabindex="-1"></a>inc.tracking <span class="ot">&lt;-</span> <span class="fu">pnbd.PlotTrackingInc</span>(params, T.cal,</span>
<span id="cb46-5"><a href="customer-lifetime-value.html#cb46-5" aria-hidden="true" tabindex="-1"></a>T.tot, w.track.data,</span>
<span id="cb46-6"><a href="customer-lifetime-value.html#cb46-6" aria-hidden="true" tabindex="-1"></a>n.periods.final)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-28-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>We see that the model generalizes pretty well the period. Instead of looking at the plot we can also show the underlying numbers.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="customer-lifetime-value.html#cb47-1" aria-hidden="true" tabindex="-1"></a>inc.tracking[,<span class="dv">20</span><span class="sc">:</span><span class="dv">25</span>]</span></code></pre></div>
<pre><code>##              [,1]    [,2]     [,3]     [,4]     [,5]     [,6]
## actual   73.00000 55.0000 70.00000 33.00000 56.00000 99.00000
## expected 78.30848 76.4191 74.64776 72.98278 71.41403 69.93268</code></pre>
<p>We can also show a cummulated sum over the weeks, notice that the hold period and the training period is separated by the dashed line.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="customer-lifetime-value.html#cb49-1" aria-hidden="true" tabindex="-1"></a>cum.tracking.data <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(w.track.data)</span>
<span id="cb49-2"><a href="customer-lifetime-value.html#cb49-2" aria-hidden="true" tabindex="-1"></a>cum.tracking <span class="ot">&lt;-</span> <span class="fu">pnbd.PlotTrackingCum</span>(params</span>
<span id="cb49-3"><a href="customer-lifetime-value.html#cb49-3" aria-hidden="true" tabindex="-1"></a>                                     ,T.cal</span>
<span id="cb49-4"><a href="customer-lifetime-value.html#cb49-4" aria-hidden="true" tabindex="-1"></a>                                     ,T.tot</span>
<span id="cb49-5"><a href="customer-lifetime-value.html#cb49-5" aria-hidden="true" tabindex="-1"></a>                                     ,cum.tracking.data</span>
<span id="cb49-6"><a href="customer-lifetime-value.html#cb49-6" aria-hidden="true" tabindex="-1"></a>                                     ,n.periods.final)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-30-1.png" width="720" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="customer-lifetime-value.html#cb50-1" aria-hidden="true" tabindex="-1"></a>cum.tracking[,<span class="dv">20</span><span class="sc">:</span><span class="dv">25</span>]</span></code></pre></div>
<pre><code>##              [,1]     [,2]     [,3]     [,4]    [,5]     [,6]
## actual   1359.000 1414.000 1484.000 1517.000 1573.00 1672.000
## expected 1308.856 1385.275 1459.923 1532.906 1604.32 1674.253</code></pre>
</div>
</div>
<div id="bgnbd" class="section level3" number="1.2.2">
<h3><span class="header-section-number">1.2.2</span> BG/NBD</h3>
<p>Used in a non-contractual situation in which customers can make a purchase at any time. The model describes the rate at which customers make purchases and the rate at which they drop out. This is done with four parameters and also allowing for heterogeneity.</p>
<p>The following is the BG/NBD model on the CDNow data.</p>
<p><em>Note: calibration = training</em></p>
<div id="data-preparation-1" class="section level4" number="1.2.2.1">
<h4><span class="header-section-number">1.2.2.1</span> Data Preparation</h4>
<p>We only need three pieces of information for every person:</p>
<ol style="list-style-type: decimal">
<li>How many transactions the customer in the training period - <strong>Frequency</strong>
<ol style="list-style-type: lower-alpha">
<li>Denoted as <span class="math inline">\(x\)</span></li>
</ol></li>
<li>The time of their last transaction - <strong>Recency</strong>
<ol style="list-style-type: lower-alpha">
<li>Denoted as <span class="math inline">\(t.x\)</span></li>
</ol></li>
<li>The total time for which they were observed
<ol style="list-style-type: lower-alpha">
<li>Denoted as <span class="math inline">\(T.cal\)</span>. For time of the calibration period.</li>
</ol></li>
</ol>
<p>Thus we must construct a data frame with a row for each customer and the information above.</p>
<p>We use <code>dc.ReadLines</code>, this is basically the same as <code>read.csv</code>. Notice that elog is a file with a lot of transactions. Thus we have customer identifier, date and amount.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="customer-lifetime-value.html#cb52-1" aria-hidden="true" tabindex="-1"></a>cdnowElog <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;data/cdnowElog.csv&quot;</span>, <span class="at">package =</span> <span class="st">&quot;BTYD&quot;</span>)</span>
<span id="cb52-2"><a href="customer-lifetime-value.html#cb52-2" aria-hidden="true" tabindex="-1"></a>elog <span class="ot">&lt;-</span> <span class="fu">dc.ReadLines</span>(cdnowElog, <span class="at">cust.idx =</span> <span class="dv">2</span></span>
<span id="cb52-3"><a href="customer-lifetime-value.html#cb52-3" aria-hidden="true" tabindex="-1"></a>                     ,<span class="at">date.idx =</span> <span class="dv">3</span>, <span class="at">sales.idx =</span> <span class="dv">5</span>)</span>
<span id="cb52-4"><a href="customer-lifetime-value.html#cb52-4" aria-hidden="true" tabindex="-1"></a>elog[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,]</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="left">cust</th>
<th align="left">date</th>
<th align="right">sales</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">19970101</td>
<td align="right">29.33</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">19970118</td>
<td align="right">29.73</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">19970802</td>
<td align="right">14.96</td>
</tr>
</tbody>
</table>
</div>
<p>Notice the name ‘elog’, that is for event log. Hence it logs all of the events.</p>
<p>We want to transform the date to a date type instead.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="customer-lifetime-value.html#cb53-1" aria-hidden="true" tabindex="-1"></a>elog<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(elog<span class="sc">$</span>date, <span class="st">&quot;%Y%m%d&quot;</span>);</span>
<span id="cb53-2"><a href="customer-lifetime-value.html#cb53-2" aria-hidden="true" tabindex="-1"></a>elog[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,]</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="left">cust</th>
<th align="left">date</th>
<th align="right">sales</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">1997-01-01</td>
<td align="right">29.33</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">1997-01-18</td>
<td align="right">29.73</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">1997-08-02</td>
<td align="right">14.96</td>
</tr>
</tbody>
</table>
</div>
<p>The following is able to merge transactions in the same customer. Before running the code we have 6919 observations (events).</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="customer-lifetime-value.html#cb54-1" aria-hidden="true" tabindex="-1"></a>elog <span class="ot">&lt;-</span> <span class="fu">dc.MergeTransactionsOnSameDate</span>(elog);</span></code></pre></div>
<p>After merging we have 6696 events. Thus it appears that some customers made several purchases on the same day.</p>
<p>Now we can <strong>split the data</strong> to get a train (calibration) and test period.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="customer-lifetime-value.html#cb55-1" aria-hidden="true" tabindex="-1"></a>end.of.cal.period <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;1997-09-30&quot;</span>) <span class="co">#Insert the last date in the train period.</span></span>
<span id="cb55-2"><a href="customer-lifetime-value.html#cb55-2" aria-hidden="true" tabindex="-1"></a>elog.cal <span class="ot">&lt;-</span> elog[<span class="fu">which</span>(elog<span class="sc">$</span>date <span class="sc">&lt;=</span> end.of.cal.period), ]</span></code></pre></div>
<p><strong><em>Notice, the BG/NBD model deals with repeat transactions, hence the first transaction is ignored.</em></strong></p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="customer-lifetime-value.html#cb56-1" aria-hidden="true" tabindex="-1"></a>split.data <span class="ot">&lt;-</span> <span class="fu">dc.SplitUpElogForRepeatTrans</span>(elog.cal);</span>
<span id="cb56-2"><a href="customer-lifetime-value.html#cb56-2" aria-hidden="true" tabindex="-1"></a>clean.elog <span class="ot">&lt;-</span> split.data<span class="sc">$</span>repeat.trans.elog;</span></code></pre></div>
<p>Now we are going to create a customer-by-time matrix. That is simply a matrix with each customer on each row and then days as columns. The following is just a snip.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="customer-lifetime-value.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Customer-by-time: Repeatitive transactions</span></span>
<span id="cb57-2"><a href="customer-lifetime-value.html#cb57-2" aria-hidden="true" tabindex="-1"></a>freq.cbt <span class="ot">&lt;-</span> <span class="fu">dc.CreateFreqCBT</span>(clean.elog);</span>
<span id="cb57-3"><a href="customer-lifetime-value.html#cb57-3" aria-hidden="true" tabindex="-1"></a>freq.cbt[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code></pre></div>
<pre><code>##     date
## cust 1997-01-08 1997-01-09 1997-01-10 1997-01-11 1997-01-12
##    1          0          0          0          0          0
##    2          0          0          0          0          0
##    6          0          0          0          1          0</code></pre>
<p>Since we initially deleted all first transactions, the frequence customer-by-time matrix does not have any of the customer who made zero repeat transactions. These customers are still important hence they will be included in the matrix with the following.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="customer-lifetime-value.html#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Customer-by-time: All first transactions transactions</span></span>
<span id="cb59-2"><a href="customer-lifetime-value.html#cb59-2" aria-hidden="true" tabindex="-1"></a>tot.cbt <span class="ot">&lt;-</span> <span class="fu">dc.CreateFreqCBT</span>(elog)</span>
<span id="cb59-3"><a href="customer-lifetime-value.html#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="customer-lifetime-value.html#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Merging both customer-by-time matrices.</span></span>
<span id="cb59-5"><a href="customer-lifetime-value.html#cb59-5" aria-hidden="true" tabindex="-1"></a>cal.cbt <span class="ot">&lt;-</span> <span class="fu">dc.MergeCustomers</span>(tot.cbt, freq.cbt)</span></code></pre></div>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="customer-lifetime-value.html#cb60-1" aria-hidden="true" tabindex="-1"></a>birth.periods <span class="ot">&lt;-</span> split.data<span class="sc">$</span>cust.data<span class="sc">$</span>birth.per</span>
<span id="cb60-2"><a href="customer-lifetime-value.html#cb60-2" aria-hidden="true" tabindex="-1"></a>last.dates <span class="ot">&lt;-</span> split.data<span class="sc">$</span>cust.data<span class="sc">$</span>last.date</span>
<span id="cb60-3"><a href="customer-lifetime-value.html#cb60-3" aria-hidden="true" tabindex="-1"></a>cal.cbs.dates <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(birth.periods, last.dates</span>
<span id="cb60-4"><a href="customer-lifetime-value.html#cb60-4" aria-hidden="true" tabindex="-1"></a>                            ,end.of.cal.period)</span>
<span id="cb60-5"><a href="customer-lifetime-value.html#cb60-5" aria-hidden="true" tabindex="-1"></a>cal.cbs <span class="ot">&lt;-</span> <span class="fu">dc.BuildCBSFromCBTAndDates</span>(cal.cbt</span>
<span id="cb60-6"><a href="customer-lifetime-value.html#cb60-6" aria-hidden="true" tabindex="-1"></a>                                      ,cal.cbs.dates</span>
<span id="cb60-7"><a href="customer-lifetime-value.html#cb60-7" aria-hidden="true" tabindex="-1"></a>                                      ,<span class="at">per=</span><span class="st">&quot;week&quot;</span>) <span class="co"># we want to see weekly data</span></span></code></pre></div>
<p><em>Notes:</em></p>
<p><em>1. cbs = customer-by-sufficient-statistics</em>
<em>2. We use <code>per = "week"</code> to get data shown per week, as ultimately it show the same as pr. day and returns a more simple data frame.</em></p>
<p>In general the procedure above can be executed in the following command: <code>dc.ElogToCbsCbt()</code>. But they have chosen to show the process, so one is able to make iterations to the data if that is needed in other applications.</p>
</div>
<div id="parameter-estimation-1" class="section level4" number="1.2.2.2">
<h4><span class="header-section-number">1.2.2.2</span> Parameter Estimation</h4>
<p>We use the following formula to estiamte the parameters. They take starting point in par.start = c(1, 3, 1, 3), and iterate from there.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="customer-lifetime-value.html#cb61-1" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">bgnbd.EstimateParameters</span>(cal.cbs);</span>
<span id="cb61-2"><a href="customer-lifetime-value.html#cb61-2" aria-hidden="true" tabindex="-1"></a>params</span></code></pre></div>
<pre><code>##        p1        p2        p3        p4 
## 0.2425982 4.4136842 0.7929899 2.4261667</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="customer-lifetime-value.html#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Log-Likelyhood of parameters</span></span>
<span id="cb63-2"><a href="customer-lifetime-value.html#cb63-2" aria-hidden="true" tabindex="-1"></a>LL <span class="ot">&lt;-</span> <span class="fu">bgnbd.cbs.LL</span>(params, cal.cbs);</span>
<span id="cb63-3"><a href="customer-lifetime-value.html#cb63-3" aria-hidden="true" tabindex="-1"></a>LL</span></code></pre></div>
<pre><code>## [1] -9582.429</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="customer-lifetime-value.html#cb65-1" aria-hidden="true" tabindex="-1"></a>p.matrix <span class="ot">&lt;-</span> <span class="fu">c</span>(params, LL);</span>
<span id="cb65-2"><a href="customer-lifetime-value.html#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="customer-lifetime-value.html#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>){</span>
<span id="cb65-4"><a href="customer-lifetime-value.html#cb65-4" aria-hidden="true" tabindex="-1"></a>  params <span class="ot">&lt;-</span> <span class="fu">bgnbd.EstimateParameters</span>(cal.cbs, params);</span>
<span id="cb65-5"><a href="customer-lifetime-value.html#cb65-5" aria-hidden="true" tabindex="-1"></a>  LL <span class="ot">&lt;-</span> <span class="fu">bgnbd.cbs.LL</span>(params, cal.cbs);</span>
<span id="cb65-6"><a href="customer-lifetime-value.html#cb65-6" aria-hidden="true" tabindex="-1"></a>  p.matrix.row <span class="ot">&lt;-</span> <span class="fu">c</span>(params, LL);</span>
<span id="cb65-7"><a href="customer-lifetime-value.html#cb65-7" aria-hidden="true" tabindex="-1"></a>  p.matrix <span class="ot">&lt;-</span> <span class="fu">rbind</span>(p.matrix, p.matrix.row);</span>
<span id="cb65-8"><a href="customer-lifetime-value.html#cb65-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb65-9"><a href="customer-lifetime-value.html#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(p.matrix) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;r&quot;</span>, <span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;LL&quot;</span>);</span>
<span id="cb65-10"><a href="customer-lifetime-value.html#cb65-10" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(p.matrix) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>;</span>
<span id="cb65-11"><a href="customer-lifetime-value.html#cb65-11" aria-hidden="true" tabindex="-1"></a>p.matrix</span></code></pre></div>
<pre><code>##           r    alpha         a        b        LL
## 1 0.2425982 4.413684 0.7929899 2.426167 -9582.429
## 2 0.2425965 4.413685 0.7929888 2.426166 -9582.429
## 3 0.2425967 4.413659 0.7929869 2.426164 -9582.429</code></pre>
<p>We have the following parameters:</p>
<ul>
<li>r = referring to the transaction - <strong>describes the gamma mixing distribution of the NBD transaction process</strong>. See figure <a href="customer-lifetime-value.html#fig:bgnbd1">1.3</a></li>
<li>alpha = refers to the transaction - <strong>describes the gamma mixing distribution of the NBD transaction process</strong>. See figure <a href="customer-lifetime-value.html#fig:bgnbd1">1.3</a></li>
<li>a = alpha that manipulates the beta distribution - <strong>explains dropout rate</strong>. See figure <a href="customer-lifetime-value.html#fig:bgnbd2">1.4</a></li>
<li>b = beta, that manipulates the beta distribution - <strong>explains dropout rate</strong>. See figure <a href="customer-lifetime-value.html#fig:bgnbd2">1.4</a></li>
</ul>
<p>They mention that it is good to try different starting points, i guess that could merely be incorporated into the loop.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="customer-lifetime-value.html#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bgnbd.PlotTransactionRateHeterogeneity</span>(params)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:bgnbd1"></span>
<img src="Customer-Analytics-Notes_files/figure-html/bgnbd1-1.png" alt="Transaction rate heterogeneity of estimated parameters" width="720" />
<p class="caption">
Figure 1.3: Transaction rate heterogeneity of estimated parameters
</p>
</div>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="customer-lifetime-value.html#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bgnbd.PlotDropoutRateHeterogeneity</span>(params)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:bgnbd2"></span>
<img src="Customer-Analytics-Notes_files/figure-html/bgnbd2-1.png" alt="Dropout probability heterogeneity of estimated parameters" width="720" />
<p class="caption">
Figure 1.4: Dropout probability heterogeneity of estimated parameters
</p>
</div>
</div>
<div id="individual-level-estimation" class="section level4" number="1.2.2.3">
<h4><span class="header-section-number">1.2.2.3</span> Individual Level Estimation</h4>
<p>This is about predicting on individual customer level. First we can estimate the number of transactions we expect a newly acquired customer to make in a give time period.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="customer-lifetime-value.html#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bgnbd.Expectation</span>(params</span>
<span id="cb69-2"><a href="customer-lifetime-value.html#cb69-2" aria-hidden="true" tabindex="-1"></a>                  ,<span class="at">t=</span><span class="dv">52</span>) <span class="co"># = 1 year, has we have 52 weeks</span></span></code></pre></div>
<pre><code>##       p3 
## 1.444004</code></pre>
<p>We see that he is expected to make 1.44 purchases.</p>
<p>The follwing show customer 1516.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="customer-lifetime-value.html#cb71-1" aria-hidden="true" tabindex="-1"></a>cal.cbs[<span class="st">&quot;1516&quot;</span>,]</span></code></pre></div>
<pre><code>##        x      t.x    T.cal 
## 26.00000 30.85714 31.00000</code></pre>
<p>We see that he made 26 repeat transactions in the calibration period. Period 30.8 was the most recent period of a purchase, indicating that he bought towards the end of period 30.</p>
<p>Now we can save the attributes in objects.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="customer-lifetime-value.html#cb73-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> cal.cbs[<span class="st">&quot;1516&quot;</span>, <span class="st">&quot;x&quot;</span>]</span>
<span id="cb73-2"><a href="customer-lifetime-value.html#cb73-2" aria-hidden="true" tabindex="-1"></a>t.x <span class="ot">&lt;-</span> cal.cbs[<span class="st">&quot;1516&quot;</span>, <span class="st">&quot;t.x&quot;</span>]</span>
<span id="cb73-3"><a href="customer-lifetime-value.html#cb73-3" aria-hidden="true" tabindex="-1"></a>T.cal <span class="ot">&lt;-</span> cal.cbs[<span class="st">&quot;1516&quot;</span>, <span class="st">&quot;T.cal&quot;</span>]</span></code></pre></div>
<p>Finally we can calculate the expected number of purchases in the holdout period.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="customer-lifetime-value.html#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bgnbd.ConditionalExpectedTransactions</span>(params</span>
<span id="cb74-2"><a href="customer-lifetime-value.html#cb74-2" aria-hidden="true" tabindex="-1"></a>                                      ,<span class="at">T.star =</span> <span class="dv">52</span> <span class="co">#Prediction period, hence 52 weeks.</span></span>
<span id="cb74-3"><a href="customer-lifetime-value.html#cb74-3" aria-hidden="true" tabindex="-1"></a>                                      ,<span class="at">x =</span> x <span class="co">#No. of repeat trans. in cal. period.</span></span>
<span id="cb74-4"><a href="customer-lifetime-value.html#cb74-4" aria-hidden="true" tabindex="-1"></a>                                      ,<span class="at">t.x =</span> t.x <span class="co">#Most recent period with purchase</span></span>
<span id="cb74-5"><a href="customer-lifetime-value.html#cb74-5" aria-hidden="true" tabindex="-1"></a>                                      ,<span class="at">T.cal =</span> T.cal) <span class="co">#Length of cal. period.</span></span></code></pre></div>
<pre><code>##       p3 
## 25.75659</code></pre>
<p>We see that the customer is expected to make 25.76 purchases in the hold-out-period.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="customer-lifetime-value.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bgnbd.PAlive</span>(<span class="at">params =</span> params</span>
<span id="cb76-2"><a href="customer-lifetime-value.html#cb76-2" aria-hidden="true" tabindex="-1"></a>             ,<span class="at">x =</span> x <span class="co">#No. of repeat transactions in the cal period</span></span>
<span id="cb76-3"><a href="customer-lifetime-value.html#cb76-3" aria-hidden="true" tabindex="-1"></a>             ,<span class="at">t.x =</span> t.x <span class="co">#Time of most recent repeat transaction</span></span>
<span id="cb76-4"><a href="customer-lifetime-value.html#cb76-4" aria-hidden="true" tabindex="-1"></a>             ,<span class="at">T.cal =</span> T.cal) <span class="co">#Length of calibration period</span></span></code></pre></div>
<pre><code>##        p3 
## 0.9688523</code></pre>
<p>We see that there is a probability of 96.8% that he will be alive after the end of the calibration period. That also seems intuitively high, as customer with the most recent transaction was in 38.4, hence this customer must also be close to the end of the calibration period.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="customer-lifetime-value.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">5</span>)){</span>
<span id="cb78-2"><a href="customer-lifetime-value.html#cb78-2" aria-hidden="true" tabindex="-1"></a>  cond.expectation <span class="ot">&lt;-</span> <span class="fu">bgnbd.ConditionalExpectedTransactions</span>(</span>
<span id="cb78-3"><a href="customer-lifetime-value.html#cb78-3" aria-hidden="true" tabindex="-1"></a>  params, <span class="at">T.star =</span> <span class="dv">52</span>, <span class="at">x =</span> i,</span>
<span id="cb78-4"><a href="customer-lifetime-value.html#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">t.x =</span> <span class="dv">20</span>, <span class="at">T.cal =</span> <span class="dv">39</span>)</span>
<span id="cb78-5"><a href="customer-lifetime-value.html#cb78-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span> (<span class="st">&quot;x:&quot;</span>,i,<span class="st">&quot;</span><span class="sc">\t</span><span class="st"> Expectation:&quot;</span>,cond.expectation, <span class="at">fill =</span> <span class="cn">TRUE</span>)</span>
<span id="cb78-6"><a href="customer-lifetime-value.html#cb78-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## x: 10     Expectation: 0.3474606
## x: 15     Expectation: 0.04283391
## x: 20     Expectation: 0.004158973
## x: 25     Expectation: 0.0003583685</code></pre>
<p><strong>I am not entirely sure what is meant by the ‘increasing frequency paradox’ as of the conditional expectation</strong></p>
</div>
<div id="plotting-goodness-of-fit-1" class="section level4" number="1.2.2.4">
<h4><span class="header-section-number">1.2.2.4</span> Plotting / Goodness-of-fit</h4>
<p>First of all we can plot the actual vs. predicted in the calibration period.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="customer-lifetime-value.html#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bgnbd.PlotFrequencyInCalibration</span>(<span class="at">params =</span> params</span>
<span id="cb80-2"><a href="customer-lifetime-value.html#cb80-2" aria-hidden="true" tabindex="-1"></a>                                 ,<span class="at">cal.cbs =</span> cal.cbs</span>
<span id="cb80-3"><a href="customer-lifetime-value.html#cb80-3" aria-hidden="true" tabindex="-1"></a>                                 ,<span class="at">censor =</span> <span class="dv">7</span> <span class="co">#All 7+ are binned.</span></span>
<span id="cb80-4"><a href="customer-lifetime-value.html#cb80-4" aria-hidden="true" tabindex="-1"></a>                                 )</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-49-1.png" width="720" style="display: block; margin: auto;" /></p>
<pre><code>##                freq.0   freq.1   freq.2   freq.3   freq.4   freq.5   freq.6
## n.x.actual   1411.000 439.0000 214.0000 100.0000 62.00000 38.00000 29.00000
## n.x.expected 1407.682 460.3225 192.4637 101.1657 59.84786 38.12006 25.54923
##               freq.7+
## n.x.actual   64.00000
## n.x.expected 71.22628</code></pre>
<p>We see that the model replicates the variance that we observe in the data very well.</p>
<p>What we see is amount of customers on y and amount of transactinos in training period.</p>
<p>Now we construct the hold/out period.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="customer-lifetime-value.html#cb82-1" aria-hidden="true" tabindex="-1"></a>elog <span class="ot">&lt;-</span> <span class="fu">dc.SplitUpElogForRepeatTrans</span>(elog)<span class="sc">$</span>repeat.trans.elog;</span>
<span id="cb82-2"><a href="customer-lifetime-value.html#cb82-2" aria-hidden="true" tabindex="-1"></a>x.star <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(cal.cbs));</span>
<span id="cb82-3"><a href="customer-lifetime-value.html#cb82-3" aria-hidden="true" tabindex="-1"></a>cal.cbs <span class="ot">&lt;-</span> <span class="fu">cbind</span>(cal.cbs, x.star);</span>
<span id="cb82-4"><a href="customer-lifetime-value.html#cb82-4" aria-hidden="true" tabindex="-1"></a>elog.custs <span class="ot">&lt;-</span> elog<span class="sc">$</span>cust;</span>
<span id="cb82-5"><a href="customer-lifetime-value.html#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(cal.cbs)){</span>
<span id="cb82-6"><a href="customer-lifetime-value.html#cb82-6" aria-hidden="true" tabindex="-1"></a>  current.cust <span class="ot">&lt;-</span> <span class="fu">rownames</span>(cal.cbs)[i]</span>
<span id="cb82-7"><a href="customer-lifetime-value.html#cb82-7" aria-hidden="true" tabindex="-1"></a>  tot.cust.trans <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">which</span>(elog.custs <span class="sc">==</span> current.cust))</span>
<span id="cb82-8"><a href="customer-lifetime-value.html#cb82-8" aria-hidden="true" tabindex="-1"></a>  cal.trans <span class="ot">&lt;-</span> cal.cbs[i, <span class="st">&quot;x&quot;</span>]</span>
<span id="cb82-9"><a href="customer-lifetime-value.html#cb82-9" aria-hidden="true" tabindex="-1"></a>  cal.cbs[i, <span class="st">&quot;x.star&quot;</span>] <span class="ot">&lt;-</span> tot.cust.trans <span class="sc">-</span> cal.trans</span>
<span id="cb82-10"><a href="customer-lifetime-value.html#cb82-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb82-11"><a href="customer-lifetime-value.html#cb82-11" aria-hidden="true" tabindex="-1"></a>cal.cbs[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,]</span></code></pre></div>
<pre><code>##   x       t.x    T.cal x.star
## 1 2 30.428571 38.85714      1
## 2 1  1.714286 38.85714      0
## 3 0  0.000000 38.85714      0</code></pre>
<p>We fill in the characteristics to the model. And we can plot</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="customer-lifetime-value.html#cb84-1" aria-hidden="true" tabindex="-1"></a>T.star <span class="ot">&lt;-</span> <span class="dv">39</span> <span class="co"># length of the holdout period</span></span>
<span id="cb84-2"><a href="customer-lifetime-value.html#cb84-2" aria-hidden="true" tabindex="-1"></a>censor <span class="ot">&lt;-</span> <span class="dv">7</span> <span class="co"># This censor serves the same purpose described above</span></span>
<span id="cb84-3"><a href="customer-lifetime-value.html#cb84-3" aria-hidden="true" tabindex="-1"></a>x.star <span class="ot">&lt;-</span> cal.cbs[,<span class="st">&quot;x.star&quot;</span>]</span>
<span id="cb84-4"><a href="customer-lifetime-value.html#cb84-4" aria-hidden="true" tabindex="-1"></a>comp <span class="ot">&lt;-</span> <span class="fu">bgnbd.PlotFreqVsConditionalExpectedFrequency</span>(params</span>
<span id="cb84-5"><a href="customer-lifetime-value.html#cb84-5" aria-hidden="true" tabindex="-1"></a>                                                     ,T.star</span>
<span id="cb84-6"><a href="customer-lifetime-value.html#cb84-6" aria-hidden="true" tabindex="-1"></a>                                                     ,cal.cbs</span>
<span id="cb84-7"><a href="customer-lifetime-value.html#cb84-7" aria-hidden="true" tabindex="-1"></a>                                                     ,x.star</span>
<span id="cb84-8"><a href="customer-lifetime-value.html#cb84-8" aria-hidden="true" tabindex="-1"></a>                                                     ,censor)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-51"></span>
<img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-51-1.png" alt="Actual vs. conditional expected transactions in the holdout period." width="720" />
<p class="caption">
Figure 1.5: Actual vs. conditional expected transactions in the holdout period.
</p>
</div>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="customer-lifetime-value.html#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(comp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;act&quot;</span>, <span class="st">&quot;exp&quot;</span>, <span class="st">&quot;bin&quot;</span>)</span>
<span id="cb85-2"><a href="customer-lifetime-value.html#cb85-2" aria-hidden="true" tabindex="-1"></a>comp</span></code></pre></div>
<pre><code>##           freq.0      freq.1     freq.2     freq.3    freq.4    freq.5
## act    0.2367116   0.6970387   1.392523   1.560000  2.532258  2.947368
## exp    0.2250893   0.5231364   1.044126   1.520256  2.163824  2.653789
## bin 1411.0000000 439.0000000 214.000000 100.000000 62.000000 38.000000
##        freq.6   freq.7+
## act  3.862069  6.359375
## exp  3.503957  6.157036
## bin 29.000000 64.000000</code></pre>
<p>Now we can assess how well the our model predict how many transactions will occur in each week.</p>
<p>First, we need to convert the total transactions pr. day into a customer-by-time matrix (cbt). And then we can transform them into weekly observations instead of daily.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="customer-lifetime-value.html#cb87-1" aria-hidden="true" tabindex="-1"></a>tot.cbt <span class="ot">&lt;-</span> <span class="fu">dc.CreateFreqCBT</span>(elog)</span></code></pre></div>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="customer-lifetime-value.html#cb88-1" aria-hidden="true" tabindex="-1"></a>d.track.data <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">7</span> <span class="sc">*</span> <span class="dv">78</span>) <span class="co">#Corresponding to the amount of daily transactions in the holdout</span></span>
<span id="cb88-2"><a href="customer-lifetime-value.html#cb88-2" aria-hidden="true" tabindex="-1"></a>origin <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;1997-01-01&quot;</span>)</span>
<span id="cb88-3"><a href="customer-lifetime-value.html#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">colnames</span>(tot.cbt)){</span>
<span id="cb88-4"><a href="customer-lifetime-value.html#cb88-4" aria-hidden="true" tabindex="-1"></a>  date.index <span class="ot">&lt;-</span> <span class="fu">difftime</span>(<span class="fu">as.Date</span>(i), origin) <span class="sc">+</span> <span class="dv">1</span>;</span>
<span id="cb88-5"><a href="customer-lifetime-value.html#cb88-5" aria-hidden="true" tabindex="-1"></a>  d.track.data[date.index] <span class="ot">&lt;-</span> <span class="fu">sum</span>(tot.cbt[,i]);</span>
<span id="cb88-6"><a href="customer-lifetime-value.html#cb88-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb88-7"><a href="customer-lifetime-value.html#cb88-7" aria-hidden="true" tabindex="-1"></a>w.track.data <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">78</span>)</span>
<span id="cb88-8"><a href="customer-lifetime-value.html#cb88-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">78</span>){</span>
<span id="cb88-9"><a href="customer-lifetime-value.html#cb88-9" aria-hidden="true" tabindex="-1"></a>  w.track.data[j] <span class="ot">&lt;-</span> <span class="fu">sum</span>(d.track.data[(j<span class="sc">*</span><span class="dv">7-6</span>)<span class="sc">:</span>(j<span class="sc">*</span><span class="dv">7</span>)])</span>
<span id="cb88-10"><a href="customer-lifetime-value.html#cb88-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Now we can plot and compare the number of transactions with the predicted (expected).</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="customer-lifetime-value.html#cb89-1" aria-hidden="true" tabindex="-1"></a>T.cal <span class="ot">&lt;-</span> cal.cbs[,<span class="st">&quot;T.cal&quot;</span>]</span>
<span id="cb89-2"><a href="customer-lifetime-value.html#cb89-2" aria-hidden="true" tabindex="-1"></a>T.tot <span class="ot">&lt;-</span> <span class="dv">78</span> <span class="co">#78 because we have 78 weeks in total, if daily then 7*78=546</span></span>
<span id="cb89-3"><a href="customer-lifetime-value.html#cb89-3" aria-hidden="true" tabindex="-1"></a>n.periods.final <span class="ot">&lt;-</span> <span class="dv">78</span> <span class="co">#Notice, often this will just be the same, but does not have to be</span></span>
<span id="cb89-4"><a href="customer-lifetime-value.html#cb89-4" aria-hidden="true" tabindex="-1"></a>inc.tracking <span class="ot">&lt;-</span> <span class="fu">bgnbd.PlotTrackingInc</span>(params, T.cal</span>
<span id="cb89-5"><a href="customer-lifetime-value.html#cb89-5" aria-hidden="true" tabindex="-1"></a>                                      ,T.tot, w.track.data</span>
<span id="cb89-6"><a href="customer-lifetime-value.html#cb89-6" aria-hidden="true" tabindex="-1"></a>                                      ,n.periods.final)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-55"></span>
<img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-55-1.png" alt="Actual vs. expected incremental purchasing behaviour." width="720" />
<p class="caption">
Figure 1.6: Actual vs. expected incremental purchasing behaviour.
</p>
</div>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="customer-lifetime-value.html#cb90-1" aria-hidden="true" tabindex="-1"></a>inc.tracking[,<span class="dv">20</span><span class="sc">:</span><span class="dv">25</span>]</span></code></pre></div>
<pre><code>##              [,1]     [,2]     [,3]     [,4]     [,5]     [,6]
## actual   73.00000 55.00000 70.00000 33.00000 56.00000 99.00000
## expected 76.86531 74.88843 73.04554 71.32166 69.70412 68.18213</code></pre>
<p>We can now plot the following with the actual vs. the expected (predicted).</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="customer-lifetime-value.html#cb92-1" aria-hidden="true" tabindex="-1"></a>cum.tracking.data <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(w.track.data)</span>
<span id="cb92-2"><a href="customer-lifetime-value.html#cb92-2" aria-hidden="true" tabindex="-1"></a>cum.tracking <span class="ot">&lt;-</span> <span class="fu">bgnbd.PlotTrackingCum</span>(params, T.cal</span>
<span id="cb92-3"><a href="customer-lifetime-value.html#cb92-3" aria-hidden="true" tabindex="-1"></a>                                      ,T.tot, cum.tracking.data</span>
<span id="cb92-4"><a href="customer-lifetime-value.html#cb92-4" aria-hidden="true" tabindex="-1"></a>                                      ,n.periods.final)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-56"></span>
<img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-56-1.png" alt="Actual vs. expected cumulative purchasing behaviour." width="720" />
<p class="caption">
Figure 1.7: Actual vs. expected cumulative purchasing behaviour.
</p>
</div>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="customer-lifetime-value.html#cb93-1" aria-hidden="true" tabindex="-1"></a>cum.tracking[,<span class="dv">20</span><span class="sc">:</span><span class="dv">25</span>]</span></code></pre></div>
<pre><code>##              [,1]     [,2]     [,3]     [,4]     [,5]   [,6]
## actual   1359.000 1414.000 1484.000 1517.000 1573.000 1672.0
## expected 1312.458 1387.346 1460.392 1531.713 1601.418 1669.6</code></pre>
<p><em>Notice that the dashed line show the shift from calibration to hold out sample.</em></p>
<p>We see that our model fits the data very well! And also captures the trend.</p>
</div>
</div>
<div id="bgbb" class="section level3" number="1.2.3">
<h3><span class="header-section-number">1.2.3</span> BG/BB</h3>
<p><strong>I am not sure if this is a part of the curriculum</strong></p>
<div id="data-preparation-2" class="section level4" number="1.2.3.1">
<h4><span class="header-section-number">1.2.3.1</span> Data Preparation</h4>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="customer-lifetime-value.html#cb95-1" aria-hidden="true" tabindex="-1"></a>simElog <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;data/discreteSimElog.csv&quot;</span></span>
<span id="cb95-2"><a href="customer-lifetime-value.html#cb95-2" aria-hidden="true" tabindex="-1"></a>                       ,<span class="at">package =</span> <span class="st">&quot;BTYD&quot;</span>)</span>
<span id="cb95-3"><a href="customer-lifetime-value.html#cb95-3" aria-hidden="true" tabindex="-1"></a>elog <span class="ot">&lt;-</span> <span class="fu">dc.ReadLines</span>(simElog, <span class="at">cust.idx =</span> <span class="dv">1</span>, <span class="at">date.idx =</span> <span class="dv">2</span>)</span>
<span id="cb95-4"><a href="customer-lifetime-value.html#cb95-4" aria-hidden="true" tabindex="-1"></a>elog[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,]</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="left">cust</th>
<th align="left">date</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">1970-01-01</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">1975-01-01</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">1977-01-01</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="customer-lifetime-value.html#cb96-1" aria-hidden="true" tabindex="-1"></a>elog<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(elog<span class="sc">$</span>date, <span class="st">&quot;%Y-%m-%d&quot;</span>)</span>
<span id="cb96-2"><a href="customer-lifetime-value.html#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(elog<span class="sc">$</span>date);</span></code></pre></div>
<pre><code>## [1] &quot;1983-01-01&quot;</code></pre>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="customer-lifetime-value.html#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(elog<span class="sc">$</span>date);</span></code></pre></div>
<pre><code>## [1] &quot;1970-01-01&quot;</code></pre>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="customer-lifetime-value.html#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># let&#39;s make the calibration period end somewhere in-between</span></span>
<span id="cb100-2"><a href="customer-lifetime-value.html#cb100-2" aria-hidden="true" tabindex="-1"></a>T.cal <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;1977-01-01&quot;</span>)</span>
<span id="cb100-3"><a href="customer-lifetime-value.html#cb100-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-4"><a href="customer-lifetime-value.html#cb100-4" aria-hidden="true" tabindex="-1"></a>simData <span class="ot">&lt;-</span> <span class="fu">dc.ElogToCbsCbt</span>(elog, <span class="at">per=</span><span class="st">&quot;year&quot;</span>, T.cal)</span>
<span id="cb100-5"><a href="customer-lifetime-value.html#cb100-5" aria-hidden="true" tabindex="-1"></a>cal.cbs <span class="ot">&lt;-</span> simData<span class="sc">$</span>cal<span class="sc">$</span>cbs</span>
<span id="cb100-6"><a href="customer-lifetime-value.html#cb100-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-7"><a href="customer-lifetime-value.html#cb100-7" aria-hidden="true" tabindex="-1"></a>freq<span class="ot">&lt;-</span> cal.cbs[,<span class="st">&quot;x&quot;</span>]</span>
<span id="cb100-8"><a href="customer-lifetime-value.html#cb100-8" aria-hidden="true" tabindex="-1"></a>rec <span class="ot">&lt;-</span> cal.cbs[,<span class="st">&quot;t.x&quot;</span>]</span>
<span id="cb100-9"><a href="customer-lifetime-value.html#cb100-9" aria-hidden="true" tabindex="-1"></a>trans.opp <span class="ot">&lt;-</span> <span class="dv">7</span> <span class="co"># transaction opportunities</span></span>
<span id="cb100-10"><a href="customer-lifetime-value.html#cb100-10" aria-hidden="true" tabindex="-1"></a>cal.rf.matrix <span class="ot">&lt;-</span> <span class="fu">dc.MakeRFmatrixCal</span>(freq, rec, trans.opp)</span>
<span id="cb100-11"><a href="customer-lifetime-value.html#cb100-11" aria-hidden="true" tabindex="-1"></a>cal.rf.matrix[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span></code></pre></div>
<pre><code>##      x t.x n.cal custs
## [1,] 0   0     7  2900
## [2,] 1   1     7   933
## [3,] 1   2     7   218
## [4,] 2   2     7   489
## [5,] 1   3     7    95</code></pre>
</div>
<div id="parameter-estimation-2" class="section level4" number="1.2.3.2">
<h4><span class="header-section-number">1.2.3.2</span> Parameter Estimation</h4>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="customer-lifetime-value.html#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(donationsSummary);</span>
<span id="cb102-2"><a href="customer-lifetime-value.html#cb102-2" aria-hidden="true" tabindex="-1"></a>rf.matrix <span class="ot">&lt;-</span> donationsSummary<span class="sc">$</span>rf.matrix</span>
<span id="cb102-3"><a href="customer-lifetime-value.html#cb102-3" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">bgbb.EstimateParameters</span>(rf.matrix);</span>
<span id="cb102-4"><a href="customer-lifetime-value.html#cb102-4" aria-hidden="true" tabindex="-1"></a>LL <span class="ot">&lt;-</span> <span class="fu">bgbb.rf.matrix.LL</span>(params, rf.matrix);</span>
<span id="cb102-5"><a href="customer-lifetime-value.html#cb102-5" aria-hidden="true" tabindex="-1"></a>p.matrix <span class="ot">&lt;-</span> <span class="fu">c</span>(params, LL);</span>
<span id="cb102-6"><a href="customer-lifetime-value.html#cb102-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-7"><a href="customer-lifetime-value.html#cb102-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>){</span>
<span id="cb102-8"><a href="customer-lifetime-value.html#cb102-8" aria-hidden="true" tabindex="-1"></a>  params <span class="ot">&lt;-</span> <span class="fu">bgbb.EstimateParameters</span>(rf.matrix, params);</span>
<span id="cb102-9"><a href="customer-lifetime-value.html#cb102-9" aria-hidden="true" tabindex="-1"></a>  LL <span class="ot">&lt;-</span> <span class="fu">bgbb.rf.matrix.LL</span>(params, rf.matrix);</span>
<span id="cb102-10"><a href="customer-lifetime-value.html#cb102-10" aria-hidden="true" tabindex="-1"></a>  p.matrix.row <span class="ot">&lt;-</span> <span class="fu">c</span>(params, LL);</span>
<span id="cb102-11"><a href="customer-lifetime-value.html#cb102-11" aria-hidden="true" tabindex="-1"></a>  p.matrix <span class="ot">&lt;-</span> <span class="fu">rbind</span>(p.matrix, p.matrix.row);</span>
<span id="cb102-12"><a href="customer-lifetime-value.html#cb102-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb102-13"><a href="customer-lifetime-value.html#cb102-13" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(p.matrix) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;beta&quot;</span>, <span class="st">&quot;gamma&quot;</span>, <span class="st">&quot;delta&quot;</span>, <span class="st">&quot;LL&quot;</span>);</span>
<span id="cb102-14"><a href="customer-lifetime-value.html#cb102-14" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(p.matrix) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>;</span>
<span id="cb102-15"><a href="customer-lifetime-value.html#cb102-15" aria-hidden="true" tabindex="-1"></a>p.matrix;</span></code></pre></div>
<pre><code>##      alpha      beta     gamma    delta        LL
## 1 1.203507 0.7497667 0.6567568 2.783887 -33225.58
## 2 1.203533 0.7497272 0.6567788 2.783812 -33225.58
## 3 1.203528 0.7497260 0.6567808 2.783796 -33225.58</code></pre>
</div>
<div id="individual-level-estimations-1" class="section level4" number="1.2.3.3">
<h4><span class="header-section-number">1.2.3.3</span> Individual Level Estimations</h4>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="customer-lifetime-value.html#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bgbb.Expectation</span>(params, <span class="at">n=</span><span class="dv">10</span>);</span></code></pre></div>
<pre><code>## [1] 3.179805</code></pre>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="customer-lifetime-value.html#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># customer A</span></span>
<span id="cb106-2"><a href="customer-lifetime-value.html#cb106-2" aria-hidden="true" tabindex="-1"></a>n.cal <span class="ot">=</span> <span class="dv">6</span></span>
<span id="cb106-3"><a href="customer-lifetime-value.html#cb106-3" aria-hidden="true" tabindex="-1"></a>n.star <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb106-4"><a href="customer-lifetime-value.html#cb106-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb106-5"><a href="customer-lifetime-value.html#cb106-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-6"><a href="customer-lifetime-value.html#cb106-6" aria-hidden="true" tabindex="-1"></a>t.x <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb106-7"><a href="customer-lifetime-value.html#cb106-7" aria-hidden="true" tabindex="-1"></a><span class="fu">bgbb.ConditionalExpectedTransactions</span>(params, n.cal</span>
<span id="cb106-8"><a href="customer-lifetime-value.html#cb106-8" aria-hidden="true" tabindex="-1"></a>                                     ,n.star, x, t.x)</span></code></pre></div>
<pre><code>## [1] 0.1302169</code></pre>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="customer-lifetime-value.html#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># customer B</span></span>
<span id="cb108-2"><a href="customer-lifetime-value.html#cb108-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="dv">4</span></span>
<span id="cb108-3"><a href="customer-lifetime-value.html#cb108-3" aria-hidden="true" tabindex="-1"></a>t.x <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb108-4"><a href="customer-lifetime-value.html#cb108-4" aria-hidden="true" tabindex="-1"></a><span class="fu">bgbb.ConditionalExpectedTransactions</span>(params, n.cal</span>
<span id="cb108-5"><a href="customer-lifetime-value.html#cb108-5" aria-hidden="true" tabindex="-1"></a>                                     ,n.star, x, t.x)</span></code></pre></div>
<pre><code>## [1] 3.627858</code></pre>
</div>
<div id="plotting-goodness-of-fit-2" class="section level4" number="1.2.3.4">
<h4><span class="header-section-number">1.2.3.4</span> Plotting / Goodness-of-fit</h4>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="customer-lifetime-value.html#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bgbb.PlotFrequencyInCalibration</span>(params, rf.matrix)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-65-1.png" width="720" style="display: block; margin: auto;" /></p>
<pre><code>##                           0        1        2        3        4        5
## actual.frequency   3464.000 1823.000 1430.000 1085.000 1036.000 1063.000
## expected.frequency 3454.848 1888.678 1348.904 1113.392 1017.928 1027.162
##                           6
## actual.frequency   1203.000
## expected.frequency 1253.088</code></pre>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="customer-lifetime-value.html#cb112-1" aria-hidden="true" tabindex="-1"></a>holdout.cbs <span class="ot">&lt;-</span> simData<span class="sc">$</span>holdout<span class="sc">$</span>cbs</span>
<span id="cb112-2"><a href="customer-lifetime-value.html#cb112-2" aria-hidden="true" tabindex="-1"></a>x.star <span class="ot">&lt;-</span> holdout.cbs[,<span class="st">&quot;x.star&quot;</span>]</span></code></pre></div>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="customer-lifetime-value.html#cb113-1" aria-hidden="true" tabindex="-1"></a>n.star <span class="ot">&lt;-</span> <span class="dv">5</span> <span class="co"># length of the holdout period</span></span>
<span id="cb113-2"><a href="customer-lifetime-value.html#cb113-2" aria-hidden="true" tabindex="-1"></a>x.star <span class="ot">&lt;-</span> donationsSummary<span class="sc">$</span>x.star</span>
<span id="cb113-3"><a href="customer-lifetime-value.html#cb113-3" aria-hidden="true" tabindex="-1"></a>comp <span class="ot">&lt;-</span> <span class="fu">bgbb.PlotFreqVsConditionalExpectedFrequency</span>(params, n.star,</span>
<span id="cb113-4"><a href="customer-lifetime-value.html#cb113-4" aria-hidden="true" tabindex="-1"></a>rf.matrix, x.star)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-67-1.png" width="720" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="customer-lifetime-value.html#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(comp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;act&quot;</span>, <span class="st">&quot;exp&quot;</span>, <span class="st">&quot;bin&quot;</span>)</span>
<span id="cb114-2"><a href="customer-lifetime-value.html#cb114-2" aria-hidden="true" tabindex="-1"></a>comp</span></code></pre></div>
<pre><code>##           freq.0       freq.1       freq.2      freq.3      freq.4      freq.5
## act 1.743649e-01    0.4328031    0.8125874    1.389862    2.061776    2.642521
## exp 7.286318e-02    0.3248841    0.7089417    1.333666    2.031203    2.784482
## bin 3.464000e+03 1823.0000000 1430.0000000 1085.000000 1036.000000 1063.000000
##          freq.6
## act    3.534497
## exp    3.752500
## bin 1203.000000</code></pre>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="customer-lifetime-value.html#cb116-1" aria-hidden="true" tabindex="-1"></a>comp <span class="ot">&lt;-</span> <span class="fu">bgbb.PlotRecVsConditionalExpectedFrequency</span>(params, n.star,</span>
<span id="cb116-2"><a href="customer-lifetime-value.html#cb116-2" aria-hidden="true" tabindex="-1"></a>rf.matrix, x.star)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-69-1.png" width="720" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="customer-lifetime-value.html#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(comp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;act&quot;</span>, <span class="st">&quot;exp&quot;</span>, <span class="st">&quot;bin&quot;</span>)</span>
<span id="cb117-2"><a href="customer-lifetime-value.html#cb117-2" aria-hidden="true" tabindex="-1"></a>comp</span></code></pre></div>
<pre><code>##            rec.0        rec.1       rec.2       rec.3       rec.4       rec.5
## act 1.743649e-01    0.2181485   0.3898876   0.4872521   0.8088685    1.652289
## exp 7.286318e-02    0.0856939   0.1798423   0.4041111   0.8510811    1.726323
## bin 3.464000e+03 1091.0000000 890.0000000 706.0000000 654.0000000 1136.000000
##           rec.6
## act    2.946886
## exp    3.027190
## bin 3163.000000</code></pre>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="customer-lifetime-value.html#cb119-1" aria-hidden="true" tabindex="-1"></a>inc.track.data <span class="ot">&lt;-</span> donationsSummary<span class="sc">$</span>annual.trans</span>
<span id="cb119-2"><a href="customer-lifetime-value.html#cb119-2" aria-hidden="true" tabindex="-1"></a>n.cal <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb119-3"><a href="customer-lifetime-value.html#cb119-3" aria-hidden="true" tabindex="-1"></a>xtickmarks <span class="ot">&lt;-</span> <span class="dv">1996</span><span class="sc">:</span><span class="dv">2006</span></span>
<span id="cb119-4"><a href="customer-lifetime-value.html#cb119-4" aria-hidden="true" tabindex="-1"></a>inc.tracking <span class="ot">&lt;-</span> <span class="fu">bgbb.PlotTrackingInc</span>(params, rf.matrix</span>
<span id="cb119-5"><a href="customer-lifetime-value.html#cb119-5" aria-hidden="true" tabindex="-1"></a>                                     ,inc.track.data</span>
<span id="cb119-6"><a href="customer-lifetime-value.html#cb119-6" aria-hidden="true" tabindex="-1"></a>                                     ,<span class="at">xticklab =</span> xtickmarks)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-71-1.png" width="720" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="customer-lifetime-value.html#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(inc.tracking) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;act&quot;</span>, <span class="st">&quot;exp&quot;</span>)</span>
<span id="cb120-2"><a href="customer-lifetime-value.html#cb120-2" aria-hidden="true" tabindex="-1"></a>inc.tracking</span></code></pre></div>
<pre><code>##         [,1]     [,2]     [,3]     [,4]     [,5]     [,6]     [,7]     [,8]
## act 5652.000 4674.000 4019.000 3552.000 3555.000 3163.000 3110.000 2938.000
## exp 5535.833 4717.059 4147.621 3724.665 3395.888 3131.647 2913.778 2730.482
##         [,9]    [,10]    [,11]
## act 2703.000 2573.000 1936.000
## exp 2573.731 2437.854 2318.727</code></pre>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="customer-lifetime-value.html#cb122-1" aria-hidden="true" tabindex="-1"></a>cum.track.data <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(inc.track.data)</span>
<span id="cb122-2"><a href="customer-lifetime-value.html#cb122-2" aria-hidden="true" tabindex="-1"></a>cum.tracking <span class="ot">&lt;-</span> <span class="fu">bgbb.PlotTrackingCum</span>(params, rf.matrix, cum.track.data</span>
<span id="cb122-3"><a href="customer-lifetime-value.html#cb122-3" aria-hidden="true" tabindex="-1"></a>                                     ,<span class="at">xticklab =</span> xtickmarks)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-73-1.png" width="720" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="customer-lifetime-value.html#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(cum.tracking) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;act&quot;</span>, <span class="st">&quot;exp&quot;</span>)</span>
<span id="cb123-2"><a href="customer-lifetime-value.html#cb123-2" aria-hidden="true" tabindex="-1"></a>cum.tracking</span></code></pre></div>
<pre><code>##         [,1]     [,2]     [,3]     [,4]     [,5]     [,6]     [,7]     [,8]
## act 5652.000 10326.00 14345.00 17897.00 21452.00 24615.00 27725.00 30663.00
## exp 5535.833 10252.89 14400.51 18125.18 21521.07 24652.71 27566.49 30296.97
##        [,9]    [,10]    [,11]
## act 33366.0 35939.00 37875.00
## exp 32870.7 35308.56 37627.29</code></pre>
</div>
</div>
<div id="examples-from-the-lecture" class="section level3" number="1.2.4">
<h3><span class="header-section-number">1.2.4</span> Examples from the lecture</h3>
<div id="paretonbd-1" class="section level4" number="1.2.4.1">
<h4><span class="header-section-number">1.2.4.1</span> Pareto/NBD</h4>
<p>PREDICTING LONG TERM CUSTOMER VALUE WITH BTYD PACKAGE</p>
<ul>
<li>Pareto/NBD (negative binomial distribution) modeling of</li>
<li>repeat-buying behavior in a noncontractual setting</li>
</ul>
<p>Based on Schmittlein, Morrison, and Colombo (1987), “Counting Your Customers:
Who Are They and What Will They Do Next?” Management Science, 33, 1-24.</p>
<p>Required data for model is:</p>
<p>“customer-by-sufficient-statistic” (cbs) matrix with the ‘sufficient’ stats being: <strong>This is the most important table, this is the information that is needed to run the model.</strong></p>
<ul>
<li>frequency of transaction (no of repeat transactions)</li>
<li>recency (time of last transaction) and</li>
<li>total time observed</li>
</ul>
<p>Main model params are:</p>
<ul>
<li>beta unobserved shape parameter for Pareto dropout process</li>
<li>s unobserved scale parameter for Pareto dropout process</li>
<li>r unobserved shape parameter for NBD transaction</li>
<li>alpha unobserved scale parameter for NBD transaction</li>
</ul>
<p>Data are divided into earlier calibration and later holdout segments,
using a single date as the cut point. “cal” data are used
to predict “holdout” data</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="customer-lifetime-value.html#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(BTYD)</span>
<span id="cb125-2"><a href="customer-lifetime-value.html#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in data</span></span>
<span id="cb125-3"><a href="customer-lifetime-value.html#cb125-3" aria-hidden="true" tabindex="-1"></a>cdnowElog <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;data/cdnowElog.csv&quot;</span>, <span class="at">package =</span> <span class="st">&quot;BTYD&quot;</span>)</span>
<span id="cb125-4"><a href="customer-lifetime-value.html#cb125-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-5"><a href="customer-lifetime-value.html#cb125-5" aria-hidden="true" tabindex="-1"></a><span class="co"># The raw data file</span></span>
<span id="cb125-6"><a href="customer-lifetime-value.html#cb125-6" aria-hidden="true" tabindex="-1"></a>raw <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(cdnowElog)</span>
<span id="cb125-7"><a href="customer-lifetime-value.html#cb125-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(raw)</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">masterid</th>
<th align="right">sampleid</th>
<th align="right">date</th>
<th align="right">cds</th>
<th align="right">sales</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">4</td>
<td align="right">1</td>
<td align="right">19970101</td>
<td align="right">2</td>
<td align="right">29.33</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">1</td>
<td align="right">19970118</td>
<td align="right">2</td>
<td align="right">29.73</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">1</td>
<td align="right">19970802</td>
<td align="right">1</td>
<td align="right">14.96</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">1</td>
<td align="right">19971212</td>
<td align="right">2</td>
<td align="right">26.48</td>
</tr>
<tr class="odd">
<td align="right">21</td>
<td align="right">2</td>
<td align="right">19970101</td>
<td align="right">3</td>
<td align="right">63.34</td>
</tr>
<tr class="even">
<td align="right">21</td>
<td align="right">2</td>
<td align="right">19970113</td>
<td align="right">1</td>
<td align="right">11.77</td>
</tr>
</tbody>
</table>
</div>
<p>We see the id of the customer and the date of transactions, and also amount of cd’s purchases and with the amount of sale.s</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="customer-lifetime-value.html#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create event log from file &quot;cdnowElog.csv&quot;, which has</span></span>
<span id="cb126-2"><a href="customer-lifetime-value.html#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="co"># customer IDs in the second column, dates in the third column, and</span></span>
<span id="cb126-3"><a href="customer-lifetime-value.html#cb126-3" aria-hidden="true" tabindex="-1"></a><span class="co"># sales numbers in the fifth column.</span></span>
<span id="cb126-4"><a href="customer-lifetime-value.html#cb126-4" aria-hidden="true" tabindex="-1"></a>elog <span class="ot">&lt;-</span> <span class="fu">dc.ReadLines</span>(<span class="fu">system.file</span>(<span class="st">&quot;data/cdnowElog.csv&quot;</span>, <span class="at">package=</span><span class="st">&quot;BTYD&quot;</span>),<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">5</span>)</span>
<span id="cb126-5"><a href="customer-lifetime-value.html#cb126-5" aria-hidden="true" tabindex="-1"></a>elog[,<span class="st">&quot;date&quot;</span>] <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(elog[,<span class="st">&quot;date&quot;</span>], <span class="st">&quot;%Y%m%d&quot;</span>)</span>
<span id="cb126-6"><a href="customer-lifetime-value.html#cb126-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-7"><a href="customer-lifetime-value.html#cb126-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(elog)  <span class="co">#take a look on the raw data</span></span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="left">cust</th>
<th align="left">date</th>
<th align="right">sales</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">1997-01-01</td>
<td align="right">29.33</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">1997-01-18</td>
<td align="right">29.73</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">1997-08-02</td>
<td align="right">14.96</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">1997-12-12</td>
<td align="right">26.48</td>
</tr>
<tr class="odd">
<td align="left">2</td>
<td align="left">1997-01-01</td>
<td align="right">63.34</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">1997-01-13</td>
<td align="right">11.77</td>
</tr>
</tbody>
</table>
</div>
<p>This is a new dataset where we have changed the names and formated the date.</p>
<p><strong>Notice, that this should be the format of all tables if you want to run the model</strong></p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="customer-lifetime-value.html#cb127-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">dc.ElogToCbsCbt</span>(elog, <span class="at">per=</span><span class="st">&quot;week&quot;</span>, <span class="at">T.cal=</span><span class="fu">as.Date</span>(<span class="st">&quot;1997-09-30&quot;</span>))</span>
<span id="cb127-2"><a href="customer-lifetime-value.html#cb127-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-3"><a href="customer-lifetime-value.html#cb127-3" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(data)</span></code></pre></div>
<pre><code>## $names
## [1] &quot;cal&quot;       &quot;holdout&quot;   &quot;cust.data&quot;</code></pre>
<p>We see that we have different attributes on the data. Notice that it is stored as a list.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="customer-lifetime-value.html#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(data<span class="sc">$</span>cal)</span></code></pre></div>
<pre><code>## $names
## [1] &quot;cbs&quot; &quot;cbt&quot;</code></pre>
<p>We see that the calibration data has both tables cbs and cbt.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="customer-lifetime-value.html#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data<span class="sc">$</span>cal<span class="sc">$</span>cbs) <span class="co">#take a look on the calibration data</span></span></code></pre></div>
<pre><code>##   x       t.x    T.cal
## 1 2 30.428571 38.85714
## 2 1  1.714286 38.85714
## 3 0  0.000000 38.85714
## 4 0  0.000000 38.85714
## 5 0  0.000000 38.85714
## 6 7 29.428571 38.85714</code></pre>
<p>We get the information:</p>
<ul>
<li>x = number of transactions. We see that there are only two transactions now, before we had 4, that is because one is in the hold out sample and we removed the first transaction.</li>
</ul>
<div id="estimate-parameters-for-paretonbd-model-based-upon-calibration-data" class="section level5" number="1.2.4.1.1">
<h5><span class="header-section-number">1.2.4.1.1</span> Estimate parameters for Pareto/NBD model based upon calibration data</h5>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="customer-lifetime-value.html#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co"># initial estimate</span></span>
<span id="cb133-2"><a href="customer-lifetime-value.html#cb133-2" aria-hidden="true" tabindex="-1"></a>(params2 <span class="ot">&lt;-</span> <span class="fu">pnbd.EstimateParameters</span>(data<span class="sc">$</span>cal<span class="sc">$</span>cbs))</span></code></pre></div>
<pre><code>## [1]  0.5533971 10.5801985  0.6060625 11.6562237</code></pre>
<p>We see the four params in the following order, r, alpha, s, beta</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="customer-lifetime-value.html#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co"># look at log likelihood</span></span>
<span id="cb135-2"><a href="customer-lifetime-value.html#cb135-2" aria-hidden="true" tabindex="-1"></a>(LL <span class="ot">&lt;-</span> <span class="fu">pnbd.cbs.LL</span>(params2, data<span class="sc">$</span>cal<span class="sc">$</span>cbs))</span></code></pre></div>
<pre><code>## [1] -9594.976</code></pre>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="customer-lifetime-value.html#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make a series of estimates, see if they converge to the same solution</span></span>
<span id="cb137-2"><a href="customer-lifetime-value.html#cb137-2" aria-hidden="true" tabindex="-1"></a>p.matrix <span class="ot">&lt;-</span> <span class="fu">c</span>(params2, LL)</span>
<span id="cb137-3"><a href="customer-lifetime-value.html#cb137-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>) {</span>
<span id="cb137-4"><a href="customer-lifetime-value.html#cb137-4" aria-hidden="true" tabindex="-1"></a>  params2 <span class="ot">&lt;-</span> <span class="fu">pnbd.EstimateParameters</span>(data<span class="sc">$</span>cal<span class="sc">$</span>cbs, params2)</span>
<span id="cb137-5"><a href="customer-lifetime-value.html#cb137-5" aria-hidden="true" tabindex="-1"></a>  LL <span class="ot">&lt;-</span> <span class="fu">pnbd.cbs.LL</span>(params2, data<span class="sc">$</span>cal<span class="sc">$</span>cbs)</span>
<span id="cb137-6"><a href="customer-lifetime-value.html#cb137-6" aria-hidden="true" tabindex="-1"></a>  p.matrix.row <span class="ot">&lt;-</span> <span class="fu">c</span>(params2, LL)</span>
<span id="cb137-7"><a href="customer-lifetime-value.html#cb137-7" aria-hidden="true" tabindex="-1"></a>  p.matrix <span class="ot">&lt;-</span> <span class="fu">rbind</span>(p.matrix, p.matrix.row)</span>
<span id="cb137-8"><a href="customer-lifetime-value.html#cb137-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb137-9"><a href="customer-lifetime-value.html#cb137-9" aria-hidden="true" tabindex="-1"></a><span class="co">#colnames(p.matrix) &lt;- c(&quot;beta&quot;,&quot;s&quot;,&quot;r&quot;,&quot;Alpha&quot;,&quot;LL&quot;)</span></span>
<span id="cb137-10"><a href="customer-lifetime-value.html#cb137-10" aria-hidden="true" tabindex="-1"></a><span class="co"># examine</span></span>
<span id="cb137-11"><a href="customer-lifetime-value.html#cb137-11" aria-hidden="true" tabindex="-1"></a>p.matrix</span></code></pre></div>
<pre><code>##                   [,1]     [,2]      [,3]     [,4]      [,5]
## p.matrix     0.5533971 10.58020 0.6060625 11.65622 -9594.976
## p.matrix.row 0.5534354 10.57952 0.6060276 11.65666 -9594.976
## p.matrix.row 0.5533710 10.57952 0.6059074 11.65812 -9594.976
## p.matrix.row 0.5533553 10.57867 0.6059434 11.65781 -9594.976
## p.matrix.row 0.5533415 10.57861 0.6059408 11.65791 -9594.976
## p.matrix.row 0.5533439 10.57851 0.6059382 11.65797 -9594.976
## p.matrix.row 0.5533318 10.57843 0.6059379 11.65807 -9594.976
## p.matrix.row 0.5533340 10.57836 0.6059363 11.65811 -9594.976
## p.matrix.row 0.5533217 10.57825 0.6059374 11.65826 -9594.976
## p.matrix.row 0.5533239 10.57819 0.6059363 11.65830 -9594.976
## p.matrix.row 0.5533034 10.57791 0.6059435 11.65883 -9594.976
## p.matrix.row 0.5533058 10.57788 0.6059432 11.65886 -9594.976
## p.matrix.row 0.5533276 10.57829 0.6059982 11.66026 -9594.976
## p.matrix.row 0.5533231 10.57829 0.6059994 11.66027 -9594.976
## p.matrix.row 0.5533233 10.57822 0.6059985 11.66032 -9594.976
## p.matrix.row 0.5533194 10.57822 0.6059995 11.66034 -9594.976
## p.matrix.row 0.5533199 10.57816 0.6059987 11.66037 -9594.976
## p.matrix.row 0.5533164 10.57816 0.6059997 11.66040 -9594.976
## p.matrix.row 0.5533170 10.57812 0.6059991 11.66043 -9594.976
## p.matrix.row 0.5533139 10.57811 0.6060002 11.66046 -9594.976
## p.matrix.row 0.5533146 10.57808 0.6059997 11.66049 -9594.976</code></pre>
<p>We see that the parameters are very stable, hence they dont change much in the iterations.</p>
<p>We see the average dropout rate: s/beta</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="customer-lifetime-value.html#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="co">#The average dropout rate</span></span>
<span id="cb139-2"><a href="customer-lifetime-value.html#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="fl">0.6060</span><span class="sc">/</span><span class="fl">11.65</span> <span class="co"># = 0.05201717. i.e.</span></span></code></pre></div>
<pre><code>## [1] 0.05201717</code></pre>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="customer-lifetime-value.html#cb141-1" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">=</span> p.matrix[<span class="dv">1</span>,<span class="dv">3</span>]</span>
<span id="cb141-2"><a href="customer-lifetime-value.html#cb141-2" aria-hidden="true" tabindex="-1"></a>  Alpha <span class="ot">=</span> p.matrix[<span class="dv">1</span>,<span class="dv">4</span>]</span>
<span id="cb141-3"><a href="customer-lifetime-value.html#cb141-3" aria-hidden="true" tabindex="-1"></a>  r<span class="sc">/</span>Alpha</span></code></pre></div>
<pre><code>##   p.matrix 
## 0.05199476</code></pre>
<p>We see the average transaction rate:</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="customer-lifetime-value.html#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co">#THe average transaction rate</span></span>
<span id="cb143-2"><a href="customer-lifetime-value.html#cb143-2" aria-hidden="true" tabindex="-1"></a><span class="fl">0.5533</span><span class="sc">/</span><span class="fl">10.58</span> <span class="co">#=0.05229679 i.e.</span></span></code></pre></div>
<pre><code>## [1] 0.05229679</code></pre>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="customer-lifetime-value.html#cb145-1" aria-hidden="true" tabindex="-1"></a>  beta <span class="ot">=</span> p.matrix[<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb145-2"><a href="customer-lifetime-value.html#cb145-2" aria-hidden="true" tabindex="-1"></a>  s <span class="ot">=</span> p.matrix[<span class="dv">1</span>,<span class="dv">2</span>]</span>
<span id="cb145-3"><a href="customer-lifetime-value.html#cb145-3" aria-hidden="true" tabindex="-1"></a>  beta<span class="sc">/</span>s</span></code></pre></div>
<pre><code>##   p.matrix 
## 0.05230499</code></pre>
<p><strong><em>Notice, it is a miracle that it so similar to the dropout rate.</em></strong></p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="customer-lifetime-value.html#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use final set of values</span></span>
<span id="cb147-2"><a href="customer-lifetime-value.html#cb147-2" aria-hidden="true" tabindex="-1"></a>(params2 <span class="ot">&lt;-</span> p.matrix[<span class="fu">dim</span>(p.matrix)[<span class="dv">1</span>],<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>])</span></code></pre></div>
<pre><code>## [1]  0.5533146 10.5780771  0.6059997 11.6604916</code></pre>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="customer-lifetime-value.html#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co">#The drop-out rate - Pareto part</span></span>
<span id="cb149-2"><a href="customer-lifetime-value.html#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pnbd.PlotDropoutRateHeterogeneity</span>(params2)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-86-1.png" width="720" style="display: block; margin: auto;" /></p>
<pre><code>##               [,1]         [,2]         [,3]         [,4]        [,5]
## x.axis.ticks     0  0.003138666  0.006277332  0.009415997  0.01255466
## heterogeneity  Inf 28.044909886 20.575655163 16.907492071 14.55321079
##                      [,6]        [,7]        [,8]       [,9]      [,10]
## x.axis.ticks   0.01569333  0.01883199  0.02197066 0.02510933 0.02824799
## heterogeneity 12.84936813 11.52895283 10.45967842 9.56698323 8.80494055
##                    [,11]      [,12]      [,13]      [,14]      [,15]      [,16]
## x.axis.ticks  0.03138666 0.03452532 0.03766399 0.04080265 0.04394132 0.04707999
## heterogeneity 8.14335724 7.56136637 7.04396357 6.58000684 6.16099837 5.78030958
##                    [,17]      [,18]      [,19]      [,20]      [,21]      [,22]
## x.axis.ticks  0.05021865 0.05335732 0.05649598 0.05963465 0.06277332 0.06591198
## heterogeneity 5.43266965 5.11381734 4.82025747 4.54908656 4.29786548 4.06452456
##                    [,23]      [,24]      [,25]      [,26]      [,27]      [,28]
## x.axis.ticks  0.06905065 0.07218931 0.07532798 0.07846664 0.08160531 0.08474398
## heterogeneity 3.84729188 3.64463819 3.45523411 3.27791632 3.11166077 2.95556109
##                    [,29]      [,30]      [,31]      [,32]     [,33]    [,34]
## x.axis.ticks  0.08788264 0.09102131 0.09415997 0.09729864 0.1004373 0.103576
## heterogeneity 2.80881100 2.67069006 2.54055175 2.41781369 2.3019494 2.192481
##                   [,35]     [,36]    [,37]     [,38]     [,39]    [,40]
## x.axis.ticks  0.1067146 0.1098533 0.112992 0.1161306 0.1192693 0.122408
## heterogeneity 2.0889748 1.9910337 1.898295 1.8104268 1.7271229 1.648102
##                   [,41]     [,42]    [,43]     [,44]     [,45]    [,46]
## x.axis.ticks  0.1255466 0.1286853 0.131824 0.1349626 0.1381013 0.141240
## heterogeneity 1.5731038 1.5018885 1.434233 1.3699320 1.3087923 1.250636
##                   [,47]     [,48]    [,49]     [,50]     [,51]     [,52]
## x.axis.ticks  0.1443786 0.1475173 0.150656 0.1537946 0.1569333 0.1600720
## heterogeneity 1.1952962 1.1426181 1.092456 1.0446756 0.9991485 0.9557561
##                   [,53]     [,54]    [,55]     [,56]     [,57]     [,58]
## x.axis.ticks  0.1632106 0.1663493 0.169488 0.1726266 0.1757653 0.1789039
## heterogeneity 0.9143868 0.8749356 0.837304 0.8013992 0.7671341 0.7344262
##                   [,59]     [,60]     [,61]     [,62]     [,63]     [,64]
## x.axis.ticks  0.1820426 0.1851813 0.1883199 0.1914586 0.1945973 0.1977359
## heterogeneity 0.7031982 0.6733769 0.6448933 0.6176821 0.5916817 0.5668339
##                   [,65]     [,66]     [,67]     [,68]     [,69]     [,70]
## x.axis.ticks  0.2008746 0.2040133 0.2071519 0.2102906 0.2134293 0.2165679
## heterogeneity 0.5430835 0.5203783 0.4986689 0.4779083 0.4580523 0.4390587
##                   [,71]     [,72]     [,73]     [,74]     [,75]     [,76]
## x.axis.ticks  0.2197066 0.2228453 0.2259839 0.2291226 0.2322613 0.2353999
## heterogeneity 0.4208875 0.4035008 0.3868625 0.3709386 0.3556964 0.3411050
##                   [,77]     [,78]     [,79]     [,80]     [,81]     [,82]
## x.axis.ticks  0.2385386 0.2416773 0.2448159 0.2479546 0.2510933 0.2542319
## heterogeneity 0.3271352 0.3137588 0.3009494 0.2886817 0.2769315 0.2656760
##                   [,83]     [,84]     [,85]     [,86]     [,87]     [,88]
## x.axis.ticks  0.2573706 0.2605093 0.2636479 0.2667866 0.2699253 0.2730639
## heterogeneity 0.2548932 0.2445624 0.2346637 0.2251782 0.2160880 0.2073757
##                   [,89]     [,90]     [,91]     [,92]     [,93]     [,94]
## x.axis.ticks  0.2762026 0.2793413 0.2824799 0.2856186 0.2887572 0.2918959
## heterogeneity 0.1990251 0.1910205 0.1833469 0.1759901 0.1689366 0.1621733
##                   [,95]     [,96]     [,97]     [,98]     [,99]    [,100]
## x.axis.ticks  0.2950346 0.2981732 0.3013119 0.3044506 0.3075892 0.3107279
## heterogeneity 0.1556879 0.1494685 0.1435038 0.1377830 0.1322958 0.1270324</code></pre>
<p>The average lifetime:</p>
<p>Hence we take one and divide it by the average dropout rate.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="customer-lifetime-value.html#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">/</span>(<span class="fl">0.6060</span><span class="sc">/</span><span class="fl">11.65</span>) <span class="co">#i.e.</span></span></code></pre></div>
<pre><code>## [1] 19.22442</code></pre>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="customer-lifetime-value.html#cb153-1" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">=</span> p.matrix[<span class="dv">1</span>,<span class="dv">3</span>]</span>
<span id="cb153-2"><a href="customer-lifetime-value.html#cb153-2" aria-hidden="true" tabindex="-1"></a>  Alpha <span class="ot">=</span> p.matrix[<span class="dv">1</span>,<span class="dv">4</span>]</span>
<span id="cb153-3"><a href="customer-lifetime-value.html#cb153-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">/</span>(r<span class="sc">/</span>Alpha)</span></code></pre></div>
<pre><code>## p.matrix 
## 19.23271</code></pre>
<p>We can then plot what characterizes the unobserved lifetime for a customer with an average dropoutrate</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="customer-lifetime-value.html#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot average tendency to drop-out</span></span>
<span id="cb155-2"><a href="customer-lifetime-value.html#cb155-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">40</span>, <span class="at">length.out=</span><span class="dv">1000</span>)</span>
<span id="cb155-3"><a href="customer-lifetime-value.html#cb155-3" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x=</span>x, <span class="at">densx=</span><span class="fu">dexp</span>(x, <span class="at">rate=</span><span class="fl">0.052</span>)) <span class="co">#Notice, 0.052 is the average dropout rate</span></span>
<span id="cb155-4"><a href="customer-lifetime-value.html#cb155-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb155-5"><a href="customer-lifetime-value.html#cb155-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>densx)) <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-88-1.png" width="720" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="customer-lifetime-value.html#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The transaction rate - NBD part</span></span>
<span id="cb156-2"><a href="customer-lifetime-value.html#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pnbd.PlotTransactionRateHeterogeneity</span>(params2)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-89-1.png" width="720" style="display: block; margin: auto;" /></p>
<pre><code>##               [,1]         [,2]         [,3]         [,4]        [,5]
## x.axis.ticks     0  0.003317791  0.006635582  0.009953373  0.01327116
## heterogeneity  Inf 28.378669973 20.104088608 16.195153025 13.75101668
##                      [,6]        [,7]       [,8]       [,9]      [,10]
## x.axis.ticks   0.01658895  0.01990675 0.02322454 0.02654233 0.02986012
## heterogeneity 12.01723584 10.69531406 9.63934342 8.76801657 8.03175296
##                    [,11]     [,12]      [,13]      [,14]      [,15]      [,16]
## x.axis.ticks  0.03317791 0.0364957 0.03981349 0.04313128 0.04644907 0.04976686
## heterogeneity 7.39825343 6.8453831 6.35735156 5.92252045 5.53207687 5.17919351
##                    [,17]      [,18]      [,19]      [,20]      [,21]      [,22]
## x.axis.ticks  0.05308465 0.05640245 0.05972024 0.06303803 0.06635582 0.06967361
## heterogeneity 4.85847735 4.56559617 4.29701856 4.04982850 3.82159058 3.61024998
##                   [,23]      [,24]      [,25]      [,26]      [,27]      [,28]
## x.axis.ticks  0.0729914 0.07630919 0.07962698 0.08294477 0.08626256 0.08958035
## heterogeneity 3.4140571 3.23151010 3.06131004 2.90232606 2.75356748 2.61416160
##                    [,29]      [,30]      [,31]     [,32]     [,33]     [,34]
## x.axis.ticks  0.09289815 0.09621594 0.09953373 0.1028515 0.1061693 0.1094871
## heterogeneity 2.48333568 2.36040227 2.24474714 2.1358192 2.0331225 1.9362085
##                   [,35]     [,36]     [,37]     [,38]     [,39]     [,40]
## x.axis.ticks  0.1128049 0.1161227 0.1194405 0.1227583 0.1260761 0.1293938
## heterogeneity 1.8446710 1.7581406 1.6762806 1.5987832 1.5253664 1.4557714
##                   [,41]     [,42]     [,43]    [,44]     [,45]     [,46]
## x.axis.ticks  0.1327116 0.1360294 0.1393472 0.142665 0.1459828 0.1493006
## heterogeneity 1.3897599 1.3271122 1.2676255 1.211112 1.1573975 1.1063207
##                   [,47]     [,48]     [,49]     [,50]     [,51]     [,52]
## x.axis.ticks  0.1526184 0.1559362 0.1592540 0.1625718 0.1658895 0.1692073
## heterogeneity 1.0577313 1.0114894 0.9674649 0.9255359 0.8855889 0.8475175
##                   [,53]     [,54]     [,55]     [,56]     [,57]     [,58]
## x.axis.ticks  0.1725251 0.1758429 0.1791607 0.1824785 0.1857963 0.1891141
## heterogeneity 0.8112221 0.7766093 0.7435917 0.7120869 0.6820176 0.6533111
##                   [,59]     [,60]     [,61]     [,62]     [,63]     [,64]
## x.axis.ticks  0.1924319 0.1957497 0.1990675 0.2023852 0.2057030 0.2090208
## heterogeneity 0.6258990 0.5997167 0.5747033 0.5508016 0.5279574 0.5061194
##                   [,65]     [,66]     [,67]     [,68]     [,69]     [,70]
## x.axis.ticks  0.2123386 0.2156564 0.2189742 0.2222920 0.2256098 0.2289276
## heterogeneity 0.4852393 0.4652714 0.4461723 0.4279011 0.4104190 0.3936892
##                   [,71]     [,72]     [,73]     [,74]     [,75]     [,76]
## x.axis.ticks  0.2322454 0.2355632 0.2388809 0.2421987 0.2455165 0.2488343
## heterogeneity 0.3776767 0.3623486 0.3476734 0.3336212 0.3201639 0.3072744
##                   [,77]     [,78]     [,79]     [,80]     [,81]     [,82]
## x.axis.ticks  0.2521521 0.2554699 0.2587877 0.2621055 0.2654233 0.2687411
## heterogeneity 0.2949273 0.2830983 0.2717641 0.2609029 0.2504937 0.2405165
##                   [,83]     [,84]     [,85]     [,86]     [,87]     [,88]
## x.axis.ticks  0.2720589 0.2753766 0.2786944 0.2820122 0.2853300 0.2886478
## heterogeneity 0.2309525 0.2217835 0.2129924 0.2045626 0.1964787 0.1887256
##                   [,89]     [,90]     [,91]    [,92]     [,93]     [,94]
## x.axis.ticks  0.2919656 0.2952834 0.2986012 0.301919 0.3052368 0.3085546
## heterogeneity 0.1812891 0.1741557 0.1673125 0.160747 0.1544474 0.1484026
##                   [,95]     [,96]     [,97]     [,98]     [,99]    [,100]
## x.axis.ticks  0.3118723 0.3151901 0.3185079 0.3218257 0.3251435 0.3284613
## heterogeneity 0.1426017 0.1370345 0.1316912 0.1265623 0.1216390 0.1169126</code></pre>
<p>So what is the interpretation of 0.0523, which is the average transaction rate. It means that on average the customers have 0.05 transactions per period (week). So the customer buys a CD every 20 week</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="customer-lifetime-value.html#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Overall fit - Calibration data</span></span>
<span id="cb158-2"><a href="customer-lifetime-value.html#cb158-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate plots</span></span>
<span id="cb158-3"><a href="customer-lifetime-value.html#cb158-3" aria-hidden="true" tabindex="-1"></a><span class="fu">pnbd.PlotFrequencyInCalibration</span>(params2, data<span class="sc">$</span>cal<span class="sc">$</span>cbs, <span class="dv">7</span>)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-90-1.png" width="720" style="display: block; margin: auto;" /></p>
<pre><code>##                freq.0   freq.1   freq.2   freq.3   freq.4   freq.5   freq.6
## n.x.actual   1411.000 439.0000 214.0000 100.0000 62.00000 38.00000 29.00000
## n.x.expected 1434.049 397.2334 194.0175 112.4031 70.59158 46.43743 31.47897
##               freq.7+
## n.x.actual   64.00000
## n.x.expected 70.78907</code></pre>
<p><strong>Using the holdout period</strong></p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="customer-lifetime-value.html#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit Holdout period</span></span>
<span id="cb160-2"><a href="customer-lifetime-value.html#cb160-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-3"><a href="customer-lifetime-value.html#cb160-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot of performance in hold-out period</span></span>
<span id="cb160-4"><a href="customer-lifetime-value.html#cb160-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-5"><a href="customer-lifetime-value.html#cb160-5" aria-hidden="true" tabindex="-1"></a>T.star <span class="ot">&lt;-</span> <span class="dv">39</span> <span class="co"># length of the holdout period</span></span>
<span id="cb160-6"><a href="customer-lifetime-value.html#cb160-6" aria-hidden="true" tabindex="-1"></a>censor <span class="ot">&lt;-</span> <span class="dv">7</span> <span class="co"># This censor serves the same purpose as above</span></span>
<span id="cb160-7"><a href="customer-lifetime-value.html#cb160-7" aria-hidden="true" tabindex="-1"></a>x.star <span class="ot">&lt;-</span> data<span class="sc">$</span>holdout<span class="sc">$</span>cbs[,<span class="st">&quot;x.star&quot;</span>]</span>
<span id="cb160-8"><a href="customer-lifetime-value.html#cb160-8" aria-hidden="true" tabindex="-1"></a>comp <span class="ot">&lt;-</span> <span class="fu">pnbd.PlotFreqVsConditionalExpectedFrequency</span>(params2, T.star,</span>
<span id="cb160-9"><a href="customer-lifetime-value.html#cb160-9" aria-hidden="true" tabindex="-1"></a>                                                    data<span class="sc">$</span>cal<span class="sc">$</span>cbs, x.star, censor)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-91-1.png" width="720" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="customer-lifetime-value.html#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(comp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;act&quot;</span>, <span class="st">&quot;exp&quot;</span>, <span class="st">&quot;bin&quot;</span>)</span>
<span id="cb161-2"><a href="customer-lifetime-value.html#cb161-2" aria-hidden="true" tabindex="-1"></a>comp</span></code></pre></div>
<pre><code>##           freq.0      freq.1     freq.2     freq.3    freq.4    freq.5
## act    0.2367116   0.6970387   1.392523   1.560000  2.532258  2.947368
## exp    0.1384572   0.5995278   1.195945   1.713991  2.398495  2.907417
## bin 1411.0000000 439.0000000 214.000000 100.000000 62.000000 38.000000
##        freq.6   freq.7+
## act  3.862069  6.359375
## exp  3.818842  6.403450
## bin 29.000000 64.000000</code></pre>
<p>The plot compares what we have observed and what we expect from the model.</p>
<p>The following calculates the expected number of transactions in a given period.</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="customer-lifetime-value.html#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A randomly selected individual</span></span>
<span id="cb163-2"><a href="customer-lifetime-value.html#cb163-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pnbd.Expectation</span>(params2,<span class="dv">78</span>)</span></code></pre></div>
<pre><code>## [1] 1.909942</code></pre>
<p>We see that for any given customer we expect around 2 purchases for the period.</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="customer-lifetime-value.html#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Probability that a randomly selected customer makes 0 purchases in the hold-out period</span></span>
<span id="cb165-2"><a href="customer-lifetime-value.html#cb165-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pnbd.pmf.General</span>(params2,T.star,<span class="at">t.end =</span> <span class="dv">78</span>,<span class="dv">0</span>)</span></code></pre></div>
<pre><code>## [1] 0.8109832</code></pre>
<p>That is a probability of 81%</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="customer-lifetime-value.html#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Analysing a specific customer - No of transactions</span></span>
<span id="cb167-2"><a href="customer-lifetime-value.html#cb167-2" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>cal<span class="sc">$</span>cbs[<span class="st">&quot;1516&quot;</span>,]</span></code></pre></div>
<pre><code>##        x      t.x    T.cal 
## 26.00000 30.85714 31.00000</code></pre>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="customer-lifetime-value.html#cb169-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> data<span class="sc">$</span>cal<span class="sc">$</span>cbs[<span class="st">&quot;1516&quot;</span>, <span class="st">&quot;x&quot;</span>]</span>
<span id="cb169-2"><a href="customer-lifetime-value.html#cb169-2" aria-hidden="true" tabindex="-1"></a>t.x <span class="ot">&lt;-</span> data<span class="sc">$</span>cal<span class="sc">$</span>cbs[<span class="st">&quot;1516&quot;</span>, <span class="st">&quot;t.x&quot;</span>]</span>
<span id="cb169-3"><a href="customer-lifetime-value.html#cb169-3" aria-hidden="true" tabindex="-1"></a>T.cal <span class="ot">&lt;-</span> data<span class="sc">$</span>cal<span class="sc">$</span>cbs[<span class="st">&quot;1516&quot;</span>, <span class="st">&quot;T.cal&quot;</span>]</span></code></pre></div>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="customer-lifetime-value.html#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="co"># x</span></span>
<span id="cb170-2"><a href="customer-lifetime-value.html#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="co"># t.x</span></span>
<span id="cb170-3"><a href="customer-lifetime-value.html#cb170-3" aria-hidden="true" tabindex="-1"></a><span class="co"># T.cal</span></span></code></pre></div>
<p>We see that the customer has made 26 purchases in the calibration period. He bought something in period 30.8 and we see the holdout period is 31 periods, hence we expect him to be alive in the end of the hold out period.</p>
<p>Now we want to calculate the number of transactions n period ahead given the information that we have about the customer.</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="customer-lifetime-value.html#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="co"># T.star no of periods ahead</span></span>
<span id="cb171-2"><a href="customer-lifetime-value.html#cb171-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">pnbd.ConditionalExpectedTransactions</span>(params2,<span class="at">T.star=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,x,t.x,T.cal)</span>
<span id="cb171-3"><a href="customer-lifetime-value.html#cb171-3" aria-hidden="true" tabindex="-1"></a><span class="fu">t</span>(<span class="fu">t</span>(df))</span></code></pre></div>
<pre><code>##           [,1]
## [1,] 0.6328092
## [2,] 1.2568947
## [3,] 1.8725683
## [4,] 2.4801239
## [5,] 3.0798392</code></pre>
<p>Notice, that the table is accumulated, hence in period 1 we expect 0.63 transactions, then in period 1 and 2 we expect 1.25 transactions and lastly in period etc.</p>
<p>The following show how much it changes from period to period (week).</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="customer-lifetime-value.html#cb173-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">diff</span>(<span class="fu">as.matrix</span>(df)))</span>
<span id="cb173-2"><a href="customer-lifetime-value.html#cb173-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(res)</span></code></pre></div>
<pre><code>##   diff.as.matrix.df..
## 1           0.6240856
## 2           0.6156736
## 3           0.6075556
## 4           0.5997153</code></pre>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="customer-lifetime-value.html#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="co"># DERT discounted expected residual no. of transactions</span></span>
<span id="cb175-2"><a href="customer-lifetime-value.html#cb175-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-3"><a href="customer-lifetime-value.html#cb175-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 15% compounded annually has been converted to 0.0027 compounded continuously,</span></span>
<span id="cb175-4"><a href="customer-lifetime-value.html#cb175-4" aria-hidden="true" tabindex="-1"></a><span class="co"># as we are dealing with weekly data and not annual data.</span></span>
<span id="cb175-5"><a href="customer-lifetime-value.html#cb175-5" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fl">0.0027</span></span>
<span id="cb175-6"><a href="customer-lifetime-value.html#cb175-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-7"><a href="customer-lifetime-value.html#cb175-7" aria-hidden="true" tabindex="-1"></a><span class="fu">pnbd.DERT</span>(params2,x,t.x,T.cal,d)</span></code></pre></div>
<pre><code>## [1] 86.04656</code></pre>
<p>We see that the DERT = 86, hence we see that the later we get the transactions, that amount is not as valuable today.</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="customer-lifetime-value.html#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the discounted expected residual transactions of a customer</span></span>
<span id="cb177-2"><a href="customer-lifetime-value.html#cb177-2" aria-hidden="true" tabindex="-1"></a><span class="co"># who made 2 repeat transactions in a calibration period that was 38.86</span></span>
<span id="cb177-3"><a href="customer-lifetime-value.html#cb177-3" aria-hidden="true" tabindex="-1"></a><span class="co"># weeks long, with the last transaction occurring in the middle of</span></span>
<span id="cb177-4"><a href="customer-lifetime-value.html#cb177-4" aria-hidden="true" tabindex="-1"></a><span class="co"># the 31th week.</span></span>
<span id="cb177-5"><a href="customer-lifetime-value.html#cb177-5" aria-hidden="true" tabindex="-1"></a><span class="fu">pnbd.DERT</span>(params2, <span class="at">x=</span><span class="dv">2</span>, <span class="at">t.x=</span><span class="fl">30.43</span>, <span class="at">T.cal=</span><span class="fl">38.86</span>, d)</span></code></pre></div>
<pre><code>## [1] 6.483942</code></pre>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="customer-lifetime-value.html#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We can also use vectors to compute DERT for several customers:</span></span>
<span id="cb179-2"><a href="customer-lifetime-value.html#cb179-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pnbd.DERT</span>(params2, <span class="at">x=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">t.x =</span> <span class="fl">30.43</span>, <span class="at">T.cal=</span><span class="fl">38.86</span>, d)</span></code></pre></div>
<pre><code>##  [1]  3.994777  6.483942  8.895852 11.218449 13.438376 15.541043 17.510758
##  [8] 19.330967 20.984605 22.454582</code></pre>
<p>We see that x iterates form 1 to 10, hence customers with 10 repeatative purchases in the calibration has a discounted expected residual no. of transactions that is increasing.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="customer-lifetime-value.html#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pnbd.Plot.DERT</span>(params2, <span class="at">x=</span><span class="dv">0</span><span class="sc">:</span><span class="dv">14</span>, <span class="at">t.x=</span><span class="dv">0</span><span class="sc">:</span><span class="dv">38</span>, <span class="at">T.cal=</span><span class="fl">38.86</span>, d, <span class="at">type=</span><span class="st">&quot;contour&quot;</span>)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-101-1.png" width="720" style="display: block; margin: auto;" /></p>
<pre><code>##            0         1         2          3           4           5
## 0  0.4770585 0.5779056 0.3199351  0.1294895  0.04460094  0.01397432
## 1  0.5184917 0.6832675 0.4167989  0.1856906  0.07018641  0.02409025
## 2  0.5592651 0.7947977 0.5300382  0.2581760  0.10636616  0.03971331
## 3  0.5993534 0.9116617 0.6600571  0.3494857  0.15607082  0.06301878
## 4  0.6387393 1.0330181 0.8069337  0.4621052  0.22264492  0.09675453
## 5  0.6774115 1.1580344 0.9704061  0.5983581  0.30980825  0.14431123
## 6  0.7153638 1.2859006 1.1498716  0.7602863  0.42158225  0.20977683
## 7  0.7525940 1.4158414 1.3444000  0.9495253  0.56217436  0.29796320
## 8  0.7891031 1.5471246 1.5527617  1.1671812  0.73581558  0.41438948
## 9  0.8248950 1.6790690 1.7734666  1.4137219  0.94655002  0.56520349
## 10 0.8599754 1.8110487 2.0048151  1.6888919  1.19798164  0.75702129
## 11 0.8943521 1.9424966 2.2449544  1.9916628  1.49299089  0.99666644
## 12 0.9280339 2.0729051 2.4919389  2.3202264  1.83344279  1.29079726
## 13 0.9610312 2.2018261 2.7437904  2.6720355  2.21991653  1.64542303
## 14 0.9933550 2.3288698 2.9985543  3.0438914  2.65149127  2.06533082
## 15 1.0250169 2.4537020 3.2543503  3.4320723  3.12562336  2.55346991
## 16 1.0560292 2.5760412 3.5094141  3.8324921  3.63814310  3.11036768
## 17 1.0864046 2.6956549 3.7621307  4.2408754  4.18338533  3.73367015
## 18 1.1161560 2.8123560 4.0110568  4.6529342  4.75444977  4.41790410
## 19 1.1452965 2.9259983 4.2549356  5.0645323  5.34356693  5.15453727
## 20 1.1738393 3.0364728 4.4927016  5.4718254  5.94252951  5.93236950
## 21 1.2017976 3.1437033 4.7234790  5.8713696  6.54314006  6.73822689
## 22 1.2291847 3.2476429 4.9465745  6.2601955  7.13762631  7.55787120
## 23 1.2560135 3.3482703 5.1614649  6.6358466  7.71898452  8.37699457
## 24 1.2822971 3.4455859 5.3677826  6.9963880  8.28122567  9.18215837
## 25 1.3080485 3.5396092 5.5652986  7.3403882  8.81951601  9.96155675
## 26 1.3332801 3.6303756 5.7539053  7.6668818  9.33021804 10.70553071
## 27 1.3580047 3.7179339 5.9335989  7.9753201  9.81084821 11.40681183
## 28 1.3822343 3.8023438 6.1044629  8.2655135 10.25997364 12.06052117
## 29 1.4059810 3.8836740 6.2666520  8.5375727 10.67707041 12.66397928
## 30 1.4292567 3.9620003 6.4203787  8.7918504 11.06236429 13.21639451
## 31 1.4520729 4.0374039 6.5658995  9.0288877 11.41666999 13.71849386
## 32 1.4744408 4.1099700 6.7035044  9.2493657 11.74124065 14.17214757
## 33 1.4963717 4.1797868 6.8335074  9.4540638 12.03763452 14.58002290
## 34 1.5178761 4.2469441 6.9562376  9.6438245 12.30760232 14.94528679
## 35 1.5389648 4.3115328 7.0720331  9.8195240 12.55299569 15.27136555
## 36 1.5596478 4.3736437 7.1812347  9.9820494 12.77569585 15.56176058
## 37 1.5799354 4.4333675 7.2841821 10.1322804 12.97755994 15.81991459
## 38 1.5998372 4.4907936 7.3812097 10.2710759 13.16038262 16.04912020
##               6            7            8            9           10
## 0   0.004114556  0.001159004 3.157681e-04 8.381558e-05 2.178551e-05
## 1   0.007764951  0.002393929 7.138094e-04 2.073603e-04 5.898752e-05
## 2   0.013911768  0.004659695 1.509334e-03 4.762941e-04 1.471827e-04
## 3   0.023846808  0.008624041 3.015561e-03 1.027220e-03 3.426460e-04
## 4   0.039348724  0.015283693 5.738362e-03 2.098668e-03 7.515759e-04
## 5   0.062804337  0.026082679 1.046679e-02 4.090760e-03 1.565463e-03
## 6   0.097341684  0.043058286 1.839462e-02 7.651648e-03 3.116206e-03
## 7   0.146968673  0.069016251 3.127967e-02 1.379946e-02 5.959438e-03
## 8   0.216706710  0.107734234 5.164741e-02 2.409017e-02 1.099716e-02
## 9   0.312702391  0.164188268 8.304433e-02 4.084317e-02 1.965375e-02
## 10  0.442292476  0.244789707 1.303433e-01 6.743709e-02 3.412274e-02
## 11  0.613988357  0.357609411 2.000964e-01 1.086871e-01 5.770463e-02
## 12  0.837337733  0.512550652 3.009202e-01 1.713104e-01 9.525758e-02
## 13  1.122616176  0.721412828 4.438759e-01 2.644750e-01 1.537813e-01
## 14  1.480304501  0.997766489 6.427829e-01 4.004069e-01 2.431453e-01
## 15  1.920325119  1.356542077 9.143596e-01 5.949913e-01 3.769505e-01
## 16  2.451047326  1.813230636 1.278041e+00 8.682471e-01 5.734687e-01
## 17  3.078129072  2.382619933 1.755282e+00 1.244470e+00 8.565240e-01
## 18  3.803334027  3.077060969 2.368140e+00 1.751744e+00 1.256055e+00
## 19  4.623528992  3.904386812 3.136983e+00 2.420453e+00 1.807924e+00
## 20  5.530098955  4.865774384 4.077365e+00 3.280398e+00 2.552366e+00
## 21  6.508986773  5.954000958 5.196353e+00 4.356373e+00 3.530366e+00
## 22  7.541459566  7.152618292 6.489054e+00 5.662461e+00 4.777472e+00
## 23  8.605543747  8.436466762 7.936315e+00 7.196076e+00 6.315236e+00
## 24  9.677905483  9.773656234 9.504633e+00 8.933520e+00 8.141779e+00
## 25 10.735844497 11.128729468 1.114882e+01 1.082906e+01 1.022448e+01
## 26 11.759057333 12.466364174 1.281711e+01 1.281881e+01 1.249841e+01
## 27 12.730910829 13.754825307 1.445762e+01 1.482916e+01 1.487299e+01
## 28 13.639107893 14.968509526 1.602433e+01 1.678736e+01 1.724600e+01
## 29 14.475770682 16.089249658 1.748154e+01 1.863136e+01 1.952054e+01
## 30 15.237068094 17.106409934 1.880573e+01 2.031618e+01 2.161946e+01
## 31 15.922558337 18.016063870 1.998532e+01 2.181591e+01 2.349298e+01
## 32 16.534410940 18.819649453 2.101878e+01 2.312205e+01 2.511909e+01
## 33 17.076635826 19.522464544 2.191207e+01 2.423957e+01 2.649864e+01
## 34 17.554400495 20.132261326 2.267597e+01 2.518241e+01 2.764821e+01
## 35 17.973474277 20.658081246 2.332386e+01 2.596939e+01 2.859317e+01
## 36 18.339807487 21.109376736 2.386998e+01 2.662112e+01 2.936224e+01
## 37 18.659234269 21.495404913 2.432831e+01 2.715782e+01 2.998382e+01
## 38 18.937278694 21.824848001 2.471182e+01 2.759818e+01 3.048392e+01
##              11           12           13           14
## 0  5.565656e-06 1.401498e-06 3.486114e-07 8.580445e-08
## 1  1.649322e-05 4.545512e-06 1.237476e-06 3.333597e-07
## 2  4.470460e-05 1.338392e-05 3.958167e-06 1.158323e-06
## 3  1.123421e-04 3.630590e-05 1.159028e-05 3.661323e-06
## 4  2.645538e-04 9.178966e-05 3.145989e-05 1.066963e-05
## 5  5.888245e-04 2.183060e-04 7.995208e-05 2.897502e-05
## 6  1.247342e-03 4.921262e-04 1.918008e-04 7.396986e-05
## 7  2.529353e-03 1.058118e-03 4.372585e-04 1.788017e-04
## 8  4.933310e-03 2.181213e-03 9.526403e-04 4.117052e-04
## 9  9.292292e-03 4.329827e-03 1.992853e-03 9.076120e-04
## 10 1.696073e-02 8.307430e-03 4.019035e-03 1.923915e-03
## 11 3.008594e-02 1.545486e-02 7.840820e-03 3.935931e-03
## 12 5.199376e-02 2.795414e-02 1.484150e-02 7.795931e-03
## 13 8.772304e-02 4.927422e-02 2.732605e-02 1.499145e-02
## 14 1.447461e-01 8.480928e-02 4.904654e-02 2.805497e-02
## 15 2.339067e-01 1.427686e-01 8.597678e-02 5.119875e-02
## 16 3.705864e-01 2.353773e-01 1.474241e-01 9.127493e-02
## 17 5.760557e-01 3.804256e-01 2.475742e-01 1.591894e-01
## 18 8.788608e-01 6.031450e-01 4.075479e-01 2.719163e-01
## 19 1.315912e+00 9.382389e-01 6.579669e-01 4.552454e-01
## 20 1.932658e+00 1.431630e+00 1.041828e+00 7.472864e-01
## 21 2.781397e+00 2.141033e+00 1.617066e+00 1.202455e+00
## 22 3.916526e+00 3.133885e+00 2.457475e+00 1.895014e+00
## 23 5.385739e+00 4.480675e+00 3.649677e+00 2.920073e+00
## 24 7.217279e+00 6.241995e+00 5.283019e+00 4.388341e+00
## 25 9.405651e+00 8.449499e+00 7.429806e+00 6.409740e+00
## 26 1.190091e+01 1.108506e+01 1.011687e+01 9.062447e+00
## 27 1.460780e+01 1.406709e+01 1.329680e+01 1.235119e+01
## 28 1.739844e+01 1.725417e+01 1.683447e+01 1.617153e+01
## 29 2.013567e+01 2.046970e+01 2.052333e+01 2.030592e+01
## 30 2.269872e+01 2.353957e+01 2.413115e+01 2.446720e+01
## 31 2.500153e+01 2.632692e+01 2.745534e+01 2.837445e+01
## 32 2.699899e+01 2.875046e+01 3.036197e+01 3.182197e+01
## 33 2.868251e+01 3.078400e+01 3.279551e+01 3.470910e+01
## 34 3.006977e+01 3.244323e+01 3.476449e+01 3.702918e+01
## 35 3.119358e+01 3.376890e+01 3.631731e+01 3.883688e+01
## 36 3.209279e+01 3.481216e+01 3.751973e+01 4.021484e+01
## 37 3.280617e+01 3.562473e+01 3.843937e+01 4.124994e+01
## 38 3.336903e+01 3.625349e+01 3.913730e+01 4.202045e+01</code></pre>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="customer-lifetime-value.html#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="co"># P(alive) </span></span>
<span id="cb183-2"><a href="customer-lifetime-value.html#cb183-2" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>cal<span class="sc">$</span>cbs[<span class="st">&quot;1516&quot;</span>,]</span></code></pre></div>
<pre><code>##        x      t.x    T.cal 
## 26.00000 30.85714 31.00000</code></pre>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="customer-lifetime-value.html#cb185-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> data<span class="sc">$</span>cal<span class="sc">$</span>cbs[<span class="st">&quot;1516&quot;</span>, <span class="st">&quot;x&quot;</span>]</span>
<span id="cb185-2"><a href="customer-lifetime-value.html#cb185-2" aria-hidden="true" tabindex="-1"></a>t.x <span class="ot">&lt;-</span> data<span class="sc">$</span>cal<span class="sc">$</span>cbs[<span class="st">&quot;1516&quot;</span>, <span class="st">&quot;t.x&quot;</span>]</span>
<span id="cb185-3"><a href="customer-lifetime-value.html#cb185-3" aria-hidden="true" tabindex="-1"></a>T.cal <span class="ot">&lt;-</span> data<span class="sc">$</span>cal<span class="sc">$</span>cbs[<span class="st">&quot;1516&quot;</span>, <span class="st">&quot;T.cal&quot;</span>]</span></code></pre></div>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="customer-lifetime-value.html#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="co"># x</span></span>
<span id="cb186-2"><a href="customer-lifetime-value.html#cb186-2" aria-hidden="true" tabindex="-1"></a><span class="co"># t.x</span></span>
<span id="cb186-3"><a href="customer-lifetime-value.html#cb186-3" aria-hidden="true" tabindex="-1"></a><span class="co"># T.cal</span></span></code></pre></div>
<ul>
<li>x = 26</li>
<li>t.x = 30.85</li>
<li>T.cal = 31</li>
</ul>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="customer-lifetime-value.html#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pnbd.PAlive</span>(params2, x, t.x, T.cal)</span></code></pre></div>
<pre><code>## [1] 0.9978738</code></pre>
<p>We see that he has a probability of 99% of being alive at the end of the calibration period.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="customer-lifetime-value.html#cb189-1" aria-hidden="true" tabindex="-1"></a>palive.pnbd <span class="ot">&lt;-</span> <span class="fu">pnbd.PAlive</span>(params2,</span>
<span id="cb189-2"><a href="customer-lifetime-value.html#cb189-2" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">t.x =</span> <span class="dv">12</span>, <span class="at">T.cal =</span> <span class="dv">39</span>)</span>
<span id="cb189-3"><a href="customer-lifetime-value.html#cb189-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) {</span>
<span id="cb189-4"><a href="customer-lifetime-value.html#cb189-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;x =&quot;</span>, i, <span class="st">&quot;:&quot;</span>, <span class="fu">sprintf</span>(<span class="st">&quot;%5.2f %%&quot;</span>, <span class="dv">100</span><span class="sc">*</span>palive.pnbd[i]), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb189-5"><a href="customer-lifetime-value.html#cb189-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## x = 1 : 45.49 % 
## x = 2 : 33.19 % 
## x = 3 : 22.14 % 
## x = 4 : 13.61 % 
## x = 5 :  7.83 %</code></pre>
<p>We see that as number of transactions inceases the probability of being alive decrease. The reason for this is that we se that the t.x. is in period 12 (the most recent purchase). We see that the customer who has bought five times before period 12, hence i bought a lot. is pretty certain that he is not a customer anymore. Where the customer who only made one purchase before period 12, may still be a customer, bu his pattern just tells that he does not buy that often.</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="customer-lifetime-value.html#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="co"># P(Alive) across customers</span></span>
<span id="cb191-2"><a href="customer-lifetime-value.html#cb191-2" aria-hidden="true" tabindex="-1"></a>p.alives <span class="ot">&lt;-</span> <span class="fu">pnbd.PAlive</span>(params2,data<span class="sc">$</span>cal<span class="sc">$</span>cbs[,<span class="st">&quot;x&quot;</span>],data<span class="sc">$</span>cal<span class="sc">$</span>cbs[,<span class="st">&quot;t.x&quot;</span>],data<span class="sc">$</span>cal<span class="sc">$</span>cbs[,<span class="st">&quot;T.cal&quot;</span>])</span>
<span id="cb191-3"><a href="customer-lifetime-value.html#cb191-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(p.alives))</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-106-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>The figure explains where the customers mainly lie of being alive. Hence in the region between 0.3 and 0.4, the most customers lie.</p>
<p>Now we can try to calculate the number of active customers.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="customer-lifetime-value.html#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of active customers</span></span>
<span id="cb192-2"><a href="customer-lifetime-value.html#cb192-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb192-3"><a href="customer-lifetime-value.html#cb192-3" aria-hidden="true" tabindex="-1"></a>no_of_active <span class="ot">&lt;-</span> <span class="fu">sum</span>(p.alives)</span>
<span id="cb192-4"><a href="customer-lifetime-value.html#cb192-4" aria-hidden="true" tabindex="-1"></a>no_of_active</span></code></pre></div>
<pre><code>## [1] 1051.878</code></pre>
<p>That is the sum of the probability of p.alives. This is an estimate of how many customers that are actually alive. One could also have made a cutoff saying that we will not accumulate on customer that have less than a certain threshold, e.g., 20%.</p>
<p>This is what he does in the following, where he does:</p>
<ol style="list-style-type: decimal">
<li>Creating a data frame</li>
<li>Sorting the customers</li>
<li>Plotting the spread</li>
<li>Calculating how many active customers there are in the specific scenario.</li>
</ol>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="customer-lifetime-value.html#cb194-1" aria-hidden="true" tabindex="-1"></a>p.alive1 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(p.alives)</span>
<span id="cb194-2"><a href="customer-lifetime-value.html#cb194-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(p.alive1)</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">p.alives</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.8691602</td>
</tr>
<tr class="even">
<td align="right">0.1679958</td>
</tr>
<tr class="odd">
<td align="right">0.2951073</td>
</tr>
<tr class="even">
<td align="right">0.2951073</td>
</tr>
<tr class="odd">
<td align="right">0.2951073</td>
</tr>
<tr class="even">
<td align="right">0.7494963</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="customer-lifetime-value.html#cb195-1" aria-hidden="true" tabindex="-1"></a>p.alive2 <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">rowid_to_column</span>(p.alive1, <span class="st">&quot;ID&quot;</span>)</span>
<span id="cb195-2"><a href="customer-lifetime-value.html#cb195-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(p.alive2)</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">ID</th>
<th align="right">p.alives</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">0.8691602</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">0.1679958</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">0.2951073</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">0.2951073</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">0.2951073</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">0.7494963</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="customer-lifetime-value.html#cb196-1" aria-hidden="true" tabindex="-1"></a>newalive <span class="ot">&lt;-</span> <span class="fu">arrange</span>(p.alive2,<span class="fu">desc</span>(p.alives))</span>
<span id="cb196-2"><a href="customer-lifetime-value.html#cb196-2" aria-hidden="true" tabindex="-1"></a>newalive2 <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">rowid_to_column</span>(newalive, <span class="st">&quot;ID1&quot;</span>)</span>
<span id="cb196-3"><a href="customer-lifetime-value.html#cb196-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(newalive2,<span class="dv">6</span>)</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">ID1</th>
<th align="right">ID</th>
<th align="right">p.alives</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">59</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">495</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">519</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">584</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">720</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">761</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="customer-lifetime-value.html#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(newalive2<span class="sc">$</span>ID1,newalive2<span class="sc">$</span>p.alives,<span class="at">xlab=</span><span class="st">&quot;Sorted customers&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;P(Alive)&quot;</span>)</span>
<span id="cb197-2"><a href="customer-lifetime-value.html#cb197-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span><span class="fl">0.5</span>)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-110-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>We see that there are approximately 500 active customers.</p>
</div>
</div>
<div id="bgnbg-example" class="section level4" number="1.2.4.2">
<h4><span class="header-section-number">1.2.4.2</span> BG/NBG example</h4>
<p><strong>Notice, this is showing how this can be applied to any data set.</strong></p>
<p><strong><em>Remember that that column names should be x, t.x, T.cal</em></strong></p>
<p>Notice, that this is not a super good files, as it is with customer with a loyalty cards, to they make many repeatitive purchases</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="customer-lifetime-value.html#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(BTYD)</span>
<span id="cb198-2"><a href="customer-lifetime-value.html#cb198-2" aria-hidden="true" tabindex="-1"></a>cal1 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;Data/BTYD/cal2010.csv&quot;</span>, <span class="at">header=</span><span class="cn">TRUE</span>,<span class="at">sep=</span><span class="st">&#39;;&#39;</span>)</span>
<span id="cb198-3"><a href="customer-lifetime-value.html#cb198-3" aria-hidden="true" tabindex="-1"></a>cal2010 <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(cal1,<span class="at">nrow=</span><span class="dv">3084</span>,<span class="at">ncol=</span><span class="dv">3</span>)</span>
<span id="cb198-4"><a href="customer-lifetime-value.html#cb198-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(cal2010) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;t.x&quot;</span>,<span class="st">&quot;T.cal&quot;</span>)</span>
<span id="cb198-5"><a href="customer-lifetime-value.html#cb198-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-6"><a href="customer-lifetime-value.html#cb198-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(cal2010,<span class="dv">10</span>)</span></code></pre></div>
<pre><code>##        x t.x T.cal
##  [1,] 77  85    85
##  [2,] 83  85    85
##  [3,] 56  83    85
##  [4,] 65  85    85
##  [5,] 77  85    85
##  [6,] 78  85    85
##  [7,] 78  85    85
##  [8,] 57  83    85
##  [9,] 83  85    85
## [10,] 79  85    85</code></pre>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="customer-lifetime-value.html#cb200-1" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">bgnbd.EstimateParameters</span>(cal2010,<span class="at">par.start =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>), <span class="at">max.param.value =</span> <span class="dv">10000</span>)</span>
<span id="cb200-2"><a href="customer-lifetime-value.html#cb200-2" aria-hidden="true" tabindex="-1"></a>params</span></code></pre></div>
<pre><code>##           p1           p2           p3           p4 
## 11.979204509 14.759439087  0.004696903  6.505009679</code></pre>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="customer-lifetime-value.html#cb202-1" aria-hidden="true" tabindex="-1"></a>LL <span class="ot">&lt;-</span> <span class="fu">bgnbd.cbs.LL</span>(params, cal2010)</span>
<span id="cb202-2"><a href="customer-lifetime-value.html#cb202-2" aria-hidden="true" tabindex="-1"></a>LL</span></code></pre></div>
<pre><code>## [1] -251853.9</code></pre>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="customer-lifetime-value.html#cb204-1" aria-hidden="true" tabindex="-1"></a>p.matrix <span class="ot">&lt;-</span> <span class="fu">c</span>(params, LL);</span>
<span id="cb204-2"><a href="customer-lifetime-value.html#cb204-2" aria-hidden="true" tabindex="-1"></a>p.matrix</span></code></pre></div>
<pre><code>##            p1            p2            p3            p4               
##  1.197920e+01  1.475944e+01  4.696903e-03  6.505010e+00 -2.518539e+05</code></pre>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="customer-lifetime-value.html#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>){</span>
<span id="cb206-2"><a href="customer-lifetime-value.html#cb206-2" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">bgnbd.EstimateParameters</span>(cal2010, params);</span>
<span id="cb206-3"><a href="customer-lifetime-value.html#cb206-3" aria-hidden="true" tabindex="-1"></a>LL <span class="ot">&lt;-</span> <span class="fu">bgnbd.cbs.LL</span>(params, cal2010);</span>
<span id="cb206-4"><a href="customer-lifetime-value.html#cb206-4" aria-hidden="true" tabindex="-1"></a>p.matrix.row <span class="ot">&lt;-</span> <span class="fu">c</span>(params, LL);</span>
<span id="cb206-5"><a href="customer-lifetime-value.html#cb206-5" aria-hidden="true" tabindex="-1"></a>p.matrix <span class="ot">&lt;-</span> <span class="fu">rbind</span>(p.matrix, p.matrix.row);</span>
<span id="cb206-6"><a href="customer-lifetime-value.html#cb206-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb206-7"><a href="customer-lifetime-value.html#cb206-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(p.matrix) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;r&quot;</span>, <span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;LL&quot;</span>);</span>
<span id="cb206-8"><a href="customer-lifetime-value.html#cb206-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(p.matrix) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>;</span>
<span id="cb206-9"><a href="customer-lifetime-value.html#cb206-9" aria-hidden="true" tabindex="-1"></a>p.matrix;</span></code></pre></div>
<pre><code>##          r    alpha           a        b        LL
## 1 11.97920 14.75944 0.004696903 6.505010 -251853.9
## 2 11.97929 14.75931 0.004696945 6.505151 -251853.9
## 3 11.97919 14.75943 0.004696956 6.505187 -251853.9</code></pre>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="customer-lifetime-value.html#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bgnbd.PlotTransactionRateHeterogeneity</span>(params)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-115-1.png" width="720" style="display: block; margin: auto;" /></p>
<pre><code>##               [,1]         [,2]         [,3]         [,4]         [,5]
## x.axis.ticks     0 1.468813e-02 2.937627e-02 4.406440e-02 5.875254e-02
## heterogeneity    0 1.607127e-14 2.611953e-11 1.803659e-09 3.417673e-08
##                       [,6]         [,7]         [,8]         [,9]        [,10]
## x.axis.ticks  7.344067e-02 8.812881e-02 1.028169e-01 1.175051e-01 1.321932e-01
## heterogeneity 3.188407e-07 1.900070e-06 8.310764e-06 2.898648e-05 8.504691e-05
##                      [,11]        [,12]       [,13]       [,14]       [,15]
## x.axis.ticks  0.1468813448 0.1615694793 0.176257614 0.190945748 0.205633883
## heterogeneity 0.0002177151 0.0004991105 0.001044562 0.002025089 0.003678372
##                     [,16]      [,17]      [,18]      [,19]     [,20]     [,21]
## x.axis.ticks  0.220322017 0.23501015 0.24969829 0.26438642 0.2790746 0.2937627
## heterogeneity 0.006316514 0.01032904 0.01618007 0.02439906 0.0355653 0.0502867
##                    [,22]      [,23]     [,24]     [,25]     [,26]     [,27]
## x.axis.ticks  0.30845082 0.32313896 0.3378271 0.3525152 0.3672034 0.3818915
## heterogeneity 0.06917424 0.09281349 0.1217351 0.1563863 0.1971043 0.2440947
##                   [,28]     [,29]     [,30]     [,31]     [,32]     [,33]
## x.axis.ticks  0.3965796 0.4112678 0.4259559 0.4406440 0.4553322 0.4700203
## heterogeneity 0.2974142 0.3569603 0.4224665 0.4935051 0.5694952 0.6497169
##                   [,34]     [,35]     [,36]     [,37]    [,38]     [,39]
## x.axis.ticks  0.4847084 0.4993966 0.5140847 0.5287728 0.543461 0.5581491
## heterogeneity 0.7333301 0.8193970 0.9069070 0.9948030 1.082009 1.1674554
##                   [,40]     [,41]     [,42]     [,43]     [,44]     [,45]
## x.axis.ticks  0.5728372 0.5875254 0.6022135 0.6169016 0.6315898 0.6462779
## heterogeneity 1.2501053 1.3289753 1.4031568 1.4718315 1.5342855 1.5899181
##                   [,46]     [,47]     [,48]     [,49]     [,50]     [,51]
## x.axis.ticks  0.6609661 0.6756542 0.6903423 0.7050305 0.7197186 0.7344067
## heterogeneity 1.6382485 1.6789183 1.7116911 1.7364497 1.7531903 1.7620148
##                   [,52]    [,53]     [,54]     [,55]     [,56]     [,57]
## x.axis.ticks  0.7490949 0.763783 0.7784711 0.7931593 0.8078474 0.8225355
## heterogeneity 1.7631221 1.756797 1.7434007 1.7233560 1.6971386 1.6652640
##                   [,58]     [,59]     [,60]     [,61]     [,62]     [,63]
## x.axis.ticks  0.8372237 0.8519118 0.8665999 0.8812881 0.8959762 0.9106643
## heterogeneity 1.6282766 1.5867388 1.5412215 1.4922951 1.4405213 1.3864463
##                   [,64]     [,65]     [,66]     [,67]    [,68]     [,69]
## x.axis.ticks  0.9253525 0.9400406 0.9547287 0.9694169 0.984105 0.9987931
## heterogeneity 1.3305948 1.2734652 1.2155255 1.1572106 1.098920 1.0410155
##                   [,70]     [,71]     [,72]     [,73]    [,74]     [,75]
## x.axis.ticks  1.0134813 1.0281694 1.0428575 1.0575457 1.072234 1.0869220
## heterogeneity 0.9838234 0.9276314 0.8726912 0.8192185 0.767395 0.7173703
##                   [,76]     [,77]     [,78]     [,79]    [,80]     [,81]
## x.axis.ticks  1.1016101 1.1162982 1.1309864 1.1456745 1.160363 1.1750508
## heterogeneity 0.6692633 0.6231647 0.5791393 0.5372285 0.497452 0.4598109
##                   [,82]     [,83]     [,84]     [,85]     [,86]     [,87]
## x.axis.ticks  1.1897389 1.2044270 1.2191152 1.2338033 1.2484914 1.2631796
## heterogeneity 0.4242895 0.3908575 0.3594724 0.3300808 0.3026212 0.2770246
##                   [,88]     [,89]     [,90]     [,91]     [,92]     [,93]
## x.axis.ticks  1.2778677 1.2925558 1.3072440 1.3219321 1.3366202 1.3513084
## heterogeneity 0.2532168 0.2311196 0.2106519 0.1917308 0.1742728 0.1581945
##                   [,94]     [,95]     [,96]     [,97]      [,98]      [,99]
## x.axis.ticks  1.3659965 1.3806846 1.3953728 1.4100609 1.42474904 1.43943718
## heterogeneity 0.1434135 0.1298486 0.1174207 0.1060533 0.09567221 0.08620665
##                   [,100]
## x.axis.ticks  1.45412531
## heterogeneity 0.07758884</code></pre>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="customer-lifetime-value.html#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bgnbd.PlotDropoutRateHeterogeneity</span>(params)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-116-1.png" width="720" style="display: block; margin: auto;" /></p>
<pre><code>##               [,1]         [,2]         [,3]         [,4]         [,5]
## x.axis.ticks     0 1.187082e-04 2.374164e-04 3.561247e-04 0.0004748329
## heterogeneity  Inf 3.832157e+01 1.921071e+01 1.282317e+01 9.6240849257
##                       [,6]         [,7]         [,8]         [,9]       [,10]
## x.axis.ticks  0.0005935411 0.0007122493 0.0008309575 0.0009496657 0.001068374
## heterogeneity 7.7023038611 6.4198859224 5.5031446971 4.8151220706 4.279676455
##                     [,11]      [,12]       [,13]       [,14]       [,15]
## x.axis.ticks  0.001187082 0.00130579 0.001424499 0.001543207 0.001661915
## heterogeneity 3.851094992 3.50027201 3.207794374 2.960216351 2.747930017
##                     [,16]       [,17]      [,18]       [,19]       [,20]
## x.axis.ticks  0.001780623 0.001899331 0.00201804 0.002136748 0.002255456
## heterogeneity 2.563886969 2.402799107 2.26062130 2.134206411 2.021069151
##                     [,21]       [,22]       [,23]       [,24]       [,25]
## x.axis.ticks  0.002374164 0.002492873 0.002611581 0.002730289 0.002848997
## heterogeneity 1.919220770 1.827050925 1.743241750 1.666704325 1.596531025
##                     [,26]       [,27]       [,28]      [,29]       [,30]
## x.axis.ticks  0.002967705 0.003086414 0.003205122 0.00332383 0.003442538
## heterogeneity 1.531959283 1.472343727 1.417134488 1.36586017 1.318114309
##                     [,31]       [,32]       [,33]       [,34]       [,35]
## x.axis.ticks  0.003561247 0.003679955 0.003798663 0.003917371 0.004036079
## heterogeneity 1.273544600 1.231844131 1.192744316 1.156009089 1.121430124
##                     [,36]       [,37]       [,38]       [,39]      [,40]
## x.axis.ticks  0.004154788 0.004273496 0.004392204 0.004510912 0.00462962
## heterogeneity 1.088822879 1.058023293 1.028885021 1.001277106 0.97508201
##                     [,41]       [,42]       [,43]       [,44]       [,45]
## x.axis.ticks  0.004748329 0.004867037 0.004985745 0.005104453 0.005223162
## heterogeneity 0.950193927 0.926517373 0.903965941 0.882461254 0.861932053
##                    [,46]       [,47]       [,48]       [,49]       [,50]
## x.axis.ticks  0.00534187 0.005460578 0.005579286 0.005697994 0.005816703
## heterogeneity 0.84231340 0.823546016 0.805575636 0.788352526 0.771831007
##                     [,51]       [,52]       [,53]       [,54]       [,55]
## x.axis.ticks  0.005935411 0.006054119 0.006172827 0.006291536 0.006410244
## heterogeneity 0.755969048 0.740727911 0.726071835 0.711967753 0.698385048
##                     [,56]      [,57]       [,58]       [,59]       [,60]
## x.axis.ticks  0.006528952 0.00664766 0.006766368 0.006885077 0.007003785
## heterogeneity 0.685295324 0.67267221 0.660491193 0.648729434 0.637365651
##                     [,61]       [,62]       [,63]       [,64]       [,65]
## x.axis.ticks  0.007122493 0.007241201 0.007359909 0.007478618 0.007597326
## heterogeneity 0.626379975 0.615753839 0.605469875 0.595511813 0.585864400
##                     [,66]       [,67]       [,68]       [,69]       [,70]
## x.axis.ticks  0.007716034 0.007834742 0.007953451 0.008072159 0.008190867
## heterogeneity 0.576513321 0.567445127 0.558647172 0.550107551 0.541815051
##                     [,71]       [,72]       [,73]     [,74]       [,75]
## x.axis.ticks  0.008309575 0.008428283 0.008546992 0.0086657 0.008784408
## heterogeneity 0.533759096 0.525929709 0.518317462 0.5109134 0.503709235
##                     [,76]       [,77]       [,78]       [,79]       [,80]
## x.axis.ticks  0.008903116 0.009021825 0.009140533 0.009259241 0.009377949
## heterogeneity 0.496696845 0.489868719 0.483217689 0.476736952 0.470420054
##                     [,81]       [,82]       [,83]       [,84]      [,85]
## x.axis.ticks  0.009496657 0.009615366 0.009734074 0.009852782 0.00997149
## heterogeneity 0.464260859 0.458253535 0.452392536 0.446672580 0.44108864
##                   [,86]      [,87]      [,88]      [,89]      [,90]      [,91]
## x.axis.ticks  0.0100902 0.01020891 0.01032761 0.01044632 0.01056503 0.01068374
## heterogeneity 0.4356359 0.43030985 0.42510607 0.42002042 0.41504892 0.41018778
##                    [,92]      [,93]      [,94]      [,95]      [,96]      [,97]
## x.axis.ticks  0.01080245 0.01092116 0.01103986 0.01115857 0.01127728 0.01139599
## heterogeneity 0.40543336 0.40078218 0.39623092 0.39177640 0.38741557 0.38314551
##                   [,98]      [,99]     [,100]
## x.axis.ticks  0.0115147 0.01163341 0.01175211
## heterogeneity 0.3789634 0.37486657 0.37085243</code></pre>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="customer-lifetime-value.html#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bgnbd.Expectation</span>(params, <span class="at">t=</span><span class="dv">52</span>)</span></code></pre></div>
<pre><code>##       p3 
## 41.92832</code></pre>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="customer-lifetime-value.html#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bgnbd.PlotFrequencyInCalibration</span>(params, cal2010, <span class="dv">85</span>)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-118-1.png" width="720" style="display: block; margin: auto;" /></p>
<pre><code>##                    freq.0   freq.1   freq.2   freq.3   freq.4   freq.5   freq.6
## n.x.actual   0.000000e+00 4.000000 2.000000 4.000000 2.000000 4.000000 2.000000
## n.x.expected 3.529993e-07 2.225145 1.927474 1.699974 1.520557 1.375656 1.256601
##                freq.7   freq.8   freq.9   freq.10   freq.11   freq.12   freq.13
## n.x.actual   3.000000 6.000000 4.000000 5.0000000 5.0000000 3.0000000 3.0000000
## n.x.expected 1.157774 1.075629 1.008158 0.9546069 0.9153288 0.8917102 0.8861372
##                freq.14   freq.15  freq.16   freq.17  freq.18   freq.19  freq.20
## n.x.actual   3.0000000 5.0000000 6.000000 10.000000 5.000000 12.000000 9.000000
## n.x.expected 0.9019715 0.9435202 1.015989  1.125409 1.278537  1.482724 1.745754
##               freq.21  freq.22   freq.23  freq.24  freq.25 freq.26   freq.27
## n.x.actual   9.000000 6.000000 10.000000 4.000000 7.000000 4.00000 12.000000
## n.x.expected 2.075664 2.480535  2.968283 3.546425 4.221866 5.00068  5.887913
##               freq.28   freq.29   freq.30  freq.31  freq.32  freq.33 freq.34
## n.x.actual   5.000000 16.000000 10.000000  7.00000 14.00000  7.00000 15.0000
## n.x.expected 6.887405  8.001637  9.231614 10.57678 12.03495 13.60233 15.2735
##              freq.35  freq.36  freq.37  freq.38  freq.39  freq.40  freq.41
## n.x.actual    9.0000 17.00000 12.00000 15.00000 17.00000 11.00000 18.00000
## n.x.expected 17.0415 18.89789 20.83288 22.83548 24.89363 26.99441 29.12421
##               freq.42  freq.43  freq.44  freq.45  freq.46  freq.47 freq.48
## n.x.actual   16.00000 36.00000 15.00000 22.00000 22.00000 16.00000 19.0000
## n.x.expected 31.26893 33.41418 35.54548 37.64844 39.70895 41.71335 43.6486
##              freq.49  freq.50  freq.51  freq.52  freq.53  freq.54  freq.55
## n.x.actual   20.0000 23.00000 25.00000 17.00000 30.00000 22.00000 24.00000
## n.x.expected 45.5024 47.26333 48.92094 50.46586 51.88983 53.18578 54.34785
##               freq.56  freq.57  freq.58  freq.59  freq.60  freq.61  freq.62
## n.x.actual   27.00000 29.00000 31.00000 33.00000 23.00000 31.00000 31.00000
## n.x.expected 55.37139 56.25297 56.99036 57.58247 58.02933 58.33204 58.49268
##               freq.63  freq.64 freq.65  freq.66  freq.67  freq.68  freq.69
## n.x.actual   35.00000 28.00000 34.0000 51.00000 47.00000 47.00000 41.00000
## n.x.expected 58.51425 58.40059 58.1563 57.78664 57.29747 56.69516 55.98646
##               freq.70  freq.71  freq.72  freq.73  freq.74  freq.75 freq.76
## n.x.actual   62.00000 61.00000 45.00000 53.00000 74.00000 73.00000 78.0000
## n.x.expected 55.17848 54.27856 53.29424 52.23314 51.10291 49.91118 48.6655
##               freq.77   freq.78  freq.79   freq.80   freq.81   freq.82
## n.x.actual   93.00000 109.00000 94.00000 123.00000 161.00000 184.00000
## n.x.expected 47.37326  46.04169 44.67778  43.28826  41.87956  40.45781
##                freq.83 freq.84  freq.85+
## n.x.actual   205.00000 225.000 327.00000
## n.x.expected  39.02881  37.598  36.17045</code></pre>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="customer-satisfaction-and-loyalty.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
