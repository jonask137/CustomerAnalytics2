<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Recommender Systems and Customer Targeting | Customer Analytics</title>
  <meta name="description" content="3 Recommender Systems and Customer Targeting | Customer Analytics" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Recommender Systems and Customer Targeting | Customer Analytics" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Recommender Systems and Customer Targeting | Customer Analytics" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="customer-satisfaction-and-loyalty.html"/>
<link rel="next" href="probabilistic-models-for-customer-analytics.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script>
<link href="libs/vis-4.20.1/vis.css" rel="stylesheet" />
<script src="libs/vis-4.20.1/vis.min.js"></script>
<script src="libs/visNetwork-binding-2.0.9/visNetwork.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>setup</a></li>
<li class="chapter" data-level="1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html"><i class="fa fa-check"></i><b>1</b> Customer Lifetime Value</a>
<ul>
<li class="chapter" data-level="1.1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#non-contractual-the-matrix-formulation-migration-model"><i class="fa fa-check"></i><b>1.1</b> Non-contractual: The matrix formulation (Migration model)</a></li>
<li class="chapter" data-level="1.2" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#contractual-valuing-customer-base-residual-lifetime-value"><i class="fa fa-check"></i><b>1.2</b> Contractual: Valuing customer base + residual lifetime value</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#sbg-shifted-beta-geometric-model"><i class="fa fa-check"></i><b>1.2.1</b> sBG (Shifted Beta Geometric model)</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#non-contractual-setting-probabilitic-models"><i class="fa fa-check"></i><b>1.3</b> Non-Contractual Setting: Probabilitic Models</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#paretonbd-vs.-bgnbd"><i class="fa fa-check"></i><b>1.3.1</b> Pareto/NBD vs.Â BG/NBD</a></li>
<li class="chapter" data-level="1.3.2" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#paretonbd"><i class="fa fa-check"></i><b>1.3.2</b> Pareto/NBD</a>
<ul>
<li class="chapter" data-level="1.3.2.1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#data-preparation"><i class="fa fa-check"></i><b>1.3.2.1</b> Data preparation</a></li>
<li class="chapter" data-level="1.3.2.2" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#parameter-estimation"><i class="fa fa-check"></i><b>1.3.2.2</b> Parameter Estimation</a></li>
<li class="chapter" data-level="1.3.2.3" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#individual-level-estimations"><i class="fa fa-check"></i><b>1.3.2.3</b> Individual Level Estimations</a></li>
<li class="chapter" data-level="1.3.2.4" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#plotting-goodness-of-fit"><i class="fa fa-check"></i><b>1.3.2.4</b> Plotting / Goodness-of-fit</a></li>
</ul></li>
<li class="chapter" data-level="1.3.3" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#bgnbd"><i class="fa fa-check"></i><b>1.3.3</b> BG/NBD</a>
<ul>
<li class="chapter" data-level="1.3.3.1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#data-preparation-1"><i class="fa fa-check"></i><b>1.3.3.1</b> Data Preparation</a></li>
<li class="chapter" data-level="1.3.3.2" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#parameter-estimation-1"><i class="fa fa-check"></i><b>1.3.3.2</b> Parameter Estimation</a></li>
<li class="chapter" data-level="1.3.3.3" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#individual-level-estimation"><i class="fa fa-check"></i><b>1.3.3.3</b> Individual Level Estimation</a></li>
<li class="chapter" data-level="1.3.3.4" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#plotting-goodness-of-fit-1"><i class="fa fa-check"></i><b>1.3.3.4</b> Plotting / Goodness-of-fit</a></li>
</ul></li>
<li class="chapter" data-level="1.3.4" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#bgbb---not-curicullum"><i class="fa fa-check"></i><b>1.3.4</b> BG/BB - Not curicullum</a></li>
<li class="chapter" data-level="1.3.5" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#examples-from-the-lecture"><i class="fa fa-check"></i><b>1.3.5</b> Examples from the lecture</a>
<ul>
<li class="chapter" data-level="1.3.5.1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#paretonbd-1"><i class="fa fa-check"></i><b>1.3.5.1</b> Pareto/NBD</a>
<ul>
<li class="chapter" data-level="1.3.5.1.1" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#estimate-parameters-for-paretonbd-model-based-upon-calibration-data"><i class="fa fa-check"></i><b>1.3.5.1.1</b> Estimate parameters for Pareto/NBD model based upon calibration data</a></li>
</ul></li>
<li class="chapter" data-level="1.3.5.2" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#dert-calculation"><i class="fa fa-check"></i><b>1.3.5.2</b> DERT Calculation</a></li>
<li class="chapter" data-level="1.3.5.3" data-path="customer-lifetime-value.html"><a href="customer-lifetime-value.html#bgnbg-example"><i class="fa fa-check"></i><b>1.3.5.3</b> BG/NBG example</a></li>
</ul></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html"><i class="fa fa-check"></i><b>2</b> Customer Satisfaction and Loyalty</a>
<ul>
<li class="chapter" data-level="2.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#customer-surveys"><i class="fa fa-check"></i><b>2.1</b> Customer surveys</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#concepts-and-examples"><i class="fa fa-check"></i><b>2.1.1</b> (1) Concepts and examples</a></li>
<li class="chapter" data-level="2.1.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#sampling-and-response-rate"><i class="fa fa-check"></i><b>2.1.2</b> (2) Sampling and response rate</a></li>
<li class="chapter" data-level="2.1.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#pretesting-and-measurement-validity"><i class="fa fa-check"></i><b>2.1.3</b> (3) Pretesting and measurement validity</a></li>
<li class="chapter" data-level="2.1.4" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#questionnaire-design"><i class="fa fa-check"></i><b>2.1.4</b> (4) Questionnaire design</a></li>
<li class="chapter" data-level="2.1.5" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#simple-size"><i class="fa fa-check"></i><b>2.1.5</b> (5) Simple size</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#nps"><i class="fa fa-check"></i><b>2.2</b> NPS</a></li>
<li class="chapter" data-level="2.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#efa-cfa-and-sem"><i class="fa fa-check"></i><b>2.3</b> EFA, CFA and SEM</a></li>
<li class="chapter" data-level="2.4" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#application-with-lavann-and-hbat-data"><i class="fa fa-check"></i><b>2.4</b> Application with Lavann and HBAT data</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#business-problem-objectives"><i class="fa fa-check"></i><b>2.4.1</b> Business Problem &amp; Objectives</a></li>
<li class="chapter" data-level="2.4.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#data"><i class="fa fa-check"></i><b>2.4.2</b> Data</a>
<ul>
<li class="chapter" data-level="2.4.2.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#efa"><i class="fa fa-check"></i><b>2.4.2.1</b> EFA</a></li>
<li class="chapter" data-level="2.4.2.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#cfa-model"><i class="fa fa-check"></i><b>2.4.2.2</b> CFA model</a>
<ul>
<li class="chapter" data-level="2.4.2.2.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#initial-model"><i class="fa fa-check"></i><b>2.4.2.2.1</b> Initial model</a></li>
<li class="chapter" data-level="2.4.2.2.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#second-model"><i class="fa fa-check"></i><b>2.4.2.2.2</b> Second model</a>
<ul>
<li class="chapter" data-level="2.4.2.2.2.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#intepretation-of-the-model"><i class="fa fa-check"></i><b>2.4.2.2.2.1</b> Intepretation of the model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2.4.2.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#sem"><i class="fa fa-check"></i><b>2.4.2.3</b> SEM</a></li>
</ul></li>
<li class="chapter" data-level="2.4.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#plotting-the-model"><i class="fa fa-check"></i><b>2.4.3</b> Plotting the model</a></li>
<li class="chapter" data-level="2.4.4" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#consider-a-more-complex-sem-model-involving-a-mediating-effect."><i class="fa fa-check"></i><b>2.4.4</b> Consider a more complex SEM model involving a mediating effect.</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#pls"><i class="fa fa-check"></i><b>2.5</b> PLS</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#definition-of-pls"><i class="fa fa-check"></i><b>2.5.1</b> Definition of PLS</a></li>
<li class="chapter" data-level="2.5.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#when-to-use-pls-and-when-to-use-sem"><i class="fa fa-check"></i><b>2.5.2</b> When to use PLS and when to use SEM</a></li>
<li class="chapter" data-level="2.5.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#model-construction"><i class="fa fa-check"></i><b>2.5.3</b> Model construction</a></li>
<li class="chapter" data-level="2.5.4" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#model-estimation"><i class="fa fa-check"></i><b>2.5.4</b> Model Estimation</a></li>
<li class="chapter" data-level="2.5.5" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#model-evaluation"><i class="fa fa-check"></i><b>2.5.5</b> Model evaluation</a></li>
<li class="chapter" data-level="2.5.6" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#example-for-the-lecture"><i class="fa fa-check"></i><b>2.5.6</b> Example for the lecture</a>
<ul>
<li class="chapter" data-level="2.5.6.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#making-structural--and-measurement-model"><i class="fa fa-check"></i><b>2.5.6.1</b> Making structural- and measurement model</a></li>
<li class="chapter" data-level="2.5.6.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#now-we-can-estimate-the-model"><i class="fa fa-check"></i><b>2.5.6.2</b> Now we can estimate the model</a></li>
<li class="chapter" data-level="2.5.6.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#measuring-quality-of-the-constructs"><i class="fa fa-check"></i><b>2.5.6.3</b> Measuring quality of the constructs</a></li>
<li class="chapter" data-level="2.5.6.4" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#are-the-coefficients-significant"><i class="fa fa-check"></i><b>2.5.6.4</b> Are the coefficients significant?</a></li>
</ul></li>
<li class="chapter" data-level="2.5.7" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#revised-code"><i class="fa fa-check"></i><b>2.5.7</b> Revised code</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#segmentation-clustering"><i class="fa fa-check"></i><b>2.6</b> Segmentation (Clustering)</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#what-is-clustering"><i class="fa fa-check"></i><b>2.6.1</b> What is clustering</a></li>
<li class="chapter" data-level="2.6.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#clustering-techniques"><i class="fa fa-check"></i><b>2.6.2</b> Clustering techniques</a></li>
<li class="chapter" data-level="2.6.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#an-example-with-hbat"><i class="fa fa-check"></i><b>2.6.3</b> An example with HBAT</a>
<ul>
<li class="chapter" data-level="2.6.3.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#background"><i class="fa fa-check"></i><b>2.6.3.1</b> 1. Background</a>
<ul>
<li class="chapter" data-level="2.6.3.1.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#the-primary-objective-is"><i class="fa fa-check"></i><b>2.6.3.1.1</b> 1.1. The primary objective is:</a></li>
</ul></li>
<li class="chapter" data-level="2.6.3.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#the-data-data-understanding-phase"><i class="fa fa-check"></i><b>2.6.3.2</b> 2. The data (Data Understanding Phase)</a>
<ul>
<li class="chapter" data-level="2.6.3.2.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#load-data-correctly"><i class="fa fa-check"></i><b>2.6.3.2.1</b> 2.1 Load data correctly</a></li>
<li class="chapter" data-level="2.6.3.2.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#check-if-the-data-is-numerical-or-categorical"><i class="fa fa-check"></i><b>2.6.3.2.2</b> 2.2 Check if the data is numerical or categorical</a></li>
<li class="chapter" data-level="2.6.3.2.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#missing-treatment"><i class="fa fa-check"></i><b>2.6.3.2.3</b> 2.3 Missing treatment</a></li>
<li class="chapter" data-level="2.6.3.2.4" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#select-relevant-variables"><i class="fa fa-check"></i><b>2.6.3.2.4</b> 2.4 Select relevant variables</a></li>
<li class="chapter" data-level="2.6.3.2.5" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#identify-extreme-outliers-the-most-dissimilar-customers"><i class="fa fa-check"></i><b>2.6.3.2.5</b> 2.5.Identify extreme outliers (the most dissimilar customers)</a></li>
<li class="chapter" data-level="2.6.3.2.6" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#standardize-the-variables-mean0-std.dev1"><i class="fa fa-check"></i><b>2.6.3.2.6</b> 2.6 Standardize the variables (mean=0, std.dev=1)</a></li>
</ul></li>
<li class="chapter" data-level="2.6.3.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#hierarchical-clustering-using-variables"><i class="fa fa-check"></i><b>2.6.3.3</b> 3. Hierarchical clustering (using variables)</a></li>
<li class="chapter" data-level="2.6.3.4" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#hierarchical-clustering-using-pcs-score-vectors"><i class="fa fa-check"></i><b>2.6.3.4</b> 4. Hierarchical clustering (using PCs score vectors)</a></li>
<li class="chapter" data-level="2.6.3.5" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#k-means"><i class="fa fa-check"></i><b>2.6.3.5</b> 5. K-means</a></li>
<li class="chapter" data-level="2.6.3.6" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#validation-and-profiling-the-clusters"><i class="fa fa-check"></i><b>2.6.3.6</b> 6. Validation and profiling the clusters</a>
<ul>
<li class="chapter" data-level="2.6.3.6.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#assessing-cluster-stability"><i class="fa fa-check"></i><b>2.6.3.6.1</b> 6.1. Assessing cluster stability</a></li>
<li class="chapter" data-level="2.6.3.6.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#assessing-criterion-predictive-validity"><i class="fa fa-check"></i><b>2.6.3.6.2</b> 6.2. Assessing criterion (predictive) validity</a></li>
<li class="chapter" data-level="2.6.3.6.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#profiling-the-final-cluster-solution"><i class="fa fa-check"></i><b>2.6.3.6.3</b> 6.3. Profiling the final cluster solution</a></li>
</ul></li>
<li class="chapter" data-level="2.6.3.7" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#final-remarks"><i class="fa fa-check"></i><b>2.6.3.7</b> 7. Final remarks</a></li>
</ul></li>
<li class="chapter" data-level="2.6.4" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#an-example-with-mcdonalds-data"><i class="fa fa-check"></i><b>2.6.4</b> An example with McDonalds data</a>
<ul>
<li class="chapter" data-level="2.6.4.1" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#loading-and-exploring-the-data"><i class="fa fa-check"></i><b>2.6.4.1</b> Loading and exploring the data</a></li>
<li class="chapter" data-level="2.6.4.2" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#k-means-clustering"><i class="fa fa-check"></i><b>2.6.4.2</b> k-Means clustering</a></li>
<li class="chapter" data-level="2.6.4.3" data-path="customer-satisfaction-and-loyalty.html"><a href="customer-satisfaction-and-loyalty.html#interpreting-the-clusters"><i class="fa fa-check"></i><b>2.6.4.3</b> Interpreting the clusters</a></li>
</ul></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html"><i class="fa fa-check"></i><b>3</b> Recommender Systems and Customer Targeting</a>
<ul>
<li class="chapter" data-level="3.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#association-rule"><i class="fa fa-check"></i><b>3.1</b> Association rule</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#loading-and-data-exploration"><i class="fa fa-check"></i><b>3.1.1</b> Loading and data exploration</a></li>
<li class="chapter" data-level="3.1.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#data-preprocessing"><i class="fa fa-check"></i><b>3.1.2</b> Data preprocessing</a>
<ul>
<li class="chapter" data-level="3.1.2.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#encoding-to-correct-data-types"><i class="fa fa-check"></i><b>3.1.2.1</b> Encoding to correct data types</a></li>
<li class="chapter" data-level="3.1.2.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#create-a-data-frame-with-one-row-pr.-invoice"><i class="fa fa-check"></i><b>3.1.2.2</b> Create a data frame with one row pr. invoice</a></li>
</ul></li>
<li class="chapter" data-level="3.1.3" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#loading-transactions"><i class="fa fa-check"></i><b>3.1.3</b> Loading transactions</a></li>
<li class="chapter" data-level="3.1.4" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#plotting"><i class="fa fa-check"></i><b>3.1.4</b> Plotting</a></li>
<li class="chapter" data-level="3.1.5" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#apriori-calculation"><i class="fa fa-check"></i><b>3.1.5</b> Apriori calculation</a>
<ul>
<li class="chapter" data-level="3.1.5.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#another-example-where-maxlen-3"><i class="fa fa-check"></i><b>3.1.5.1</b> Another example where maxlen = 3</a></li>
<li class="chapter" data-level="3.1.5.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#filtering-on-right-hand-side.-an-example-with-the-item-metal"><i class="fa fa-check"></i><b>3.1.5.2</b> Filtering on right hand side. An example with the item {METAL}</a></li>
<li class="chapter" data-level="3.1.5.3" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#filtering-on-left-hand-side.-an-example-with-the-item-metal"><i class="fa fa-check"></i><b>3.1.5.3</b> Filtering on left hand side. An example with the item {METAL}</a></li>
</ul></li>
<li class="chapter" data-level="3.1.6" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#plotting-association-rules"><i class="fa fa-check"></i><b>3.1.6</b> Plotting association rules</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#colaborative-filtering"><i class="fa fa-check"></i><b>3.2</b> Colaborative filtering</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#loading-and-formatting-data"><i class="fa fa-check"></i><b>3.2.1</b> Loading and formatting data</a>
<ul>
<li class="chapter" data-level="3.2.1.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#loading-metadata-that-gets-loaded-with-main-dataset"><i class="fa fa-check"></i><b>3.2.1.1</b> Loading metadata that gets loaded with main dataset</a></li>
</ul></li>
<li class="chapter" data-level="3.2.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#data-exploration"><i class="fa fa-check"></i><b>3.2.2</b> Data Exploration</a>
<ul>
<li class="chapter" data-level="3.2.2.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#plotting-1"><i class="fa fa-check"></i><b>3.2.2.1</b> Plotting</a></li>
</ul></li>
<li class="chapter" data-level="3.2.3" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#what-models-can-we-use"><i class="fa fa-check"></i><b>3.2.3</b> What models can we use?</a></li>
<li class="chapter" data-level="3.2.4" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#training-and-test-set"><i class="fa fa-check"></i><b>3.2.4</b> Training and test set</a></li>
<li class="chapter" data-level="3.2.5" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#a-small-example-with-ibcf-item-based"><i class="fa fa-check"></i><b>3.2.5</b> A small example with IBCF (item based)</a></li>
<li class="chapter" data-level="3.2.6" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#ubcf---user-based-collaborative-based"><i class="fa fa-check"></i><b>3.2.6</b> UBCF - User based collaborative based</a>
<ul>
<li class="chapter" data-level="3.2.6.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#fitting-the-model"><i class="fa fa-check"></i><b>3.2.6.1</b> Fitting the model</a></li>
<li class="chapter" data-level="3.2.6.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#predicting-making-recommendations"><i class="fa fa-check"></i><b>3.2.6.2</b> Predicting (making) recommendations</a></li>
</ul></li>
<li class="chapter" data-level="3.2.7" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#cross-validation"><i class="fa fa-check"></i><b>3.2.7</b> Cross validation</a></li>
<li class="chapter" data-level="3.2.8" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#ibcf---item-based-collaborative-based"><i class="fa fa-check"></i><b>3.2.8</b> IBCF - Item based collaborative based</a>
<ul>
<li class="chapter" data-level="3.2.8.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#fitting-the-model-using-cv"><i class="fa fa-check"></i><b>3.2.8.1</b> Fitting the model (using CV)</a></li>
<li class="chapter" data-level="3.2.8.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#making-predictions"><i class="fa fa-check"></i><b>3.2.8.2</b> Making predictions</a></li>
<li class="chapter" data-level="3.2.8.3" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#performance-metrics"><i class="fa fa-check"></i><b>3.2.8.3</b> Performance metrics</a></li>
</ul></li>
<li class="chapter" data-level="3.2.9" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#building-roc-curve-and-precision-recall-rate"><i class="fa fa-check"></i><b>3.2.9</b> Building ROC curve and precision / recall rate</a></li>
<li class="chapter" data-level="3.2.10" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#comparing-ubcf-and-ibcf"><i class="fa fa-check"></i><b>3.2.10</b> Comparing UBCF and IBCF</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#latent-factor-models"><i class="fa fa-check"></i><b>3.3</b> Latent Factor Models</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#fitting-the-model-1"><i class="fa fa-check"></i><b>3.3.1</b> Fitting the model</a></li>
<li class="chapter" data-level="3.3.2" data-path="recommender-systems-and-customer-targeting.html"><a href="recommender-systems-and-customer-targeting.html#making-predictions-1"><i class="fa fa-check"></i><b>3.3.2</b> Making predictions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html"><i class="fa fa-check"></i><b>4</b> Probabilistic Models for Customer Analytics</a>
<ul>
<li class="chapter" data-level="4.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#bayesian-networks"><i class="fa fa-check"></i><b>4.1</b> Bayesian Networks</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#why-bayesian"><i class="fa fa-check"></i><b>4.1.1</b> <strong><em>Why Bayesian?</em></strong></a>
<ul>
<li class="chapter" data-level="4.1.1.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#many-names-for-bayesian-networks"><i class="fa fa-check"></i><b>4.1.1.1</b> <strong>Many names for Bayesian Networks</strong></a></li>
</ul></li>
<li class="chapter" data-level="4.1.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#terms-and-explanatory-examples"><i class="fa fa-check"></i><b>4.1.2</b> Terms and explanatory examples</a>
<ul>
<li class="chapter" data-level="4.1.2.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#types-of-connections"><i class="fa fa-check"></i><b>4.1.2.1</b> Types of connections</a></li>
<li class="chapter" data-level="4.1.2.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#variable-selection-based-on-a-bayesian-network"><i class="fa fa-check"></i><b>4.1.2.2</b> Variable selection based on a Bayesian Network</a></li>
</ul></li>
<li class="chapter" data-level="4.1.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#independence"><i class="fa fa-check"></i><b>4.1.3</b> Independence</a></li>
<li class="chapter" data-level="4.1.4" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#methods-for-identifying-the-network"><i class="fa fa-check"></i><b>4.1.4</b> Methods for identifying the network</a>
<ul>
<li class="chapter" data-level="4.1.4.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#algorithms-focused-on-causality-discovery"><i class="fa fa-check"></i><b>4.1.4.1</b> 1. <strong><em>Algorithms focused on causality discovery</em></strong></a></li>
<li class="chapter" data-level="4.1.4.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#algorithms-focused-on-prediction"><i class="fa fa-check"></i><b>4.1.4.2</b> 2. <strong><em>Algorithms focused on prediction</em></strong></a></li>
</ul></li>
<li class="chapter" data-level="4.1.5" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#real-life-application"><i class="fa fa-check"></i><b>4.1.5</b> <strong>Real life application</strong></a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#application-1-explaining-and-predicting-customer-retention-in-a-virtual-community"><i class="fa fa-check"></i><b>4.2</b> Application 1: Explaining and Predicting Customer Retention in a Virtual Community</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#getting-the-structure"><i class="fa fa-check"></i><b>4.2.1</b> 1. Getting the structure</a>
<ul>
<li class="chapter" data-level="4.2.1.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#a.-building-the-structure-and-parameters-manually"><i class="fa fa-check"></i><b>4.2.1.1</b> A. Building the structure and parameters manually</a>
<ul>
<li class="chapter" data-level="4.2.1.1.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#approaches-to-make-the-network"><i class="fa fa-check"></i><b>4.2.1.1.1</b> Approaches to make the network</a>
<ul>
<li class="chapter" data-level="4.2.1.1.1.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#i-first-approach"><i class="fa fa-check"></i><b>4.2.1.1.1.1</b> (i) First approach</a></li>
<li class="chapter" data-level="4.2.1.1.1.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#ii-second-approach"><i class="fa fa-check"></i><b>4.2.1.1.1.2</b> (ii) Second approach</a></li>
<li class="chapter" data-level="4.2.1.1.1.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#iii-third-approach"><i class="fa fa-check"></i><b>4.2.1.1.1.3</b> (iii) Third approach</a></li>
</ul></li>
<li class="chapter" data-level="4.2.1.1.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#loadingentering-data"><i class="fa fa-check"></i><b>4.2.1.1.2</b> Loading/entering data</a></li>
<li class="chapter" data-level="4.2.1.1.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#conditional-probability-table-cpt"><i class="fa fa-check"></i><b>4.2.1.1.3</b> Conditional probability table (CPT)</a></li>
</ul></li>
<li class="chapter" data-level="4.2.1.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#b.-learning-the-structure-and-parameters-from-observational-data"><i class="fa fa-check"></i><b>4.2.1.2</b> B. Learning the structure and parameters from observational data</a>
<ul>
<li class="chapter" data-level="4.2.1.2.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#grow-shrink-gs---learning-a-structure-using-a-constrained-based-algorithm"><i class="fa fa-check"></i><b>4.2.1.2.1</b> Grow-shrink (gs) - Learning a structure using a constrained-based algorithm</a>
<ul>
<li class="chapter" data-level="4.2.1.2.1.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#identifying-undirectred-links"><i class="fa fa-check"></i><b>4.2.1.2.1.1</b> Identifying undirectred links</a></li>
</ul></li>
<li class="chapter" data-level="4.2.1.2.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#hill-climbing-hc---learning-the-structure-using-a-score-based-algorithm"><i class="fa fa-check"></i><b>4.2.1.2.2</b> Hill-Climbing (hc) - Learning the structure using a score-based algorithm</a></li>
<li class="chapter" data-level="4.2.1.2.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#fitting-the-model-to-the-data-learning-the-probabilities"><i class="fa fa-check"></i><b>4.2.1.2.3</b> Fitting the model to the data (learning the probabilities)</a></li>
<li class="chapter" data-level="4.2.1.2.4" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#alternatives-to-grow-shrink-and-hc"><i class="fa fa-check"></i><b>4.2.1.2.4</b> Alternatives to Grow-Shrink and HC</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4.2.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#model-evaluation-1"><i class="fa fa-check"></i><b>4.2.2</b> 2. Model evaluation</a>
<ul>
<li class="chapter" data-level="4.2.2.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#i.-metrics-of-model-complexity"><i class="fa fa-check"></i><b>4.2.2.1</b> I. Metrics of model complexity</a></li>
<li class="chapter" data-level="4.2.2.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#ii.-metrics-of-model-sensitivity"><i class="fa fa-check"></i><b>4.2.2.2</b> II. Metrics of model sensitivity</a></li>
<li class="chapter" data-level="4.2.2.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#iii.-evaluate-the-arc.strength"><i class="fa fa-check"></i><b>4.2.2.3</b> III. Evaluate the arc.strength()</a>
<ul>
<li class="chapter" data-level="4.2.2.3.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#for-the-growth-shrink"><i class="fa fa-check"></i><b>4.2.2.3.1</b> For the growth shrink</a></li>
<li class="chapter" data-level="4.2.2.3.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#for-the-hill-climbing-structure"><i class="fa fa-check"></i><b>4.2.2.3.2</b> For the hill-climbing structure</a></li>
<li class="chapter" data-level="4.2.2.3.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#different-information-criteria-evaluations"><i class="fa fa-check"></i><b>4.2.2.3.3</b> Different information criteria evaluations</a></li>
</ul></li>
<li class="chapter" data-level="4.2.2.4" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#iv.-metrics-of-predictive-accuracy-error-rate-confusion-matrix-auc"><i class="fa fa-check"></i><b>4.2.2.4</b> IV. Metrics of predictive accuracy (error rate, confusion matrix, AUC)</a>
<ul>
<li class="chapter" data-level="4.2.2.4.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#cross-validation-1"><i class="fa fa-check"></i><b>4.2.2.4.1</b> Cross validation</a></li>
<li class="chapter" data-level="4.2.2.4.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#alternative-approach-to-fit-and-predict-without-grain"><i class="fa fa-check"></i><b>4.2.2.4.2</b> Alternative approach to fit and predict (Without gRain)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4.2.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#making-inference-and-queries-based-on-the-model"><i class="fa fa-check"></i><b>4.2.3</b> 3. Making inference and queries based on the model</a>
<ul>
<li class="chapter" data-level="4.2.3.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#diagnostics-forward-inference"><i class="fa fa-check"></i><b>4.2.3.1</b> Diagnostics (Forward inference)</a>
<ul>
<li class="chapter" data-level="4.2.3.1.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#let-us-repeat-the-same-analysis-by-setting-evidence-in-pleasure"><i class="fa fa-check"></i><b>4.2.3.1.1</b> <em>let us repeat the same analysis by setting evidence in Pleasure</em></a></li>
</ul></li>
<li class="chapter" data-level="4.2.3.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#diagnostic-backward-inference"><i class="fa fa-check"></i><b>4.2.3.2</b> Diagnostic (Backward inference)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#application-2-identifying-populations-with-positive-expected-lift-in-profit-elp-and-targeting"><i class="fa fa-check"></i><b>4.3</b> Application 2: Identifying populations with Positive Expected Lift in Profit (ELP) and targeting</a></li>
<li class="chapter" data-level="4.4" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#application-3-product-recommendation-using-probabilistic-models-bn"><i class="fa fa-check"></i><b>4.4</b> Application 3: Product Recommendation using Probabilistic Models (BN)</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#method-1-learn-the-probabilistic-relationships-using-a-bayesian-network-learning"><i class="fa fa-check"></i><b>4.4.1</b> Method 1: Learn the probabilistic relationships using a Bayesian network learning</a></li>
<li class="chapter" data-level="4.4.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#method-2-finding-latent-segments"><i class="fa fa-check"></i><b>4.4.2</b> Method 2: Finding latent segments</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#latent-models-for-cross-selling-and-acquisition-sequence"><i class="fa fa-check"></i><b>4.5</b> Latent models for cross selling and acquisition sequence</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#latent-trait-model---applying-the-ltm-package-in-r"><i class="fa fa-check"></i><b>4.5.1</b> Latent Trait Model - Applying the LTM Package in R</a></li>
<li class="chapter" data-level="4.5.2" data-path="probabilistic-models-for-customer-analytics.html"><a href="probabilistic-models-for-customer-analytics.html#the-latent-hidden-markov-model"><i class="fa fa-check"></i><b>4.5.2</b> The latent (hidden) Markov model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="customer-behavior.html"><a href="customer-behavior.html"><i class="fa fa-check"></i><b>5</b> Customer behavior</a>
<ul>
<li class="chapter" data-level="5.1" data-path="customer-behavior.html"><a href="customer-behavior.html#characteristics-of-cliskstream"><i class="fa fa-check"></i><b>5.1</b> Characteristics of cliskstream</a></li>
<li class="chapter" data-level="5.2" data-path="customer-behavior.html"><a href="customer-behavior.html#applications-with-clickstream-data"><i class="fa fa-check"></i><b>5.2</b> Applications with clickstream data</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="customer-behavior.html"><a href="customer-behavior.html#a-motivating-example"><i class="fa fa-check"></i><b>5.2.1</b> A motivating example</a>
<ul>
<li class="chapter" data-level="5.2.1.1" data-path="customer-behavior.html"><a href="customer-behavior.html#i-predict-either-the-next-click-or-the-ï¬nal-click-state-of-a-customer."><i class="fa fa-check"></i><b>5.2.1.1</b> i) Predict either the next click or the ï¬nal click (state) of a customer.</a></li>
<li class="chapter" data-level="5.2.1.2" data-path="customer-behavior.html"><a href="customer-behavior.html#ii-clustering-and-generalizing-upon-clickstreams"><i class="fa fa-check"></i><b>5.2.1.2</b> ii) Clustering and generalizing upon clickstreams</a></li>
</ul></li>
<li class="chapter" data-level="5.2.2" data-path="customer-behavior.html"><a href="customer-behavior.html#second-exercise-clickstream-more-extensive"><i class="fa fa-check"></i><b>5.2.2</b> Second exercise (clickstream) more extensive</a></li>
<li class="chapter" data-level="5.2.3" data-path="customer-behavior.html"><a href="customer-behavior.html#a-concrete-eaxmple-with-real-data"><i class="fa fa-check"></i><b>5.2.3</b> A concrete eaxmple with real data</a>
<ul>
<li class="chapter" data-level="5.2.3.1" data-path="customer-behavior.html"><a href="customer-behavior.html#markov-chain"><i class="fa fa-check"></i><b>5.2.3.1</b> (1) Markov Chain</a></li>
<li class="chapter" data-level="5.2.3.2" data-path="customer-behavior.html"><a href="customer-behavior.html#using-association-rule-mining"><i class="fa fa-check"></i><b>5.2.3.2</b> (2) Using association rule mining</a></li>
<li class="chapter" data-level="5.2.3.3" data-path="customer-behavior.html"><a href="customer-behavior.html#use-frequencies-instead-of-the-sequence"><i class="fa fa-check"></i><b>5.2.3.3</b> (3) Use frequencies instead of the sequence</a></li>
<li class="chapter" data-level="5.2.3.4" data-path="customer-behavior.html"><a href="customer-behavior.html#neural-networks"><i class="fa fa-check"></i><b>5.2.3.4</b> (4) Neural networks</a></li>
</ul></li>
<li class="chapter" data-level="5.2.4" data-path="customer-behavior.html"><a href="customer-behavior.html#optional-exercise"><i class="fa fa-check"></i><b>5.2.4</b> Optional exercise</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="customer-behavior.html"><a href="customer-behavior.html#ab-testing"><i class="fa fa-check"></i><b>5.3</b> AB Testing</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="customer-behavior.html"><a href="customer-behavior.html#what-is-it-and-when-to-apply-it"><i class="fa fa-check"></i><b>5.3.1</b> (1 + 2): What is it and when to apply it</a></li>
<li class="chapter" data-level="5.3.2" data-path="customer-behavior.html"><a href="customer-behavior.html#how-to-perform-an-ab-test"><i class="fa fa-check"></i><b>5.3.2</b> (3): How to perform an A/B test</a></li>
<li class="chapter" data-level="5.3.3" data-path="customer-behavior.html"><a href="customer-behavior.html#pitfalls-and-challenges."><i class="fa fa-check"></i><b>5.3.3</b> (4): Pitfalls and challenges.</a></li>
<li class="chapter" data-level="5.3.4" data-path="customer-behavior.html"><a href="customer-behavior.html#ab-tests-and-bandits."><i class="fa fa-check"></i><b>5.3.4</b> (5): A/B tests and bandits.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="privacy.html"><a href="privacy.html"><i class="fa fa-check"></i><b>6</b> Privacy</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Customer Analytics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="recommender-systems-and-customer-targeting" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Recommender Systems and Customer Targeting</h1>
<p>This group of lectures cover three different approaches to mining associations.</p>
<ol style="list-style-type: decimal">
<li>Association rules</li>
<li>Collaborative filtering</li>
<li>Latent factor models</li>
</ol>
<p><strong><em>Association rules</em></strong></p>
<p>We see that association rules looks at transactions and assess what products there appear to be on the same transaction, and thus creates association rules based on these.</p>
<p>With these rules you can start making recommendations or generate ideas of what products should be marketed together. For instance one of the fun examples is where you see that beers and diapers often comes together. When you think about it, it is very logical, because people with small kids cant go out, but they might still enjoy a beer, thus they have to do it at home.</p>
<p><strong><em>Collaborative filtering</em></strong></p>
<p>Then we have collaborative filtering. Here we will work on two different approaches, item-based and user-based.</p>
<ul>
<li><p>User-based: we want to predict one users ratings of a given product/service based on similarity with other users.</p></li>
<li><p>item-based: we want to predict one users ratings of a given product/service based on its similarity with other products, e.g., if one consistenly rate thai food high, then he may also like other thai food, this is in principle also what I have explored with the recommender system on the DSP.</p></li>
</ul>
<p>This is very much used for making recommender system. This was also very much applied in the Netflix competition.</p>
<p>With this, we have the term cold start, that is when you have a new user, you must make some recommendations before you can use the contents, e.g., what you are doing at Netflix, so it starts knowing your preferences.</p>
<p><strong><em>Latent factor models</em></strong></p>
<p>The last approach is the latent factor model, this is just an extension of the user-based and item-based, where both scenarios are considered. This method assumes that we make some constructs, e.g., as in SEM, where the constructs are explained by different items (movies). Then it would be obvious to make constructs based on different genres. These constructs are not directly observable, hence the name latent.</p>
<p>Within LFM cold start also applies.</p>
<p>In general we see that this model gives the best predictions. That is also due to the possibility of regularizing user ratings, hence accounting for user specific biases.</p>
<p>Notice that in the very end of this chapter a comparison between IBCF, UBCF, latent factor models and latent factor models accounting for user bias is shown.</p>
<div id="association-rule" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Association rule</h2>
<p>Basically the method looks at what products that appear in the same transaction and the finds pairs, or items that come together.</p>
<p>Terms:</p>
<ul>
<li>Items: these are the different products that can be bought, can also be a product group</li>
<li>Itemset: this is the dataset containing a list of all of the items</li>
<li>Syntatic Constrains: constraints involving restrictions on items that can appear in a rule. E.g., one may say, that we only want to evaluate one item (product) or an itemrange.</li>
<li>Support Constraints: constraints the number of transactions in T that support a rule. Notice that in R there are default values for this.</li>
<li>Minsupport: This is the threshold assigned to item pairs, used in procedure 1.
+ Large itemssets: Item combinations that meets the minsupport. This is denoted with I1,I2,â¦Ik.
+ Small itemssets: Item combinations that does not meet the minsupport</li>
</ul>
<p>Procedure:</p>
<pre><code>1. Generate all combinations of items that have fractional transactinos support. Perhaps above a certain threshold.
    a. We group all combinations in two groups:
        i. Large itemsets. Examples: 1) Diaper and beer, 2) Milk, Bread --&gt; Eggs, Coke.
        ii. Small itemsets.
        </code></pre>
<p>For a large itemset generate all rules, that use items from the large itemsets (I1,I2,â¦Ik). We call all of these rules subsets (X) of Y.</p>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb429-1"><a href="recommender-systems-and-customer-targeting.html#cb429-1" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.datacamp.com/community/tutorials/market-basket-analysis-r</span></span>
<span id="cb429-2"><a href="recommender-systems-and-customer-targeting.html#cb429-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb429-3"><a href="recommender-systems-and-customer-targeting.html#cb429-3" aria-hidden="true" tabindex="-1"></a><span class="co">#install and load package arules</span></span>
<span id="cb429-4"><a href="recommender-systems-and-customer-targeting.html#cb429-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(arules)</span>
<span id="cb429-5"><a href="recommender-systems-and-customer-targeting.html#cb429-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(arulesViz)</span>
<span id="cb429-6"><a href="recommender-systems-and-customer-targeting.html#cb429-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb429-7"><a href="recommender-systems-and-customer-targeting.html#cb429-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb429-8"><a href="recommender-systems-and-customer-targeting.html#cb429-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb429-9"><a href="recommender-systems-and-customer-targeting.html#cb429-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb429-10"><a href="recommender-systems-and-customer-targeting.html#cb429-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb429-11"><a href="recommender-systems-and-customer-targeting.html#cb429-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plyr)</span>
<span id="cb429-12"><a href="recommender-systems-and-customer-targeting.html#cb429-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb429-13"><a href="recommender-systems-and-customer-targeting.html#cb429-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DataExplorer)</span></code></pre></div>
<div id="loading-and-data-exploration" class="section level3" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Loading and data exploration</h3>
<p>First we load it</p>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb430-1"><a href="recommender-systems-and-customer-targeting.html#cb430-1" aria-hidden="true" tabindex="-1"></a><span class="co">#read excel into R dataframe</span></span>
<span id="cb430-2"><a href="recommender-systems-and-customer-targeting.html#cb430-2" aria-hidden="true" tabindex="-1"></a>retail <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&#39;Data/Recommender Systems/Online_Retail.xlsx&#39;</span>)</span>
<span id="cb430-3"><a href="recommender-systems-and-customer-targeting.html#cb430-3" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(retail)</span></code></pre></div>
<p>The data frame has rows with granularity of items, hence one item pr. line. Where one invoice may occur several times.</p>
<p>We also have some other information. notice that stock code is an ID for the product.</p>
<p>We see that some have some odd quantities, these are just plotted to see what is going on.</p>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb431-1"><a href="recommender-systems-and-customer-targeting.html#cb431-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Quantity[StockCode <span class="sc">==</span> <span class="dv">23843</span>])</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/QuantityAssessment-1.png" width="720" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb432-1"><a href="recommender-systems-and-customer-targeting.html#cb432-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Quantity[StockCode <span class="sc">==</span> <span class="dv">23166</span>])</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/QuantityAssessment-2.png" width="720" style="display: block; margin: auto;" /></p>
</div>
<div id="data-preprocessing" class="section level3" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Data preprocessing</h3>
<p>complete.cases(data) will return a logical vector indicating which rows have no missing values. Then use the vector to get only rows that are complete using retail[,]. That is because we have NAâs.</p>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb433-1"><a href="recommender-systems-and-customer-targeting.html#cb433-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_missing</span>(retail)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/PlotMissing%20Retail-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>We see that the customer ID is only there 75% of the time, also the description appear to be missing in some examples. Now we are going to remove these.</p>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb434-1"><a href="recommender-systems-and-customer-targeting.html#cb434-1" aria-hidden="true" tabindex="-1"></a>retail <span class="ot">&lt;-</span> retail[<span class="fu">complete.cases</span>(retail), ]</span>
<span id="cb434-2"><a href="recommender-systems-and-customer-targeting.html#cb434-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_missing</span>(retail)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-192-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>Now we see that we remove approx. 140.000 observations, where we had 541.909 observations before and 406.829 observations after removing NAâs, corresponding with approx. 25% of the observations.</p>
<div id="encoding-to-correct-data-types" class="section level4" number="3.1.2.1">
<h4><span class="header-section-number">3.1.2.1</span> Encoding to correct data types</h4>
<p>Now we want to make the description a factor instead of character.</p>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb435-1"><a href="recommender-systems-and-customer-targeting.html#cb435-1" aria-hidden="true" tabindex="-1"></a><span class="co">#The following prints whole tables, although I just show the first couple of rows in a following chunk</span></span>
<span id="cb435-2"><a href="recommender-systems-and-customer-targeting.html#cb435-2" aria-hidden="true" tabindex="-1"></a>retail <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Description =</span> <span class="fu">as.factor</span>(Description))</span>
<span id="cb435-3"><a href="recommender-systems-and-customer-targeting.html#cb435-3" aria-hidden="true" tabindex="-1"></a>retail <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Country =</span> <span class="fu">as.factor</span>(Country))</span></code></pre></div>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb436-1"><a href="recommender-systems-and-customer-targeting.html#cb436-1" aria-hidden="true" tabindex="-1"></a>retail<span class="sc">$</span>Date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(retail<span class="sc">$</span>InvoiceDate)</span></code></pre></div>
<div class="sourceCode" id="cb437"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb437-1"><a href="recommender-systems-and-customer-targeting.html#cb437-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(retail)</span></code></pre></div>
<div class="kable-table">
<table>
<colgroup>
<col width="7%" />
<col width="7%" />
<col width="27%" />
<col width="6%" />
<col width="15%" />
<col width="7%" />
<col width="8%" />
<col width="11%" />
<col width="8%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">InvoiceNo</th>
<th align="left">StockCode</th>
<th align="left">Description</th>
<th align="right">Quantity</th>
<th align="left">InvoiceDate</th>
<th align="right">UnitPrice</th>
<th align="right">CustomerID</th>
<th align="left">Country</th>
<th align="left">Date</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">536365</td>
<td align="left">85123A</td>
<td align="left">WHITE HANGING HEART T-LIGHT HOLDER</td>
<td align="right">6</td>
<td align="left">2010-12-01 08:26:00</td>
<td align="right">2.55</td>
<td align="right">17850</td>
<td align="left">United Kingdom</td>
<td align="left">2010-12-01</td>
</tr>
<tr class="even">
<td align="left">536365</td>
<td align="left">71053</td>
<td align="left">WHITE METAL LANTERN</td>
<td align="right">6</td>
<td align="left">2010-12-01 08:26:00</td>
<td align="right">3.39</td>
<td align="right">17850</td>
<td align="left">United Kingdom</td>
<td align="left">2010-12-01</td>
</tr>
<tr class="odd">
<td align="left">536365</td>
<td align="left">84406B</td>
<td align="left">CREAM CUPID HEARTS COAT HANGER</td>
<td align="right">8</td>
<td align="left">2010-12-01 08:26:00</td>
<td align="right">2.75</td>
<td align="right">17850</td>
<td align="left">United Kingdom</td>
<td align="left">2010-12-01</td>
</tr>
<tr class="even">
<td align="left">536365</td>
<td align="left">84029G</td>
<td align="left">KNITTED UNION FLAG HOT WATER BOTTLE</td>
<td align="right">6</td>
<td align="left">2010-12-01 08:26:00</td>
<td align="right">3.39</td>
<td align="right">17850</td>
<td align="left">United Kingdom</td>
<td align="left">2010-12-01</td>
</tr>
<tr class="odd">
<td align="left">536365</td>
<td align="left">84029E</td>
<td align="left">RED WOOLLY HOTTIE WHITE HEART.</td>
<td align="right">6</td>
<td align="left">2010-12-01 08:26:00</td>
<td align="right">3.39</td>
<td align="right">17850</td>
<td align="left">United Kingdom</td>
<td align="left">2010-12-01</td>
</tr>
<tr class="even">
<td align="left">536365</td>
<td align="left">22752</td>
<td align="left">SET 7 BABUSHKA NESTING BOXES</td>
<td align="right">2</td>
<td align="left">2010-12-01 08:26:00</td>
<td align="right">7.65</td>
<td align="right">17850</td>
<td align="left">United Kingdom</td>
<td align="left">2010-12-01</td>
</tr>
</tbody>
</table>
</div>
<p>We also want a column with the date and one with the transaction time.</p>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb438-1"><a href="recommender-systems-and-customer-targeting.html#cb438-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Extract time from InvoiceDate and store in another variable</span></span>
<span id="cb438-2"><a href="recommender-systems-and-customer-targeting.html#cb438-2" aria-hidden="true" tabindex="-1"></a>TransTime <span class="ot">&lt;-</span> <span class="fu">format</span>(retail<span class="sc">$</span>InvoiceDate,<span class="st">&quot;%H:%M:%S&quot;</span>)</span>
<span id="cb438-3"><a href="recommender-systems-and-customer-targeting.html#cb438-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Convert and edit InvoiceNo into numeric</span></span>
<span id="cb438-4"><a href="recommender-systems-and-customer-targeting.html#cb438-4" aria-hidden="true" tabindex="-1"></a>InvoiceNo <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(retail<span class="sc">$</span>InvoiceNo))</span>
<span id="cb438-5"><a href="recommender-systems-and-customer-targeting.html#cb438-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb438-6"><a href="recommender-systems-and-customer-targeting.html#cb438-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Bind new columns TransTime and InvoiceNo into dataframe retail</span></span>
<span id="cb438-7"><a href="recommender-systems-and-customer-targeting.html#cb438-7" aria-hidden="true" tabindex="-1"></a>retail <span class="ot">&lt;-</span> <span class="fu">cbind</span>(retail,TransTime)</span></code></pre></div>
<p>Now we can glimpse</p>
<div class="sourceCode" id="cb439"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb439-1"><a href="recommender-systems-and-customer-targeting.html#cb439-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(retail)</span></code></pre></div>
<pre><code>## Rows: 406,829
## Columns: 10
## $ InvoiceNo   &lt;chr&gt; &quot;536365&quot;, &quot;536365&quot;, &quot;536365&quot;, &quot;536365&quot;, &quot;536365&quot;, &quot;536365&quot;â¦
## $ StockCode   &lt;chr&gt; &quot;85123A&quot;, &quot;71053&quot;, &quot;84406B&quot;, &quot;84029G&quot;, &quot;84029E&quot;, &quot;22752&quot;, â¦
## $ Description &lt;chr&gt; &quot;WHITE HANGING HEART T-LIGHT HOLDER&quot;, &quot;WHITE METAL LANTERNâ¦
## $ Quantity    &lt;dbl&gt; 6, 6, 8, 6, 6, 2, 6, 6, 6, 32, 6, 6, 8, 6, 6, 3, 2, 3, 3, â¦
## $ InvoiceDate &lt;dttm&gt; 2010-12-01 08:26:00, 2010-12-01 08:26:00, 2010-12-01 08:2â¦
## $ UnitPrice   &lt;dbl&gt; 2.55, 3.39, 2.75, 3.39, 3.39, 7.65, 4.25, 1.85, 1.85, 1.69â¦
## $ CustomerID  &lt;dbl&gt; 17850, 17850, 17850, 17850, 17850, 17850, 17850, 17850, 17â¦
## $ Country     &lt;chr&gt; &quot;United Kingdom&quot;, &quot;United Kingdom&quot;, &quot;United Kingdom&quot;, &quot;Uniâ¦
## $ Date        &lt;date&gt; 2010-12-01, 2010-12-01, 2010-12-01, 2010-12-01, 2010-12-0â¦
## $ TransTime   &lt;chr&gt; &quot;08:26:00&quot;, &quot;08:26:00&quot;, &quot;08:26:00&quot;, &quot;08:26:00&quot;, &quot;08:26:00&quot;â¦</code></pre>
</div>
<div id="create-a-data-frame-with-one-row-pr.-invoice" class="section level4" number="3.1.2.2">
<h4><span class="header-section-number">3.1.2.2</span> Create a data frame with one row pr. invoice</h4>
<p>What you need to do is group data in the retail dataframe either by CustomerID, CustomerID, and Date or you can also group data using InvoiceNo and Date. We need this grouping and apply a function on it and store the output in another dataframe.</p>
<p>This can be done by ddply.</p>
<p>The following lines of code will combine all products from one InvoiceNo and date and combine all products from that InvoiceNo and date as one row, with each item, separated by â,â.</p>
<div class="sourceCode" id="cb441"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb441-1"><a href="recommender-systems-and-customer-targeting.html#cb441-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plyr)</span>
<span id="cb441-2"><a href="recommender-systems-and-customer-targeting.html#cb441-2" aria-hidden="true" tabindex="-1"></a>transactionData <span class="ot">&lt;-</span> <span class="fu">ddply</span>(<span class="at">.data =</span> retail</span>
<span id="cb441-3"><a href="recommender-systems-and-customer-targeting.html#cb441-3" aria-hidden="true" tabindex="-1"></a>                         ,<span class="at">.variables =</span> <span class="fu">c</span>(<span class="st">&quot;InvoiceNo&quot;</span>,<span class="st">&quot;Date&quot;</span>) <span class="co">#Group by</span></span>
<span id="cb441-4"><a href="recommender-systems-and-customer-targeting.html#cb441-4" aria-hidden="true" tabindex="-1"></a>                         ,<span class="at">.fun =</span> <span class="cf">function</span>(df1)<span class="fu">paste</span>(df1<span class="sc">$</span>Description <span class="co">#This concatenates the items</span></span>
<span id="cb441-5"><a href="recommender-systems-and-customer-targeting.html#cb441-5" aria-hidden="true" tabindex="-1"></a>                                                    ,<span class="at">collapse =</span> <span class="st">&quot;,&quot;</span>))</span>
<span id="cb441-6"><a href="recommender-systems-and-customer-targeting.html#cb441-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(transactionData)</span></code></pre></div>
<div class="kable-table">
<table>
<colgroup>
<col width="1%" />
<col width="2%" />
<col width="96%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">InvoiceNo</th>
<th align="left">Date</th>
<th align="left">V1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">536365</td>
<td align="left">2010-12-01</td>
<td align="left">WHITE HANGING HEART T-LIGHT HOLDER,WHITE METAL LANTERN,CREAM CUPID HEARTS COAT HANGER,KNITTED UNION FLAG HOT WATER BOTTLE,RED WOOLLY HOTTIE WHITE HEART.,SET 7 BABUSHKA NESTING BOXES,GLASS STAR FROSTED T-LIGHT HOLDER</td>
</tr>
<tr class="even">
<td align="left">536366</td>
<td align="left">2010-12-01</td>
<td align="left">HAND WARMER UNION JACK,HAND WARMER RED POLKA DOT</td>
</tr>
<tr class="odd">
<td align="left">536367</td>
<td align="left">2010-12-01</td>
<td align="left">ASSORTED COLOUR BIRD ORNAMENT,POPPYâS PLAYHOUSE BEDROOM,POPPYâS PLAYHOUSE KITCHEN,FELTCRAFT PRINCESS CHARLOTTE DOLL,IVORY KNITTED MUG COSY,BOX OF 6 ASSORTED COLOUR TEASPOONS,BOX OF VINTAGE JIGSAW BLOCKS,BOX OF VINTAGE ALPHABET BLOCKS,HOME BUILDING BLOCK WORD,LOVE BUILDING BLOCK WORD,RECIPE BOX WITH METAL HEART,DOORMAT NEW ENGLAND</td>
</tr>
<tr class="even">
<td align="left">536368</td>
<td align="left">2010-12-01</td>
<td align="left">JAM MAKING SET WITH JARS,RED COAT RACK PARIS FASHION,YELLOW COAT RACK PARIS FASHION,BLUE COAT RACK PARIS FASHION</td>
</tr>
<tr class="odd">
<td align="left">536369</td>
<td align="left">2010-12-01</td>
<td align="left">BATH BUILDING BLOCK WORD</td>
</tr>
<tr class="even">
<td align="left">536370</td>
<td align="left">2010-12-01</td>
<td align="left">ALARM CLOCK BAKELIKE PINK,ALARM CLOCK BAKELIKE RED,ALARM CLOCK BAKELIKE GREEN,PANDA AND BUNNIES STICKER SHEET,STARS GIFT TAPE,INFLATABLE POLITICAL GLOBE,VINTAGE HEADS AND TAILS CARD GAME,SET/2 RED RETROSPOT TEA TOWELS,ROUND SNACK BOXES SET OF4 WOODLAND,SPACEBOY LUNCH BOX,LUNCH BOX I LOVE LONDON,CIRCUS PARADE LUNCH BOX,CHARLOTTE BAG DOLLY GIRL DESIGN,RED TOADSTOOL LED NIGHT LIGHT,SET 2 TEA TOWELS I LOVE LONDON,VINTAGE SEASIDE JIGSAW PUZZLES,MINI JIGSAW CIRCUS PARADE,MINI JIGSAW SPACEBOY,MINI PAINT SET VINTAGE,POSTAGE</td>
</tr>
</tbody>
</table>
</div>
<p>So we see that now we have granularity on invoiceNo, and the the date and lastly the items are listed, where they are separated with a comma.</p>
<p>Now we only want the items pr. invoice (basket), hence we remove the invoice InvoiceNo and Date.</p>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb442-1"><a href="recommender-systems-and-customer-targeting.html#cb442-1" aria-hidden="true" tabindex="-1"></a>transactionData <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(transactionData<span class="sc">$</span>V1)</span>
<span id="cb442-2"><a href="recommender-systems-and-customer-targeting.html#cb442-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(transactionData) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;items&quot;</span>) <span class="co">#Rename column to items</span></span>
<span id="cb442-3"><a href="recommender-systems-and-customer-targeting.html#cb442-3" aria-hidden="true" tabindex="-1"></a>transactionData[<span class="dv">1</span>,]</span></code></pre></div>
<pre><code>## [1] &quot;WHITE HANGING HEART T-LIGHT HOLDER,WHITE METAL LANTERN,CREAM CUPID HEARTS COAT HANGER,KNITTED UNION FLAG HOT WATER BOTTLE,RED WOOLLY HOTTIE WHITE HEART.,SET 7 BABUSHKA NESTING BOXES,GLASS STAR FROSTED T-LIGHT HOLDER&quot;</code></pre>
<p>We see that the dataframe now consists of only on column with all items separated with a comma. Now we are going to save it, and load it back into the environment.</p>
<p><strong>Saving the data</strong></p>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb444-1"><a href="recommender-systems-and-customer-targeting.html#cb444-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(transactionData,<span class="st">&quot;Data/Recommender Systems/market_basket_transactions.csv&quot;</span>, <span class="at">quote =</span> <span class="cn">FALSE</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
</div>
</div>
<div id="loading-transactions" class="section level3" number="3.1.3">
<h3><span class="header-section-number">3.1.3</span> Loading transactions</h3>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb445-1"><a href="recommender-systems-and-customer-targeting.html#cb445-1" aria-hidden="true" tabindex="-1"></a>tr <span class="ot">&lt;-</span> <span class="fu">read.transactions</span>(<span class="st">&#39;market_basket_transactions.csv&#39;</span>, <span class="at">format =</span> <span class="st">&#39;basket&#39;</span>, <span class="at">sep=</span><span class="st">&#39;,&#39;</span>)</span>
<span id="cb445-2"><a href="recommender-systems-and-customer-targeting.html#cb445-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(tr)</span></code></pre></div>
<pre><code>## transactions as itemMatrix in sparse format with
##  22191 rows (elements/itemsets/transactions) and
##  7876 columns (items) and a density of 0.001930725 
## 
## most frequent items:
## WHITE HANGING HEART T-LIGHT HOLDER           REGENCY CAKESTAND 3 TIER 
##                               1803                               1709 
##            JUMBO BAG RED RETROSPOT                      PARTY BUNTING 
##                               1460                               1285 
##      ASSORTED COLOUR BIRD ORNAMENT                            (Other) 
##                               1250                             329938 
## 
## element (itemset/transaction) length distribution:
## sizes
##    1    2    3    4    5    6    7    8    9   10   11   12   13   14   15   16 
## 3598 1594 1141  908  861  758  696  676  663  593  624  537  516  531  551  522 
##   17   18   19   20   21   22   23   24   25   26   27   28   29   30   31   32 
##  464  441  483  419  395  315  306  272  238  253  229  213  222  215  170  159 
##   33   34   35   36   37   38   39   40   41   42   43   44   45   46   47   48 
##  138  142  134  109  111   90  113   94   93   87   88   65   63   67   63   60 
##   49   50   51   52   53   54   55   56   57   58   59   60   61   62   63   64 
##   59   49   64   40   41   49   43   36   29   39   30   27   28   17   25   25 
##   65   66   67   68   69   70   71   72   73   74   75   76   77   78   79   80 
##   20   27   24   22   15   20   19   13   16   16   11   15   12    7    9   14 
##   81   82   83   84   85   86   87   88   89   90   91   92   93   94   95   96 
##   15   12    8    9   11   11   14    8    6    5    6   11    6    4    4    3 
##   97   98   99  100  101  102  103  104  105  106  107  108  109  110  111  112 
##    6    5    2    4    2    4    4    3    2    2    6    3    4    3    2    1 
##  113  114  116  117  118  120  121  122  123  125  126  127  131  132  133  134 
##    3    1    3    3    3    1    2    2    1    3    2    2    1    1    2    1 
##  140  141  142  143  145  146  147  150  154  157  168  171  177  178  180  202 
##    1    2    2    1    1    2    1    1    3    2    2    2    1    1    1    1 
##  204  228  236  249  250  285  320  400  419 
##    1    1    1    1    1    1    1    1    1 
## 
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    1.00    3.00   10.00   15.21   21.00  419.00 
## 
## includes extended item information - examples:
##                       labels
## 1                   1 HANGER
## 2     10 COLOUR SPACEBOY PEN
## 3 12 COLOURED PARTY BALLOONS</code></pre>
<p>We see that when we load it back into the environment using <code>read.transactions()</code> we create something similar to a data term matrix, this is merely a sparse matrix, where we see that we have 7.876 items and 22.191 baskets/invoices. Hence each row is just âticked-offâ if the basket contains the product.</p>
<p>We see the summary specify that we have 22.191 transactions and 7.876 items, the most frequent is âwhite hanging heeart t-light holderâ. We see that the largest basket has 419 units. Where basket sizes of 1 unit is the most typical.</p>
<p>Then the mean = 15 products and the median 10 products.</p>
</div>
<div id="plotting" class="section level3" number="3.1.4">
<h3><span class="header-section-number">3.1.4</span> Plotting</h3>
<p>Now we want to plot the most frequent products.</p>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb447-1"><a href="recommender-systems-and-customer-targeting.html#cb447-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an item frequency plot for the top 20 items</span></span>
<span id="cb447-2"><a href="recommender-systems-and-customer-targeting.html#cb447-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb447-3"><a href="recommender-systems-and-customer-targeting.html#cb447-3" aria-hidden="true" tabindex="-1"></a><span class="fu">itemFrequencyPlot</span>(tr</span>
<span id="cb447-4"><a href="recommender-systems-and-customer-targeting.html#cb447-4" aria-hidden="true" tabindex="-1"></a>                  ,<span class="at">topN =</span> <span class="dv">20</span></span>
<span id="cb447-5"><a href="recommender-systems-and-customer-targeting.html#cb447-5" aria-hidden="true" tabindex="-1"></a>                  ,<span class="at">type =</span> <span class="st">&quot;absolute&quot;</span></span>
<span id="cb447-6"><a href="recommender-systems-and-customer-targeting.html#cb447-6" aria-hidden="true" tabindex="-1"></a>                  ,<span class="at">col =</span> <span class="fu">brewer.pal</span>(<span class="dv">8</span>,<span class="st">&#39;Pastel2&#39;</span>)</span>
<span id="cb447-7"><a href="recommender-systems-and-customer-targeting.html#cb447-7" aria-hidden="true" tabindex="-1"></a>                  ,<span class="at">main =</span> <span class="st">&quot;Absolute Item Frequency Plot&quot;</span>)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-202-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>We see that top combinations. E.g., more than 1.500 baskets where the top combination occurs. Now we can look at it in a relative way instead.</p>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb448-1"><a href="recommender-systems-and-customer-targeting.html#cb448-1" aria-hidden="true" tabindex="-1"></a><span class="fu">itemFrequencyPlot</span>(tr</span>
<span id="cb448-2"><a href="recommender-systems-and-customer-targeting.html#cb448-2" aria-hidden="true" tabindex="-1"></a>                  ,<span class="at">topN =</span> <span class="dv">20</span></span>
<span id="cb448-3"><a href="recommender-systems-and-customer-targeting.html#cb448-3" aria-hidden="true" tabindex="-1"></a>                  ,<span class="at">type =</span> <span class="st">&quot;relative&quot;</span></span>
<span id="cb448-4"><a href="recommender-systems-and-customer-targeting.html#cb448-4" aria-hidden="true" tabindex="-1"></a>                  ,<span class="at">col =</span> <span class="fu">brewer.pal</span>(<span class="dv">8</span>,<span class="st">&#39;Pastel2&#39;</span>)</span>
<span id="cb448-5"><a href="recommender-systems-and-customer-targeting.html#cb448-5" aria-hidden="true" tabindex="-1"></a>                  ,<span class="at">main =</span> <span class="st">&quot;Relative Item Frequency Plot&quot;</span>)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-203-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>This is basically the same, just written in percentage.</p>
</div>
<div id="apriori-calculation" class="section level3" number="3.1.5">
<h3><span class="header-section-number">3.1.5</span> Apriori calculation</h3>
<p>We will now start looking at association rules. To do so, we apply the apriori principle.</p>
<p>We set the following:</p>
<ul>
<li>supp = minimum support, where we see that the combinations must occur in at least 0.1% of the baskets</li>
<li>conf = the describes the conditional relationship between the left-hand and right-hand side. Hence we want a relationship that is greater than 80%, as we want to avoid random pairs. You can have a rate combination of items (low support) althought the confidence is high, if these pairs always come together.</li>
<li>maxlen = the maximum length of items in a basket.</li>
</ul>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb449-1"><a href="recommender-systems-and-customer-targeting.html#cb449-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Min Support as 0.001, confidence as 0.8.</span></span>
<span id="cb449-2"><a href="recommender-systems-and-customer-targeting.html#cb449-2" aria-hidden="true" tabindex="-1"></a>association.rules <span class="ot">&lt;-</span> <span class="fu">apriori</span>(<span class="at">data =</span> tr</span>
<span id="cb449-3"><a href="recommender-systems-and-customer-targeting.html#cb449-3" aria-hidden="true" tabindex="-1"></a>                             ,<span class="at">parameter =</span> <span class="fu">list</span>(<span class="at">supp =</span> <span class="fl">0.001</span> <span class="co">#we only see rules where the support is at least 0.001</span></span>
<span id="cb449-4"><a href="recommender-systems-and-customer-targeting.html#cb449-4" aria-hidden="true" tabindex="-1"></a>                                               ,<span class="at">conf =</span> <span class="fl">0.8</span> <span class="co">#The confidence should be at least 0.8</span></span>
<span id="cb449-5"><a href="recommender-systems-and-customer-targeting.html#cb449-5" aria-hidden="true" tabindex="-1"></a>                                               ,<span class="at">maxlen =</span> <span class="dv">10</span> <span class="co">#We only want ot look at a max length of 10 items pr. basket</span></span>
<span id="cb449-6"><a href="recommender-systems-and-customer-targeting.html#cb449-6" aria-hidden="true" tabindex="-1"></a>                                               )</span>
<span id="cb449-7"><a href="recommender-systems-and-customer-targeting.html#cb449-7" aria-hidden="true" tabindex="-1"></a>                             )</span></code></pre></div>
<pre><code>## Apriori
## 
## Parameter specification:
##  confidence minval smax arem  aval originalSupport maxtime support minlen
##         0.8    0.1    1 none FALSE            TRUE       5   0.001      1
##  maxlen target  ext
##      10  rules TRUE
## 
## Algorithmic control:
##  filter tree heap memopt load sort verbose
##     0.1 TRUE TRUE  FALSE TRUE    2    TRUE
## 
## Absolute minimum support count: 22 
## 
## set item appearances ...[0 item(s)] done [0.00s].
## set transactions ...[7876 item(s), 22191 transaction(s)] done [0.11s].
## sorting and recoding items ... [2324 item(s)] done [0.01s].
## creating transaction tree ... done [0.01s].
## checking subsets of size 1 2 3 4 5 6 7 8 9 10 done [0.27s].
## writing ... [49122 rule(s)] done [0.03s].
## creating S4 object  ... done [0.03s].</code></pre>
<p><em>The parameters can be seen as constraints, to lower the amount of rules that we are going to make</em></p>
<p>Extra note on support. We only want to see combinations that occurs 1 out of 1000 times, hence <code>supp = 0.001</code></p>
<p>Now we have calculated association rules lets call the summary.</p>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb451-1"><a href="recommender-systems-and-customer-targeting.html#cb451-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(association.rules)</span></code></pre></div>
<pre><code>## set of 49122 rules
## 
## rule length distribution (lhs + rhs):sizes
##     2     3     4     5     6     7     8     9    10 
##   105  2111  6854 16424 14855  6102  1937   613   121 
## 
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   2.000   5.000   5.000   5.499   6.000  10.000 
## 
## summary of quality measures:
##     support           confidence        coverage             lift        
##  Min.   :0.001036   Min.   :0.8000   Min.   :0.001036   Min.   :  9.846  
##  1st Qu.:0.001082   1st Qu.:0.8333   1st Qu.:0.001262   1st Qu.: 22.237  
##  Median :0.001262   Median :0.8788   Median :0.001442   Median : 28.760  
##  Mean   :0.001417   Mean   :0.8849   Mean   :0.001609   Mean   : 64.589  
##  3rd Qu.:0.001532   3rd Qu.:0.9259   3rd Qu.:0.001712   3rd Qu.: 69.200  
##  Max.   :0.015997   Max.   :1.0000   Max.   :0.019107   Max.   :715.839  
##      count       
##  Min.   : 23.00  
##  1st Qu.: 24.00  
##  Median : 28.00  
##  Mean   : 31.45  
##  3rd Qu.: 34.00  
##  Max.   :355.00  
## 
## mining info:
##  data ntransactions support confidence
##    tr         22191   0.001        0.8</code></pre>
<p>We see some basic descriptions, e.g., we have the most combinations around 5 and 6. We see that the lower end and upper end has very few. My guess would be that for a basket combination of 10 to not be random, there are only few things that are naturally there.</p>
<p>In the other end (e.g., with length of 2), then there are many products that comes in pairs, but it is also influenced by a lot of randomness. Hence we are ruling out a lot of combinations with the confidence = 80%, if we were to decrease the confidence, then we could have found more association rules.</p>
<p>Now we can <strong>inspect the first 10 combinations</strong></p>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb453-1"><a href="recommender-systems-and-customer-targeting.html#cb453-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inspect</span>(association.rules[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>])</span></code></pre></div>
<pre><code>##      lhs                            rhs                                support confidence    coverage     lift count
## [1]  {WOBBLY CHICKEN}            =&gt; {DECORATION}                   0.001261773  1.0000000 0.001261773 443.8200    28
## [2]  {WOBBLY CHICKEN}            =&gt; {METAL}                        0.001261773  1.0000000 0.001261773 443.8200    28
## [3]  {DECOUPAGE}                 =&gt; {GREETING CARD}                0.001036456  1.0000000 0.001036456 389.3158    23
## [4]  {BILLBOARD FONTS DESIGN}    =&gt; {WRAP}                         0.001306836  1.0000000 0.001306836 715.8387    29
## [5]  {WRAP}                      =&gt; {BILLBOARD FONTS DESIGN}       0.001306836  0.9354839 0.001396963 715.8387    29
## [6]  {ENAMEL PINK TEA CONTAINER} =&gt; {ENAMEL PINK COFFEE CONTAINER} 0.001396963  0.8157895 0.001712406 385.1741    31
## [7]  {WOBBLY RABBIT}             =&gt; {DECORATION}                   0.001532153  1.0000000 0.001532153 443.8200    34
## [8]  {WOBBLY RABBIT}             =&gt; {METAL}                        0.001532153  1.0000000 0.001532153 443.8200    34
## [9]  {ART LIGHTS}                =&gt; {FUNK MONKEY}                  0.001712406  1.0000000 0.001712406 583.9737    38
## [10] {FUNK MONKEY}               =&gt; {ART LIGHTS}                   0.001712406  1.0000000 0.001712406 583.9737    38</code></pre>
<p>We see that the confidence is one in many examples, that is for instance because when you have bought <em>wobbly chicken</em>, the you also buy <em>decoration</em> and for this pair it also goes the other way around <em>(actually cant remember why, we probably checked)</em>.</p>
<p>Lets take the first row as an example:</p>
<ul>
<li>We have wobbly chicken in the basket, then you will also buy decoration.</li>
<li>Support = this pair occurs in 0.0013% of the times.</li>
<li>Confidence = this is 1, meaning when we have WC then the decoration will always be there</li>
<li>Coverage = that is how often the lhs appear in total</li>
<li>Lift = an indication of how much it is boosting the sale. We see that when we have a lift of 444, it means that we are more than 400 times boosting the sale of decoration given a sale of wobbly chicken. If you had a lift of 1, then you would have equal probability of buying e.g., decoration given wobbly chicken is in the basket. On the other side, lets say that lift is less than 1, then you prone to not buying. See the equation in the following.</li>
</ul>
<p>We see an example where the coverage is not one, that is because when you buy one, then you do not always buy the other. That is calculated by:</p>
<p><span class="math display">\[\frac{support}{coverage} = confidence\]</span></p>
<p>We see that:</p>
<ul>
<li>Support = <span class="math inline">\(\frac{TotalInvoices}{AbsoluteNo.OfTransactions} = Support\)</span></li>
<li>Coverage = <span class="math inline">\(\frac{Support}{Confidence} = Coverage\)</span></li>
<li>Lift = <span class="math inline">\(\frac{P(A|B)}{P(A)} = Lift\)</span>, we see with lift, that we actually need to find out how the pairs appear. See an example in the following.</li>
</ul>
<div class="figure">
<img src="images/LiftExample.png" alt="" />
<p class="caption">Lift example</p>
</div>
<p><strong>Manual calculation of support, coverage and confidence and lift</strong></p>
<p>We are going to do three things:</p>
<ol style="list-style-type: decimal">
<li>Count no. of transactions with the left hand side combination</li>
<li>Count the no. of transactions where the right hand side combination is within the transactions found in step 1.</li>
<li>Divide support by coverage to find confidence. If 1 = the right hand side combination is always in the basket when the left hand side is, when e.g., 0.5 instead, then the right hand side is only half of the time in the basket when the left hand side is.</li>
</ol>
<div class="sourceCode" id="cb455"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb455-1"><a href="recommender-systems-and-customer-targeting.html#cb455-1" aria-hidden="true" tabindex="-1"></a><span class="co">#We are going to look at the pair woobly chicken and decoration</span></span>
<span id="cb455-2"><a href="recommender-systems-and-customer-targeting.html#cb455-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb455-3"><a href="recommender-systems-and-customer-targeting.html#cb455-3" aria-hidden="true" tabindex="-1"></a>left <span class="ot">&lt;-</span> <span class="st">&quot;WRAP&quot;</span></span>
<span id="cb455-4"><a href="recommender-systems-and-customer-targeting.html#cb455-4" aria-hidden="true" tabindex="-1"></a>right <span class="ot">&lt;-</span> <span class="st">&quot;BILLBOARD FONTS DESIGN&quot;</span></span>
<span id="cb455-5"><a href="recommender-systems-and-customer-targeting.html#cb455-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb455-6"><a href="recommender-systems-and-customer-targeting.html#cb455-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Find row number of a given item</span></span>
<span id="cb455-7"><a href="recommender-systems-and-customer-targeting.html#cb455-7" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">t</span>(<span class="fu">t</span>(<span class="fu">as.vector</span>(tr<span class="sc">@</span>itemInfo))) <span class="sc">==</span> left)</span>
<span id="cb455-8"><a href="recommender-systems-and-customer-targeting.html#cb455-8" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(tr<span class="sc">@</span>data[idx,])</span></code></pre></div>
<pre><code>## 
## FALSE  TRUE 
## 22160    31</code></pre>
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb457-1"><a href="recommender-systems-and-customer-targeting.html#cb457-1" aria-hidden="true" tabindex="-1"></a>coverage <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">table</span>(tr<span class="sc">@</span>data[idx,])[<span class="dv">2</span>]<span class="sc">/</span><span class="fu">ncol</span>(tr<span class="sc">@</span>data))</span>
<span id="cb457-2"><a href="recommender-systems-and-customer-targeting.html#cb457-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb457-3"><a href="recommender-systems-and-customer-targeting.html#cb457-3" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">t</span>(<span class="fu">t</span>(<span class="fu">as.vector</span>(tr<span class="sc">@</span>itemInfo))) <span class="sc">==</span> left)</span>
<span id="cb457-4"><a href="recommender-systems-and-customer-targeting.html#cb457-4" aria-hidden="true" tabindex="-1"></a>idx_right <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">t</span>(<span class="fu">t</span>(<span class="fu">as.vector</span>(tr<span class="sc">@</span>itemInfo))) <span class="sc">==</span> right)</span>
<span id="cb457-5"><a href="recommender-systems-and-customer-targeting.html#cb457-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb457-6"><a href="recommender-systems-and-customer-targeting.html#cb457-6" aria-hidden="true" tabindex="-1"></a><span class="co">#which(tr@data[idx,] == TRUE)</span></span>
<span id="cb457-7"><a href="recommender-systems-and-customer-targeting.html#cb457-7" aria-hidden="true" tabindex="-1"></a><span class="co">#which(tr@data[idx_right,] == TRUE)</span></span>
<span id="cb457-8"><a href="recommender-systems-and-customer-targeting.html#cb457-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb457-9"><a href="recommender-systems-and-customer-targeting.html#cb457-9" aria-hidden="true" tabindex="-1"></a>right_side <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="fu">which</span>(tr<span class="sc">@</span>data[idx,] <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">%in%</span> <span class="fu">which</span>(tr<span class="sc">@</span>data[idx_right,] <span class="sc">==</span> <span class="cn">TRUE</span>))</span>
<span id="cb457-10"><a href="recommender-systems-and-customer-targeting.html#cb457-10" aria-hidden="true" tabindex="-1"></a>right_side <span class="co">#Inteprete to see if there are only T, F or both.</span></span></code></pre></div>
<pre><code>## 
## FALSE  TRUE 
##     2    29</code></pre>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb459-1"><a href="recommender-systems-and-customer-targeting.html#cb459-1" aria-hidden="true" tabindex="-1"></a><span class="co">#We see that decoration is always in the basket when wobbly chicken is.</span></span>
<span id="cb459-2"><a href="recommender-systems-and-customer-targeting.html#cb459-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-3"><a href="recommender-systems-and-customer-targeting.html#cb459-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-4"><a href="recommender-systems-and-customer-targeting.html#cb459-4" aria-hidden="true" tabindex="-1"></a>support <span class="ot">=</span> <span class="fu">as.vector</span>(right_side[<span class="dv">2</span>]<span class="sc">/</span><span class="fu">ncol</span>(tr<span class="sc">@</span>data))</span>
<span id="cb459-5"><a href="recommender-systems-and-customer-targeting.html#cb459-5" aria-hidden="true" tabindex="-1"></a>support</span></code></pre></div>
<pre><code>## [1] 0.001306836</code></pre>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb461-1"><a href="recommender-systems-and-customer-targeting.html#cb461-1" aria-hidden="true" tabindex="-1"></a>confidence <span class="ot">=</span> support <span class="sc">/</span> coverage </span>
<span id="cb461-2"><a href="recommender-systems-and-customer-targeting.html#cb461-2" aria-hidden="true" tabindex="-1"></a>confidence <span class="co">#Hence a very stron relationship from woobly chicken to decoration</span></span></code></pre></div>
<pre><code>## [1] 0.9354839</code></pre>
<p>lift</p>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb463-1"><a href="recommender-systems-and-customer-targeting.html#cb463-1" aria-hidden="true" tabindex="-1"></a>p_WC_given_d <span class="ot">&lt;-</span> <span class="dv">28</span><span class="sc">/</span><span class="dv">28</span> <span class="co">#because they are both there 28 times.</span></span>
<span id="cb463-2"><a href="recommender-systems-and-customer-targeting.html#cb463-2" aria-hidden="true" tabindex="-1"></a>p_WC <span class="ot">&lt;-</span> <span class="dv">50</span><span class="sc">/</span><span class="dv">22191</span> <span class="co">#The support of WC</span></span>
<span id="cb463-3"><a href="recommender-systems-and-customer-targeting.html#cb463-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb463-4"><a href="recommender-systems-and-customer-targeting.html#cb463-4" aria-hidden="true" tabindex="-1"></a>p_WC_given_d<span class="sc">/</span>p_WC <span class="co">#444</span></span></code></pre></div>
<pre><code>## [1] 443.82</code></pre>
<p><strong>Now we can inspect the rules after they are sorted</strong></p>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb465-1"><a href="recommender-systems-and-customer-targeting.html#cb465-1" aria-hidden="true" tabindex="-1"></a>sortedRules <span class="ot">&lt;-</span> <span class="fu">sort</span>(association.rules,<span class="at">by=</span><span class="st">&quot;lift&quot;</span>,<span class="at">decreasing=</span><span class="cn">TRUE</span>)</span>
<span id="cb465-2"><a href="recommender-systems-and-customer-targeting.html#cb465-2" aria-hidden="true" tabindex="-1"></a><span class="fu">inspect</span>(sortedRules[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)])</span></code></pre></div>
<p><em>Notice that bookdown gave an error so I just manually inserted the output</em></p>
<div class="figure">
<img src="images/sortedRulesOutput.png" alt="" />
<p class="caption">Sorted Rules Output</p>
</div>
<p>The conclusions are the same, it is just sorted now.</p>
<p>The LIFT reflects how often the LHS is bought given the RHS is in the basket.</p>
<div id="another-example-where-maxlen-3" class="section level4" number="3.1.5.1">
<h4><span class="header-section-number">3.1.5.1</span> Another example where maxlen = 3</h4>
<p>Here we only want to look at combinations with up to three items.</p>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb466-1"><a href="recommender-systems-and-customer-targeting.html#cb466-1" aria-hidden="true" tabindex="-1"></a>shorter.association.rules <span class="ot">&lt;-</span> <span class="fu">apriori</span>(tr, <span class="at">parameter =</span> <span class="fu">list</span>(<span class="at">supp=</span><span class="fl">0.001</span> <span class="co">#must occur in 1 in 1000</span></span>
<span id="cb466-2"><a href="recommender-systems-and-customer-targeting.html#cb466-2" aria-hidden="true" tabindex="-1"></a>                                                          ,<span class="at">conf=</span><span class="fl">0.8</span> <span class="co">#We need to pairs to be at least 80% of the time together</span></span>
<span id="cb466-3"><a href="recommender-systems-and-customer-targeting.html#cb466-3" aria-hidden="true" tabindex="-1"></a>                                                          ,<span class="at">maxlen=</span><span class="dv">3</span>))</span></code></pre></div>
<pre><code>## Apriori
## 
## Parameter specification:
##  confidence minval smax arem  aval originalSupport maxtime support minlen
##         0.8    0.1    1 none FALSE            TRUE       5   0.001      1
##  maxlen target  ext
##       3  rules TRUE
## 
## Algorithmic control:
##  filter tree heap memopt load sort verbose
##     0.1 TRUE TRUE  FALSE TRUE    2    TRUE
## 
## Absolute minimum support count: 22 
## 
## set item appearances ...[0 item(s)] done [0.00s].
## set transactions ...[7876 item(s), 22191 transaction(s)] done [0.10s].
## sorting and recoding items ... [2324 item(s)] done [0.01s].
## creating transaction tree ... done [0.01s].
## checking subsets of size 1 2 3 done [0.13s].
## writing ... [2216 rule(s)] done [0.02s].
## creating S4 object  ... done [0.01s].</code></pre>
<p>Notice that the RHS and LHS summarize up to 3, where before it could go all the way up to 10.</p>
</div>
<div id="filtering-on-right-hand-side.-an-example-with-the-item-metal" class="section level4" number="3.1.5.2">
<h4><span class="header-section-number">3.1.5.2</span> Filtering on right hand side. An example with the item {METAL}</h4>
<p>We want to see what is purchased before buying metal.</p>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb468-1"><a href="recommender-systems-and-customer-targeting.html#cb468-1" aria-hidden="true" tabindex="-1"></a><span class="co">#For example, to find what customers buy before buying &#39;METAL&#39; run the following line of code</span></span>
<span id="cb468-2"><a href="recommender-systems-and-customer-targeting.html#cb468-2" aria-hidden="true" tabindex="-1"></a>metal.association.rules <span class="ot">&lt;-</span> <span class="fu">apriori</span>(<span class="at">data =</span> tr</span>
<span id="cb468-3"><a href="recommender-systems-and-customer-targeting.html#cb468-3" aria-hidden="true" tabindex="-1"></a>                                   ,<span class="at">parameter =</span> <span class="fu">list</span>(<span class="at">supp=</span><span class="fl">0.001</span>, <span class="at">conf=</span><span class="fl">0.8</span>)</span>
<span id="cb468-4"><a href="recommender-systems-and-customer-targeting.html#cb468-4" aria-hidden="true" tabindex="-1"></a>                                   ,<span class="at">appearance =</span> <span class="fu">list</span>(<span class="at">default=</span><span class="st">&quot;lhs&quot;</span>,<span class="at">rhs=</span><span class="st">&quot;METAL&quot;</span>))</span></code></pre></div>
<pre><code>## Apriori
## 
## Parameter specification:
##  confidence minval smax arem  aval originalSupport maxtime support minlen
##         0.8    0.1    1 none FALSE            TRUE       5   0.001      1
##  maxlen target  ext
##      10  rules TRUE
## 
## Algorithmic control:
##  filter tree heap memopt load sort verbose
##     0.1 TRUE TRUE  FALSE TRUE    2    TRUE
## 
## Absolute minimum support count: 22 
## 
## set item appearances ...[1 item(s)] done [0.00s].
## set transactions ...[7876 item(s), 22191 transaction(s)] done [0.12s].
## sorting and recoding items ... [2324 item(s)] done [0.01s].
## creating transaction tree ... done [0.01s].
## checking subsets of size 1 2 3 4 5 6 7 8 9 10 done [0.31s].
## writing ... [5 rule(s)] done [0.03s].
## creating S4 object  ... done [0.01s].</code></pre>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb470-1"><a href="recommender-systems-and-customer-targeting.html#cb470-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inspect</span>(metal.association.rules)</span></code></pre></div>
<pre><code>##     lhs                            rhs     support     confidence coverage   
## [1] {WOBBLY CHICKEN}            =&gt; {METAL} 0.001261773 1          0.001261773
## [2] {WOBBLY RABBIT}             =&gt; {METAL} 0.001532153 1          0.001532153
## [3] {DECORATION}                =&gt; {METAL} 0.002253166 1          0.002253166
## [4] {DECORATION,WOBBLY CHICKEN} =&gt; {METAL} 0.001261773 1          0.001261773
## [5] {DECORATION,WOBBLY RABBIT}  =&gt; {METAL} 0.001532153 1          0.001532153
##     lift   count
## [1] 443.82 28   
## [2] 443.82 34   
## [3] 443.82 50   
## [4] 443.82 28   
## [5] 443.82 34</code></pre>
<p>Now we see the combinations where the metal is the right hand side. Where we which products that leads to purchase of metal.</p>
</div>
<div id="filtering-on-left-hand-side.-an-example-with-the-item-metal" class="section level4" number="3.1.5.3">
<h4><span class="header-section-number">3.1.5.3</span> Filtering on left hand side. An example with the item {METAL}</h4>
<p>We can do the same for the left hand side.</p>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="recommender-systems-and-customer-targeting.html#cb472-1" aria-hidden="true" tabindex="-1"></a>metal.association.rules <span class="ot">&lt;-</span> <span class="fu">apriori</span>(<span class="at">data =</span> tr</span>
<span id="cb472-2"><a href="recommender-systems-and-customer-targeting.html#cb472-2" aria-hidden="true" tabindex="-1"></a>                                   ,<span class="at">parameter =</span> <span class="fu">list</span>(<span class="at">supp=</span><span class="fl">0.001</span>, <span class="at">conf=</span><span class="fl">0.8</span>)</span>
<span id="cb472-3"><a href="recommender-systems-and-customer-targeting.html#cb472-3" aria-hidden="true" tabindex="-1"></a>                                   ,<span class="at">appearance =</span> <span class="fu">list</span>(<span class="at">lhs=</span><span class="st">&quot;METAL&quot;</span>,<span class="at">default=</span><span class="st">&quot;rhs&quot;</span>))</span></code></pre></div>
<pre><code>## Apriori
## 
## Parameter specification:
##  confidence minval smax arem  aval originalSupport maxtime support minlen
##         0.8    0.1    1 none FALSE            TRUE       5   0.001      1
##  maxlen target  ext
##      10  rules TRUE
## 
## Algorithmic control:
##  filter tree heap memopt load sort verbose
##     0.1 TRUE TRUE  FALSE TRUE    2    TRUE
## 
## Absolute minimum support count: 22 
## 
## set item appearances ...[1 item(s)] done [0.00s].
## set transactions ...[7876 item(s), 22191 transaction(s)] done [0.11s].
## sorting and recoding items ... [2324 item(s)] done [0.01s].
## creating transaction tree ... done [0.01s].
## checking subsets of size 1 2 done [0.00s].
## writing ... [1 rule(s)] done [0.00s].
## creating S4 object  ... done [0.01s].</code></pre>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb474-1"><a href="recommender-systems-and-customer-targeting.html#cb474-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inspect</span>(<span class="fu">head</span>(metal.association.rules))</span></code></pre></div>
<pre><code>##     lhs        rhs          support     confidence coverage    lift   count
## [1] {METAL} =&gt; {DECORATION} 0.002253166 1          0.002253166 443.82 50</code></pre>
<p>Where this is showing what products metal leads to buying.</p>
<p>We see only one item that is followed by buying metal.</p>
</div>
</div>
<div id="plotting-association-rules" class="section level3" number="3.1.6">
<h3><span class="header-section-number">3.1.6</span> Plotting association rules</h3>
<p>We want to get all where the confidence is greater than 40%.</p>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb476-1"><a href="recommender-systems-and-customer-targeting.html#cb476-1" aria-hidden="true" tabindex="-1"></a><span class="co">#This is just showed as an example, so we can do the filtering</span></span>
<span id="cb476-2"><a href="recommender-systems-and-customer-targeting.html#cb476-2" aria-hidden="true" tabindex="-1"></a>association.rules <span class="ot">&lt;-</span> <span class="fu">apriori</span>(<span class="at">data =</span> tr</span>
<span id="cb476-3"><a href="recommender-systems-and-customer-targeting.html#cb476-3" aria-hidden="true" tabindex="-1"></a>                             ,<span class="at">parameter =</span> <span class="fu">list</span>(<span class="at">supp=</span><span class="fl">0.001</span>, <span class="at">conf=</span><span class="fl">0.3</span>,<span class="at">maxlen=</span><span class="dv">10</span>))</span></code></pre></div>
<pre><code>## Apriori
## 
## Parameter specification:
##  confidence minval smax arem  aval originalSupport maxtime support minlen
##         0.3    0.1    1 none FALSE            TRUE       5   0.001      1
##  maxlen target  ext
##      10  rules TRUE
## 
## Algorithmic control:
##  filter tree heap memopt load sort verbose
##     0.1 TRUE TRUE  FALSE TRUE    2    TRUE
## 
## Absolute minimum support count: 22 
## 
## set item appearances ...[0 item(s)] done [0.00s].
## set transactions ...[7876 item(s), 22191 transaction(s)] done [0.11s].
## sorting and recoding items ... [2324 item(s)] done [0.01s].
## creating transaction tree ... done [0.01s].
## checking subsets of size 1 2 3 4 5 6 7 8 9 10 done [0.27s].
## writing ... [180603 rule(s)] done [0.05s].
## creating S4 object  ... done [0.05s].</code></pre>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb478-1"><a href="recommender-systems-and-customer-targeting.html#cb478-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Subsetting</span></span>
<span id="cb478-2"><a href="recommender-systems-and-customer-targeting.html#cb478-2" aria-hidden="true" tabindex="-1"></a>subRules <span class="ot">&lt;-</span> association.rules[<span class="fu">quality</span>(association.rules)<span class="sc">$</span>confidence<span class="sc">&gt;</span><span class="fl">0.4</span>]</span></code></pre></div>
<p>We see that the higher the confidence the higher the lift, so there appears to be a strong relationship between these.</p>
<p>We can also show it in the following.</p>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb479-1"><a href="recommender-systems-and-customer-targeting.html#cb479-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot SubRules</span></span>
<span id="cb479-2"><a href="recommender-systems-and-customer-targeting.html#cb479-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(subRules)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-213-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>We see that usually the lift is the greatest in the top left corner, where the confidence is high and support is low.</p>
<p>This makes sense, as you cannot lift (boost) the sales of another product, if their relationship is already rather high.</p>
<p>Now we can plot the length of the rule with respect to confidence</p>
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb480-1"><a href="recommender-systems-and-customer-targeting.html#cb480-1" aria-hidden="true" tabindex="-1"></a><span class="co">#The order is the number of items in the rule</span></span>
<span id="cb480-2"><a href="recommender-systems-and-customer-targeting.html#cb480-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(subRules,<span class="at">method=</span><span class="st">&quot;two-key plot&quot;</span>)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-214-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>The following is supposed to be an interactive plot. But does not appear to work, missing a library.</p>
<div class="sourceCode" id="cb481"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb481-1"><a href="recommender-systems-and-customer-targeting.html#cb481-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plotly_arules(subRules)</span></span></code></pre></div>
<p>Now we can plot some interactive plot, where one can explore the rules.</p>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb482-1"><a href="recommender-systems-and-customer-targeting.html#cb482-1" aria-hidden="true" tabindex="-1"></a>top10subRules <span class="ot">&lt;-</span> <span class="fu">head</span>(subRules, <span class="at">n =</span> <span class="dv">10</span>, <span class="at">by =</span> <span class="st">&quot;confidence&quot;</span>)</span>
<span id="cb482-2"><a href="recommender-systems-and-customer-targeting.html#cb482-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(top10subRules, <span class="at">method =</span> <span class="st">&quot;graph&quot;</span>,  <span class="at">engine =</span> <span class="st">&quot;htmlwidget&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-a5ecc4aaa305a8aba535" style="width:720px;height:480px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-a5ecc4aaa305a8aba535">{"x":{"nodes":{"id":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],"label":["WOBBLY CHICKEN","DECOUPAGE","BILLBOARD FONTS DESIGN","WOBBLY RABBIT","ART LIGHTS","FUNK MONKEY","BLACK TEA","DECORATION","METAL","GREETING CARD","WRAP","SUGAR JARS","COFFEE","rule 1","rule 2","rule 3","rule 4","rule 5","rule 6","rule 7","rule 8","rule 9","rule 10"],"group":["item","item","item","item","item","item","item","item","item","item","item","item","item","rule","rule","rule","rule","rule","rule","rule","rule","rule","rule"],"value":[1,1,1,1,1,1,1,1,1,1,1,1,1,22.5217391304348,22.5217391304348,1,26.8260869565217,48.3478260869565,48.3478260869565,65.5652173913044,65.5652173913044,100,100],"color":["#CBD2FC","#CBD2FC","#CBD2FC","#CBD2FC","#CBD2FC","#CBD2FC","#CBD2FC","#CBD2FC","#CBD2FC","#CBD2FC","#CBD2FC","#CBD2FC","#CBD2FC","#EE8484","#EE8484","#EE9797","#EE1B1B","#EE8484","#EE8484","#EE5050","#EE5050","#EEB8B8","#EEDCDC"],"title":["WOBBLY CHICKEN","DECOUPAGE","BILLBOARD FONTS DESIGN","WOBBLY RABBIT","ART LIGHTS","FUNK MONKEY","BLACK TEA","DECORATION","METAL","GREETING CARD","WRAP","SUGAR JARS","COFFEE","<B>[1]<\/B><BR><B>{WOBBLY CHICKEN}<\/B><BR>&nbsp;&nbsp; => <B>{DECORATION}<\/B><BR><BR>support = 0.00126<BR>confidence = 1<BR>coverage = 0.00126<BR>lift = 444<BR>count = 28<BR>order = 2","<B>[2]<\/B><BR><B>{WOBBLY CHICKEN}<\/B><BR>&nbsp;&nbsp; => <B>{METAL}<\/B><BR><BR>support = 0.00126<BR>confidence = 1<BR>coverage = 0.00126<BR>lift = 444<BR>count = 28<BR>order = 2","<B>[3]<\/B><BR><B>{DECOUPAGE}<\/B><BR>&nbsp;&nbsp; => <B>{GREETING CARD}<\/B><BR><BR>support = 0.00104<BR>confidence = 1<BR>coverage = 0.00104<BR>lift = 389<BR>count = 23<BR>order = 2","<B>[4]<\/B><BR><B>{BILLBOARD FONTS DESIGN}<\/B><BR>&nbsp;&nbsp; => <B>{WRAP}<\/B><BR><BR>support = 0.00131<BR>confidence = 1<BR>coverage = 0.00131<BR>lift = 716<BR>count = 29<BR>order = 2","<B>[5]<\/B><BR><B>{WOBBLY RABBIT}<\/B><BR>&nbsp;&nbsp; => <B>{DECORATION}<\/B><BR><BR>support = 0.00153<BR>confidence = 1<BR>coverage = 0.00153<BR>lift = 444<BR>count = 34<BR>order = 2","<B>[6]<\/B><BR><B>{WOBBLY RABBIT}<\/B><BR>&nbsp;&nbsp; => <B>{METAL}<\/B><BR><BR>support = 0.00153<BR>confidence = 1<BR>coverage = 0.00153<BR>lift = 444<BR>count = 34<BR>order = 2","<B>[7]<\/B><BR><B>{ART LIGHTS}<\/B><BR>&nbsp;&nbsp; => <B>{FUNK MONKEY}<\/B><BR><BR>support = 0.00171<BR>confidence = 1<BR>coverage = 0.00171<BR>lift = 584<BR>count = 38<BR>order = 2","<B>[8]<\/B><BR><B>{FUNK MONKEY}<\/B><BR>&nbsp;&nbsp; => <B>{ART LIGHTS}<\/B><BR><BR>support = 0.00171<BR>confidence = 1<BR>coverage = 0.00171<BR>lift = 584<BR>count = 38<BR>order = 2","<B>[9]<\/B><BR><B>{BLACK TEA}<\/B><BR>&nbsp;&nbsp; => <B>{SUGAR JARS}<\/B><BR><BR>support = 0.00207<BR>confidence = 1<BR>coverage = 0.00207<BR>lift = 239<BR>count = 46<BR>order = 2","<B>[10]<\/B><BR><B>{BLACK TEA}<\/B><BR>&nbsp;&nbsp; => <B>{COFFEE}<\/B><BR><BR>support = 0.00207<BR>confidence = 1<BR>coverage = 0.00207<BR>lift = 69.3<BR>count = 46<BR>order = 2"],"shape":["box","box","box","box","box","box","box","box","box","box","box","box","box","circle","circle","circle","circle","circle","circle","circle","circle","circle","circle"],"x":[0.0529254946004827,-0.108543569549674,0.670368755381245,-0.748859055996987,-1,-0.623181385296201,0.910881275443141,-0.0806472694586914,-0.583905639682287,0.309265338051627,0.150511241178377,1,0.723996786277975,0.124878215219845,-0.268484606316649,0.0863689626088731,0.423887375593151,-0.416086578387413,-0.814767778246167,-0.789781085147382,-0.82854359723994,0.974622176561853,0.829044077838918],"y":[-0.953567633097298,0.608656757958557,0.729210402199562,-0.367615750898478,0.38315515273308,0.469004185395587,-0.288084907884943,-0.407804480942226,-0.879248621115431,0.2053275596083,1,0.245600936742714,-0.803753573551053,-0.66018380434099,-1,0.386383316852367,0.878956290665081,-0.310044487738283,-0.650558020849152,0.22412636444318,0.632661414690208,-0.015408595951533,-0.553510073567192]},"edges":{"from":[1,1,2,3,4,4,5,6,7,7,14,15,16,17,18,19,20,21,22,23],"to":[14,15,16,17,18,19,20,21,22,23,8,9,10,11,8,9,6,5,12,13],"arrows":["to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","scaling":{"label":{"enabled":true}},"physics":false},"manipulation":{"enabled":false},"edges":{"smooth":false},"physics":{"stabilization":false},"interaction":{"hover":true}},"groups":["item","rule"],"width":null,"height":null,"idselection":{"enabled":true,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":null,"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","igraphlayout":{"type":"square"},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);","highlight":{"enabled":true,"hoverNearest":true,"degree":1,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":false,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb483"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb483-1"><a href="recommender-systems-and-customer-targeting.html#cb483-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code></pre></div>
</div>
</div>
<div id="colaborative-filtering" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Colaborative filtering</h2>
<p>As mentioned in the beginning of the chapter, we see that one can make recommendations based on similarity with other users and or similarity between products.</p>
<div id="loading-and-formatting-data" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Loading and formatting data</h3>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb484-1"><a href="recommender-systems-and-customer-targeting.html#cb484-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(recommenderlab)</span>
<span id="cb484-2"><a href="recommender-systems-and-customer-targeting.html#cb484-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<div class="sourceCode" id="cb485"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb485-1"><a href="recommender-systems-and-customer-targeting.html#cb485-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;MovieLense&quot;</span>)</span>
<span id="cb485-2"><a href="recommender-systems-and-customer-targeting.html#cb485-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb485-3"><a href="recommender-systems-and-customer-targeting.html#cb485-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Data is given in realRatingMatrix format  ; Optimized to store sparse matrices</span></span>
<span id="cb485-4"><a href="recommender-systems-and-customer-targeting.html#cb485-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(MovieLense)</span>
<span id="cb485-5"><a href="recommender-systems-and-customer-targeting.html#cb485-5" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(MovieLense,<span class="at">vec.len=</span><span class="dv">2</span>) <span class="co">#not as we normally reference list elements by \\$ but \\@</span></span></code></pre></div>
<pre><code>## [1] &quot;realRatingMatrix&quot;
## attr(,&quot;package&quot;)
## [1] &quot;recommenderlab&quot;
## Formal class &#39;realRatingMatrix&#39; [package &quot;recommenderlab&quot;] with 2 slots
##   ..@ data     :Formal class &#39;dgCMatrix&#39; [package &quot;Matrix&quot;] with 6 slots
##   .. .. ..@ i       : int [1:99392] 0 1 4 5 9 ...
##   .. .. ..@ p       : int [1:1665] 0 452 583 673 882 ...
##   .. .. ..@ Dim     : int [1:2] 943 1664
##   .. .. ..@ Dimnames:List of 2
##   .. .. .. ..$ : chr [1:943] &quot;1&quot; &quot;2&quot; ...
##   .. .. .. ..$ : chr [1:1664] &quot;Toy Story (1995)&quot; &quot;GoldenEye (1995)&quot; ...
##   .. .. ..@ x       : num [1:99392] 5 4 4 4 4 ...
##   .. .. ..@ factors : list()
##   ..@ normalize: NULL</code></pre>
<p>the following are the different methods that we can use.</p>
<div class="sourceCode" id="cb487"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb487-1"><a href="recommender-systems-and-customer-targeting.html#cb487-1" aria-hidden="true" tabindex="-1"></a><span class="fu">methods</span>(<span class="at">class =</span> <span class="fu">class</span>(MovieLense)) <span class="co"># methods applicable to this class</span></span></code></pre></div>
<pre><code>##  [1] [                      [&lt;-                    binarize              
##  [4] calcPredictionAccuracy coerce                 colCounts             
##  [7] colMeans               colSds                 colSums               
## [10] denormalize            dim                    dimnames              
## [13] dimnames&lt;-             dissimilarity          evaluationScheme      
## [16] getData.frame          getList                getNormalize          
## [19] getRatingMatrix        getRatings             getTopNLists          
## [22] hasRating              image                  nratings              
## [25] Recommender            removeKnownRatings     rowCounts             
## [28] rowMeans               rowSds                 rowSums               
## [31] sample                 show                  
## see &#39;?methods&#39; for accessing help and source code</code></pre>
<p>We see the dimensions of our matrix with users and the movies.</p>
<div class="sourceCode" id="cb489"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb489-1"><a href="recommender-systems-and-customer-targeting.html#cb489-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(MovieLense)</span></code></pre></div>
<pre><code>## [1]  943 1664</code></pre>
<p>We see that there 1.664 movies and 943 users.</p>
<div id="loading-metadata-that-gets-loaded-with-main-dataset" class="section level4" number="3.2.1.1">
<h4><span class="header-section-number">3.2.1.1</span> Loading metadata that gets loaded with main dataset</h4>
<p><strong><em>This is not applied in the exercise, but just shown</em></strong></p>
<div class="sourceCode" id="cb491"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb491-1"><a href="recommender-systems-and-customer-targeting.html#cb491-1" aria-hidden="true" tabindex="-1"></a>moviemeta <span class="ot">&lt;-</span> MovieLenseMeta</span>
<span id="cb491-2"><a href="recommender-systems-and-customer-targeting.html#cb491-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(moviemeta)</span></code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<p>We see that it is a data.frame. It has the following column names:</p>
<div class="sourceCode" id="cb493"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb493-1"><a href="recommender-systems-and-customer-targeting.html#cb493-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(moviemeta)</span></code></pre></div>
<pre><code>##  [1] &quot;title&quot;       &quot;year&quot;        &quot;url&quot;         &quot;unknown&quot;     &quot;Action&quot;     
##  [6] &quot;Adventure&quot;   &quot;Animation&quot;   &quot;Children&#39;s&quot;  &quot;Comedy&quot;      &quot;Crime&quot;      
## [11] &quot;Documentary&quot; &quot;Drama&quot;       &quot;Fantasy&quot;     &quot;Film-Noir&quot;   &quot;Horror&quot;     
## [16] &quot;Musical&quot;     &quot;Mystery&quot;     &quot;Romance&quot;     &quot;Sci-Fi&quot;      &quot;Thriller&quot;   
## [21] &quot;War&quot;         &quot;Western&quot;</code></pre>
<p>We see that the genre for each movie is presented.</p>
</div>
</div>
<div id="data-exploration" class="section level3" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Data Exploration</h3>
<p>We can see the topics for each movie. Only used for exploration purposes.</p>
<div class="sourceCode" id="cb495"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb495-1"><a href="recommender-systems-and-customer-targeting.html#cb495-1" aria-hidden="true" tabindex="-1"></a><span class="co">#What do we know about the films?</span></span>
<span id="cb495-2"><a href="recommender-systems-and-customer-targeting.html#cb495-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pander)</span>
<span id="cb495-3"><a href="recommender-systems-and-customer-targeting.html#cb495-3" aria-hidden="true" tabindex="-1"></a><span class="fu">pander</span>(<span class="fu">head</span>(moviemeta,<span class="dv">2</span>),<span class="at">caption =</span> <span class="st">&quot;First few Rows within Movie Meta Data &quot;</span>)</span></code></pre></div>
<table style="width:36%;">
<caption>First few Rows within Movie Meta Data (continued below)</caption>
<colgroup>
<col width="26%" />
<col width="9%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">title</th>
<th align="center">year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">Toy Story (1995)</td>
<td align="center">1995</td>
</tr>
<tr class="even">
<td align="center">GoldenEye (1995)</td>
<td align="center">1995</td>
</tr>
</tbody>
</table>
<table style="width:100%;">
<caption>Table continues below</caption>
<colgroup>
<col width="73%" />
<col width="13%" />
<col width="13%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">url</th>
<th align="center">unknown</th>
<th align="center">Action</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><a href="http://us.imdb.com/M/title-exact?Toy%20Story%20(1995)" class="uri">http://us.imdb.com/M/title-exact?Toy%20Story%20(1995)</a></td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center"><a href="http://us.imdb.com/M/title-exact?GoldenEye%20(1995)" class="uri">http://us.imdb.com/M/title-exact?GoldenEye%20(1995)</a></td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
</tbody>
</table>
<table>
<caption>Table continues below</caption>
<colgroup>
<col width="15%" />
<col width="15%" />
<col width="17%" />
<col width="11%" />
<col width="10%" />
<col width="18%" />
<col width="10%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">Adventure</th>
<th align="center">Animation</th>
<th align="center">Childrenâs</th>
<th align="center">Comedy</th>
<th align="center">Crime</th>
<th align="center">Documentary</th>
<th align="center">Drama</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">0</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
</tbody>
</table>
<table>
<caption>Table continues below</caption>
<colgroup>
<col width="12%" />
<col width="14%" />
<col width="11%" />
<col width="12%" />
<col width="12%" />
<col width="12%" />
<col width="11%" />
<col width="13%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">Fantasy</th>
<th align="center">Film-Noir</th>
<th align="center">Horror</th>
<th align="center">Musical</th>
<th align="center">Mystery</th>
<th align="center">Romance</th>
<th align="center">Sci-Fi</th>
<th align="center">Thriller</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
</tbody>
</table>
<table style="width:22%;">
<colgroup>
<col width="8%" />
<col width="13%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">War</th>
<th align="center">Western</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">0</td>
<td align="center">0</td>
</tr>
</tbody>
</table>
<p>We can also interpret the ratings for a given customer</p>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb496-1"><a href="recommender-systems-and-customer-targeting.html#cb496-1" aria-hidden="true" tabindex="-1"></a><span class="do">## look at the first few ratings of the first user</span></span>
<span id="cb496-2"><a href="recommender-systems-and-customer-targeting.html#cb496-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">as</span>(MovieLense[<span class="dv">1</span>,], <span class="st">&quot;list&quot;</span>)[[<span class="dv">1</span>]])</span></code></pre></div>
<pre><code>##                                     Toy Story (1995) 
##                                                    5 
##                                     GoldenEye (1995) 
##                                                    3 
##                                    Four Rooms (1995) 
##                                                    4 
##                                    Get Shorty (1995) 
##                                                    3 
##                                       Copycat (1995) 
##                                                    3 
## Shanghai Triad (Yao a yao yao dao waipo qiao) (1995) 
##                                                    5</code></pre>
<div id="plotting-1" class="section level4" number="3.2.2.1">
<h4><span class="header-section-number">3.2.2.1</span> Plotting</h4>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb498-1"><a href="recommender-systems-and-customer-targeting.html#cb498-1" aria-hidden="true" tabindex="-1"></a><span class="do">## number of ratings per user</span></span>
<span id="cb498-2"><a href="recommender-systems-and-customer-targeting.html#cb498-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">rowCounts</span>(MovieLense))</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-226-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>We see that most has reviewed less than 100 movies. Therefore we also see in the following plot, that most movies have less than 100 reviews, where we have a long tail with some movies that have very few ratings.</p>
<div class="sourceCode" id="cb499"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb499-1"><a href="recommender-systems-and-customer-targeting.html#cb499-1" aria-hidden="true" tabindex="-1"></a><span class="do">## number of ratings per movie</span></span>
<span id="cb499-2"><a href="recommender-systems-and-customer-targeting.html#cb499-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">colCounts</span>(MovieLense))</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-227-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>Now we can look at which movies that are top 10, based on number of times watched.</p>
<div class="sourceCode" id="cb500"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb500-1"><a href="recommender-systems-and-customer-targeting.html#cb500-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Top 10 movies</span></span>
<span id="cb500-2"><a href="recommender-systems-and-customer-targeting.html#cb500-2" aria-hidden="true" tabindex="-1"></a>movie_watched <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb500-3"><a href="recommender-systems-and-customer-targeting.html#cb500-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">movie_name =</span> <span class="fu">names</span>(<span class="fu">colCounts</span>(MovieLense)),</span>
<span id="cb500-4"><a href="recommender-systems-and-customer-targeting.html#cb500-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">watched_times =</span> <span class="fu">colCounts</span>(MovieLense)</span>
<span id="cb500-5"><a href="recommender-systems-and-customer-targeting.html#cb500-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb500-6"><a href="recommender-systems-and-customer-targeting.html#cb500-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb500-7"><a href="recommender-systems-and-customer-targeting.html#cb500-7" aria-hidden="true" tabindex="-1"></a>top_ten_movies <span class="ot">&lt;-</span> movie_watched[<span class="fu">order</span>(movie_watched<span class="sc">$</span>watched_times, <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ][<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, ] </span>
<span id="cb500-8"><a href="recommender-systems-and-customer-targeting.html#cb500-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb500-9"><a href="recommender-systems-and-customer-targeting.html#cb500-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(top_ten_movies) <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">x=</span>movie_name, <span class="at">y=</span>watched_times) <span class="sc">+</span> </span>
<span id="cb500-10"><a href="recommender-systems-and-customer-targeting.html#cb500-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,<span class="at">fill =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="at">color =</span> <span class="st">&quot;dodgerblue2&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Movie Tile&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Count&quot;</span>) <span class="sc">+</span></span>
<span id="cb500-11"><a href="recommender-systems-and-customer-targeting.html#cb500-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">40</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-228-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>Looking at the overall data, we see that the mean rating is 3.5 where the median is actually 4, which seem pretty high.</p>
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb501-1"><a href="recommender-systems-and-customer-targeting.html#cb501-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">getRatings</span>(MovieLense))</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    1.00    3.00    4.00    3.53    4.00    5.00</code></pre>
<p>This we can also plot.</p>
<div class="sourceCode" id="cb503"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb503-1"><a href="recommender-systems-and-customer-targeting.html#cb503-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">ratings =</span> <span class="fu">getRatings</span>(MovieLense)) <span class="sc">%&gt;%</span></span>
<span id="cb503-2"><a href="recommender-systems-and-customer-targeting.html#cb503-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(ratings)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">width =</span> <span class="fl">0.75</span>)<span class="sc">+</span></span>
<span id="cb503-3"><a href="recommender-systems-and-customer-targeting.html#cb503-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&#39;MovieLense Ratings Distribution&#39;</span>)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-230-1.png" width="720" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="what-models-can-we-use" class="section level3" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> What models can we use?</h3>
<p>Here we can see some of the recommender models that are available.</p>
<div class="sourceCode" id="cb504"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb504-1"><a href="recommender-systems-and-customer-targeting.html#cb504-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Different recommender models</span></span>
<span id="cb504-2"><a href="recommender-systems-and-customer-targeting.html#cb504-2" aria-hidden="true" tabindex="-1"></a>recommender_models <span class="ot">&lt;-</span>  recommenderRegistry<span class="sc">$</span><span class="fu">get_entries</span>(<span class="at">dataType=</span><span class="st">&quot;realRatingMatrix&quot;</span>)</span>
<span id="cb504-3"><a href="recommender-systems-and-customer-targeting.html#cb504-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(recommender_models)</span></code></pre></div>
<pre><code>##  [1] &quot;HYBRID_realRatingMatrix&quot;       &quot;ALS_realRatingMatrix&quot;         
##  [3] &quot;ALS_implicit_realRatingMatrix&quot; &quot;IBCF_realRatingMatrix&quot;        
##  [5] &quot;LIBMF_realRatingMatrix&quot;        &quot;POPULAR_realRatingMatrix&quot;     
##  [7] &quot;RANDOM_realRatingMatrix&quot;       &quot;RERECOMMEND_realRatingMatrix&quot; 
##  [9] &quot;SVD_realRatingMatrix&quot;          &quot;SVDF_realRatingMatrix&quot;        
## [11] &quot;UBCF_realRatingMatrix&quot;</code></pre>
<div class="sourceCode" id="cb506"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb506-1"><a href="recommender-systems-and-customer-targeting.html#cb506-1" aria-hidden="true" tabindex="-1"></a><span class="co">#recommenderRegistry$get_entries(dataType=&quot;realRatingMatrix&quot;) #If run, you will see the parameters</span></span></code></pre></div>
<p>We will focus on:</p>
<ul>
<li>UBCF</li>
<li>IBCF</li>
<li>SVD</li>
<li>ALS</li>
<li>SVDF</li>
</ul>
</div>
<div id="training-and-test-set" class="section level3" number="3.2.4">
<h3><span class="header-section-number">3.2.4</span> Training and test set</h3>
<p>We want movies with at least 30 ratings and at least 100 users for each items. We see that the following approach is actually pretty clever, where we see that we filter on rows and columns by making the logical directly in the subsetting.</p>
<div class="sourceCode" id="cb507"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb507-1"><a href="recommender-systems-and-customer-targeting.html#cb507-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Training and test set At least 30 items evaluated or at least 100 users for each item</span></span>
<span id="cb507-2"><a href="recommender-systems-and-customer-targeting.html#cb507-2" aria-hidden="true" tabindex="-1"></a>rates <span class="ot">&lt;-</span> MovieLense[<span class="fu">rowCounts</span>(MovieLense) <span class="sc">&gt;</span> <span class="dv">30</span></span>
<span id="cb507-3"><a href="recommender-systems-and-customer-targeting.html#cb507-3" aria-hidden="true" tabindex="-1"></a>                    ,<span class="fu">colCounts</span>(MovieLense) <span class="sc">&gt;</span> <span class="dv">100</span>]</span>
<span id="cb507-4"><a href="recommender-systems-and-customer-targeting.html#cb507-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb507-5"><a href="recommender-systems-and-customer-targeting.html#cb507-5" aria-hidden="true" tabindex="-1"></a>rates1 <span class="ot">&lt;-</span> rates[<span class="fu">rowCounts</span>(rates) <span class="sc">&gt;</span> <span class="dv">30</span>,] <span class="co">#This is included again, to make sure that we have accounted for both</span></span></code></pre></div>
<p>Now we can split the data into train and test data.</p>
<p>We randomly define the which_train vector that is <code>TRUE</code> for users in the training set and <code>FALSE</code> for the others. Will set the probability in the training set as 80%</p>
<div class="sourceCode" id="cb508"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb508-1"><a href="recommender-systems-and-customer-targeting.html#cb508-1" aria-hidden="true" tabindex="-1"></a>which_train <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>), <span class="at">size =</span> <span class="fu">nrow</span>(rates1), <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.2</span>)) <span class="co">#Random sampling</span></span>
<span id="cb508-2"><a href="recommender-systems-and-customer-targeting.html#cb508-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb508-3"><a href="recommender-systems-and-customer-targeting.html#cb508-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the training and the test sets</span></span>
<span id="cb508-4"><a href="recommender-systems-and-customer-targeting.html#cb508-4" aria-hidden="true" tabindex="-1"></a>recc_data_train <span class="ot">&lt;-</span> rates1[which_train, ]</span>
<span id="cb508-5"><a href="recommender-systems-and-customer-targeting.html#cb508-5" aria-hidden="true" tabindex="-1"></a>recc_data_test <span class="ot">&lt;-</span> rates1[<span class="sc">!</span>which_train, ]</span></code></pre></div>
<p>My guess is that <code>recc</code> is for recommender.</p>
</div>
<div id="a-small-example-with-ibcf-item-based" class="section level3" number="3.2.5">
<h3><span class="header-section-number">3.2.5</span> A small example with IBCF (item based)</h3>
<p><strong>Fitting the model</strong></p>
<div class="sourceCode" id="cb509"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb509-1"><a href="recommender-systems-and-customer-targeting.html#cb509-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s build the recommender IBCF - cosine:</span></span>
<span id="cb509-2"><a href="recommender-systems-and-customer-targeting.html#cb509-2" aria-hidden="true" tabindex="-1"></a>recc_model <span class="ot">&lt;-</span> <span class="fu">Recommender</span>(<span class="at">data =</span> recc_data_train <span class="co">#On the train data</span></span>
<span id="cb509-3"><a href="recommender-systems-and-customer-targeting.html#cb509-3" aria-hidden="true" tabindex="-1"></a>                          ,<span class="at">method =</span> <span class="st">&quot;IBCF&quot;</span> <span class="co">#The col. filt. model</span></span>
<span id="cb509-4"><a href="recommender-systems-and-customer-targeting.html#cb509-4" aria-hidden="true" tabindex="-1"></a>                          ,<span class="at">parameter =</span> <span class="fu">list</span>(<span class="at">k =</span> <span class="dv">30</span>) <span class="co">#No. of neighbors</span></span>
<span id="cb509-5"><a href="recommender-systems-and-customer-targeting.html#cb509-5" aria-hidden="true" tabindex="-1"></a>                          )</span></code></pre></div>
<p>We have now created a IBCF Recommender Model</p>
<p><strong>Predicting recommendations on test data</strong></p>
<p>We want 5 recommendations for each user, based on the test data set.</p>
<div class="sourceCode" id="cb510"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb510-1"><a href="recommender-systems-and-customer-targeting.html#cb510-1" aria-hidden="true" tabindex="-1"></a>n_recommended <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb510-2"><a href="recommender-systems-and-customer-targeting.html#cb510-2" aria-hidden="true" tabindex="-1"></a>recc_predicted <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="at">object =</span> recc_model</span>
<span id="cb510-3"><a href="recommender-systems-and-customer-targeting.html#cb510-3" aria-hidden="true" tabindex="-1"></a>                          ,<span class="at">newdata =</span> recc_data_test</span>
<span id="cb510-4"><a href="recommender-systems-and-customer-targeting.html#cb510-4" aria-hidden="true" tabindex="-1"></a>                          ,<span class="at">n =</span> n_recommended)</span>
<span id="cb510-5"><a href="recommender-systems-and-customer-targeting.html#cb510-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb510-6"><a href="recommender-systems-and-customer-targeting.html#cb510-6" aria-hidden="true" tabindex="-1"></a><span class="co"># This is the recommendation for the first user</span></span>
<span id="cb510-7"><a href="recommender-systems-and-customer-targeting.html#cb510-7" aria-hidden="true" tabindex="-1"></a>recc_predicted<span class="sc">@</span>items[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>## [1] 239 296 330 314 227</code></pre>
<p>These are the recommendations for the given user. Now we can look for the movei name, which we are recommending. Now we want to convert the numbers into the actual movie names.</p>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb512-1"><a href="recommender-systems-and-customer-targeting.html#cb512-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now let&#39;s define a list with the recommendations for each user</span></span>
<span id="cb512-2"><a href="recommender-systems-and-customer-targeting.html#cb512-2" aria-hidden="true" tabindex="-1"></a>recc_matrix <span class="ot">&lt;-</span> <span class="fu">lapply</span>(recc_predicted<span class="sc">@</span>items, <span class="cf">function</span>(x){</span>
<span id="cb512-3"><a href="recommender-systems-and-customer-targeting.html#cb512-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(rates)[x]</span>
<span id="cb512-4"><a href="recommender-systems-and-customer-targeting.html#cb512-4" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb512-5"><a href="recommender-systems-and-customer-targeting.html#cb512-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb512-6"><a href="recommender-systems-and-customer-targeting.html#cb512-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s take a look the recommendations for the first four users:</span></span>
<span id="cb512-7"><a href="recommender-systems-and-customer-targeting.html#cb512-7" aria-hidden="true" tabindex="-1"></a>recc_matrix[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span></code></pre></div>
<pre><code>## $`1`
## [1] &quot;Highlander (1986)&quot;  &quot;Stand by Me (1986)&quot; &quot;Con Air (1997)&quot;    
## [4] &quot;Ransom (1996)&quot;      &quot;Batman (1989)&quot;     
## 
## $`8`
## [1] &quot;Net, The (1995)&quot;        &quot;Ed Wood (1994)&quot;         &quot;Lion King, The (1994)&quot; 
## [4] &quot;Time to Kill, A (1996)&quot; &quot;Air Force One (1997)&quot;  
## 
## $`11`
## [1] &quot;Jurassic Park (1993)&quot;     &quot;Carrie (1976)&quot;           
## [3] &quot;Peacemaker, The (1997)&quot;   &quot;Wizard of Oz, The (1939)&quot;
## [5] &quot;Stand by Me (1986)&quot;      
## 
## $`14`
## [1] &quot;Hoop Dreams (1994)&quot;                 &quot;Searching for Bobby Fischer (1993)&quot;
## [3] &quot;Sting, The (1973)&quot;                  &quot;Young Frankenstein (1974)&quot;         
## [5] &quot;Edge, The (1997)&quot;</code></pre>
<p>Then we see recommendations for four persons.</p>
</div>
<div id="ubcf---user-based-collaborative-based" class="section level3" number="3.2.6">
<h3><span class="header-section-number">3.2.6</span> UBCF - User based collaborative based</h3>
<p>The method computes the similarity between users with cosine</p>
<div id="fitting-the-model" class="section level4" number="3.2.6.1">
<h4><span class="header-section-number">3.2.6.1</span> Fitting the model</h4>
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb514-1"><a href="recommender-systems-and-customer-targeting.html#cb514-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s build a recommender model leaving the parameters to their defaults. </span></span>
<span id="cb514-2"><a href="recommender-systems-and-customer-targeting.html#cb514-2" aria-hidden="true" tabindex="-1"></a>recc_model <span class="ot">&lt;-</span> <span class="fu">Recommender</span>(<span class="at">data =</span> recc_data_train</span>
<span id="cb514-3"><a href="recommender-systems-and-customer-targeting.html#cb514-3" aria-hidden="true" tabindex="-1"></a>                          ,<span class="at">method =</span> <span class="st">&quot;UBCF&quot;</span>)</span></code></pre></div>
<p>A UBCF recommender has now been created</p>
</div>
<div id="predicting-making-recommendations" class="section level4" number="3.2.6.2">
<h4><span class="header-section-number">3.2.6.2</span> Predicting (making) recommendations</h4>
<div class="sourceCode" id="cb515"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb515-1"><a href="recommender-systems-and-customer-targeting.html#cb515-1" aria-hidden="true" tabindex="-1"></a>n_recommended <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb515-2"><a href="recommender-systems-and-customer-targeting.html#cb515-2" aria-hidden="true" tabindex="-1"></a>recc_predicted <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="at">object =</span> recc_model</span>
<span id="cb515-3"><a href="recommender-systems-and-customer-targeting.html#cb515-3" aria-hidden="true" tabindex="-1"></a>                          ,<span class="at">newdata =</span> recc_data_test</span>
<span id="cb515-4"><a href="recommender-systems-and-customer-targeting.html#cb515-4" aria-hidden="true" tabindex="-1"></a>                          ,<span class="at">n =</span> n_recommended)</span>
<span id="cb515-5"><a href="recommender-systems-and-customer-targeting.html#cb515-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb515-6"><a href="recommender-systems-and-customer-targeting.html#cb515-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s define a list with the recommendations to the test set users.</span></span>
<span id="cb515-7"><a href="recommender-systems-and-customer-targeting.html#cb515-7" aria-hidden="true" tabindex="-1"></a>recc_matrix <span class="ot">&lt;-</span> <span class="fu">sapply</span>(recc_predicted<span class="sc">@</span>items, <span class="cf">function</span>(x) {</span>
<span id="cb515-8"><a href="recommender-systems-and-customer-targeting.html#cb515-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(rates)[x]</span>
<span id="cb515-9"><a href="recommender-systems-and-customer-targeting.html#cb515-9" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb515-10"><a href="recommender-systems-and-customer-targeting.html#cb515-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb515-11"><a href="recommender-systems-and-customer-targeting.html#cb515-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Again, let&#39;s look at the first four users</span></span>
<span id="cb515-12"><a href="recommender-systems-and-customer-targeting.html#cb515-12" aria-hidden="true" tabindex="-1"></a>recc_matrix[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span></code></pre></div>
<pre><code>## [1] &quot;In the Name of the Father (1993)&quot;                          
## [2] &quot;Like Water For Chocolate (Como agua para chocolate) (1992)&quot;
## [3] &quot;Shine (1996)&quot;                                              
## [4] &quot;Glory (1989)&quot;</code></pre>
<p>Now we get recommendations based on user based filtering.</p>
</div>
</div>
<div id="cross-validation" class="section level3" number="3.2.7">
<h3><span class="header-section-number">3.2.7</span> Cross validation</h3>
<p><em>The purpose is to make a more stable model through cross validation.</em></p>
<p><strong><em>The cross validation, that we set up here, is going to be used in the following code, for estimating models.</em></strong></p>
<p>We can split the data into some chunks, take a chunk out as the test set, and evaluate the accuracy. Then we can do the same with each other chunk and compute the average accuracy. Here we construct the evaluation model</p>
<div class="sourceCode" id="cb517"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb517-1"><a href="recommender-systems-and-customer-targeting.html#cb517-1" aria-hidden="true" tabindex="-1"></a>n_fold <span class="ot">&lt;-</span> <span class="dv">4</span> </span>
<span id="cb517-2"><a href="recommender-systems-and-customer-targeting.html#cb517-2" aria-hidden="true" tabindex="-1"></a>rating_threshold <span class="ot">&lt;-</span> <span class="dv">4</span> <span class="co"># threshold at which we consider the item to be good</span></span>
<span id="cb517-3"><a href="recommender-systems-and-customer-targeting.html#cb517-3" aria-hidden="true" tabindex="-1"></a>items_to_keep <span class="ot">&lt;-</span> <span class="dv">20</span> <span class="co"># given=20 means that while testing the model use only 20 randomly picked ratings from every user to predict the unknown ratings</span></span>
<span id="cb517-4"><a href="recommender-systems-and-customer-targeting.html#cb517-4" aria-hidden="true" tabindex="-1"></a><span class="co"># in the test set the known data set has the ratings specified by given and the unknown data set the remaining ratings used for validation  </span></span>
<span id="cb517-5"><a href="recommender-systems-and-customer-targeting.html#cb517-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb517-6"><a href="recommender-systems-and-customer-targeting.html#cb517-6" aria-hidden="true" tabindex="-1"></a>eval_sets <span class="ot">&lt;-</span> <span class="fu">evaluationScheme</span>(<span class="at">data =</span> rates1</span>
<span id="cb517-7"><a href="recommender-systems-and-customer-targeting.html#cb517-7" aria-hidden="true" tabindex="-1"></a>                              ,<span class="at">method =</span> <span class="st">&quot;cross-validation&quot;</span></span>
<span id="cb517-8"><a href="recommender-systems-and-customer-targeting.html#cb517-8" aria-hidden="true" tabindex="-1"></a>                              ,<span class="at">k =</span> n_fold, </span>
<span id="cb517-9"><a href="recommender-systems-and-customer-targeting.html#cb517-9" aria-hidden="true" tabindex="-1"></a>                              <span class="at">given =</span> items_to_keep</span>
<span id="cb517-10"><a href="recommender-systems-and-customer-targeting.html#cb517-10" aria-hidden="true" tabindex="-1"></a>                              ,<span class="at">goodRating =</span> rating_threshold)</span>
<span id="cb517-11"><a href="recommender-systems-and-customer-targeting.html#cb517-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb517-12"><a href="recommender-systems-and-customer-targeting.html#cb517-12" aria-hidden="true" tabindex="-1"></a>size_sets <span class="ot">&lt;-</span><span class="fu">sapply</span>(eval_sets<span class="sc">@</span>runsTrain, length)</span>
<span id="cb517-13"><a href="recommender-systems-and-customer-targeting.html#cb517-13" aria-hidden="true" tabindex="-1"></a>size_sets</span></code></pre></div>
<pre><code>## [1] 459 459 459 459</code></pre>
</div>
<div id="ibcf---item-based-collaborative-based" class="section level3" number="3.2.8">
<h3><span class="header-section-number">3.2.8</span> IBCF - Item based collaborative based</h3>
<div id="fitting-the-model-using-cv" class="section level4" number="3.2.8.1">
<h4><span class="header-section-number">3.2.8.1</span> Fitting the model (using CV)</h4>
<div class="sourceCode" id="cb519"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb519-1"><a href="recommender-systems-and-customer-targeting.html#cb519-1" aria-hidden="true" tabindex="-1"></a>model_to_evaluate <span class="ot">&lt;-</span> <span class="st">&quot;IBCF&quot;</span></span>
<span id="cb519-2"><a href="recommender-systems-and-customer-targeting.html#cb519-2" aria-hidden="true" tabindex="-1"></a>model_parameters <span class="ot">&lt;-</span> <span class="cn">NULL</span>  <span class="co"># we use the standard settings</span></span>
<span id="cb519-3"><a href="recommender-systems-and-customer-targeting.html#cb519-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb519-4"><a href="recommender-systems-and-customer-targeting.html#cb519-4" aria-hidden="true" tabindex="-1"></a>eval_recommender <span class="ot">&lt;-</span><span class="fu">Recommender</span>(<span class="at">data =</span> <span class="fu">getData</span>(eval_sets, <span class="st">&quot;train&quot;</span>)</span>
<span id="cb519-5"><a href="recommender-systems-and-customer-targeting.html#cb519-5" aria-hidden="true" tabindex="-1"></a>                               ,<span class="at">method =</span> model_to_evaluate</span>
<span id="cb519-6"><a href="recommender-systems-and-customer-targeting.html#cb519-6" aria-hidden="true" tabindex="-1"></a>                               ,<span class="at">parameter =</span> model_parameters)</span></code></pre></div>
</div>
<div id="making-predictions" class="section level4" number="3.2.8.2">
<h4><span class="header-section-number">3.2.8.2</span> Making predictions</h4>
<p>The IBCF can recommend new items and predict their ratings. In order to build the model, we need to specify how many items we want to recommend, for example, 5.</p>
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb520-1"><a href="recommender-systems-and-customer-targeting.html#cb520-1" aria-hidden="true" tabindex="-1"></a>items_to_recommend <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb520-2"><a href="recommender-systems-and-customer-targeting.html#cb520-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb520-3"><a href="recommender-systems-and-customer-targeting.html#cb520-3" aria-hidden="true" tabindex="-1"></a><span class="co"># We can build the matrix with the predicted ratings using the predict function:</span></span>
<span id="cb520-4"><a href="recommender-systems-and-customer-targeting.html#cb520-4" aria-hidden="true" tabindex="-1"></a>eval_prediction <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="at">object =</span> eval_recommender</span>
<span id="cb520-5"><a href="recommender-systems-and-customer-targeting.html#cb520-5" aria-hidden="true" tabindex="-1"></a>                           ,<span class="at">newdata =</span> <span class="fu">getData</span>(eval_sets, <span class="st">&quot;known&quot;</span>)</span>
<span id="cb520-6"><a href="recommender-systems-and-customer-targeting.html#cb520-6" aria-hidden="true" tabindex="-1"></a>                           ,<span class="at">n =</span> items_to_recommend</span>
<span id="cb520-7"><a href="recommender-systems-and-customer-targeting.html#cb520-7" aria-hidden="true" tabindex="-1"></a>                           ,<span class="at">type =</span> <span class="st">&quot;ratings&quot;</span>)</span></code></pre></div>
</div>
<div id="performance-metrics" class="section level4" number="3.2.8.3">
<h4><span class="header-section-number">3.2.8.3</span> Performance metrics</h4>
<p><strong>Per user</strong></p>
<p>By using the <code>calcPredictionAccuracy</code>, we can calculate:</p>
<ul>
<li>the Root mean square error <strong>(RMSE)</strong>,</li>
<li>Mean squared error <strong>(MSE)</strong>, and</li>
<li>the Mean absolute error <strong>(MAE)</strong>.</li>
</ul>
<p>We want to compare the results on each user, hence we take the head. In the following we are also plotting a histogram.</p>
<div class="sourceCode" id="cb521"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb521-1"><a href="recommender-systems-and-customer-targeting.html#cb521-1" aria-hidden="true" tabindex="-1"></a>eval_accuracy <span class="ot">&lt;-</span> <span class="fu">calcPredictionAccuracy</span>(</span>
<span id="cb521-2"><a href="recommender-systems-and-customer-targeting.html#cb521-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> eval_prediction</span>
<span id="cb521-3"><a href="recommender-systems-and-customer-targeting.html#cb521-3" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">data =</span> <span class="fu">getData</span>(eval_sets, <span class="st">&quot;unknown&quot;</span>)</span>
<span id="cb521-4"><a href="recommender-systems-and-customer-targeting.html#cb521-4" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">byUser =</span> <span class="cn">TRUE</span> <span class="co">#Because, how good does the model work for each user</span></span>
<span id="cb521-5"><a href="recommender-systems-and-customer-targeting.html#cb521-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb521-6"><a href="recommender-systems-and-customer-targeting.html#cb521-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb521-7"><a href="recommender-systems-and-customer-targeting.html#cb521-7" aria-hidden="true" tabindex="-1"></a><span class="co"># This is a small sample of the results for the Prediction and Accuracy</span></span>
<span id="cb521-8"><a href="recommender-systems-and-customer-targeting.html#cb521-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(eval_accuracy)</span></code></pre></div>
<pre><code>##        RMSE      MSE       MAE
## 1  1.497832 2.243502 1.1888625
## 12 1.035603 1.072474 0.6004122
## 14 1.290864 1.666331 0.9981729
## 15 1.612897 2.601437 1.2568863
## 20 1.436871 2.064599 1.2632984
## 32 1.287141 1.656732 1.0935495</code></pre>
<div class="sourceCode" id="cb523"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb523-1"><a href="recommender-systems-and-customer-targeting.html#cb523-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, let&#39;s take a look at the RMSE by each user</span></span>
<span id="cb523-2"><a href="recommender-systems-and-customer-targeting.html#cb523-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(eval_accuracy[,<span class="st">&quot;RMSE&quot;</span>]) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb523-3"><a href="recommender-systems-and-customer-targeting.html#cb523-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Distribution of the RMSE by user&quot;</span>)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-243-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>We see that the typical RMSE is between 1 and 1.5.</p>
<p><strong>Overall</strong></p>
<p>The following is the average for all users</p>
<div class="sourceCode" id="cb524"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb524-1"><a href="recommender-systems-and-customer-targeting.html#cb524-1" aria-hidden="true" tabindex="-1"></a><span class="co"># However, we need to evaluate the model as a whole, so we will set the byUser to False</span></span>
<span id="cb524-2"><a href="recommender-systems-and-customer-targeting.html#cb524-2" aria-hidden="true" tabindex="-1"></a>eval_accuracy <span class="ot">&lt;-</span> <span class="fu">calcPredictionAccuracy</span>(</span>
<span id="cb524-3"><a href="recommender-systems-and-customer-targeting.html#cb524-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> eval_prediction</span>
<span id="cb524-4"><a href="recommender-systems-and-customer-targeting.html#cb524-4" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">data =</span> <span class="fu">getData</span>(eval_sets, <span class="st">&quot;unknown&quot;</span>)</span>
<span id="cb524-5"><a href="recommender-systems-and-customer-targeting.html#cb524-5" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">byUser =</span> <span class="cn">FALSE</span> <span class="co">#We want it for the whole model</span></span>
<span id="cb524-6"><a href="recommender-systems-and-customer-targeting.html#cb524-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb524-7"><a href="recommender-systems-and-customer-targeting.html#cb524-7" aria-hidden="true" tabindex="-1"></a>eval_accuracy <span class="co">#for IBCF</span></span></code></pre></div>
<pre><code>##      RMSE       MSE       MAE 
## 1.2865540 1.6552211 0.9776134</code></pre>
<p>The mean absolute error is just above 1, hence one rating off. Lets us take a look at the confusionmatrix to see how it looks there.</p>
<p>Notice that we specificy n, that is because we want predictions for different number of predictions.</p>
<div class="sourceCode" id="cb526"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb526-1"><a href="recommender-systems-and-customer-targeting.html#cb526-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Confusion matrix good threshold =4</span></span>
<span id="cb526-2"><a href="recommender-systems-and-customer-targeting.html#cb526-2" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">evaluate</span>(<span class="at">x =</span> eval_sets <span class="co">#Using the Cross validation</span></span>
<span id="cb526-3"><a href="recommender-systems-and-customer-targeting.html#cb526-3" aria-hidden="true" tabindex="-1"></a>                    ,<span class="at">method =</span> model_to_evaluate</span>
<span id="cb526-4"><a href="recommender-systems-and-customer-targeting.html#cb526-4" aria-hidden="true" tabindex="-1"></a>                    ,<span class="at">n =</span> <span class="fu">seq</span>(<span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">10</span>)) <span class="co">#We make from 10 to 100 recommendations</span></span></code></pre></div>
<pre><code>## IBCF run fold/sample [model time/prediction time]
##   1  [0.148sec/0.037sec] 
##   2  [0.149sec/0.037sec] 
##   3  [0.142sec/0.036sec] 
##   4  [0.156sec/0.037sec]</code></pre>
<p>results object is an evaluationResults object containing the results of the evaluation.
Each element of the list corresponds to a different split of the k-fold.
Letâs look at the first element</p>
<div class="sourceCode" id="cb528"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb528-1"><a href="recommender-systems-and-customer-targeting.html#cb528-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Results for each CV</span></span>
<span id="cb528-2"><a href="recommender-systems-and-customer-targeting.html#cb528-2" aria-hidden="true" tabindex="-1"></a><span class="fu">getConfusionMatrix</span>(results)[[<span class="dv">1</span>]] <span class="co">#the first cross validation, 2 would be the second CV etc.</span></span></code></pre></div>
<pre><code>##              TP       FP       FN       TN   N precision     recall        TPR
##  [1,]  1.750000  8.25000 43.30769 258.6923 312 0.1750000 0.03764419 0.03764419
##  [2,]  3.320513 16.67949 41.73718 250.2628 312 0.1660256 0.07092946 0.07092946
##  [3,]  4.980769 25.01923 40.07692 241.9231 312 0.1660256 0.10898860 0.10898860
##  [4,]  6.262821 33.73718 38.79487 233.2051 312 0.1565705 0.13940092 0.13940092
##  [5,]  7.705128 42.29487 37.35256 224.6474 312 0.1541026 0.17067432 0.17067432
##  [6,]  9.076923 50.92308 35.98077 216.0192 312 0.1512821 0.19979843 0.19979843
##  [7,] 10.416667 59.58333 34.64103 207.3590 312 0.1488095 0.23239186 0.23239186
##  [8,] 11.666667 68.33333 33.39103 198.6090 312 0.1458333 0.26205976 0.26205976
##  [9,] 12.967949 77.03205 32.08974 189.9103 312 0.1440883 0.28825533 0.28825533
## [10,] 14.198718 85.80128 30.85897 181.1410 312 0.1419872 0.31749146 0.31749146
##              FPR   n
##  [1,] 0.03084949  10
##  [2,] 0.06239415  20
##  [3,] 0.09371258  30
##  [4,] 0.12651359  40
##  [5,] 0.15869446  50
##  [6,] 0.19111871  60
##  [7,] 0.22358664  70
##  [8,] 0.25637477  80
##  [9,] 0.28901715  90
## [10,] 0.32195177 100</code></pre>
<div class="sourceCode" id="cb530"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb530-1"><a href="recommender-systems-and-customer-targeting.html#cb530-1" aria-hidden="true" tabindex="-1"></a><span class="co">#getConfusionMatrix(results)[[2]] #the first cross validation, 2 would be the second CV etc.</span></span>
<span id="cb530-2"><a href="recommender-systems-and-customer-targeting.html#cb530-2" aria-hidden="true" tabindex="-1"></a><span class="co">#getConfusionMatrix(results)[[3]] #the first cross validation, 2 would be the second CV etc.</span></span>
<span id="cb530-3"><a href="recommender-systems-and-customer-targeting.html#cb530-3" aria-hidden="true" tabindex="-1"></a><span class="co">#getConfusionMatrix(results)[[4]] #the first cross validation, 2 would be the second CV etc.</span></span></code></pre></div>
<p>We see that the more recommendations we make, the âbetterâ does the results get, although making 100 recommendations also means that the FP is also increasing, hence we start recommending something, where it did not turn out to be purchased. Hence it is a trade-off.</p>
<p>In this case, look at the first four columns</p>
<ul>
<li>True Positives (TP): These are recommended items that have been purchased.</li>
<li>False Positives (FP): These are recommended items that havenât been purchased</li>
<li>False Negatives (FN): These are not recommended items that have been purchased.</li>
<li>True Negatives (TN): These are not recommended items that havenât been purchased.</li>
</ul>
<p><strong>Manually making the ROC curve</strong></p>
<div class="sourceCode" id="cb531"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb531-1"><a href="recommender-systems-and-customer-targeting.html#cb531-1" aria-hidden="true" tabindex="-1"></a><span class="co"># If we want to take account of all the splits at the same time, we can just sum up the indices:</span></span>
<span id="cb531-2"><a href="recommender-systems-and-customer-targeting.html#cb531-2" aria-hidden="true" tabindex="-1"></a>columns_to_sum <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;TP&quot;</span>, <span class="st">&quot;FP&quot;</span>, <span class="st">&quot;FN&quot;</span>, <span class="st">&quot;TN&quot;</span>)</span>
<span id="cb531-3"><a href="recommender-systems-and-customer-targeting.html#cb531-3" aria-hidden="true" tabindex="-1"></a>indices_summed <span class="ot">&lt;-</span> <span class="fu">Reduce</span>(<span class="st">&quot;+&quot;</span>, <span class="fu">getConfusionMatrix</span>(results))[, columns_to_sum]</span>
<span id="cb531-4"><a href="recommender-systems-and-customer-targeting.html#cb531-4" aria-hidden="true" tabindex="-1"></a>TPR <span class="ot">&lt;-</span> indices_summed[,<span class="st">&quot;TP&quot;</span>]<span class="sc">/</span>(indices_summed[,<span class="st">&quot;TP&quot;</span>] <span class="sc">+</span> indices_summed[,<span class="st">&quot;FN&quot;</span>])</span>
<span id="cb531-5"><a href="recommender-systems-and-customer-targeting.html#cb531-5" aria-hidden="true" tabindex="-1"></a>FPR <span class="ot">&lt;-</span> indices_summed[,<span class="st">&quot;FP&quot;</span>]<span class="sc">/</span>(indices_summed[,<span class="st">&quot;FP&quot;</span>] <span class="sc">+</span> indices_summed[,<span class="st">&quot;TN&quot;</span>])</span>
<span id="cb531-6"><a href="recommender-systems-and-customer-targeting.html#cb531-6" aria-hidden="true" tabindex="-1"></a>indices_summed <span class="ot">&lt;-</span> <span class="fu">cbind</span>(indices_summed,TPR,FPR)</span>
<span id="cb531-7"><a href="recommender-systems-and-customer-targeting.html#cb531-7" aria-hidden="true" tabindex="-1"></a>indices_summed</span></code></pre></div>
<pre><code>##              TP        FP       FN        TN        TPR        FPR
##  [1,]  7.051282  32.94872 174.0897 1033.9103 0.03892703 0.03088386
##  [2,] 13.416667  66.58333 167.7244 1000.2756 0.07406752 0.06241062
##  [3,] 19.666667 100.33333 161.4744  966.5256 0.10857102 0.09404554
##  [4,] 25.141026 134.85897 156.0000  932.0000 0.13879255 0.12640750
##  [5,] 30.705128 169.29487 150.4359  897.5641 0.16950952 0.15868533
##  [6,] 35.858974 204.14103 145.2821  862.7179 0.19796164 0.19134771
##  [7,] 41.224359 238.77564 139.9167  828.0833 0.22758157 0.22381181
##  [8,] 46.384615 273.61538 134.7564  793.2436 0.25606908 0.25646818
##  [9,] 51.615385 308.36538 129.5256  758.4936 0.28494586 0.28904044
## [10,] 56.891026 343.02564 124.2500  723.8333 0.31407035 0.32152857</code></pre>
<div class="sourceCode" id="cb533"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb533-1"><a href="recommender-systems-and-customer-targeting.html#cb533-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> TPR <span class="ot">&lt;-</span> indices_summed[,<span class="st">&quot;FPR&quot;</span>],<span class="at">y =</span> TPR <span class="ot">&lt;-</span> indices_summed[,<span class="st">&quot;TPR&quot;</span>],<span class="at">type =</span> <span class="st">&quot;b&quot;</span></span>
<span id="cb533-2"><a href="recommender-systems-and-customer-targeting.html#cb533-2" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">cex =</span> <span class="dv">0</span> <span class="co">#To remove dots.</span></span>
<span id="cb533-3"><a href="recommender-systems-and-customer-targeting.html#cb533-3" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">xlab =</span> <span class="st">&quot;FPR&quot;</span></span>
<span id="cb533-4"><a href="recommender-systems-and-customer-targeting.html#cb533-4" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">ylab =</span> <span class="st">&quot;TPR&quot;</span></span>
<span id="cb533-5"><a href="recommender-systems-and-customer-targeting.html#cb533-5" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb533-6"><a href="recommender-systems-and-customer-targeting.html#cb533-6" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> TPR <span class="ot">&lt;-</span> indices_summed[,<span class="st">&quot;FPR&quot;</span>],<span class="at">y =</span> TPR <span class="ot">&lt;-</span> indices_summed[,<span class="st">&quot;TPR&quot;</span>],<span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">10</span>,<span class="dv">100</span>,<span class="dv">10</span>))</span>
<span id="cb533-7"><a href="recommender-systems-and-customer-targeting.html#cb533-7" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&quot;ROC&quot;</span>)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-247-1.png" width="720" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="building-roc-curve-and-precision-recall-rate" class="section level3" number="3.2.9">
<h3><span class="header-section-number">3.2.9</span> Building ROC curve and precision / recall rate</h3>
<p>Building an ROC curve. Will need these factors</p>
<ol style="list-style-type: decimal">
<li>True Positive Rate (TPR): Percentage of purchased items that have been recommended. TP/(TP + FN)</li>
<li>False Positive Rate (FPR): Percentage of not purchased items that have been recommended. FP/(FP + TN)</li>
</ol>
<div class="sourceCode" id="cb534"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb534-1"><a href="recommender-systems-and-customer-targeting.html#cb534-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(results, <span class="at">annotate =</span> <span class="cn">TRUE</span>, <span class="at">main =</span> <span class="st">&quot;ROC curve&quot;</span>)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-248-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>Now we can also make a precision / recall rate</p>
<p>We can also look at the accuracy metrics as well:</p>
<ul>
<li>Precision: Percentage of recommended items that have been purchased. FP/(TP + FP)</li>
<li>Recall: Percentage of purchased items that have been recommended. TP/(TP + FN) = True Positive Rate</li>
</ul>
<div class="sourceCode" id="cb535"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb535-1"><a href="recommender-systems-and-customer-targeting.html#cb535-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(results, <span class="st">&quot;prec/rec&quot;</span>, <span class="at">annotate =</span> <span class="cn">TRUE</span>, <span class="at">main =</span> <span class="st">&quot;Precision-Recall&quot;</span>)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-249-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>The plots above gives an indication of how many recommendations to make. Notice that it is based upon the results object that we are making, there we specify the intervals for which we are going to recommend.</p>
</div>
<div id="comparing-ubcf-and-ibcf" class="section level3" number="3.2.10">
<h3><span class="header-section-number">3.2.10</span> Comparing UBCF and IBCF</h3>
<p>let us see how the models compare</p>
<div class="sourceCode" id="cb536"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb536-1"><a href="recommender-systems-and-customer-targeting.html#cb536-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Comparing models</span></span>
<span id="cb536-2"><a href="recommender-systems-and-customer-targeting.html#cb536-2" aria-hidden="true" tabindex="-1"></a>models_to_evaluate <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">IBCF_cos =</span> <span class="fu">list</span>(<span class="at">name =</span> <span class="st">&quot;IBCF&quot;</span>, <span class="at">param =</span> <span class="fu">list</span>(<span class="at">method =</span> <span class="st">&quot;cosine&quot;</span>)),  <span class="co">#Cosine correl. coef.</span></span>
<span id="cb536-3"><a href="recommender-systems-and-customer-targeting.html#cb536-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">IBCF_cor =</span> <span class="fu">list</span>(<span class="at">name =</span> <span class="st">&quot;IBCF&quot;</span>, <span class="at">param =</span> <span class="fu">list</span>(<span class="at">method =</span> <span class="st">&quot;pearson&quot;</span>)), <span class="co">#Pearson correl. coef.</span></span>
<span id="cb536-4"><a href="recommender-systems-and-customer-targeting.html#cb536-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">UBCF_cos =</span> <span class="fu">list</span>(<span class="at">name =</span> <span class="st">&quot;UBCF&quot;</span>, <span class="at">param =</span> <span class="fu">list</span>(<span class="at">method =</span> <span class="st">&quot;cosine&quot;</span>)), </span>
<span id="cb536-5"><a href="recommender-systems-and-customer-targeting.html#cb536-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">UBCF_cor =</span> <span class="fu">list</span>(<span class="at">name =</span> <span class="st">&quot;UBCF&quot;</span>, <span class="at">param =</span> <span class="fu">list</span>(<span class="at">method =</span> <span class="st">&quot;pearson&quot;</span>)), </span>
<span id="cb536-6"><a href="recommender-systems-and-customer-targeting.html#cb536-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">random =</span> <span class="fu">list</span>(<span class="at">name =</span> <span class="st">&quot;RANDOM&quot;</span>, <span class="at">param =</span> <span class="cn">NULL</span>))</span>
<span id="cb536-7"><a href="recommender-systems-and-customer-targeting.html#cb536-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb536-8"><a href="recommender-systems-and-customer-targeting.html#cb536-8" aria-hidden="true" tabindex="-1"></a><span class="co"># In order to evaluate the models, we need to test them, varying the number of items.</span></span>
<span id="cb536-9"><a href="recommender-systems-and-customer-targeting.html#cb536-9" aria-hidden="true" tabindex="-1"></a>n_recommendations <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="fu">seq</span>(<span class="dv">10</span>,<span class="dv">100</span>,<span class="dv">10</span>))</span>
<span id="cb536-10"><a href="recommender-systems-and-customer-targeting.html#cb536-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb536-11"><a href="recommender-systems-and-customer-targeting.html#cb536-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Now let&#39;s run and evaluate the models</span></span>
<span id="cb536-12"><a href="recommender-systems-and-customer-targeting.html#cb536-12" aria-hidden="true" tabindex="-1"></a>list_results <span class="ot">&lt;-</span> <span class="fu">evaluate</span>(<span class="at">x =</span> eval_sets, <span class="at">method =</span> models_to_evaluate, <span class="at">n =</span> n_recommendations)</span></code></pre></div>
<pre><code>## IBCF run fold/sample [model time/prediction time]
##   1  [0.146sec/0.038sec] 
##   2  [0.145sec/0.036sec] 
##   3  [0.154sec/0.036sec] 
##   4  [0.155sec/0.102sec] 
## IBCF run fold/sample [model time/prediction time]
##   1  [0.242sec/0.036sec] 
##   2  [0.232sec/0.036sec] 
##   3  [0.233sec/0.037sec] 
##   4  [0.227sec/0.036sec] 
## UBCF run fold/sample [model time/prediction time]
##   1  [0.004sec/0.237sec] 
##   2  [0.003sec/0.305sec] 
##   3  [0.004sec/0.239sec] 
##   4  [0.005sec/0.298sec] 
## UBCF run fold/sample [model time/prediction time]
##   1  [0.004sec/0.268sec] 
##   2  [0.003sec/0.339sec] 
##   3  [0.005sec/0.26sec] 
##   4  [0.004sec/0.328sec] 
## RANDOM run fold/sample [model time/prediction time]
##   1  [0sec/0.041sec] 
##   2  [0.001sec/0.046sec] 
##   3  [0.001sec/0.039sec] 
##   4  [0.001sec/0.04sec]</code></pre>
<p>Now we can plot the roc curves and the and the precision - recall rate.</p>
<div class="sourceCode" id="cb538"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb538-1"><a href="recommender-systems-and-customer-targeting.html#cb538-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(list_results, <span class="at">annotate =</span> <span class="dv">1</span>, <span class="at">legend =</span> <span class="st">&quot;topleft&quot;</span>)</span>
<span id="cb538-2"><a href="recommender-systems-and-customer-targeting.html#cb538-2" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&quot;ROC curve&quot;</span>)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-251-1.png" width="720" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb539"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb539-1"><a href="recommender-systems-and-customer-targeting.html#cb539-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(list_results, <span class="st">&quot;prec/rec&quot;</span>, <span class="at">annotate =</span> <span class="dv">1</span>, <span class="at">legend =</span> <span class="st">&quot;bottomright&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.4</span>))</span>
<span id="cb539-2"><a href="recommender-systems-and-customer-targeting.html#cb539-2" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&quot;Precision-recall&quot;</span>)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-251-2.png" width="720" style="display: block; margin: auto;" /></p>
<p>We see that the IBCF Pearson correlation coefficient gets the best result. We also see that the random recommendations is almost as good as some of the other methods.</p>
<p><strong>Other evaluation criteria</strong></p>
<ol style="list-style-type: decimal">
<li>Coverage - what we have seen earlier</li>
<li>Diversity and novelty - To avoid monotone lists, discover new families of items</li>
<li>Serendipity - Unexpected and surprisng items might be valuable</li>
<li>Familiarity - GIve the user the impression of understanding his/her needs</li>
<li>Biases - Do we just end up recommended the best movies? hence there is a great bias.</li>
</ol>
<div class="sourceCode" id="cb540"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb540-1"><a href="recommender-systems-and-customer-targeting.html#cb540-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code></pre></div>
</div>
</div>
<div id="latent-factor-models" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Latent Factor Models</h2>
<p>This is a snippet from the introduction in the chapter:</p>
<p><em>The last approach is the latent factor model, this is just an extension of the user-based and item-based, where both scenarios are considered. This method assumes that we make some constructs, e.g., as in SEM, where the constructs are explained by different items (movies). Then it would be obvious to make constructs based on different genres. These constructs are not directly observable, hence the name latent.</em></p>
<p><em>Within LFM cold start also applies</em></p>
<p><strong>How is correlation measured?</strong></p>
<p>We see that the dot product (inner product) between items and users, here we are able to interpret the projection of these from the center to see how similar/dissimilar they are. From the image we can see that Gus and the guy in the top right is more or less perpendicular, so they do not share much interest on the y axis, although on the x axis they appear to be equally far out, hence the dot product appears to be able to reflect similarity between perople.</p>
<p><img src="images/DotProduct.png" alt="Dot product example" />.</p>
<p>Hence to make these projections we need to find to matrices - namely U and V. To estimate the values for these to matrices, we have used one approach, the <strong>Signular Value Decomposition (SVD)</strong>. Notice that this approach demands that we have a full matrix, as we often have sparse matrices, is that it replace missing values with the column means. This introduce a lot of bias, but makes the model work. For this method we cannot really avoid it, because each movie is never reviewed by all users.</p>
<p>Notice that for this method we are able to account for bias for ratings, e.g., one person may often give relatively higher ratings than other, hence we can regularize this to get rid of some bias.</p>
<div class="sourceCode" id="cb541"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb541-1"><a href="recommender-systems-and-customer-targeting.html#cb541-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(recommenderlab)</span>
<span id="cb541-2"><a href="recommender-systems-and-customer-targeting.html#cb541-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<div class="sourceCode" id="cb542"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb542-1"><a href="recommender-systems-and-customer-targeting.html#cb542-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(MovieLense)</span>
<span id="cb542-2"><a href="recommender-systems-and-customer-targeting.html#cb542-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(MovieLense)</span></code></pre></div>
<pre><code>## [1] &quot;realRatingMatrix&quot;
## attr(,&quot;package&quot;)
## [1] &quot;recommenderlab&quot;</code></pre>
<div class="sourceCode" id="cb544"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb544-1"><a href="recommender-systems-and-customer-targeting.html#cb544-1" aria-hidden="true" tabindex="-1"></a><span class="fu">help</span>(MovieLense)</span>
<span id="cb544-2"><a href="recommender-systems-and-customer-targeting.html#cb544-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(MovieLense)</span></code></pre></div>
<pre><code>## [1]  943 1664</code></pre>
<p>Select only the users who have rated at least 50 movies or movies that had been rated more than 100 times. As if they did not rate more than this it starts getting difficult recommeding movies for them.</p>
<div class="sourceCode" id="cb546"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb546-1"><a href="recommender-systems-and-customer-targeting.html#cb546-1" aria-hidden="true" tabindex="-1"></a>(ratings_movies <span class="ot">&lt;-</span> MovieLense[<span class="fu">rowCounts</span>(MovieLense) <span class="sc">&gt;</span> <span class="dv">50</span>,</span>
<span id="cb546-2"><a href="recommender-systems-and-customer-targeting.html#cb546-2" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">colCounts</span>(MovieLense) <span class="sc">&gt;</span> <span class="dv">100</span>])</span></code></pre></div>
<pre><code>## 560 x 332 rating matrix of class &#39;realRatingMatrix&#39; with 55298 ratings.</code></pre>
<div class="sourceCode" id="cb548"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb548-1"><a href="recommender-systems-and-customer-targeting.html#cb548-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use the minimum number of items purchased by any user to decide item number to keep</span></span>
<span id="cb548-2"><a href="recommender-systems-and-customer-targeting.html#cb548-2" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(<span class="fu">rowCounts</span>(ratings_movies))</span>
<span id="cb548-3"><a href="recommender-systems-and-customer-targeting.html#cb548-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb548-4"><a href="recommender-systems-and-customer-targeting.html#cb548-4" aria-hidden="true" tabindex="-1"></a>n_fold <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb548-5"><a href="recommender-systems-and-customer-targeting.html#cb548-5" aria-hidden="true" tabindex="-1"></a>items_to_keep <span class="ot">&lt;-</span> <span class="dv">15</span> <span class="co">#randomly chosen items from a given responded</span></span>
<span id="cb548-6"><a href="recommender-systems-and-customer-targeting.html#cb548-6" aria-hidden="true" tabindex="-1"></a>rating_threshold <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="co">#A good rating is three or higher</span></span></code></pre></div>
<pre><code>## [1] 18</code></pre>
<p>In the following we include SVD-Funk, there is a bunch of tuning parameters, these are:</p>
<ul>
<li>k = number of topics</li>
<li>gamma = Learning parameter / learning rate</li>
<li>lambda = The regularization</li>
</ul>
<p><em>Notice that there are default values, although we choose to set k to 50.</em></p>
<div class="sourceCode" id="cb550"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb550-1"><a href="recommender-systems-and-customer-targeting.html#cb550-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use k-fold to validate models</span></span>
<span id="cb550-2"><a href="recommender-systems-and-customer-targeting.html#cb550-2" aria-hidden="true" tabindex="-1"></a>eval_sets <span class="ot">&lt;-</span> <span class="fu">evaluationScheme</span>(<span class="at">data =</span> ratings_movies</span>
<span id="cb550-3"><a href="recommender-systems-and-customer-targeting.html#cb550-3" aria-hidden="true" tabindex="-1"></a>                              ,<span class="at">method =</span> <span class="st">&quot;cross-validation&quot;</span></span>
<span id="cb550-4"><a href="recommender-systems-and-customer-targeting.html#cb550-4" aria-hidden="true" tabindex="-1"></a>                              ,<span class="at">k =</span> n_fold</span>
<span id="cb550-5"><a href="recommender-systems-and-customer-targeting.html#cb550-5" aria-hidden="true" tabindex="-1"></a>                              ,<span class="at">given =</span> items_to_keep</span>
<span id="cb550-6"><a href="recommender-systems-and-customer-targeting.html#cb550-6" aria-hidden="true" tabindex="-1"></a>                              ,<span class="at">goodRating =</span> rating_threshold)</span>
<span id="cb550-7"><a href="recommender-systems-and-customer-targeting.html#cb550-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb550-8"><a href="recommender-systems-and-customer-targeting.html#cb550-8" aria-hidden="true" tabindex="-1"></a><span class="co">#We want to comapre different approaches</span></span>
<span id="cb550-9"><a href="recommender-systems-and-customer-targeting.html#cb550-9" aria-hidden="true" tabindex="-1"></a>models  <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb550-10"><a href="recommender-systems-and-customer-targeting.html#cb550-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">IBCF =</span> <span class="fu">list</span>(<span class="at">name =</span> <span class="st">&quot;IBCF&quot;</span>,<span class="at">param =</span> <span class="fu">list</span>(<span class="at">method =</span> <span class="st">&quot;cosine&quot;</span>)),</span>
<span id="cb550-11"><a href="recommender-systems-and-customer-targeting.html#cb550-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">UBCF =</span> <span class="fu">list</span>(<span class="at">name =</span> <span class="st">&quot;UBCF&quot;</span>, <span class="at">param =</span> <span class="fu">list</span>(<span class="at">method =</span> <span class="st">&quot;pearson&quot;</span>)),</span>
<span id="cb550-12"><a href="recommender-systems-and-customer-targeting.html#cb550-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">SVD =</span> <span class="fu">list</span>(<span class="at">name =</span> <span class="st">&quot;SVD&quot;</span>, <span class="at">param =</span> <span class="fu">list</span>(<span class="at">k =</span> <span class="dv">50</span>)), <span class="co">#50 concepts included</span></span>
<span id="cb550-13"><a href="recommender-systems-and-customer-targeting.html#cb550-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">SVDF =</span> <span class="fu">list</span>(<span class="at">name =</span> <span class="st">&quot;SVDF&quot;</span>, <span class="at">param =</span> <span class="fu">list</span>(<span class="at">k =</span> <span class="dv">50</span>)) <span class="co">#50 concepts included</span></span>
<span id="cb550-14"><a href="recommender-systems-and-customer-targeting.html#cb550-14" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>notice that the SVDF takes some time to compute. That is beacuse it has to go through all the known ratings and construct the U and V matrix.</p>
<div class="sourceCode" id="cb551"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb551-1"><a href="recommender-systems-and-customer-targeting.html#cb551-1" aria-hidden="true" tabindex="-1"></a><span class="co"># varying the number of items we want to recommend to users</span></span>
<span id="cb551-2"><a href="recommender-systems-and-customer-targeting.html#cb551-2" aria-hidden="true" tabindex="-1"></a>n_rec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="fu">seq</span>(<span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">10</span>))</span>
<span id="cb551-3"><a href="recommender-systems-and-customer-targeting.html#cb551-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb551-4"><a href="recommender-systems-and-customer-targeting.html#cb551-4" aria-hidden="true" tabindex="-1"></a><span class="co"># evaluating the recommendations</span></span>
<span id="cb551-5"><a href="recommender-systems-and-customer-targeting.html#cb551-5" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">evaluate</span>(<span class="at">x =</span> eval_sets, <span class="at">method =</span> models, <span class="at">n=</span> n_rec)</span></code></pre></div>
<pre><code>## IBCF run fold/sample [model time/prediction time]
##   1  [0.142sec/0.036sec] 
##   2  [0.138sec/0.033sec] 
##   3  [0.137sec/0.031sec] 
##   4  [0.14sec/0.033sec] 
## UBCF run fold/sample [model time/prediction time]
##   1  [0.004sec/0.415sec] 
##   2  [0.003sec/0.226sec] 
##   3  [0.004sec/0.232sec] 
##   4  [0.003sec/0.228sec] 
## SVD run fold/sample [model time/prediction time]
##   1  [0.128sec/0.044sec] 
##   2  [0.12sec/0.034sec] 
##   3  [0.132sec/0.034sec] 
##   4  [0.123sec/0.035sec] 
## SVDF run fold/sample [model time/prediction time]
##   1  [52.911sec/12.98sec] 
##   2  [54.063sec/12.735sec] 
##   3  [51.292sec/12.718sec] 
##   4  [56.732sec/13.261sec]</code></pre>
<div class="sourceCode" id="cb553"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb553-1"><a href="recommender-systems-and-customer-targeting.html#cb553-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract the related average confusion matrices</span></span>
<span id="cb553-2"><a href="recommender-systems-and-customer-targeting.html#cb553-2" aria-hidden="true" tabindex="-1"></a>(avg_matrices <span class="ot">&lt;-</span> <span class="fu">lapply</span>(results, avg))</span>
<span id="cb553-3"><a href="recommender-systems-and-customer-targeting.html#cb553-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb553-4"><a href="recommender-systems-and-customer-targeting.html#cb553-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(results, <span class="at">annotate=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-259-1.png" width="720" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb554"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb554-1"><a href="recommender-systems-and-customer-targeting.html#cb554-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(results, <span class="st">&quot;prec/rec&quot;</span>, <span class="at">annotate =</span> <span class="cn">TRUE</span>, <span class="at">main =</span> <span class="st">&quot;Precision-Recall&quot;</span>)</span></code></pre></div>
<p><img src="Customer-Analytics-Notes_files/figure-html/unnamed-chunk-259-2.png" width="720" style="display: block; margin: auto;" /></p>
<pre><code>## $IBCF
##               TP         FP       FN       TN   N precision      recall
##  [1,]  0.3303571  0.6696429 72.75357 243.2464 317 0.3303571 0.004568692
##  [2,]  1.5160714  3.4839286 71.56786 240.4321 317 0.3032143 0.020634324
##  [3,]  2.8767857  7.1232143 70.20714 236.7929 317 0.2876786 0.040088734
##  [4,]  5.3482143 14.6517857 67.73571 229.2643 317 0.2674107 0.074195302
##  [5,]  7.7696429 22.2303571 65.31429 221.6857 317 0.2589881 0.108197019
##  [6,] 10.0553571 29.9446429 63.02857 213.9714 317 0.2513839 0.138813338
##  [7,] 12.2535714 37.7464286 60.83036 206.1696 317 0.2450714 0.169588086
##  [8,] 14.4321429 45.5678571 58.65179 198.3482 317 0.2405357 0.200229136
##  [9,] 16.5714286 53.4160714 56.51250 190.5000 317 0.2367549 0.229422172
## [10,] 18.7178571 61.2267857 54.36607 182.6893 317 0.2340674 0.257042328
## [11,] 20.8678571 69.0125000 52.21607 174.9036 317 0.2320829 0.286646823
## [12,] 22.9678571 76.8339286 50.11607 167.0821 317 0.2300182 0.314631273
##               TPR         FPR   n
##  [1,] 0.004568692 0.002698827   1
##  [2,] 0.020634324 0.014071290   5
##  [3,] 0.040088734 0.028856182  10
##  [4,] 0.074195302 0.059630384  20
##  [5,] 0.108197019 0.090767888  30
##  [6,] 0.138813338 0.122424915  40
##  [7,] 0.169588086 0.154621771  50
##  [8,] 0.200229136 0.186736794  60
##  [9,] 0.229422172 0.219029327  70
## [10,] 0.257042328 0.251059370  80
## [11,] 0.286646823 0.283069688  90
## [12,] 0.314631273 0.315243075 100
## 
## $UBCF
##              TP        FP       FN       TN   N precision      recall
##  [1,]  0.200000  0.800000 72.88393 243.1161 317 0.2000000 0.003102085
##  [2,]  1.089286  3.910714 71.99464 240.0054 317 0.2178571 0.015381877
##  [3,]  2.339286  7.660714 70.74464 236.2554 317 0.2339286 0.033106915
##  [4,]  5.080357 14.919643 68.00357 228.9964 317 0.2540179 0.071419240
##  [5,]  7.907143 22.092857 65.17679 221.8232 317 0.2635714 0.111028558
##  [6,] 10.662500 29.337500 62.42143 214.5786 317 0.2665625 0.149532758
##  [7,] 13.430357 36.569643 59.65357 207.3464 317 0.2686071 0.188680995
##  [8,] 16.210714 43.789286 56.87321 200.1268 317 0.2701786 0.226556760
##  [9,] 18.898214 51.101786 54.18571 192.8143 317 0.2699745 0.263241745
## [10,] 21.560714 58.439286 51.52321 185.4768 317 0.2695089 0.298798935
## [11,] 24.225000 65.775000 48.85893 178.1411 317 0.2691667 0.334021810
## [12,] 26.925000 73.075000 46.15893 170.8411 317 0.2692500 0.370086522
##               TPR         FPR   n
##  [1,] 0.003102085 0.003318243   1
##  [2,] 0.015381877 0.016126021   5
##  [3,] 0.033106915 0.031489110  10
##  [4,] 0.071419240 0.061072796  20
##  [5,] 0.111028558 0.090076120  30
##  [6,] 0.149532758 0.119608890  40
##  [7,] 0.188680995 0.149044295  50
##  [8,] 0.226556760 0.178323728  60
##  [9,] 0.263241745 0.208088165  70
## [10,] 0.298798935 0.237866098  80
## [11,] 0.334021810 0.267605469  90
## [12,] 0.370086522 0.297205841 100
## 
## $SVD
##              TP        FP       FN       TN   N precision      recall
##  [1,]  0.450000  0.550000 72.63393 243.3661 317 0.4500000 0.006932589
##  [2,]  2.092857  2.907143 70.99107 241.0089 317 0.4185714 0.032002768
##  [3,]  3.908929  6.091071 69.17500 237.8250 317 0.3908929 0.058777921
##  [4,]  7.021429 12.978571 66.06250 230.9375 317 0.3510714 0.102528131
##  [5,]  9.905357 20.094643 63.17857 223.8214 317 0.3301786 0.143496673
##  [6,] 12.557143 27.442857 60.52679 216.4732 317 0.3139286 0.180218464
##  [7,] 15.187500 34.812500 57.89643 209.1036 317 0.3037500 0.217443813
##  [8,] 17.698214 42.301786 55.38571 201.6143 317 0.2949702 0.252858144
##  [9,] 19.951786 50.048214 53.13214 193.8679 317 0.2850255 0.283024508
## [10,] 22.310714 57.689286 50.77321 186.2268 317 0.2788839 0.313963244
## [11,] 24.585714 65.414286 48.49821 178.5018 317 0.2731746 0.345222131
## [12,] 26.835714 73.164286 46.24821 170.7518 317 0.2683571 0.377419316
##               TPR        FPR   n
##  [1,] 0.006932589 0.00217082   1
##  [2,] 0.032002768 0.01154666   5
##  [3,] 0.058777921 0.02428955  10
##  [4,] 0.102528131 0.05221222  20
##  [5,] 0.143496673 0.08114971  30
##  [6,] 0.180218464 0.11096119  40
##  [7,] 0.217443813 0.14107822  50
##  [8,] 0.252858144 0.17165752  60
##  [9,] 0.283024508 0.20347839  70
## [10,] 0.313963244 0.23468178  80
## [11,] 0.345222131 0.26641002  90
## [12,] 0.377419316 0.29820879 100
## 
## $SVDF
##               TP         FP       FN       TN   N precision      recall
##  [1,]  0.4642857  0.5357143 72.61964 243.3804 317 0.4642857 0.006798236
##  [2,]  2.0607143  2.9392857 71.02321 240.9768 317 0.4121429 0.029918990
##  [3,]  3.9517857  6.0482143 69.13214 237.8679 317 0.3951786 0.057327356
##  [4,]  7.1517857 12.8482143 65.93214 231.0679 317 0.3575893 0.101596714
##  [5,] 10.1982143 19.8017857 62.88571 224.1143 317 0.3399405 0.143170359
##  [6,] 13.1017857 26.8982143 59.98214 217.0179 317 0.3275446 0.181778879
##  [7,] 15.8625000 34.1375000 57.22143 209.7786 317 0.3172500 0.219532352
##  [8,] 18.7410714 41.2589286 54.34286 202.6571 317 0.3123512 0.257835571
##  [9,] 21.4839286 48.5160714 51.60000 195.4000 317 0.3069133 0.294144039
## [10,] 24.2910714 55.7089286 48.79286 188.2071 317 0.3036384 0.331652928
## [11,] 27.0857143 62.9142857 45.99821 181.0018 317 0.3009524 0.369219330
## [12,] 29.7785714 70.2214286 43.30536 173.6946 317 0.2977857 0.404098654
##               TPR         FPR   n
##  [1,] 0.006798236 0.002107731   1
##  [2,] 0.029918990 0.011670172   5
##  [3,] 0.057327356 0.024138018  10
##  [4,] 0.101596714 0.051502000  20
##  [5,] 0.143170359 0.079566522  30
##  [6,] 0.181778879 0.108251975  40
##  [7,] 0.219532352 0.137661019  50
##  [8,] 0.257835571 0.166475776  60
##  [9,] 0.294144039 0.195882123  70
## [10,] 0.331652928 0.225024274  80
## [11,] 0.369219330 0.254149429  90
## [12,] 0.404098654 0.283631574 100</code></pre>
<p>We will see from the plot how the different models perform. We see that the SVDF appear to have the best performance.</p>
<div id="fitting-the-model-1" class="section level3" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Fitting the model</h3>
<div class="sourceCode" id="cb556"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb556-1"><a href="recommender-systems-and-customer-targeting.html#cb556-1" aria-hidden="true" tabindex="-1"></a>recommender_ibcf <span class="ot">&lt;-</span> <span class="fu">Recommender</span>(<span class="at">data =</span> <span class="fu">getData</span>(eval_sets, <span class="st">&quot;train&quot;</span>),</span>
<span id="cb556-2"><a href="recommender-systems-and-customer-targeting.html#cb556-2" aria-hidden="true" tabindex="-1"></a>                                <span class="at">method =</span> <span class="st">&quot;IBCF&quot;</span>,<span class="at">parameter =</span> <span class="fu">list</span>(<span class="at">method =</span> <span class="st">&quot;cosine&quot;</span>))</span>
<span id="cb556-3"><a href="recommender-systems-and-customer-targeting.html#cb556-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb556-4"><a href="recommender-systems-and-customer-targeting.html#cb556-4" aria-hidden="true" tabindex="-1"></a>recommender_ubcf <span class="ot">&lt;-</span> <span class="fu">Recommender</span>(<span class="at">data =</span> <span class="fu">getData</span>(eval_sets, <span class="st">&quot;train&quot;</span>),</span>
<span id="cb556-5"><a href="recommender-systems-and-customer-targeting.html#cb556-5" aria-hidden="true" tabindex="-1"></a>                                <span class="at">method =</span> <span class="st">&quot;UBCF&quot;</span>,<span class="at">parameter =</span> <span class="fu">list</span>(<span class="at">method =</span> <span class="st">&quot;pearson&quot;</span>))</span>
<span id="cb556-6"><a href="recommender-systems-and-customer-targeting.html#cb556-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb556-7"><a href="recommender-systems-and-customer-targeting.html#cb556-7" aria-hidden="true" tabindex="-1"></a>recommender_svd <span class="ot">&lt;-</span> <span class="fu">Recommender</span>(<span class="at">data =</span> <span class="fu">getData</span>(eval_sets, <span class="st">&quot;train&quot;</span>),</span>
<span id="cb556-8"><a href="recommender-systems-and-customer-targeting.html#cb556-8" aria-hidden="true" tabindex="-1"></a>                                <span class="at">method =</span> <span class="st">&quot;SVD&quot;</span>,<span class="at">parameter =</span> <span class="fu">list</span>(<span class="at">k=</span><span class="dv">50</span>))</span>
<span id="cb556-9"><a href="recommender-systems-and-customer-targeting.html#cb556-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb556-10"><a href="recommender-systems-and-customer-targeting.html#cb556-10" aria-hidden="true" tabindex="-1"></a>recommender_svdf <span class="ot">&lt;-</span> <span class="fu">Recommender</span>(<span class="at">data =</span> <span class="fu">getData</span>(eval_sets, <span class="st">&quot;train&quot;</span>),</span>
<span id="cb556-11"><a href="recommender-systems-and-customer-targeting.html#cb556-11" aria-hidden="true" tabindex="-1"></a>                               <span class="at">method =</span> <span class="st">&quot;SVDF&quot;</span>,<span class="at">parameter =</span> <span class="fu">list</span>(<span class="at">k=</span><span class="dv">50</span>))</span>
<span id="cb556-12"><a href="recommender-systems-and-customer-targeting.html#cb556-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb556-13"><a href="recommender-systems-and-customer-targeting.html#cb556-13" aria-hidden="true" tabindex="-1"></a>items_to_recommend <span class="ot">&lt;-</span> <span class="dv">10</span></span></code></pre></div>
</div>
<div id="making-predictions-1" class="section level3" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> Making predictions</h3>
<div class="sourceCode" id="cb557"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb557-1"><a href="recommender-systems-and-customer-targeting.html#cb557-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Produce predictions based upon the known dataset</span></span>
<span id="cb557-2"><a href="recommender-systems-and-customer-targeting.html#cb557-2" aria-hidden="true" tabindex="-1"></a>eval_prediction_ibcf <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="at">object =</span> recommender_ibcf</span>
<span id="cb557-3"><a href="recommender-systems-and-customer-targeting.html#cb557-3" aria-hidden="true" tabindex="-1"></a>                                ,<span class="at">newdata =</span> <span class="fu">getData</span>(eval_sets, <span class="st">&quot;known&quot;</span>)</span>
<span id="cb557-4"><a href="recommender-systems-and-customer-targeting.html#cb557-4" aria-hidden="true" tabindex="-1"></a>                                ,<span class="at">n =</span> items_to_recommend</span>
<span id="cb557-5"><a href="recommender-systems-and-customer-targeting.html#cb557-5" aria-hidden="true" tabindex="-1"></a>                                ,<span class="at">type =</span> <span class="st">&quot;ratings&quot;</span>)</span>
<span id="cb557-6"><a href="recommender-systems-and-customer-targeting.html#cb557-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb557-7"><a href="recommender-systems-and-customer-targeting.html#cb557-7" aria-hidden="true" tabindex="-1"></a>eval_prediction_ubcf <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="at">object =</span> recommender_ubcf</span>
<span id="cb557-8"><a href="recommender-systems-and-customer-targeting.html#cb557-8" aria-hidden="true" tabindex="-1"></a>                                ,<span class="at">newdata =</span> <span class="fu">getData</span>(eval_sets, <span class="st">&quot;known&quot;</span>)</span>
<span id="cb557-9"><a href="recommender-systems-and-customer-targeting.html#cb557-9" aria-hidden="true" tabindex="-1"></a>                                ,<span class="at">n =</span> items_to_recommend</span>
<span id="cb557-10"><a href="recommender-systems-and-customer-targeting.html#cb557-10" aria-hidden="true" tabindex="-1"></a>                                ,<span class="at">type =</span> <span class="st">&quot;ratings&quot;</span>)</span>
<span id="cb557-11"><a href="recommender-systems-and-customer-targeting.html#cb557-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb557-12"><a href="recommender-systems-and-customer-targeting.html#cb557-12" aria-hidden="true" tabindex="-1"></a>eval_prediction_svd <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="at">object =</span> recommender_svd</span>
<span id="cb557-13"><a href="recommender-systems-and-customer-targeting.html#cb557-13" aria-hidden="true" tabindex="-1"></a>                               ,<span class="at">newdata =</span> <span class="fu">getData</span>(eval_sets, <span class="st">&quot;known&quot;</span>)</span>
<span id="cb557-14"><a href="recommender-systems-and-customer-targeting.html#cb557-14" aria-hidden="true" tabindex="-1"></a>                               ,<span class="at">n =</span> items_to_recommend</span>
<span id="cb557-15"><a href="recommender-systems-and-customer-targeting.html#cb557-15" aria-hidden="true" tabindex="-1"></a>                               ,<span class="at">type =</span> <span class="st">&quot;ratings&quot;</span>)</span>
<span id="cb557-16"><a href="recommender-systems-and-customer-targeting.html#cb557-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb557-17"><a href="recommender-systems-and-customer-targeting.html#cb557-17" aria-hidden="true" tabindex="-1"></a>eval_prediction_svdf <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="at">object =</span> recommender_svdf</span>
<span id="cb557-18"><a href="recommender-systems-and-customer-targeting.html#cb557-18" aria-hidden="true" tabindex="-1"></a>                                ,<span class="at">newdata =</span> <span class="fu">getData</span>(eval_sets, <span class="st">&quot;known&quot;</span>)</span>
<span id="cb557-19"><a href="recommender-systems-and-customer-targeting.html#cb557-19" aria-hidden="true" tabindex="-1"></a>                                ,<span class="at">n =</span> items_to_recommend</span>
<span id="cb557-20"><a href="recommender-systems-and-customer-targeting.html#cb557-20" aria-hidden="true" tabindex="-1"></a>                                ,<span class="at">type =</span> <span class="st">&quot;ratings&quot;</span>)</span></code></pre></div>
<p>Now we want to compare the different models on the unknown data.</p>
<div class="sourceCode" id="cb558"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb558-1"><a href="recommender-systems-and-customer-targeting.html#cb558-1" aria-hidden="true" tabindex="-1"></a><span class="do">######################RANDOM######################</span></span>
<span id="cb558-2"><a href="recommender-systems-and-customer-targeting.html#cb558-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb558-3"><a href="recommender-systems-and-customer-targeting.html#cb558-3" aria-hidden="true" tabindex="-1"></a><span class="co">#UBCF</span></span>
<span id="cb558-4"><a href="recommender-systems-and-customer-targeting.html#cb558-4" aria-hidden="true" tabindex="-1"></a>eval_accuracy_ubcf <span class="ot">&lt;-</span> <span class="fu">calcPredictionAccuracy</span>(</span>
<span id="cb558-5"><a href="recommender-systems-and-customer-targeting.html#cb558-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> eval_prediction_ubcf, <span class="at">data =</span> <span class="fu">getData</span>(eval_sets, <span class="st">&quot;unknown&quot;</span>), <span class="at">byUser =</span> F)</span>
<span id="cb558-6"><a href="recommender-systems-and-customer-targeting.html#cb558-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb558-7"><a href="recommender-systems-and-customer-targeting.html#cb558-7" aria-hidden="true" tabindex="-1"></a>eval_accuracy_ubcf_user <span class="ot">&lt;-</span> <span class="fu">calcPredictionAccuracy</span>(</span>
<span id="cb558-8"><a href="recommender-systems-and-customer-targeting.html#cb558-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> eval_prediction_ubcf, <span class="at">data =</span> <span class="fu">getData</span>(eval_sets, <span class="st">&quot;unknown&quot;</span>), <span class="at">byUser =</span> <span class="cn">TRUE</span>)</span>
<span id="cb558-9"><a href="recommender-systems-and-customer-targeting.html#cb558-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb558-10"><a href="recommender-systems-and-customer-targeting.html#cb558-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;UBCF&quot;</span>)</span>
<span id="cb558-11"><a href="recommender-systems-and-customer-targeting.html#cb558-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(eval_accuracy_ubcf_user)</span>
<span id="cb558-12"><a href="recommender-systems-and-customer-targeting.html#cb558-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb558-13"><a href="recommender-systems-and-customer-targeting.html#cb558-13" aria-hidden="true" tabindex="-1"></a><span class="co">#IBCF</span></span>
<span id="cb558-14"><a href="recommender-systems-and-customer-targeting.html#cb558-14" aria-hidden="true" tabindex="-1"></a>eval_accuracy_ibcf <span class="ot">&lt;-</span> <span class="fu">calcPredictionAccuracy</span>(</span>
<span id="cb558-15"><a href="recommender-systems-and-customer-targeting.html#cb558-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> eval_prediction_ibcf, <span class="at">data =</span> <span class="fu">getData</span>(eval_sets, <span class="st">&quot;unknown&quot;</span>), <span class="at">byUser =</span> F)</span>
<span id="cb558-16"><a href="recommender-systems-and-customer-targeting.html#cb558-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb558-17"><a href="recommender-systems-and-customer-targeting.html#cb558-17" aria-hidden="true" tabindex="-1"></a>eval_accuracy_ibcf_user <span class="ot">&lt;-</span> <span class="fu">calcPredictionAccuracy</span>(</span>
<span id="cb558-18"><a href="recommender-systems-and-customer-targeting.html#cb558-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> eval_prediction_ibcf, <span class="at">data =</span> <span class="fu">getData</span>(eval_sets, <span class="st">&quot;unknown&quot;</span>), <span class="at">byUser =</span> <span class="cn">TRUE</span>)</span>
<span id="cb558-19"><a href="recommender-systems-and-customer-targeting.html#cb558-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb558-20"><a href="recommender-systems-and-customer-targeting.html#cb558-20" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;IBCF&quot;</span>)</span>
<span id="cb558-21"><a href="recommender-systems-and-customer-targeting.html#cb558-21" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(eval_accuracy_ibcf_user)</span>
<span id="cb558-22"><a href="recommender-systems-and-customer-targeting.html#cb558-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb558-23"><a href="recommender-systems-and-customer-targeting.html#cb558-23" aria-hidden="true" tabindex="-1"></a><span class="co">#SVD</span></span>
<span id="cb558-24"><a href="recommender-systems-and-customer-targeting.html#cb558-24" aria-hidden="true" tabindex="-1"></a>eval_accuracy_svd <span class="ot">&lt;-</span> <span class="fu">calcPredictionAccuracy</span>(</span>
<span id="cb558-25"><a href="recommender-systems-and-customer-targeting.html#cb558-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> eval_prediction_svd, <span class="at">data =</span> <span class="fu">getData</span>(eval_sets, <span class="st">&quot;unknown&quot;</span>), <span class="at">byUser =</span> F)</span>
<span id="cb558-26"><a href="recommender-systems-and-customer-targeting.html#cb558-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb558-27"><a href="recommender-systems-and-customer-targeting.html#cb558-27" aria-hidden="true" tabindex="-1"></a>eval_accuracy_svd_user <span class="ot">&lt;-</span> <span class="fu">calcPredictionAccuracy</span>(</span>
<span id="cb558-28"><a href="recommender-systems-and-customer-targeting.html#cb558-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> eval_prediction_svd, <span class="at">data =</span> <span class="fu">getData</span>(eval_sets, <span class="st">&quot;unknown&quot;</span>), <span class="at">byUser =</span> <span class="cn">TRUE</span>)</span>
<span id="cb558-29"><a href="recommender-systems-and-customer-targeting.html#cb558-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb558-30"><a href="recommender-systems-and-customer-targeting.html#cb558-30" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;SVD&quot;</span>)</span>
<span id="cb558-31"><a href="recommender-systems-and-customer-targeting.html#cb558-31" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(eval_accuracy_svd_user)</span>
<span id="cb558-32"><a href="recommender-systems-and-customer-targeting.html#cb558-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb558-33"><a href="recommender-systems-and-customer-targeting.html#cb558-33" aria-hidden="true" tabindex="-1"></a><span class="co">#SVDF</span></span>
<span id="cb558-34"><a href="recommender-systems-and-customer-targeting.html#cb558-34" aria-hidden="true" tabindex="-1"></a>eval_accuracy_svdf <span class="ot">&lt;-</span> <span class="fu">calcPredictionAccuracy</span>(</span>
<span id="cb558-35"><a href="recommender-systems-and-customer-targeting.html#cb558-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> eval_prediction_svdf, <span class="at">data =</span> <span class="fu">getData</span>(eval_sets, <span class="st">&quot;unknown&quot;</span>), <span class="at">byUser =</span> F)</span>
<span id="cb558-36"><a href="recommender-systems-and-customer-targeting.html#cb558-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb558-37"><a href="recommender-systems-and-customer-targeting.html#cb558-37" aria-hidden="true" tabindex="-1"></a>eval_accuracy_svdf_user <span class="ot">&lt;-</span> <span class="fu">calcPredictionAccuracy</span>(</span>
<span id="cb558-38"><a href="recommender-systems-and-customer-targeting.html#cb558-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> eval_prediction_svdf, <span class="at">data =</span> <span class="fu">getData</span>(eval_sets, <span class="st">&quot;unknown&quot;</span>), <span class="at">byUser =</span> <span class="cn">TRUE</span>)</span>
<span id="cb558-39"><a href="recommender-systems-and-customer-targeting.html#cb558-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb558-40"><a href="recommender-systems-and-customer-targeting.html#cb558-40" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;SVDF&quot;</span>)</span>
<span id="cb558-41"><a href="recommender-systems-and-customer-targeting.html#cb558-41" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(eval_accuracy_svdf_user)</span></code></pre></div>
<pre><code>## [1] &quot;UBCF&quot;
##         RMSE       MSE       MAE
## 5  1.3368297 1.7871136 1.1166378
## 8  1.0496554 1.1017764 0.8630784
## 10 0.6969517 0.4857417 0.5665927
## 24 0.6808052 0.4634957 0.5013154
## 26 0.7600131 0.5776199 0.5963810
## 37 1.1899559 1.4159951 0.9527017
## [1] &quot;IBCF&quot;
##         RMSE       MSE       MAE
## 5  1.7149052 2.9408998 1.4097262
## 8  1.3435709 1.8051829 0.8648377
## 10 0.7288311 0.5311948 0.5706625
## 24 1.0849837 1.1771897 0.7312437
## 26 0.8459852 0.7156910 0.5825797
## 37 1.4891927 2.2176948 1.1190274
## [1] &quot;SVD&quot;
##         RMSE       MSE       MAE
## 5  1.2528478 1.5696277 1.0431439
## 8  1.0341382 1.0694418 0.8087618
## 10 0.5723975 0.3276389 0.5225907
## 24 0.7489073 0.5608622 0.6738023
## 26 0.8562948 0.7332408 0.6644771
## 37 1.0759907 1.1577561 0.9287478
## [1] &quot;SVDF&quot;
##         RMSE       MSE       MAE
## 5  1.1476491 1.3170984 0.9137723
## 8  0.7923530 0.6278232 0.6298550
## 10 0.5562461 0.3094097 0.4909283
## 24 0.6734846 0.4535816 0.5358979
## 26 0.7109840 0.5054983 0.5710451
## 37 1.0980914 1.2058048 0.8323201</code></pre>
<p>We can then assess the RMSE for each model.</p>
<div class="sourceCode" id="cb560"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb560-1"><a href="recommender-systems-and-customer-targeting.html#cb560-1" aria-hidden="true" tabindex="-1"></a>eval_accuracy_ubcf</span>
<span id="cb560-2"><a href="recommender-systems-and-customer-targeting.html#cb560-2" aria-hidden="true" tabindex="-1"></a>eval_accuracy_ibcf</span>
<span id="cb560-3"><a href="recommender-systems-and-customer-targeting.html#cb560-3" aria-hidden="true" tabindex="-1"></a>eval_accuracy_svd</span>
<span id="cb560-4"><a href="recommender-systems-and-customer-targeting.html#cb560-4" aria-hidden="true" tabindex="-1"></a>eval_accuracy_svdf</span></code></pre></div>
<pre><code>##      RMSE       MSE       MAE 
## 1.0437604 1.0894357 0.8148581 
##      RMSE       MSE       MAE 
## 1.2996132 1.6889945 0.9752173 
##      RMSE       MSE       MAE 
## 0.9606769 0.9229001 0.7682577 
##      RMSE       MSE       MAE 
## 0.8972149 0.8049946 0.6967501</code></pre>
<p>We see that the SVDF appear to do the best.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="customer-satisfaction-and-loyalty.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="probabilistic-models-for-customer-analytics.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
